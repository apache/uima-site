<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Apache UIMA™ Development Community">
<title>Apache UIMA™ - Tutorials and User&#8217;s Guides</title>
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Apache UIMA™ - Tutorials and User&#8217;s Guides</h1>
<div class="details">
<span id="author" class="author">Apache UIMA™ Development Community</span><br>
<span id="revnumber">version 3.5.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">UIMA Tutorials and User's Guides</div>
<ul class="sectlevel1">
<li><a href="#ugr.tug.aae">1. Annotator and Analysis Engine Developer&#8217;s Guide</a>
<ul class="sectlevel2">
<li><a href="#ugr.tug.aae.getting_started">1.1. Getting Started</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.aae.defining_types">1.1.1. Defining Types</a></li>
<li><a href="#ugr.tug.aae.generating_jcas_sources">1.1.2. Generating Java Source Files for CAS Types</a></li>
<li><a href="#ugr.tug.aae.developing_annotator_code">1.1.3. Developing Your Annotator Code</a></li>
<li><a href="#ugr.tug.aae.creating_xml_descriptor">1.1.4. Creating the XML Descriptor</a></li>
<li><a href="#ugr.tug.aae.testing_your_annotator">1.1.5. Testing Your Annotator</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aae.configuration_logging">1.2. Configuration and Logging</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.aae.configuration_parameters">1.2.1. Configuration Parameters</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.aae.declaring_parameters_in_the_descriptor">Declaring Parameters in the Descriptor</a></li>
<li><a href="#ugr.tug.aae.accessing_parameter_values_from_annotator">Accessing Parameter Values from the Annotator Code</a></li>
<li><a href="#ugr.tug.aae.supporting_reconfiguration">Supporting Reconfiguration</a></li>
<li><a href="#ugr.tug.aae.configuration_parameter_groups">Configuration Parameter Groups</a></li>
<li><a href="#ugr.tug.aae.configuration_parameter_overrides">Overriding Configuration Parameter Settings</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aae.logging">1.2.2. Logging</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.aae.logging.configuring">Specifying the Logging Configuration when using Java&#8217;s built-in logger</a></li>
<li><a href="#ugr.tug.aae.logging.setting_logging_levels">Setting Logging Levels when using Java&#8217;s built-in logger</a></li>
<li><a href="#ugr.tug.aae.logging.output_format">Configuring the format of logging output when using Java&#8217;s built-in logger</a></li>
<li><a href="#ugr.tug.aae.logging.meaning_of_severity_levels">Meaning of the logging severity levels used by the UIMA logger</a></li>
<li><a href="#ugr.tug.aae.logging.using_outside_of_an_annotator">Using loggers outside of an annotator</a></li>
<li><a href="#ugr.tug.aae.logging.change_logger_implementation">Changing the underlying UIMA logging implementation</a></li>
<li><a href="#_uv3.logging.suppress_annotator_logging">Throttling excessive logging from Annotators</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.aae.building_aggregates">1.3. Building Aggregate Analysis Engines</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.aae.combining_annotators">1.3.1. Combining Annotators</a></li>
<li><a href="#ugr.tug.aae.aaes_can_contain_cas_consumers">1.3.2. AAEs can also contain CAS Consumers</a></li>
<li><a href="#ugr.tug.aae.reading_results_previous_annotators">1.3.3. Reading the Results of Previous Annotators</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aae.other_examples">1.4. Other examples</a></li>
<li><a href="#ugr.tug.aae.additional_topics">1.5. Additional Topics</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.aae.contract_for_annotator_methods">1.5.1. Annotator Methods</a></li>
<li><a href="#ugr.tug.aae.reporting_errors_from_annotators">1.5.2. Reporting errors from Annotators</a></li>
<li><a href="#ugr.tug.aae.throwing_exceptions_from_annotators">1.5.3. Throwing Exceptions from Annotators</a></li>
<li><a href="#ugr.tug.aae.accessing_external_resource_files">1.5.4. Accessing External Resources</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.aae.resources.declaring_dependencies">Declaring Resource Dependencies</a></li>
<li><a href="#ugr.tug.aae.resources.accessing_from_uimacontext">Accessing the Resource from the UimaContext</a></li>
<li><a href="#ugr.tug.aae.resources.declaring_and_bindings">Declaring Resources and Bindings</a></li>
<li><a href="#ugr.tug.aae.resources.sharing_among_annotators">Sharing Resources among Annotators</a></li>
<li><a href="#ugr.tug.aae.resources.threading">Threading and Shared Resources</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aae.result_specification_setting">1.5.5. Result Specifications</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.aae.result_spec.default">Default ResultSpecification</a></li>
<li><a href="#ugr.tug.aae.result_spec.passing_to_annotators">Passing Result Specifications to Annotators</a></li>
<li><a href="#ugr.tug.aae.result_spec.aggregates">Aggregates</a></li>
<li><a href="#ugr.tug.aae.result_spec.aggregates.cpes">Collection Proessing Engines</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aae.classpath_when_using_jcas">1.5.6. Class path setup when using JCas</a></li>
<li><a href="#ugr.tug.aae.using_shell_scripts">1.5.7. Using the Shell Scripts</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aae.common_pitfalls">1.6. Common Pitfalls</a></li>
<li><a href="#ugr.tug.aae.viewing_uima_objects_in_eclipse_debugger">1.7. UIMA Objects in Eclipse Debugger</a></li>
<li><a href="#ugr.tug.aae.xml_intro_ae_descriptor">1.8. Introduction to Analysis Engine Descriptor XML Syntax</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.aae.header_annotator_class_identification">1.8.1. Header and Annotator Class Identification</a></li>
<li><a href="#ugr.tug.aae.xml_intro_simple_metadata_attributes">1.8.2. Simple Metadata Attributes</a></li>
<li><a href="#ugr.tug.aae.xml_intro_type_system_definition">1.8.3. Type System Definition</a></li>
<li><a href="#ugr.tug.aae.xml_intro_capabilities">1.8.4. Capabilities</a></li>
<li><a href="#ugr.tug.aae.xml_intro.configuration_parameters">1.8.5. Configuration Parameters (Optional)</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.aae.xml_intro.configuration_parameters_declarations">Configuration Parameter Declarations</a></li>
<li><a href="#ugr.tug.aae.xml_intro_configuration_parameter_settings">Configuration Parameter Settings</a></li>
<li><a href="#ugr.tug.aae.xml_intro.aggregate">Aggregate Analysis Engine Descriptor</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.cpe">2. Collection Processing Engine Developer&#8217;s Guide</a>
<ul class="sectlevel2">
<li><a href="#ugr.tug.cpe.concepts">2.1. CPE Concepts</a></li>
<li><a href="#ugr.tug.cpe.configurator_and_viewer">2.2. CPE Configurator and CAS viewer</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.cpe.cpe_configurator">2.2.1. Using the CPE Configurator</a></li>
<li><a href="#ugr.tug.cpe.running_cpe_configurator_from_eclipse">2.2.2. Running the CPE Configurator from Eclipse</a></li>
</ul>
</li>
<li><a href="#ugr.tug.cpe.running_cpe_from_application">2.3. Running a CPE from Your Own Java Application</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.cpe.using_listeners">2.3.1. Using Listeners</a></li>
</ul>
</li>
<li><a href="#ugr.tug.cpe.developing_collection_processing_components">2.4. Developing Collection Processing Components</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.cpe.collection_reader.developing">2.4.1. Developing Collection Readers</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.cpe.collection_reader.java_class">Java Class for the Collection Reader</a></li>
<li><a href="#ugr.tug.cpe.collection_reader.required_methods">Required Methods in the Collection Reader class</a>
<ul class="sectlevel5">
<li><a href="#ugr.tug.cpe.collection_reader.required_methods.initialize">initialize()</a></li>
<li><a href="#ugr.tug.cpe.collection_reader.hasnext">hasNext()</a></li>
<li><a href="#ugr.tug.cpe.collection_reader.required_methods.getnext">getNext(CAS)</a></li>
<li><a href="#ugr.tug.cpe.collection_reader.required_methods.getprogress">getProgress()</a></li>
<li><a href="#ugr.tug.cpe.collection_reader.required_methods.close">close()</a></li>
<li><a href="#ugr.tug.cpe.collection_reader.optional_methods">Optional Methods</a>
<ul class="sectlevel6">
<li><a href="#ugr.tug.cpe.collection_reader.optional_methods.reconfigure">reconfigure()</a></li>
<li><a href="#ugr.tug.cpe.collection_reader.optional_methods.typesysteminit">typeSystemInit()</a></li>
</ul>
</li>
<li><a href="#ugr.tug.cpe.collection_reader.threading">Threading considerations</a></li>
<li><a href="#ugr.tug.cpe.collection_reader.descriptor">XML Descriptor for a Collection Reader</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.cpe.cas_initializer.developing">2.4.2. Developing CASInitializers</a></li>
<li><a href="#ugr.tug.cpe.cas_consumer.developing">2.4.3. Developing CASConsumers</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.cpe.cas_consumer.required_methods">Required Methods for a CAS Consumer</a>
<ul class="sectlevel5">
<li><a href="#ugr.tug.cpe.cas_consumer.required_methods.initialize">initialize()</a></li>
<li><a href="#ugr.tug.cpe.cas_consumer.required_methods.processcas">processCas()</a></li>
<li><a href="#ugr.tug.cpe.cas_consumer.optional_methods">Optional Methods</a>
<ul class="sectlevel6">
<li><a href="#ugr.tug.cpe.cas_consumer.optional_methods.batchprocesscomplete">batchProcessComplete()</a></li>
<li><a href="#ugr.tug.cpe.cas_consumer.optional_methods.collectionprocesscomplete">collectionProcessComplete()</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.cpe.deploying_a_cpe">2.5. Deploying a CPE</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.cpe.deployment_alternatives">2.5.1. CPE Deployment alternatives</a></li>
<li><a href="#ugr.tug.cpe.managed_deployment">2.5.2. Deploying Managed CAS Processors</a></li>
<li><a href="#ugr.tug.cpe.deploying_nonmanaged_cas_processors">2.5.3. Deploying Non-managed CAS Processors</a></li>
<li><a href="#ugr.tug.cpe.integrated_deployment">2.5.4. Deploying Integrated CAS Processors</a></li>
</ul>
</li>
<li><a href="#ugr.tug.cpe.collection_processing_examples">2.6. Collection Processing Examples</a></li>
</ul>
</li>
<li><a href="#ugr.tug.application">3. Application Developer&#8217;s Guide</a>
<ul class="sectlevel2">
<li><a href="#ugr.tug.appication.uimaframework_class">3.1. The UIMAFramework Class</a></li>
<li><a href="#ugr.tug.application.using_aes">3.2. Using Analysis Engines</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.application.instantiating_an_ae">3.2.1. Instantiating an Analysis Engine</a></li>
<li><a href="#ugr.tug.application.analyzing_text_documents">3.2.2. Analyzing Text Documents</a></li>
<li><a href="#ugr.tug.applications.analyzing_non_text_artifacts">3.2.3. Analyzing Non-Text Artifacts</a></li>
<li><a href="#ugr.tug.applications.accessing_analysis_results">3.2.4. Accessing Analysis Results</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.applications.accessing_results_using_jcas">Accessing Analysis Results using the JCas</a></li>
<li><a href="#ugr.tug.application.accessing_results_using_cas">Accessing Analysis Results using the CAS</a></li>
</ul>
</li>
<li><a href="#ugr.tug.applications.multi_threaded">3.2.5. Multi-threaded Applications</a></li>
<li><a href="#ugr.tug.application.using_multiple_aes">3.2.6. Using Multiple Analysis Engines and Creating Shared CASes</a></li>
<li><a href="#ugr.tug.application.saving_cases_to_file_systems">3.2.7. Saving CASes to file systems or general Streams</a></li>
</ul>
</li>
<li><a href="#ugr.tug.application.using_cpes">3.3. Using Collection Processing Engines</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.application.running_a_cpe_from_a_descriptor">3.3.1. Running a Collection Processing Engine from a Descriptor</a></li>
<li><a href="#ugr.tug.application.configuring_a_cpe_descriptor_programmatically">3.3.2. Configuring a Collection Processing Engine Descriptor Programmatically</a></li>
</ul>
</li>
<li><a href="#ugr.tug.application.setting_configuration_parameters">3.4. Setting Configuration Parameters</a></li>
<li><a href="#ugr.tug.application.integrating_text_analysis_and_search">3.5. Integrating Text Analysis and Search</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.application.building_an_index">3.5.1. Building an Index</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.application.search.configuring_indexer">Configuring the Semantic Search CAS Indexer</a></li>
<li><a href="#ugr.tug.application.search.cpe_with_semantic_search_cas_consumer">Building and Running a CPE including the Semantic Search CAS Indexer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.application.remote_services">3.6. Working with Remote Services</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.application.how_to_deploy_a_vinci_service">3.6.1. Deploying a UIMA Component as a Vinci Service</a></li>
<li><a href="#ugr.tug.application.how_to_call_a_uima_service">3.6.2. Calling a UIMA Service</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.application.vinci_service_client_descriptor">Vinci Service Client Descriptor</a></li>
</ul>
</li>
<li><a href="#ugr.tug.application.restrictions_on_remotely_deployed_services">3.6.3. Restrictions on remotely deployed services</a></li>
<li><a href="#ugr.tug.application.vns">3.6.4. The Vinci Naming Services (VNS)</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.application.vns.starting">Starting VNS</a></li>
<li><a href="#ugr.tug.application.vns_files">VNS Files</a></li>
<li><a href="#ugr.tug.application.launching_vinci_services">Launching Vinci Services</a></li>
</ul>
</li>
<li><a href="#ugr.tug.configuring_timeout_settings">3.6.5. Configuring Timeout Settings</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.setting_client_timeout">Setting the Client Timeout</a></li>
<li><a href="#ugr.tug.setting_server_socket_timeout">Setting the Server Socket Timeout</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.application.increasing_performance_using_parallelism">3.7. Increasing performance using parallelism</a></li>
<li><a href="#ugr.tug.application.jmx">3.8. Monitoring AE Performance using JMX</a></li>
<li><a href="#_tug.application.pto">3.9. Performance Tuning Options</a></li>
</ul>
</li>
<li><a href="#ugr.tug.fc">4. Flow Controller Developer&#8217;s Guide</a>
<ul class="sectlevel2">
<li><a href="#ugr.tug.fc.developing_fc_code">4.1. Developing the Flow Controller Code</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.fc.fc_interface_overview">4.1.1. Flow Controller Interface Overview</a></li>
<li><a href="#ugr.tug.fc.example_code">4.1.2. Example Code</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.fc.whiteboard">The WhiteboardFlowController Class</a></li>
<li><a href="#ugr.tug.fc.whiteboardflow">The WhiteboardFlow Class</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.fc.creating_fc_descriptor">4.2. Creating the Flow Controller Descriptor</a></li>
<li><a href="#ugr.tug.fc.adding_fc_to_aggregate">4.3. Adding a Flow Controller to an Aggregate Analysis Engine</a></li>
<li><a href="#ugr.tug.fc.adding_fc_to_cpe">4.4. Adding a Flow Controller to a Collection Processing Engine</a></li>
<li><a href="#ugr.tug.fc.using_fc_with_cas_multipliers">4.5. Using Flow Controllers with CAS Multipliers</a></li>
<li><a href="#ugr.tug.fc.continuing_when_exceptions_occur">4.6. Continuing the Flow When Exceptions Occur</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aas">5. Annotations, Artifacts, and Sofas</a>
<ul class="sectlevel2">
<li><a href="#ugr.tug.aas.terminology">5.1. Terminology</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.aas.artifact">5.1.1. Artifact</a></li>
<li><a href="#ugr.tug.aas.sofa">5.1.2. Subject of Analysis — Sofa</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aas.sofa_data_formats">5.2. Formats of Sofa Data</a></li>
<li><a href="#ugr.tug.aas.setting_accessing_sofa_data">5.3. Setting and Accessing Sofa Data</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.aas.setting_sofa_data">5.3.1. Setting Sofa Data</a></li>
<li><a href="#ugr.tug.aas.accessing_sofa_data">5.3.2. Accessing Sofa Data</a></li>
<li><a href="#ugr.tug.aas.accessing_sofa_data_using_java_stream">5.3.3. Accessing Sofa Data using a Java Stream</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aas.sofa_fs">5.4. The Sofa Feature Structure</a></li>
<li><a href="#ugr.tug.aas.annotations">5.5. Annotations</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.aas.built_in_annotation_types">5.5.1. Built-in Annotation types</a></li>
<li><a href="#ugr.tug.aas.annotations_associated_sofa">5.5.2. Annotations have an associated Sofa</a></li>
</ul>
</li>
<li><a href="#ugr.tug.aas.annotationbase">5.6. AnnotationBase</a></li>
</ul>
</li>
<li><a href="#ugr.tug.mvs">6. Multiple CAS Views of an Artifact</a>
<ul class="sectlevel2">
<li><a href="#ugr.tug.mvs.cas_views_and_sofas">6.1. CAS Views and Sofas</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.mvs.naming_views_sofas">6.1.1. Naming CAS Views and Sofas</a></li>
<li><a href="#ugr.tug.mvs.multi_view_and_single_view">6.1.2. Multi-View, Single-View components &amp; applications</a></li>
</ul>
</li>
<li><a href="#ugr.tug.mvs.multi_view_components">6.2. Multi-View Components</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.mvs.deciding_multi_view">6.2.1. How UIMA decides if a component is Multi-View</a></li>
<li><a href="#ugr.tug.mvs.additional_capabilities">6.2.2. Multi-View: additional capabilities</a></li>
<li><a href="#ugr.tug.mvs.component_xml_metadata">6.2.3. Component XML metadata</a></li>
</ul>
</li>
<li><a href="#ugr.tug.mvs.sofa_capabilities_and_apis_for_apps">6.3. Sofa Capabilities and APIs for Applications</a></li>
<li><a href="#ugr.tug.mvs.sofa_name_mapping">6.4. Sofa Name Mapping</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.mvs.name_mapping_aggregate">6.4.1. Name Mapping in an Aggregate Descriptor</a></li>
<li><a href="#ugr.tug.mvs.name_mapping_cpe">6.4.2. Name Mapping in a CPEDescriptor</a></li>
<li><a href="#ugr.tug.mvs.specifying_cas_view_for_process">6.4.3. Specifying the CAS View delivered to a Components Process Method</a></li>
<li><a href="#ugr.tug.mvs.name_mapping_application">6.4.4. Name Mapping in a UIMA Application</a></li>
<li><a href="#ugr.tug.mvs.name_mapping_remote_services">6.4.5. Name Mapping for Remote Services</a></li>
</ul>
</li>
<li><a href="#ugr.tug.mvs.jcas_extensions_for_multi_views">6.5. JCas extensions for Multiple Views</a></li>
<li><a href="#ugr.tug.mvs.sample_application">6.6. Sample Multi-View Application</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.mvs.sample_application.descriptor">6.6.1. Annotator Descriptor</a></li>
<li><a href="#ugr.tug.mvs.sample_application.setup">6.6.2. Application Setup</a></li>
<li><a href="#ugr.tug.mvs.sample_application.annotator_processing">6.6.3. Annotator Processing</a></li>
<li><a href="#ugr.tug.mvs.sample_application.accessing_results">6.6.4. Accessing the results of analysis</a></li>
</ul>
</li>
<li><a href="#ugr.tug.mvs.views_api_summary">6.7. Views API Summary</a></li>
</ul>
</li>
<li><a href="#ugr.tug.cm">7. CAS Multiplier Developer&#8217;s Guide</a>
<ul class="sectlevel2">
<li><a href="#ugr.tug.cm.developing_multiplier_code">7.1. Developing the CAS Multiplier Code</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.cm.cm_interface_overview">7.1.1. CAS Multiplier Interface Overview</a></li>
<li><a href="#ugr.tug.cm.how_to_get_empty_cas_instance">7.1.2. How to Get an Empty CAS Instance</a></li>
<li><a href="#ugr.tug.cm.example_code">7.1.3. Example Code</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.cm.example_code.overall_structure">Overall Structure</a></li>
<li><a href="#ugr.tug.cm.example_code.initialize">Initialize Method</a></li>
<li><a href="#ugr.tug.cm.example_code.process">Process Method</a></li>
<li><a href="#ugr.tug.cm.example_code.hasnext">HasNext Method</a></li>
<li><a href="#ugr.tug.cm.example_code.next">Next Method</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.cm.creating_cm_descriptor">7.2. Creating the CAS Multiplier Descriptor</a></li>
<li><a href="#ugr.tug.cm.using_cm_in_aae">7.3. Using a CAS Multiplier in an Aggregate Analysis Engine</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.cm.adding_cm_to_aggregate">7.3.1. Adding the CAS Multiplier to the Aggregate</a></li>
<li><a href="#ugr.tug.cm.cm_and_fc">7.3.2. CAS Multipliers and Flow Control</a></li>
<li><a href="#ugr.tug.cm.aggregate_cms">7.3.3. Aggregate CAS Multipliers</a></li>
</ul>
</li>
<li><a href="#ugr.tug.cm.using_cm_in_cpe">7.4. Using a CAS Multiplier in a Collection Processing Engine</a></li>
<li><a href="#ugr.tug.cm.calling_cm_from_app">7.5. Calling a CAS Multiplier from an Application</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.cm.retrieving_output_cases">7.5.1. Retrieving Output CASes from the CAS Multiplier</a></li>
<li><a href="#ugr.tug.cm.using_cm_with_other_aes">7.5.2. Using a CAS Multiplier with other Analysis Engines</a></li>
</ul>
</li>
<li><a href="#ugr.tug.cm.using_cm_to_merge_cases">7.6. Using a CAS Multiplier to Merge CASes</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.cm.overview_of_how_to_merge_cases">7.6.1. Overview of How to Merge CASes</a></li>
<li><a href="#ugr.tug.cm.example_cas_merger">7.6.2. Example CAS Merger</a>
<ul class="sectlevel4">
<li><a href="#ugr.tug.cm.example_cas_merger.process">Process Method</a></li>
<li><a href="#ugr.tug.cm.example_cas_merger.hasnext_and_next">HasNext and Next Methods</a></li>
</ul>
</li>
<li><a href="#ugr.tug.cm.using_the_simple_text_merger_in_an_aggregate_ae">7.6.3. Using the SimpleTextMerger in an Aggregate Analysis Engine</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.xmi_emf">8. XMI and EMF Interoperability</a>
<ul class="sectlevel2">
<li><a href="#ugr.tug.xmi_emf.overview">8.1. Overview</a></li>
<li><a href="#ugr.tug.xmi_emf.converting_ecore_to_from_uima_type_system">8.2. Converting an Ecore Model to or from a UIMA Type System</a></li>
<li><a href="#ugr.tug.xmi_emf.using_xmi_cas_serialization">8.3. Using XMI CAS Serialization</a>
<ul class="sectlevel3">
<li><a href="#ugr.tug.xmi_emf.xml_character_issues">8.3.1. Character Encoding Issues with XML Serialization</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.tug.type_mapping">9. Managing different Type Systems</a>
<ul class="sectlevel2">
<li><a href="#ugr.tug.type_mapping.type_merging">9.1. Annotators, Type Merging, and Remotes</a></li>
<li><a href="#ugr.tug.type_mapping.remote_support">9.2. Supporting Remote Annotators</a></li>
<li><a href="#ugr.tug.type_mapping.allowed_differences">9.3. Type filtering support in Binary Compressed Serialization/Deserialization</a></li>
<li><a href="#ugr.tug.type_mapping.compressed">9.4. Remote Services support with Compressed Binary Serialization</a></li>
<li><a href="#ugr.tug.type_filtering.compressed_file">9.5. Compressed Binary serialization to/from files</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Copyright © 2006, 2021 The Apache Software Foundation</p>
</div>
<div class="paragraph">
<p>Copyright © 2004, 2006 International Business Machines Corporation</p>
</div>
<h4 id="_license_and_disclaimer" class="discrete">License and Disclaimer</h4>
<div class="paragraph">
<p>The ASF licenses this documentation to you under the Apache License, Version 2.0 (the "License");
you may not use this documentation except in compliance with the License.  You may obtain a copy of
the License at</p>
</div>
<div class="paragraph text-center">
<p><a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a></p>
</div>
<div class="paragraph">
<p>Unless required by applicable law or agreed to in writing, this documentation and its contents are
distributed under the License on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied.  See the License for the specific language governing permissions and
limitations under the License.</p>
</div>
<h4 id="_trademarks" class="discrete">Trademarks</h4>
<div class="paragraph">
<p>All terms mentioned in the text that are known to be trademarks or service marks have been
appropriately capitalized.  Use of such terms in this book should not be regarded as affecting the
validity of the the trademark or service mark.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.tug.aae"><a class="anchor" href="#ugr.tug.aae"></a>1. Annotator and Analysis Engine Developer&#8217;s Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to develop UIMA <em>type systems</em>, <em>Annotators</em> and <em>Analysis Engines</em> using the UIMA SDK.
It is helpful to read the UIMA Conceptual Overview chapter for a review on these concepts.</p>
</div>
<div class="paragraph">
<p>An <em>Analysis Engine (AE)</em> is a program that analyzes artifacts (e.g.
documents) and infers information from them.</p>
</div>
<div class="paragraph">
<p>Analysis Engines are constructed from building blocks called <em>Annotators</em>.
An annotator is a component that contains analysis logic.
Annotators analyze an artifact (for example, a text document) and create additional data (metadata) about that artifact.
It is a goal of UIMA that annotators need not be concerned with anything other than their analysis logic – for example the details of their deployment or their interaction with other annotators.</p>
</div>
<div class="paragraph">
<p>An Analysis Engine (AE) may contain a single annotator (this is referred to as a <em>Primitive AE)</em>, or it may be a composition of others and therefore contain multiple annotators (this is referred to as an <em>Aggregate
    AE</em>). Primitive and aggregate AEs implement the same interface and can be used interchangeably by applications.</p>
</div>
<div class="paragraph">
<p>Annotators produce their analysis results in the form of typed <em>Feature Structures</em>, which are simply data structures that have a type and a set of (attribute, value) pairs.
An <em>annotation</em> is a particular type of Feature Structure that is attached to a region of the artifact being analyzed (a span of text in a document, for example).</p>
</div>
<div class="paragraph">
<p>For example, an annotator may produce an Annotation over the span of text <code>President Bush</code>, where the type of the Annotation is <code>Person</code> and the attribute <code>fullName</code> has the value <code>George W. Bush</code>, and its position in the artifact is character position 12 through character position 26.</p>
</div>
<div class="paragraph">
<p>It is also possible for annotators to record information associated with the entire document rather than a particular span (these are considered Feature Structures but not Annotations).</p>
</div>
<div class="paragraph">
<p>All feature structures, including annotations, are represented in the UIMA <em>Common Analysis Structure(CAS)</em>.
The CAS is the central data structure through which all UIMA components communicate.
Included with the UIMA SDK is an easy-to-use, native Java interface to the CAS called the <em>JCas</em>.
The JCas represents each feature structure as a Java object; the example feature structure from the previous paragraph would be an instance of a Java class Person with getFullName() and setFullName() methods.</p>
</div>
<div class="paragraph">
<p>The CAS interface for accessing feature structures uses UIMA Type an Feature object instances, which are computed at run time, depending on the type system being used.
This interface supports writing general annotators which can work for all type systems.
It is used, for example, internally, in the CasCopier implementation, to copy the content of one CAS to another.</p>
</div>
<div class="paragraph">
<p>The JCas interface can take advantage of knowing ahead of time the particular Types and Features a pipeline is using.
The JCas Classes correspond to a particular UIMA type, and the class includes  special setters and getters whose names match the features.</p>
</div>
<div class="paragraph">
<p>The remainder of this chapter will refer to the analysis of text documents and the creation of annotations that are attached to spans of text in those documents.
Keep in mind that the CAS can represent arbitrary types of feature structures, and feature structures can refer to other feature structures.
For example, you can use the CAS to represent a parse tree for a document.
Also, the artifact that you are analyzing need not be a text document.</p>
</div>
<div class="paragraph">
<p>This guide is organized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em><a href="#ugr.tug.aae.getting_started">Section 1.1</a></em> is a tutorial with step-by-step instructions for how to develop and test a simple UIMA annotator.</p>
</li>
<li>
<p><em><a href="#ugr.tug.aae.configuration_logging">Section 1.2</a></em> discusses how to make your UIMA annotator configurable, and how it can write messages to the UIMA log file.</p>
</li>
<li>
<p><em><a href="#ugr.tug.aae.building_aggregates">Section 1.3</a></em> describes how annotators can be combined into aggregate analysis engines. It also describes how one annotator can make use of the analysis results produced by an annotator that has run previously.</p>
</li>
<li>
<p><em><a href="#ugr.tug.aae.other_examples">Section 1.4</a></em> describes several other examples you may find interesting, including</p>
<div class="ulist">
<ul>
<li>
<p><code>SimpleTokenAndSentenceAnnotator</code>: a simple tokenizer and sentence annotator.</p>
</li>
<li>
<p><code>PersonTitleDBWriterCasConsumer</code>: a sample CAS Consumer which populates a relational database with some annotations. It uses JDBC and in this example, hooks up with the Open Source Apache Derby database.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em><a href="#ugr.tug.aae.additional_topics">Section 1.5</a></em> describes additional features of the UIMA SDK that may help you in building your own annotators and analysis engines.</p>
</li>
<li>
<p><em><a href="#ugr.tug.aae.common_pitfalls">Section 1.6</a></em> contains some useful guidelines to help you ensure that your annotators will work correctly in any UIMA application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This guide does not discuss how to build <a href="#ugr.tug.application">UIMA Applications</a>, which are programs that use Analysis Engines, along with other components, e.g. a search engine, document store, and user interface, to deliver a complete package of functionality to an end-user.</p>
</div>
<div class="sect2">
<h3 id="ugr.tug.aae.getting_started"><a class="anchor" href="#ugr.tug.aae.getting_started"></a>1.1. Getting Started</h3>
<div class="paragraph">
<p>This section is a step-by-step tutorial that will get you started developing UIMA annotators.
All of the files referred to by the examples in this chapter are in the <code>examples</code> directory of the UIMA SDK.
This directory is designed to be <a href="oas.html#ugr.ovv.eclipse_setup.example_code">imported</a> into your Eclipse workspace.
See for how to attach the UIMA Javadocs to the jar files.
Also you may wish to <a href="oas.html#ugr.ovv.eclipse_setup.linking_uima_javadocs">attach the UIMA Javadocs to the JAR files</a> or refer to the UIMA SDK Javadocs located in the <a href="api/index.html">docs/api/index.html</a> directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you hover over a UIMA class or method defined in the UIMA SDK Javadocs, the Javadocs appear after a short delay.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you downloaded the source distribution for UIMA, you can <a href="ref.html#ugr.ref.javadocs">attach that as well to the library JAR files[</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example annotator that we are going to walk through will detect room numbers for rooms where the room numbering scheme follows some simple conventions.
In our example, there are two kinds of patterns we want to find; here are some examples, together with their corresponding regular expression patterns:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Yorktown patterns</dt>
<dd>
<p>20-001, 31-206, 04-123 (Regular Expression Pattern: <code>##-[0-2]##</code>)</p>
</dd>
<dt class="hdlist1">Hawthorne patterns</dt>
<dd>
<p>GN-K35, 1S-L07, 4N-B21 (Regular Expression Pattern: <code>[G1-4][NS]-[A-Z]##</code>)</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There are several steps to develop and test a simple UIMA annotator.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define the CAS types that the annotator will use.</p>
</li>
<li>
<p>Generate the Java classes for these types.</p>
</li>
<li>
<p>Write the actual annotator Java code.</p>
</li>
<li>
<p>Create the Analysis Engine descriptor.</p>
</li>
<li>
<p>Test the annotator.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These steps are discussed in the next sections.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.defining_types"><a class="anchor" href="#ugr.tug.aae.defining_types"></a>1.1.1. Defining Types</h4>
<div class="paragraph">
<p>The first step in developing an annotator is to define the CAS Feature Structure types that it creates.
This is done in an XML file called a <em>Type System
        Descriptor</em>.
UIMA defines basic primitive types such as Boolean, Byte, Short, Integer, Long, Float, and Double, as well as Arrays of these primitive types.
UIMA also defines the built-in types <code>TOP</code>, which is the root  of the type system, analogous to Object in Java; <code>FSArray</code>, which is  an array of Feature Structures (i.e.
an array of instances of TOP); and <code>Annotation</code>, which we will discuss in more detail in this section.</p>
</div>
<div class="paragraph">
<p>UIMA includes an <a href="oas.html#ugr.ovv.eclipse_setup">Eclipse plug-in</a> that will help you edit Type System Descriptors, so if you are using Eclipse you will not need to worry about the details of the XML syntax.</p>
</div>
<div class="paragraph">
<p>The Type System Descriptor for our annotator is located in the file <code>descriptors/tutorial/ex1/TutorialTypeSystem.xml.</code>
This and all other examples are located in the <code>examples</code> directory of the installation of the UIMA SDK, which can be <a href="oas.html#ugr.ovv.eclipse_setup.example_code">imported</a> into an Eclipse project for your convenience.</p>
</div>
<div class="paragraph">
<p>In Eclipse, expand the <code>uimaj-examples</code> project in the Package Explorer view, and browse to the file <code>descriptors/tutorial/ex1/TutorialTypeSystem.xml</code>.
Right-click on the file in the navigator and select <em>Open With → Component Descriptor Editor</em>.
Once the editor opens, click on the <em>Type System</em> tab at the bottom of the editor window.
You should see a view such as the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image002.jpg" alt="image002">
</div>
<div class="title">Figure 1. Screenshot of editor for Type System Definitions</div>
</div>
<div class="paragraph">
<p>Our annotator will need only one type&#8201;&#8212;&#8201;<code>org.apache.uima.tutorial.RoomNumber</code>.
(We use the same namespace conventions as are used for Java classes.) Just as in Java, types have supertypes.
The supertype is listed in the second column of the left table.
In this case our RoomNumber annotation extends from the built-in type <code>uima.tcas.Annotation</code>.</p>
</div>
<div class="paragraph">
<p>Descriptions can be included with types and features.
In this example, there is a description associated with the <code>building</code> feature.
To see it, hover the mouse over the feature.</p>
</div>
<div class="paragraph">
<p>The bottom tab labeled <em>Source</em> will show you the XML source file associated with this descriptor.</p>
</div>
<div class="paragraph">
<p>The built-in Annotation type declares three fields (called <em>Features</em> in CAS terminology).  The features <code>begin</code> and <code>end</code> store the character offsets of the span of text to which the  annotation refers.
The feature <code>sofa</code> (Subject of Analysis) indicates which document the begin and end offsets point into.
The <code>sofa</code> feature can be ignored for now since we assume in this tutorial that the CAS contains only one subject of analysis (document).</p>
</div>
<div class="paragraph">
<p>Our RoomNumber type will inherit these three features from <code>uima.tcas.Annotation</code>, its supertype; they are not visible in this view because inherited features are not shown.
One additional feature, <code>building</code>, is declared.
It takes a String as its value.
Instead of String, we could have declared the range-type of our feature to be any other CAS type (defined or built-in).</p>
</div>
<div class="paragraph">
<p>If you are not using Eclipse, if you need to edit the type system, do so using any XML or text editor, directly.
The following is the actual XML representation of the Type System displayed above in the editor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
  &lt;typeSystemDescription xmlns="http://uima.apache.org/resourceSpecifier"&gt;
    &lt;name&gt;TutorialTypeSystem&lt;/name&gt;
    &lt;description&gt;Type System Definition for the tutorial examples -
        as of Exercise 1&lt;/description&gt;
    &lt;vendor&gt;Apache Software Foundation&lt;/vendor&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;types&gt;
      &lt;typeDescription&gt;
        &lt;name&gt;org.apache.uima.tutorial.RoomNumber&lt;/name&gt;
        &lt;description&gt;&lt;/description&gt;
        &lt;supertypeName&gt;uima.tcas.Annotation&lt;/supertypeName&gt;
        &lt;features&gt;
          &lt;featureDescription&gt;
            &lt;name&gt;building&lt;/name&gt;
            &lt;description&gt;Building containing this room&lt;/description&gt;
            &lt;rangeTypeName&gt;uima.cas.String&lt;/rangeTypeName&gt;
          &lt;/featureDescription&gt;
        &lt;/features&gt;
      &lt;/typeDescription&gt;
    &lt;/types&gt;
  &lt;/typeSystemDescription&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.generating_jcas_sources"><a class="anchor" href="#ugr.tug.aae.generating_jcas_sources"></a>1.1.2. Generating Java Source Files for CAS Types</h4>
<div class="paragraph">
<p>When you save a descriptor that you have modified, the Component Descriptor Editor will automatically generate Java classes corresponding to the types that are defined in that descriptor (unless this has been disabled), using a utility called JCasGen.
These Java classes will have the same name (including package) as the CAS types, and will have get and set methods for each of the features that you have defined.</p>
</div>
<div class="paragraph">
<p>This feature is enabled/disabled using the UIMA menu pulldown (or the Eclipse Preferences →UIMA). If automatic running of JCasGen is not happening, please make sure the option is checked:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image004.jpg" alt="image004">
</div>
<div class="title">Figure 2. Screenshot of enabling automatic running of JCasGen</div>
</div>
<div class="paragraph">
<p>The Java class for the example org.apache.uima.tutorial.RoomNumber type can be found in <code>src/org/apache/uima/tutorial/RoomNumber.java</code> . You will see how to use these generated classes in the next section.</p>
</div>
<div class="paragraph">
<p>If you are not using the Component Descriptor Editor, you will need to generate these Java classes by using the <em>JCasGen</em> tool.
JCasGen reads a Type System Descriptor XML file and generates the corresponding Java classes that you can then use in your annotator code.
To launch JCasGen, run the jcasgen shell script located in the <code>/bin</code> directory of the UIMA SDK installation.
This should launch a GUI that looks something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image006.jpg" alt="image006">
</div>
<div class="title">Figure 3. Screenshot of JCasGen</div>
</div>
<div class="paragraph">
<p>Use the &#8220;Browse&#8221; buttons to select your input file (<code>TutorialTypeSystem.xml</code>) and output directory (the root of the source tree into which you want the generated files placed). Then click the <em>Go</em> button.
If the Type System Descriptor has no errors, new Java source files will be generated under the specified output directory.</p>
</div>
<div class="paragraph">
<p>There are some <a href="tools.html#ugr.tools.jcasgen">additional options</a> to choose from when running JCasGen.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.developing_annotator_code"><a class="anchor" href="#ugr.tug.aae.developing_annotator_code"></a>1.1.3. Developing Your Annotator Code</h4>
<div class="paragraph">
<p>Annotator implementations all implement a standard interface (AnalysisComponent), having several methods, the most important of which are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initialize</code>,</p>
</li>
<li>
<p><code>process</code>, and</p>
</li>
<li>
<p><code>destroy</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>initialize</code> is called by the framework once when it first creates an instance of the annotator class. <code>process</code> is called once per item being processed. <code>destroy</code> may be called by the application when it is done using your annotator.
There is a  default implementation of this interface for annotators using the JCas, called <code>JCasAnnotator_ImplBase</code>, which  has implementations of all required methods except for the process method.</p>
</div>
<div class="paragraph">
<p>Our annotator class extends the <a href="#ugr.tug.aas">JCasAnnotator_ImplBase</a>; most annotators that use the JCas will extend from this class, so they only have to implement the process method. This class is not restricted to handling just text.</p>
</div>
<div class="paragraph">
<p>Annotators are not required to extend from the JCasAnnotator_ImplBase class; they may instead directly implement the AnalysisComponent interface, and provide all method implementations themselves.
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> This allows you to have your annotator inherit from some other superclass if necessary.
If you would like to do this, see the Javadocs for <code>JCasAnnotator</code> for descriptions of the methods you must implement.</p>
</div>
<div class="paragraph">
<p>Annotator classes need to be public, cannot be declared abstract, and must have public, no-args constructors, so that they can be instantiated by the framework.
<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> .</p>
</div>
<div class="paragraph">
<p>The class definition for our RoomNumberAnnotator implements the process method, and is shown here.
You can find the source for this in the <code>uimaj-examples/src/org/apache/uima/tutorial/ex1/RoomNumberAnnotator.java</code> .</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In Eclipse, in the &#8220;Package Explorer&#8221; view, this will appear by default in the project <code>uimaj-examples</code>, in the folder <code>src</code>, in the package <code>org.apache.uima.tutorial.ex1</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In Eclipse, open the RoomNumberAnnotator.java in the uimaj-examples project, under the src directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>package org.apache.uima.tutorial.ex1;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

import org.apache.uima.analysis_component.JCasAnnotator_ImplBase;
import org.apache.uima.jcas.JCas;
import org.apache.uima.tutorial.RoomNumber;

/**
 * Example annotator that detects room numbers using
 * Java 1.4 regular expressions.
 */
public class RoomNumberAnnotator extends JCasAnnotator_ImplBase {
  private Pattern mYorktownPattern =
        Pattern.compile("\\b[0-4]\\d-[0-2]\\d\\d\\b");

  private Pattern mHawthornePattern =
        Pattern.compile("\\b[G1-4][NS]-[A-Z]\\d\\d\\b");

  public void process(JCas aJCas) {
    // Discussed Later
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two Java class fields, mYorktownPattern and mHawthornePattern, hold regular expressions that will be used in the process method.
Note that these two fields are part of the Java implementation of the annotator code, and not a part of the CAS type system.
We are using the regular expression facility that is built into Java 1.4.
It is not critical that you know the details of how this works, but if you are curious the details can be found in the Java API docs for the java.util.regex package.</p>
</div>
<div class="paragraph">
<p>The only method that we are required to implement is <code>process</code>.
This method is typically  called once for each document that is being analyzed.
This method takes one argument, which is a JCas instance;  this holds the document to be analyzed and all of the analysis results. <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void process(JCas aJCas) {
  // get document text
  String docText = aJCas.getDocumentText();
  // search for Yorktown room numbers
  Matcher m = mYorktownPattern.matcher(docText);
  int pos = 0;
  while (m.find(pos)) {
    // found one - create annotation, with the begin/end positions
    RoomNumber annotation = new RoomNumber(aJCas, m.start(), m.end());
    annotation.setBuilding("Yorktown");
    annotation.addToIndexes();
    pos = m.end();
  }

  // search for Hawthorne room numbers
  m = mHawthornePattern.matcher(docText);
  pos = 0;
  while (m.find(pos)) {
    // found one - create annotation, with the begin/end positions
    RoomNumber annotation = new RoomNumber(aJCas, m.start(), m.end());
    annotation.setBuilding("Hawthorne");
    annotation.addToIndexes();
    pos = m.end();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Matcher class is part of the java.util.regex package and is used to find the room numbers in the document text.
When we find one, recording the annotation is as simple as creating a new Java object and calling some set methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>RoomNumber annotation = new RoomNumber(aJCas, m.start(), m.end());
annotation.setBuilding("Yorktown");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>RoomNumber</code> class was generated from the type system description by the Component Descriptor Editor or the JCasGen tool, as discussed in the previous section.</p>
</div>
<div class="paragraph">
<p>Finally, we call <code>annotation.addToIndexes()</code> to add the new annotation to the indexes maintained in the CAS.
By default, the CAS implementation used for analysis of text documents keeps an index of all annotations in their order from beginning to end of the document.
Subsequent annotators or applications use the indexes to iterate over the annotations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you don&#8217;t add the instance to the indexes, it cannot be retrieved by down-stream annotators, using the indexes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can also call <code>addToIndexes()</code> on Feature Structures that are not subtypes of <code>uima.tcas.Annotation</code>, but these will not be sorted in any particular way.
If you want to specify a sort order, you can define your own <a href="ref.html#ugr.ref.xml.component_descriptor.aes.index">custom indexes</a> in the <a href="ref.html#ugr.ref.cas">CAS</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We&#8217;re almost ready to test the RoomNumberAnnotator.
There is just one more step remaining.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.creating_xml_descriptor"><a class="anchor" href="#ugr.tug.aae.creating_xml_descriptor"></a>1.1.4. Creating the XML Descriptor</h4>
<div class="paragraph">
<p>The UIMA architecture requires that descriptive information about an annotator be represented in an XML file and provided along with the annotator class file(s) to the UIMA framework at run time.
This XML file is called an <em>Analysis Engine Descriptor</em>.
The descriptor includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name, description, version, and vendor</p>
</li>
<li>
<p>The annotator&#8217;s inputs and outputs, defined in terms of the types in a Type System Descriptor</p>
</li>
<li>
<p>Declaration of the configuration parameters that the annotator accepts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>Component Descriptor Editor</em> plugin, which we previously used to edit the Type System descriptor, can also be used to edit Analysis Engine Descriptors.</p>
</div>
<div class="paragraph">
<p>A descriptor for our RoomNumberAnnotator is provided with the UIMA distribution under the name <code>descriptors/tutorial/ex1/RoomNumberAnnotator.xml.</code> To edit it in Eclipse, right-click on that file in the navigator and select Open With → Component Descriptor Editor.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>In Eclipse, you can double click on the tab at the top of the Component Descriptor Editor&#8217;s window identifying the currently selected editor, and the window will &#8220;Maximize&#8221;.
Double click it again to restore the original size.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are not using Eclipse, you will need to edit Analysis Engine descriptors manually.
See <a href="#ugr.tug.aae.xml_intro_ae_descriptor">Section 1.8</a> for an introduction to the Analysis Engine descriptor XML syntax.
The remainder of this section assumes you are using the Component Descriptor Editor plug-in to edit the Analysis Engine descriptor.</p>
</div>
<div class="paragraph">
<p>The <a href="tools.html#ugr.tools.cde">Component Descriptor Editor</a> consists of several tabbed pages; we will only need to use a few of them here.</p>
</div>
<div class="paragraph">
<p>The initial page of the Component Descriptor Editor is the Overview page, which appears as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image008.jpg" alt="image008">
</div>
<div class="title">Figure 4. Screenshot of Component Descriptor Editor overview page</div>
</div>
<div class="paragraph">
<p>This presents an overview of the RoomNumberAnnotator Analysis Engine (AE). The left side of the page shows that this descriptor is for a <em>Primitive</em> AE (meaning it consists of a single annotator), and that the annotator code is developed in Java.
Also, it specifies the Java class that implements our logic (the code which was discussed in the previous section). Finally, on the right side of the page are listed some descriptive attributes of our annotator.</p>
</div>
<div class="paragraph">
<p>The other two pages that need to be filled out are the Type System page and the Capabilities page.
You can switch to these pages using the tabs at the bottom of the Component Descriptor Editor.
In the tutorial, these are already filled out for you.</p>
</div>
<div class="paragraph">
<p>The RoomNumberAnnotator will be using the TutorialTypeSystem we looked at in Section <a href="#ugr.tug.aae.defining_types">Section 1.1.1</a>.
To specify this, we add this type system to the Analysis Engine&#8217;s list of Imported Type Systems, using the Type System page&#8217;s right side panel, as shown here:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image010.jpg" alt="image010">
</div>
<div class="title">Figure 5. Screenshot of CDE Type System page</div>
</div>
<div class="paragraph">
<p>On the Capabilities page, we define our annotator&#8217;s inputs and outputs, in terms of the types in the type system.
The Capabilities page is shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image012.jpg" alt="image012">
</div>
<div class="title">Figure 6. Screenshot of CDE Capabilities page</div>
</div>
<div class="paragraph">
<p>Although capabilities come in sets, having multiple sets is deprecated; here we&#8217;re just using one set.
The RoomNumberAnnotator is very simple.
It requires no input types, as it operates directly on the document text&#8201;&#8212;&#8201;which is supplied as a part of the CAS initialization (and which is always assumed to be present). It produces only one output type (RoomNumber), and it sets the value of the <code>building</code> feature on that type.
This is all represented on the Capabilities page.</p>
</div>
<div class="paragraph">
<p>The Capabilities page has two other parts for specifying languages and Sofas.
The languages section allows you to specify which languages your Analysis Engine supports.
The RoomNumberAnnotator happens to be language-independent, so we can leave this blank.
The Sofas section allows you to specify the names of additional subjects of analysis.
This capability and the Sofa Mappings at the bottom are <a href="#ugr.tug.aas">advanced topics</a>.</p>
</div>
<div class="paragraph">
<p>This is all of the information we need to provide for a simple annotator.
If you want to peek at the XML that this tool saves you from having to write, click on the &#8220;Source&#8221; tab at the bottom to view the generated XML.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.testing_your_annotator"><a class="anchor" href="#ugr.tug.aae.testing_your_annotator"></a>1.1.5. Testing Your Annotator</h4>
<div class="paragraph">
<p>Having developed an annotator, we need a way to try it out on some example documents.
The UIMA SDK includes a tool called the Document Analyzer that will allow us to do this.
To run the Document Analyzer, execute the documentAnalyzer shell script that is in the <code>bin</code> directory of your UIMA SDK installation, or, if you are using the example Eclipse project, execute the &#8220;UIMA Document Analyzer&#8221; run configuration supplied with that project.
(To do this, click on the menu bar Run → Run &#8230;&#8203; → and under Java Applications in the left box, click on UIMA Document Analyzer.)</p>
</div>
<div class="paragraph">
<p>You should see a screen that looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image014.jpg" alt="image014">
</div>
<div class="title">Figure 7. Screenshot of UIMA Document Analyzer GUI</div>
</div>
<div class="paragraph">
<p>There are six options on this screen:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Directory containing documents to analyze</p>
</li>
<li>
<p>Directory where analysis results will be written</p>
</li>
<li>
<p>The XML descriptor for the Analysis Engine (AE) you want to run</p>
</li>
<li>
<p>(Optional) an XML tag, within the input documents, that contains the text to be analyzed. For example, the value TEXT would cause the AE to only analyze the portion of the document enclosed within &lt;TEXT&gt;&#8230;&#8203;&lt;/TEXT&gt; tags.</p>
</li>
<li>
<p>Language of the document</p>
</li>
<li>
<p>Character encoding</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Use the Browse button next to the third item to set the &#8220;Location of AE XML
        Descriptor&#8221; field to the descriptor we&#8217;ve just been discussing —<code>&lt;where-you-installed-uima-e.g.UIMA_HOME&gt;
          /examples/descriptors/tutorial/ex1/RoomNumberAnnotator.xml</code> . Set the other fields to the values shown in the screen shot above (which should be the default values if this is the first time you&#8217;ve run the Document Analyzer). Then click the &#8220;Run&#8221; button to start processing.</p>
</div>
<div class="paragraph">
<p>When processing completes, an &#8220;Analysis Results&#8221; window should appear.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image016.jpg" alt="image016">
</div>
<div class="title">Figure 8. Screenshot of UIMA Document Analyzer Results GUI</div>
</div>
<div class="paragraph">
<p>Make sure &#8220;Java Viewer&#8221; is selected as the Results Display Format, and <strong>double-click</strong> on the document UIMASummerSchool2003.txt to view the annotations that were discovered.
The view should look something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image018.jpg" alt="image018">
</div>
<div class="title">Figure 9. Screenshot of UIMA CAS Annotation Viewer GUI</div>
</div>
<div class="paragraph">
<p>You can click the mouse on one of the highlighted annotations to see a list of all its features in the frame on the right.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The legend will only show those types which have at least one instance in the CAS, and are declared as outputs in the capabilities section of the descriptor (see <a href="#ugr.tug.aae.creating_xml_descriptor">Section 1.1.4</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the DocumentAnalyzer to test any UIMA annotator —just make sure that the annotator&#8217;s classes are in the class path.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aae.configuration_logging"><a class="anchor" href="#ugr.tug.aae.configuration_logging"></a>1.2. Configuration and Logging</h3>
<div class="sect3">
<h4 id="ugr.tug.aae.configuration_parameters"><a class="anchor" href="#ugr.tug.aae.configuration_parameters"></a>1.2.1. Configuration Parameters</h4>
<div class="paragraph">
<p>The example RoomNumberAnnotator from the previous section used hardcoded regular expressions and location names, which is obviously not very flexible.
For example, you might want to have the patterns of room numbers be supplied by a configuration parameter, rather than having to redo the annotator&#8217;s Java code to add additional patterns.
Rather than add a new hardcoded regular expression for a new pattern, a better solution is to use configuration parameters.</p>
</div>
<div class="paragraph">
<p>UIMA allows annotators to declare configuration parameters in their descriptors.
The descriptor also specifies default values for the parameters, though these can be overridden at runtime.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.declaring_parameters_in_the_descriptor"><a class="anchor" href="#ugr.tug.aae.declaring_parameters_in_the_descriptor"></a>Declaring Parameters in the Descriptor</h5>
<div class="paragraph">
<p>The example descriptor <code>descriptors/tutorial/ex2/RoomNumberAnnotator.xml</code> is the same as the descriptor from the previous section except that information has been filled in for the Parameters and Parameter Settings pages of the Component Descriptor Editor.</p>
</div>
<div class="paragraph">
<p>First, in Eclipse, open example two&#8217;s RoomNumberAnnotator in the Component Descriptor Editor, and then go to the Parameters page (click on the parameters tab at the bottom of the window), which is shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image020.jpg" alt="image020">
</div>
<div class="title">Figure 10. Screenshot of UIMA Component Descriptor Editor (CDE) Parameters page</div>
</div>
<div class="paragraph">
<p>Two parameters –Patterns and Locations&#8201;&#8212;&#8201;have been declared.
In this screen shot, the mouse (not shown) is hovering over Patterns to show its description in the small popup window.
Every parameter has the following information associated with it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name –the name by which the annotator code refers to the parameter</p>
</li>
<li>
<p>description –a natural language description of the intent of the parameter</p>
</li>
<li>
<p>type –the data type of the parameter&#8217;s value –must be one of String, Integer, Float, or Boolean.</p>
</li>
<li>
<p>multiValued –true if the parameter can take multiple-values (an array), false if the parameter takes only a single value. Shown above as <code>Multi</code>.</p>
</li>
<li>
<p>mandatory –true if a value must be provided for the parameter. Shown above as <code>Req</code> (for required).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both of our parameters are mandatory and accept an array of Strings as their value.</p>
</div>
<div class="paragraph">
<p>Next, default values are assigned to the parameters on the Parameter Settings page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image022.jpg" alt="image022">
</div>
<div class="title">Figure 11. Screenshot of UIMA Component Descriptor Editor (CDE) Parameter Settings page</div>
</div>
<div class="paragraph">
<p>Here the &#8220;Patterns&#8221; parameter is selected, and the right pane shows the list of values for this parameter, in this case the regular expressions that match particular room numbering conventions.
Notice the third pattern is new, for matching the style of room numbers in the third building, which has room numbers such as <code>J2-A11</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.accessing_parameter_values_from_annotator"><a class="anchor" href="#ugr.tug.aae.accessing_parameter_values_from_annotator"></a>Accessing Parameter Values from the Annotator Code</h5>
<div class="paragraph">
<p>The class <code>org.apache.uima.tutorial.ex2.RoomNumberAnnotator</code> has overridden the initialize method.
The initialize method is called by the UIMA framework when the annotator is instantiated, so it is a good place to read configuration parameter values.
The default initialize method does nothing with configuration parameters, so you have to override it.
To see the code in Eclipse, switch to the src folder, and open <code>org.apache.uima.tutorial.ex2</code>.
Here is the method body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>/**
* @see AnalysisComponent#initialize(UimaContext)
*/
public void initialize(UimaContext aContext)
        throws ResourceInitializationException {
  super.initialize(aContext);

  // Get config. parameter values
  String[] patternStrings =
        (String[]) aContext.getConfigParameterValue("Patterns");
  mLocations =
        (String[]) aContext.getConfigParameterValue("Locations");

  // compile regular expressions
  mPatterns = new Pattern[patternStrings.length];
  for (int i = 0; i &lt; patternStrings.length; i++) {
    mPatterns[i] = Pattern.compile(patternStrings[i]);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configuration parameter values are accessed through the UimaContext.
As you will see in subsequent sections of this chapter, the UimaContext is the annotator&#8217;s access point for all of the facilities provided by the UIMA framework –for example logging and external resource access.</p>
</div>
<div class="paragraph">
<p>The UimaContext&#8217;s <code>getConfigParameterValue</code> method takes the name of the parameter as an argument; this must match one of the parameters declared in the descriptor.
The return value of this method is a Java Object, whose type corresponds to the declared type of the parameter.
It is up to the annotator to cast it to the appropriate type, String[] in this case.</p>
</div>
<div class="paragraph">
<p>If there is a problem retrieving the parameter values, the framework throws an exception.
Generally annotators don&#8217;t handle these, and just let them propagate up.</p>
</div>
<div class="paragraph">
<p>To see the configuration parameters working, run the Document Analyzer application and select the descriptor <code>examples/descriptors/tutorial/ex2/RoomNumberAnnotator.xml</code> . In the example document <code>WatsonConferenceRooms.txt</code>, you should see some examples of Hawthorne II room numbers that would not have been detected by the ex1 version of RoomNumberAnnotator.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.supporting_reconfiguration"><a class="anchor" href="#ugr.tug.aae.supporting_reconfiguration"></a>Supporting Reconfiguration</h5>
<div class="paragraph">
<p>If you take a look at the Javadocs (located in the <a href="api/index.html">docs/api</a> directory) for <code>org.apache.uima.analysis_component.AnaysisComponent</code> (which our annotator implements indirectly through JCasAnnotator_ImplBase), you will see that there is a reconfigure() method, which is called by the containing application through the UIMA framework, if the configuration parameter values are changed.</p>
</div>
<div class="paragraph">
<p>The AnalysisComponent_ImplBase class provides a default implementation that just calls the annotator&#8217;s destroy method followed by its initialize method.
This works fine for our annotator.
The only situation in which you might want to override the default reconfigure() is if your annotator has very expensive initialization logic, and you don&#8217;t want to reinitialize everything if just one configuration parameter has changed.
In that case, you can provide a more intelligent implementation of reconfigure() for your annotator.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.configuration_parameter_groups"><a class="anchor" href="#ugr.tug.aae.configuration_parameter_groups"></a>Configuration Parameter Groups</h5>
<div class="paragraph">
<p>For annotators with many sets of configuration parameters, UIMA supports organizing them into groups.
It is possible to define a parameter with the same name in multiple groups; one common use for this is for annotators that can process documents in several languages and which want to have different parameter settings for the different languages.</p>
</div>
<div class="paragraph">
<p>The syntax for defining parameter groups in your descriptor is fairly straightforward –see <a href="ref.html#ugr.ref.xml.component_descriptor">Component Descriptor Reference</a> for details.
Values of parameters defined within groups are accessed through the two-argument version of <code>UimaContext.getConfigParameterValue</code>, which takes both the group name and the parameter name as its arguments.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.configuration_parameter_overrides"><a class="anchor" href="#ugr.tug.aae.configuration_parameter_overrides"></a>Overriding Configuration Parameter Settings</h5>
<div class="paragraph">
<p>There are two ways that the value assigned to a configuration parameter can be overridden.
An aggregate may declare a parameter that overrides one or more of the parameters in one or more of its delegates.
The aggregate must also define a value for the parameter, unless the parameter is itself overridden by a setting in the parent aggregate.</p>
</div>
<div class="paragraph">
<p>An alternative method that avoids these strict hierarchical override constraints is to associate an external global name with a parameter and to assign values to these external names in an <a href="ref.html#ugr.ref.xml.component_descriptor.aes.external_configuration_parameter_overrides">external properties file</a>.
With this approach a particular parameter setting can be easily shared by multiple descriptors, even across different applications.
For applications with many levels of descriptor nesting it avoids the need to edit aggregate override definitions when the location of an annotator in the hierarchy is changed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.logging"><a class="anchor" href="#ugr.tug.aae.logging"></a>1.2.2. Logging</h4>
<div class="paragraph">
<p>The UIMA SDK provides a logging facility, which is very similar to the <code>java.util.logging.Logger</code> class.
In addition, it includes the <a href="https://www.slf4j.org/">SLF4j framework</a> and all the methods in that framework&#8217;s <code>Logger</code> API, plus the Java 8 specific API extensions that take <code>Supplier</code> parameters.</p>
</div>
<div class="paragraph">
<p>Each logger instance is associated with a name.
By convention, this name is usually a hierarchy of simple names connected with periods,  often the fully qualified class name of the component issuing the logging call.
The name (or any of its parents - starting prefixes up to a period)  can be referenced in a configuration file which can then configure for each logger various things such as the logging level and where messages should go.</p>
</div>
<div class="paragraph">
<p>The UIMA framework supports this convention using the <code>UimaContext</code> object.
If you access a logger instance using <code>getContext().getLogger()</code> or the shorter, but equivalent <code>getLogger()</code> within an Annotator, the logger name will be the fully qualified name of the Annotator implementation class.</p>
</div>
<div class="paragraph">
<p>Here is an example from the process method of <code>org.apache.uima.tutorial.ex2.RoomNumberAnnotator</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>getLogger().trace("Found: {}", () -&gt; annotation.toString());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>trace</code> call  indicates that this is a tracing message.
This is useful for tracing program flow, but it is a low level which is not usually enabled.</p>
</div>
<div class="paragraph">
<p>The first parameter is the message, with substitutable parts.
The convention for where those parts go is written as either {} or {n}, where "n" is an integer, specifying the argument number.
The modern logging APIs use the {} style, with API calls such as <code>logger.<strong>level</strong>( msg-using-{}-convention, substitutable-arguments)</code>, while the older java.util.logger framework uses <code>logger.log(<strong>level</strong>, msg-using-{n} convention, substitutable-arguments)</code>.</p>
</div>
<div class="paragraph">
<p>UIMA supports both styles.
For new code, it is recommended to use the first style, together with the Java 8 lambda method for the arguments, which  insures that the work of turning the <code>annotation</code> argument into a printable string only will happen if tracing is enabled.</p>
</div>
<div class="paragraph">
<p>Log statements are "filtered" according to the logging configuration, by Level, and sometimes by additional indicators, such as Markers.
Levels work in a hierarchy.
A given level of  filtering passes that level and all higher levels.
Some levels have two names, due to the  way the different logger back ends name things.
Most levels are also used as method names on  the logger, to indicate logging for that level.
For example, you could say <code>aLogger.log(Level.INFO, message)</code> but you can also say <code>aLogger.info(message)</code>). The level ordering, highest to lowest,  and the associated method names are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SEVERE or ERROR; error(&#8230;&#8203;)</p>
</li>
<li>
<p>WARN or WARNING; warn(&#8230;&#8203;)</p>
</li>
<li>
<p>INFO; info(&#8230;&#8203;)</p>
</li>
<li>
<p>CONFIG; info(UIMA_MARKER_CONFIG, &#8230;&#8203;)</p>
</li>
<li>
<p>FINE or DEBUG; debug(&#8230;&#8203;)</p>
</li>
<li>
<p>FINER or TRACE; trace(&#8230;&#8203;)</p>
</li>
<li>
<p>FINEST; trace(UIMA_MARKER_FINEST, &#8230;&#8203;)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The CONFIG and FINEST levels are merged with other levels, but are distinguished by having <code>Markers</code>.
If the filtering is configured to pass CONFIG level, then it will pass also the INFO/WARN/ERROR  (or their alternative names WARNING/SEVERE) levels as well.</p>
</div>
<div class="paragraph">
<p>Each logging backend has its own documentation for how  to configure loggers at run time, via configuration files or APIs in some cases.
Some backends even allow dynamic reconfiguration while running, just by updating the configuration file (it is re-loaded every so often, if changed).</p>
</div>
<div class="paragraph">
<p>For the built-in-to-Java logging back end, if no logging configuration file is provided (see next section),  the Java Virtual Machine defaults would be used, which typically set the level to INFO and higher messages, and direct output to the console.</p>
</div>
<div class="paragraph">
<p>The UIMA logger is by default implemented using an SLF4J implementation; this (in turn) connects to a logging back end, determined via a search of the classpath for a connector.
If none can be found, then a message to that effect will be printed to System.err, and no logging will be done.
The binary distribution for UIMA includes, in its <code>lib</code> directory, the  Jar which connects SLF4j to the Java-built-in logger to use as its back end, so if you use the standard launchers, you will get this logging back end.</p>
</div>
<div class="paragraph">
<p>Assuming you are using the Java-built-in-logger as the back-end,  if you specify the configuration using the standard UIMA SDK <code>Logger.properties</code> (found in <code>UIMA_HOME/config/</code>), the output will be directed to a file named uima.log, in the current working directory (often the &#8220;project&#8221; directory when running from Eclipse, for instance).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When using Eclipse, the uima.log file, if written into the Eclipse workspace in the project uimaj-examples, for example, may not appear in the Eclipse package explorer view until you right-click the uimaj-examples project with the mouse, and select &#8220;Refresh&#8221;.
This operation refreshes the Eclipse display to conform to what may have changed on the file system.
Also, you can set the Eclipse preferences for the workspace to automatically refresh (Window → Preferences → General → Workspace, then click the &#8220;refresh
      automatically&#8221; checkbox.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next several sections mainly describe how to configure the built-in Java logger.
See the documentation for other logging back ends for  details on how to configure those.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.logging.configuring"><a class="anchor" href="#ugr.tug.aae.logging.configuring"></a>Specifying the Logging Configuration when using Java&#8217;s built-in logger</h5>
<div class="paragraph">
<p>The standard Java built-in logging initialization mechanisms will look for a Java System Property named <code>java.util.logging.config.file</code> and if found, will use the value of this property as the name of a standard &#8220;properties&#8221; file, for setting the logging level.
Please refer to the Java 1.4.
documentation for more information on the format and use of this file.</p>
</div>
<div class="paragraph">
<p>Two sample logging specification property files can be found in the UIMA_HOME directory where the UIMA SDK is installed: <code>config/Logger.properties</code>, and <code>config/FileConsoleLogger.properties</code>.
These specify the same logging, except the first logs just to a file, while the second logs both to a file and to the console.
You can edit these files, or create additional ones, as described below, to change the logging behavior.</p>
</div>
<div class="paragraph">
<p>When running your own Java application, you can specify the location of this logging configuration file on your Java command line by setting the Java system property <code>java.util.logging.config.file</code> to be the logging configuration filename.
This file specification can be either absolute or relative to the working directory.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>java "-Djava.util.logging.config.file=C:/Program Files/apache-uima/config/Logger.properties"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In a shell script, you can use environment variables such as UIMA_HOME if convenient.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using Eclipse to launch your application, you can set this property in the VM arguments section of the Arguments tab of the run configuration screen.
If you&#8217;ve set an environment variable UIMA_HOME, you could for example, use the string: <code>"-Djava.util.logging.config.file=${env_var:UIMA_HOME}/config/Logger.properties".</code></p>
</div>
<div class="paragraph">
<p>If you running the .bat or .sh files in the UIMA SDK&#8217;s <code>bin</code> directory, you can specify the location of your logger configuration file by setting the <code>UIMA_LOGGER_CONFIG_FILE</code> environment variable prior to running the script, for example (on Windows):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>set UIMA_LOGGER_CONFIG_FILE=C:/myapp/MyLogger.properties</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.logging.setting_logging_levels"><a class="anchor" href="#ugr.tug.aae.logging.setting_logging_levels"></a>Setting Logging Levels when using Java&#8217;s built-in logger</h5>
<div class="paragraph">
<p>Within the logging control file, the default global logging level specifies which kinds of events are logged across all loggers.
For any given facility this global level can be overridden by a facility specific level.
Multiple handlers are supported.
This allows messages to be directed to a log file, as well as to a &#8220;console&#8221;.
Note that the ConsoleHandler also has a separate level setting to limit messages printed to the console.
For example: <code>.level=
          INFO</code></p>
</div>
<div class="paragraph">
<p>The properties file can change where the log is written, as well.</p>
</div>
<div class="paragraph">
<p>Facility specific properties allow different logging for each class, as well.
For example, to set the com.xyz.foo logger to only log SEVERE messages: <code>com.xyz.foo.level = SEVERE</code></p>
</div>
<div class="paragraph">
<p>If you have a sample annotator in the package <code>org.apache.uima.SampleAnnotator</code> you can set the log level by specifying: <code>org.apache.uima.SampleAnnotator.level =
          ALL</code></p>
</div>
<div class="paragraph">
<p>There are other logging controls; for a full discussion, please read the contents of the <code>Logger.properties</code> file and the Java specification for logging in Java 1.4.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.logging.output_format"><a class="anchor" href="#ugr.tug.aae.logging.output_format"></a>Configuring the format of logging output when using Java&#8217;s built-in logger</h5>
<div class="paragraph">
<p>The logging output is formatted by handlers specified in the properties file for configuring logging, described above.
The default formatter that comes with the UIMA SDK formats logging output as follows:</p>
</div>
<div class="paragraph">
<p><code>Timestamp - threadID: sourceInfo: Message level:
          message</code></p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="paragraph">
<p><code>7/12/04 2:15:35 PM - 10:
          org.apache.uima.util.TestClass.main(62): INFO: You are not logged
          in!</code></p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.logging.meaning_of_severity_levels"><a class="anchor" href="#ugr.tug.aae.logging.meaning_of_severity_levels"></a>Meaning of the logging severity levels used by the UIMA logger</h5>
<div class="paragraph">
<p>These levels are defined by the Java logging framework, which was incorporated into Java as of the 1.4 release level.
The levels are defined in the Javadocs for java.util.logging.Level, and include both logging and tracing levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OFF is a special level that can be used to turn off logging.</p>
</li>
<li>
<p>ALL indicates that all messages should be logged.</p>
</li>
<li>
<p>CONFIG is a message level for configuration messages. These would typically occur once (during configuration) in methods like <code>initialize()</code>.</p>
</li>
<li>
<p>INFO is a message level for informational messages, for example, connected to server IP: 192.168.120.12</p>
</li>
<li>
<p>WARNING is a message level indicating a potential problem.</p>
</li>
<li>
<p>SEVERE is a message level indicating a serious failure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tracing levels, typically used for debugging:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FINE is a message level providing tracing information, typically at a collection level (messages occurring once per collection).</p>
</li>
<li>
<p>FINER indicates a fairly detailed tracing message, typically at a document level (once per document).</p>
</li>
<li>
<p>FINEST indicates a highly detailed tracing message.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.logging.using_outside_of_an_annotator"><a class="anchor" href="#ugr.tug.aae.logging.using_outside_of_an_annotator"></a>Using loggers outside of an annotator</h5>
<div class="paragraph">
<p>An application using UIMA may want to log its messages using the same logging framework.
This can be done by getting a reference to the UIMA logger, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Logger logger = UIMAFramework.getLogger(TestClass.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also simply get a direct reference to an Slf4j logger using the standard approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>org.slf4j.Logger logger = org.slf4j.LogFactory.getLogger(TestClass.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class argument specifies the name of the logger, using the fully qualified class name.
For UIMA loggers, if not specified, the name of the returned logger instance is &#8220;org.apache.uima&#8221;.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.logging.change_logger_implementation"><a class="anchor" href="#ugr.tug.aae.logging.change_logger_implementation"></a>Changing the underlying UIMA logging implementation</h5>
<div class="paragraph">
<p>By default the UIMA framework uses, under the hood of the UIMA Logger interface, the  SLF4J logging framework to do logging.
This allows UIMA, when running embedded inside other frameworks, to defer the choice of back-end logging frameworks to those applications.</p>
</div>
<div class="paragraph">
<p>For backwards compatibility with Version 2, the older methods (prior to Slf4j) for switching the logger implementation remains.
You do this by specifying the system property</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>-Dorg.apache.uima.logger.class=&lt;loggerClass&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>when the UIMA framework is started.</p>
</div>
<div class="paragraph">
<p>The specified logger class must be available in the classpath and has to subclass the <code>org.apache.uima.util.Logger_common_impl</code> class.</p>
</div>
<div class="paragraph">
<p>For backwards compatibility, V3 continues to provide the class <code>org.apache.uima.util.impl.Log4jLogger_impl</code> as an alternative which can be specified this way by this JVM argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>-Dorg.apache.uima.logger.class=org.apache.uima.util.impl.Log4jLogger_impl</code></pre>
</div>
</div>
<div class="paragraph">
<p>to switch to the log4j back end.
This has been updated in V3 to <code>log4j 2</code> (see <a href="https://logging.apache.org/log4j" class="bare">https://logging.apache.org/log4j</a>). If you use this, you must provide the required <code>Log4j 2</code> jars in the classpath.</p>
</div>
</div>
<div class="sect4">
<h5 id="_uv3.logging.suppress_annotator_logging"><a class="anchor" href="#_uv3.logging.suppress_annotator_logging"></a>Throttling excessive logging from Annotators</h5>
<div class="paragraph">
<p>Sometimes, in production, you may find annotators are logging excessively, and you wish to throttle  this.
But you may not have access to logging settings to control this, perhaps because UIMA is running as a library component within another framework.
For this special case, you can limit logging done by Annotators by passing an additional parameter to the UIMA Framework&#8217;s  produceAnalysisEngine API, using the key name <code>AnalysisEngine.PARAM_THROTTLE_EXCESSIVE_ANNOTATOR_LOGGING</code> and setting the value to an Integer object equal to the the limit.
Using 0 will suppress all logging.
Any positive number allows that many log records to be logged, per level.
A limit of 10 would allow  10 Errors, 10 Warnings, etc.
The limit is enforced separately, per logger instance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This only works if the logger used by Annotators is obtained from the  Annotator base implementation class via the <code>getLogger()</code> method.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aae.building_aggregates"><a class="anchor" href="#ugr.tug.aae.building_aggregates"></a>1.3. Building Aggregate Analysis Engines</h3>
<div class="sect3">
<h4 id="ugr.tug.aae.combining_annotators"><a class="anchor" href="#ugr.tug.aae.combining_annotators"></a>1.3.1. Combining Annotators</h4>
<div class="paragraph">
<p>The UIMA SDK makes it very easy to combine any sequence of Analysis Engines to form an <em>Aggregate Analysis Engine</em>.
This is done through an XML descriptor; no Java code is required!</p>
</div>
<div class="paragraph">
<p>If you go to the <code>examples/descriptors/tutorial/ex3</code> folder (in Eclipse, it&#8217;s in your uimaj-examples project, under the <code>descriptors/tutorial/ex3</code> folder), you will find a descriptor for a TutorialDateTime annotator.
This annotator detects dates and times.
To see what this annotator can do, try it out using the Document Analyzer.
If you are curious as to how this annotator works, the source code is included, but it is not necessary to understand the code at this time.</p>
</div>
<div class="paragraph">
<p>We are going to combine the TutorialDateTime annotator with the RoomNumberAnnotator to create an aggregate Analysis Engine.
This is illustrated in the following figure:</p>
</div>
<div class="paragraph">
<div class="title">Combining Annotators to form an Aggregate Analysis Engine</div>
<p>image::images/tutorials_and_users_guides/tug.aae/image024.png[Combining Annotators to form an Aggregate Analysis
              Engine]</p>
</div>
<div class="paragraph">
<p>The descriptor that does this is named <code>RoomNumberAndDateTime.xml</code>, which you can open in the Component Descriptor Editor plug-in.
This is in the uimaj-examples project in the folder <code>descriptors/tutorial/ex3</code>.</p>
</div>
<div class="paragraph">
<p>The &#8220;Aggregate&#8221; page of the Component Descriptor Editor is used to define which components make up the aggregate.
A screen shot is shown below.
(If you are not using Eclipse, see <a href="#ugr.tug.aae.xml_intro_ae_descriptor">Section 1.8</a> for the actual XML syntax for Aggregate Analysis Engine Descriptors.)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image026.jpg" alt="image026">
</div>
<div class="title">Figure 12. Aggregate page of the Component Descriptor Editor (CDE)</div>
</div>
<div class="paragraph">
<p>On the left side of the screen is the list of component engines that make up the aggregate –in this case, the TutorialDateTime annotator and the RoomNumberAnnotator.
To add a component, you can click the &#8220;Add&#8221; button and browse to its descriptor.
You can also click the &#8220;Find AE&#8221; button and search for an Analysis Engine in your Eclipse workspace.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>Add Remote</em> button is used for adding components which run <a href="#ugr.tug.application.how_to_call_a_uima_service">remotely</a> (for example, on another machine using a remote networking connection).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The order of the components in the left pane does not imply an order of execution.
The order of execution, or <em>flow</em> is determined in the &#8220;Component Engine Flow&#8221; section on the right.
UIMA supports different types of algorithms (including user-definable) for determining the flow.
Here we pick the simplest: <code>FixedFlow</code>.
We have chosen to have the RoomNumberAnnotator execute first, although in this case it doesn&#8217;t really matter, since the RoomNumber and DateTime annotators do not have any dependencies on one another.</p>
</div>
<div class="paragraph">
<p>If you look at the <em>Type System</em> page of the Component Descriptor Editor, you will see that it displays the type system but is not editable.
The Type System of an Aggregate Analysis Engine is automatically computed by merging the Type Systems of all of its components.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the components have different definitions for the same type name, The Component Descriptor Editor will show a warning.
It is possible to continue past this warning, in which case your aggregate&#8217;s type system will have the correct &#8220;merged&#8221; type definition that contains all of the features defined on that type by all of your components.
However, it is not recommended to use this feature in conjunction with JCAS, since the JCAS Java Class definitions cannot be so easily <a href="ref.html#ugr.ref.jcas.merging_types_from_other_specs">merged</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Capabilities page is where you explicitly declare the aggregate Analysis Engine&#8217;s inputs and outputs.
Sofas and Languages are described later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image028.jpg" alt="image028">
</div>
<div class="title">Figure 13. Screen shot of the Capabilities page of the Component Descriptor Editor</div>
</div>
<div class="paragraph">
<p>Note that it is not automatically assumed that all outputs of each component Analysis Engine (AE) are passed through as outputs of the aggregate AE.
If, for example, the TutorialDateTime annotator also produced Word and Sentence annotations,  but those were not of interest as output in this case, we can exclude them from the  list of outputs.</p>
</div>
<div class="paragraph">
<p>You can run this AE using the Document Analyzer in the same way that you run any other AE.
Just select the <code>examples/descriptors/tutorial/ex3/RoomNumberAndDateTime.xml</code> descriptor and click the Run button.
You should see that RoomNumbers, Dates, and Times are all shown:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image030.jpg" alt="image030">
</div>
<div class="title">Figure 14. Screen shot results of running the Document Analyzer</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.aaes_can_contain_cas_consumers"><a class="anchor" href="#ugr.tug.aae.aaes_can_contain_cas_consumers"></a>1.3.2. AAEs can also contain CAS Consumers</h4>
<div class="paragraph">
<p>In addition to aggregating Analysis Engines, Aggregates <a href="#ugr.tug.cpe">can also contain CAS Consumers</a>, or even a mixture of these components with regular Analysis Engines.
The UIMA Examples has an example of an Aggregate which contains both an analysis engine and a CAS consumer, in <code>examples/descriptors/MixedAggregate.xml.</code></p>
</div>
<div class="paragraph">
<p>Analysis Engines support the <code>collectionProcessComplete</code> method, which is particularly important for many CAS Consumers.
If an application (or a Collection Processing Engine) calls <code>collectionProcessComplete</code> on an aggregate, the framework will deliver that call to all of the components of the aggregate.
If you use one of the built-in flow types (fixedFlow or capabilityLanguageFlow), then the order specified in that flow will be the same order in which the <code>collectionProcessComplete</code> calls are made to the components.
If a custom flow is used, then the calls will be made in arbitrary order.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.reading_results_previous_annotators"><a class="anchor" href="#ugr.tug.aae.reading_results_previous_annotators"></a>1.3.3. Reading the Results of Previous Annotators</h4>
<div class="paragraph">
<p>So far, we have been looking at annotators that look directly at the document text.
However, annotators can also use the results of other annotators.
One useful thing we can do at this point is look for the co-occurrence of a Date, a RoomNumber, and two Times –and annotate that as a Meeting.</p>
</div>
<div class="paragraph">
<p>The <code>select</code> API, available on the CAS, JCas, and individual UIMA indexes,  is the preferred way to get  feature structures from the CAS and work with them.</p>
</div>
<div class="paragraph">
<p>The CAS maintains <em>indexes</em> of annotations, and from an index you can obtain an iterator that allows you to step through all annotations of a particular type in that index.
Indexes are optional; they allow you to specify a sorting order or can specify set-inclusion criteria.
One built-in index is the Annotation index; this contains sorted instances of type Annotation  or its subtypes.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s some example code that would iterate over all of the TimeAnnot annotations in the JCas, in some unspecified order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>for (TimeAnnot : aJCas.select(TimeAnnot.class)) {
  //do something
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same code, but using the Annotation index to specify an ordering (assuming that TimeAnnot is a subtype of Annotation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>for (TimeAnnot : aJCas.getAnnotationIndex().select(TimeAnnot.class)) {
  //do something
}
  // or
for (TimeAnnot : aJCas.getAnnotationIndex(TimeAnnot.class).select()) {
  //do something
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, if you&#8217;ve defined your own <a href="ref.html#ugr.ref.xml.component_descriptor.aes.index">custom index</a>, you can get an iterator over that specific index by calling <code>aJCas.getIndex(label, clazz)</code>.
The <code>getIndex(&#8230;&#8203;)</code> method&#8217;s second argument  specialized the index to subtype of the type the index was declared to index.
For instance, if you defined an index called "allEvents" over the type <code>Event</code>, and wanted  to get an index over just a particular subtype of event, say, <code>TimeEvent</code>, you can ask for that index using <code>aJCas.getIndex("allEvents", TimeEvent.class)</code>.</p>
</div>
<div class="paragraph">
<p>Whereever the type is specified by TimeEvent.class, the APIs also allow the non-JCas  specification of the type by passing an instance of a UIMA Type class.
This alternative enables writing code that can be used for any type, discovered at run time.</p>
</div>
<div class="paragraph">
<p>Now that we&#8217;ve explained the basics, let&#8217;s take a look at the process method for <code>org.apache.uima.tutorial.ex4.MeetingAnnotator</code>.
Since we&#8217;re looking for a combination of a RoomNumber, a Date, and two Times, there are four nested iterators.
(There&#8217;s surely a better algorithm for doing this, but to keep things simple we&#8217;re just going to look at every combination of the four items.)</p>
</div>
<div class="paragraph">
<p>For each combination of the four annotations, we compute the span of text that includes all of them, and then we check to see if that span is smaller than a &#8220;window&#8221; size, a configuration parameter.
There are also some checks to make sure that we don&#8217;t annotate the same span of text multiple times.
If all the checks pass, we create a Meeting annotation over the whole span.
There&#8217;s really nothing to it!</p>
</div>
<div class="paragraph">
<p>The XML descriptor, located in <code>examples/descriptors/tutorial/ex4/MeetingAnnotator.xml</code> , is also very straightforward.
An important difference from previous descriptors is that this is the first annotator we&#8217;ve discussed that has input requirements.
This can be seen on the &#8220;Capabilities&#8221; page of the Component Descriptor Editor:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image032.jpg" alt="image032">
</div>
<div class="title">Figure 15. Screen shot of Capabilities page of the Component Descriptor Editor</div>
</div>
<div class="paragraph">
<p>If we were to run the MeetingAnnotator on its own, it wouldn&#8217;t detect anything because it wouldn&#8217;t have any input annotations to work with.
The required input annotations can be produced by the RoomNumber and DateTime annotators.
So, we create an aggregate Analysis Engine containing these two annotators, followed by the Meeting annotator.
This aggregate is illustrated in <a href="#ugr.tug.aae.fig.aggregate_for_meeting_annotator">Figure 16</a>.
The descriptor for this is in <code>examples/descriptors/tutorial/ex4/MeetingDetectorAE.xml</code>. Give it a try in the Document Analyzer.</p>
</div>
<div id="ugr.tug.aae.fig.aggregate_for_meeting_annotator" class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image034.png" alt="image034">
</div>
<div class="title">Figure 16. An Aggregate Analysis Engine where an internal component uses output from previousengines</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aae.other_examples"><a class="anchor" href="#ugr.tug.aae.other_examples"></a>1.4. Other examples</h3>
<div class="paragraph">
<p>The UIMA SDK include several other examples you may find interesting, including</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SimpleTokenAndSentenceAnnotator</code>: a simple tokenizer and sentence annotator.</p>
</li>
<li>
<p><code>XmlDetagger</code>: A <a href="#ugr.tug.mvs">multi-sofa</a> annotator that does XML detagging.
Reads XML data from the input Sofa (named "xmlDocument"); this data can be stored in the CAS as a string or array, or it can be a URI to a remote file. The XML is parsed using the JVM&#8217;s default parser, and the plain-text content is written to a new sofa called "plainTextDocument".</p>
</li>
<li>
<p><code>PersonTitleDBWriterCasConsumer</code>: a sample CAS Consumer which populates a relational database with some annotations.
It uses JDBC and in this example, hooks up with the Open Source Apache Derby database.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aae.additional_topics"><a class="anchor" href="#ugr.tug.aae.additional_topics"></a>1.5. Additional Topics</h3>
<div class="sect3">
<h4 id="ugr.tug.aae.contract_for_annotator_methods"><a class="anchor" href="#ugr.tug.aae.contract_for_annotator_methods"></a>1.5.1. Annotator Methods</h4>
<div class="paragraph">
<p>The UIMA framework ensures that an Annotator instance is called by only one thread at a time.
An instance never has to worry about running some method on one  thread, and then asynchronously being called using another thread.
This approach  simplifies the design of annotators –they do not have to be designed to support multi-threading.
When multiple threading is wanted, for performance, multiple instances of the Annotator are created, each one running on just one thread.</p>
</div>
<div class="paragraph">
<p>The following table defines the methods called by the framework, when they are called, and the requirements annotator implementations must follow.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">When Called by Framework</th>
<th class="tableblock halign-left valign-top">Requirements</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initialize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Typically only called once, when instance is created. Can be called
again if application does a reinitialize call and the default behavior
                isn&#8217;t overridden (the default behavior for reinitialize is to call <code>destroy</code> followed by <code>initialize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normally does one-time initialization, including reading of
                configuration parameters. If the application changes the parameters, it
                can call initialize to have the annotator re-do its
                initialization.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>typeSystemInit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Called before <code>process</code> whenever the type system
                in the CAS being passed in differs from what was previously passed in a <code>process</code> call (and called for the first CAS passed in,
                too). The Type System being passed to an annotator only changes in the case of
                remote annotators that are active as servers, receiving possibly
                different type systems to operate on.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Typically, users of JCas do not implement any method for this. An
                annotator can use this call to read the CAS type system and setup any instance
                variables that make accessing the types and features convenient.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>process</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Called once for each CAS. Called by the application if not using
                Collection Processing Manager (CPM); the application calls the process
                method on the analysis engine, which is then delegated by the framework to
                all the annotators in the engine. For Collection Processing application,
                the CPM calls the process method. If the application creates and manages
                your own Collection Processing Engine via API calls (see Javadocs), the
                application calls this on the Collection Processing Engine, and it is
                delegated by the framework to the components.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Process the CAS, adding and/or modifying elements in it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>destroy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This method can be called by applications, and is also called by the
                Collection Processing Manager framework when the collection processing
                completes. It is also called on Aggregate delegate components, if those
                components successfully complete their <code>initialize</code> call, if
                a subsequent delegate (or flow controller) in the aggregate fails to initialize.
                This allows components which need to clean up things done during initialization
                to do so.  It is up to the component writer to use a try/finally construct during initialization
                to cleanup from errors that occur during initialization within one component.
                The <code>destroy</code> call on an aggregate is
                propagated to all contained analysis engines.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An annotator should release all resources, close files, close
                database connections, etc., and return to a state where another initialize
                call could be received to restart. Typically, after a destroy call, no
                further calls will be made to an annotator instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reconfigure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This method is never called by the framework, unless an application calls it on the Engine object –in which case it the framework propagates it to all annotators contained in the Engine. Its purpose is to signal that the configuration parameters have changed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A default implementation of this calls destroy, followed by
                initialize. This is the only case where initialize would be called more than
                once. Users should implement whatever logic is needed to return the
                annotator to an initialized state, including re-reading the
                configuration parameter data.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.reporting_errors_from_annotators"><a class="anchor" href="#ugr.tug.aae.reporting_errors_from_annotators"></a>1.5.2. Reporting errors from Annotators</h4>
<div class="paragraph">
<p>There are two broad classes of errors that can occur: recoverable and unrecoverable.
Because Annotators are often expected to process very large numbers of artifacts (for example, text documents), they should be written to recover where possible.</p>
</div>
<div class="paragraph">
<p>For example, if an upstream annotator created some input for an annotator which is invalid, the annotator may want to log this event, ignore the bad input and continue.
It may include a notification of this event in the CAS, for further downstream annotators to consider.
Or, it may throw an exception (see next section)&#8201;&#8212;&#8201;but in this case, it cannot do any further processing on that document.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The choice of what to do can be made configurable, using the configuration parameters.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.throwing_exceptions_from_annotators"><a class="anchor" href="#ugr.tug.aae.throwing_exceptions_from_annotators"></a>1.5.3. Throwing Exceptions from Annotators</h4>
<div class="paragraph">
<p>Let&#8217;s say an invalid regular expression was passed as a parameter to the RoomNumberAnnotator.
Because this is an error related to the overall configuration, and not something we could expect to ignore, we should throw an appropriate exception, and most Java programmers would expect to do so like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>throw new ResourceInitializationException(
    "The regular expression " + x + " is not valid.");</code></pre>
</div>
</div>
<div class="paragraph">
<p>UIMA, however, does not do it this way.
All UIMA exceptions are <em>internationalized</em>, meaning that they support translation into other languages.
This is accomplished by eliminating hardcoded message strings and instead using external message digests.
Message digests are files containing (key, value) pairs.
The key is used in the Java code instead of the actual message string.
This allows the message string to be easily translated later by modifying the message digest file, not the Java code.
Also, message strings in the digest can contain parameters that are filled in when the exception is thrown.
The format of the message digest file is described in the Javadocs for the Java class <code>java.util.PropertyResourceBundle</code> and in the load method of <code>java.util.Properties</code>.</p>
</div>
<div class="paragraph">
<p>The first thing an annotator developer must choose is what Exception class to use.
There are three to choose from:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ResourceConfigurationException should be thrown from the annotator&#8217;s reconfigure() method if invalid configuration parameter values have been specified.</p>
</li>
<li>
<p>ResourceInitializationException should be thrown from the annotator&#8217;s initialize() method if initialization fails for any  reason (including invalid configuration parameters).</p>
</li>
<li>
<p>AnalysisEngineProcessException should be thrown from the annotator&#8217;s process() method if the processing of a particular document fails for any reason.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Generally you will not need to define your own custom exception classes, but if you do they must extend one of these three classes, which are the only types of Exceptions that the annotator interface permits annotators to throw.</p>
</div>
<div class="paragraph">
<p>All of the UIMA Exception classes share common constructor varieties.
There are four possible arguments:</p>
</div>
<div class="paragraph">
<p>The name of the message digest to use (optional –if not specified the default UIMA message digest is used).</p>
</div>
<div class="paragraph">
<p>The key string used to select the message in the message digest.</p>
</div>
<div class="paragraph">
<p>An object array containing the parameters to include in the message.
Messages can have substitutable parts.
When the message is given, the string representation of the objects passed are substituted into the message.
The object array is often created using the syntax <code>new Object[]{x, y}</code>.</p>
</div>
<div class="paragraph">
<p>Another exception which is the &#8220;cause&#8221; of the exception you are throwing.
This feature is commonly used when you catch another exception and rethrow it.
(optional)</p>
</div>
<div class="paragraph">
<p>If you look at source file (folder: src in Eclipse) <code>org.apache.uima.tutorial.ex5.RoomNumberAnnotator</code>, you will see the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>try {
  mPatterns[i] = Pattern.compile(patternStrings[i]);
}
catch (PatternSyntaxException e) {
  throw new ResourceInitializationException(
     MESSAGE_DIGEST, "regex_syntax_error",
     new Object[]{patternStrings[i]}, e);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the MESSAGE_DIGEST constant has the value `
        "org.apache.uima.tutorial.ex5.RoomNumberAnnotator_Messages". `</p>
</div>
<div class="paragraph">
<p>Message digests are specified using a dotted name, just like Java classes.
This file, with the .properties extension, must be present in the class path.
In Eclipse, you find this file under the src folder, in the package org.apache.uima.tutorial.ex5, with the name RoomNumberAnnotator_Messages.properties.
Outside of Eclipse, you can find this in the <code>uimaj-examples.jar</code> with the name <code>org/apache/uima/tutorial/ex5/RoomNumberAnnotator_Messages.properties.</code> If you look in this file you will see the line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>regex_syntax_error = {0} is not a valid regular expression.</code></pre>
</div>
</div>
<div class="paragraph">
<p>which is the error message for the example exception we showed above.
The placeholder {0} will be filled by the toString() value of the argument passed to the exception constructor – in this case, the regular expression pattern that didn&#8217;t compile.
If there were additional arguments, their locations in the message would be indicated as {1}, {2}, and so on.</p>
</div>
<div class="paragraph">
<p>If a message digest is not specified in the call to the exception constructor, the default is <code>UIMAException.STANDARD_MESSAGE_CATALOG</code> (whose value is &#8220;`org.apache.uima.UIMAException_Messages`&#8221; in the current release but may change). This message digest is located in the <code>uima-core.jar</code> file at <code>org/apache/uima/UIMAException_messages.properties</code>– you can take a look to see if any of these exception messages are useful to use.</p>
</div>
<div class="paragraph">
<p>To try out the regex_syntax_error exception, just use the Document Analyzer to run <code>examples/descriptors/tutorial/ex5/RoomNumberAnnotator.xml</code> , which happens to have an invalid regular expression in its configuration parameter settings.</p>
</div>
<div class="paragraph">
<p>To summarize, here are the steps to take if you want to define your own exception message:</p>
</div>
<div class="paragraph">
<p>Create a file with the .properties extension, where you declare message keys and their associated messages, using the same syntax as shown above for the regex_syntax_error exception.
The properties file syntax is more completely described in the Javadocs for the <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/Properties.html#load(java.io.InputStream)">
        load</a> method of the java.util.Properties class.</p>
</div>
<div class="paragraph">
<p>Put your properties file somewhere in your class path (it can be in your annotator&#8217;s .jar file).</p>
</div>
<div class="paragraph">
<p>Define a String constant (called MESSAGE_DIGEST for example) in your annotator code whose value is the dotted name of this properties file.
For example, if your properties file is inside your jar file at the location <code>org/myorg/myannotator/Messages.properties</code>, then this String constant should have the value <code>org.myorg.myannotator.Messages</code>.
Do not include the .properties extension.
In Java Internationalization terminology, this is called the Resource Bundle name.
For more information see the Javadocs for the <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/PropertyResourceBundle.html">
        PropertyResourceBundle</a> class.</p>
</div>
<div class="paragraph">
<p>In your annotator code, throw an exception like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>throw new ResourceInitializationException(
    MESSAGE_DIGEST, "your_message_name",
    new Object[]{param1,param2,...});</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also wish to look at the Javadocs for the UIMAException class.</p>
</div>
<div class="paragraph">
<p>For more information on Java&#8217;s internationalization features, see the <a href="http://java.sun.com/j2se/1.5.0/docs/guide/intl/index.html">
        Java Internationalization Guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.accessing_external_resource_files"><a class="anchor" href="#ugr.tug.aae.accessing_external_resource_files"></a>1.5.4. Accessing External Resources</h4>
<div class="paragraph">
<p>External Resources are Java objects that have a life cycle where they are (optionally) initialized at startup time by reading external data from  a file or via a URL (which can access information over the http protocol, for instance). It is not <em>required</em> that Extermal Resource objects  do any external data reading to initialize themselves.
However, this is such a  common use case, that we will presume this mode of operation in the description below.</p>
</div>
<div class="paragraph">
<p>Sometimes you may want an annotator to read from an external resource,  such as a URL or a file –for example, a long list of keys and values that you are going to build into a HashMap.
You could, of course, just introduce a configuration parameter that holds the absolute path or URL to this resource, and build the HashMap in your annotator&#8217;s initialize method.
However, this is not the best solution for three reasons:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Including an absolute path in your descriptor to specify the initialization data makes your annotator difficult for others to use. Each user will need to edit this descriptor and set the absolute path to a value appropriate for his or her installation.</p>
</li>
<li>
<p>You cannot share the created Java object(s), e.g., a HashMap,  between multiple annotators. Also, in some deployment scenarios there may be more than one instance of your annotator, and you would like to have the option for them to share the same Java Object(s).</p>
</li>
<li>
<p>Your annotator would become dependent on a particular  implementation of the Java Object(s).  It would be better if there was  a decoupling between the actual implementation, and the API used to access it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A better way to create these sharable Java objects and initialize them  via external disk or URL sources is through the ResourceManager component.
In this section we are going to show an example of how to use the Resource Manager.</p>
</div>
<div class="paragraph">
<p>This example annotator will annotate UIMA acronyms (e.g.
UIMA, AE, CAS, JCas) and store the acronym&#8217;s expanded form as a feature of the annotation.
The acronyms and their expanded forms are stored in an external file.</p>
</div>
<div class="paragraph">
<p>First, look at the <code>examples/descriptors/tutorial/ex6/UimaAcronymAnnotator.xml</code> descriptor.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image036.jpg" alt="image036">
</div>
<div class="title">Figure 17. Screen shot of Component Descriptor Editor page for configuring External Resources</div>
</div>
<div class="paragraph">
<p>The values of the rows in the two tables are longer than can be easily shown.
You can click the small button at the top right to shift the layout from two side-by-side tables, to a vertically stacked layout.
You can also click the small twisty on the &#8220;Imports for External Resources and Bindings&#8221; to collapse this section, because it&#8217;s not used here.
Then the same screen will appear like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image038.jpg" alt="image038">
</div>
<div class="title">Figure 18. Screen shot of Component Descriptor Editor page for configuring External Resources after adjusting the layout</div>
</div>
<div class="paragraph">
<p>The top window has a scroll bar allowing you to see the rest of the line.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.resources.declaring_dependencies"><a class="anchor" href="#ugr.tug.aae.resources.declaring_dependencies"></a>Declaring Resource Dependencies</h5>
<div class="paragraph">
<p>The bottom window is where an annotator declares an external resource dependency.
The XML for this is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;externalResourceDependency&gt;
  &lt;key&gt;AcronymTable&lt;/key&gt;
  &lt;description&gt;Table of acronyms and their expanded forms.&lt;/description&gt;
  &lt;interfaceName&gt;
    org.apache.uima.tutorial.ex6.StringMapResource
  &lt;/interfaceName&gt;
&lt;/externalResourceDependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The &lt;key&gt; value (AcronymTable) is the name by which the annotator identifies this resource.
The key must be unique for all resources that this annotator accesses, but the same key could be used by different annotators to mean different things.
The interface name (<code>org.apache.uima.tutorial.ex6.StringMapResource</code>) is the Java interface through which the annotator accesses the data.
Specifying an interface name is optional.
If you do not specify an interface name, annotators will instead get an interface which can provide direct access to the  data resource (file or URL) that is  associated with this external resource.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.resources.accessing_from_uimacontext"><a class="anchor" href="#ugr.tug.aae.resources.accessing_from_uimacontext"></a>Accessing the Resource from the UimaContext</h5>
<div class="paragraph">
<p>If you look at the <code>org.apache.uima.tutorial.ex6.UimaAcronymAnnotator</code> source, you will see that the annotator accesses this resource from the UimaContext by calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>StringMapResource mMap =
  (StringMapResource)getContext().getResourceObject("AcronymTable");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The object returned from the <code>getResourceObject</code> method will implement the interface declared in the <code>&lt;interfaceName&gt;</code> section of the descriptor, <code>StringMapResource</code> in this case.
The annotator code does not need to know the location of external data that may be used to initilize this object, nor the Java class that might be used to read the data and implement the <code>StringMapResource</code> interface.</p>
</div>
<div class="paragraph">
<p>Note that if we did not specify a Java interface in our descriptor, our annotator could directly access the resource data as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>InputStream stream = getContext().getResourceAsStream("AcronymTable");</code></pre>
</div>
</div>
<div class="paragraph">
<p>If necessary, the annotator could also determine the location of the resource file, by calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>URI uri = getContext().getResourceURI("AcronymTable");</code></pre>
</div>
</div>
<div class="paragraph">
<p>These last two options are only available in the case where the descriptor does not declare a Java interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The methods for getting access to resources include <code>getResourceURL</code>.
That  method returns a URL, which may contain spaces encoded as %20.
url.getPath() would return the path without decoding these %20 into spaces. <code>getResourceURI</code> on the other hand, returns a URI, and the uri.getPath() <em>does</em> do the conversion of %20 into spaces.
See also <code>getResourceFilePath</code>, which does a getResourceURI followed by uri.getPath().</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.resources.declaring_and_bindings"><a class="anchor" href="#ugr.tug.aae.resources.declaring_and_bindings"></a>Declaring Resources and Bindings</h5>
<div class="paragraph">
<p>Refer back to the top window in the Resources page of the Component Descriptor Editor.
This is where we specify the location of the resource data, and the Java class used to read the data.
For the example, this corresponds to the following section of the descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;resourceManagerConfiguration&gt;
  &lt;externalResources&gt;
    &lt;externalResource&gt;
      &lt;name&gt;UimaAcronymTableFile&lt;/name&gt;
      &lt;description&gt;
         A table containing UIMA acronyms and their expanded forms.
      &lt;/description&gt;
      &lt;fileResourceSpecifier&gt;
        &lt;fileUrl&gt;file:org/apache/uima/tutorial/ex6/uimaAcronyms.txt
        &lt;/fileUrl&gt;
      &lt;/fileResourceSpecifier&gt;
      &lt;implementationName&gt;
         org.apache.uima.tutorial.ex6.StringMapResource_impl
      &lt;/implementationName&gt;
    &lt;/externalResource&gt;
  &lt;/externalResources&gt;

  &lt;externalResourceBindings&gt;
    &lt;externalResourceBinding&gt;
      &lt;key&gt;AcronymTable&lt;/key&gt;
      &lt;resourceName&gt;UimaAcronymTableFile&lt;/resourceName&gt;
    &lt;/externalResourceBinding&gt;
  &lt;/externalResourceBindings&gt;
&lt;/resourceManagerConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first section of this XML declares an externalResource, the <code>UimaAcronymTableFile</code>.
With this, the fileUrl element specifies the path to the data file.
This can be a file on the file system, but can also be a remote resource access via, e.g., the http protocol.
The fileUrl element doesn&#8217;t have to be a "file", it can be a URL.
This can be an absolute URL (e.g.
one that starts with file:/ or <a href="file:///" class="bare">file:///</a>, or <a href="file://my.host.org/" class="bare">file://my.host.org/</a>), but that is not recommended because it makes installation of your component more difficult, as noted earlier.
Better is a relative URL, which will be looked up within the classpath (and/or datapath), as used in this example.
In this case, the file <code>org/apache/uima/tutorial/ex6/uimaAcronyms.txt</code> is located in <code>uimaj-examples.jar</code>, which is in the classpath.
If you look in this file you will see the definitions of several UIMA acronyms.</p>
</div>
<div class="paragraph">
<p>The second section of the XML declares an externalResourceBinding, which connects the key <code>AcronymTable</code>, declared in the annotator&#8217;s external resource dependency, to the actual resource name <code>UimaAcronymTableFile</code>.
This is rather trivial in this case; for more on bindings see the example <code>UimaMeetingDetectorAE.xml</code> below.
There is no global repository for external resources; it is up to the user to define each resource needed by a particular set of annotators.</p>
</div>
<div class="paragraph">
<p>In the Component Descriptor Editor, bindings are indicated below the external resource.
To create a new binding, you select an external resource (which must have previously been defined), and an external resource dependency, and then click the <code>Bind</code> button, which only enables if you have selected two things to bind together.</p>
</div>
<div class="paragraph">
<p>When the Analysis Engine is initialized, it creates a single instance of <code>StringMapResource_impl</code> and loads it with the contents of the data file.
This means that the framework calls the instance&#8217;s <code>load</code> method, passing it an instance of DataResource, from which you can obtain  a stream or URI/URL of the external resource that was declared in the external resource;  for resources where loading does not make sense, you can implement a <code>load</code> method which ignores its argument and just returns, or performes whatever initialization is appropriate at startup time.
See the Javadocs for  SharedResourceObject for details on this.</p>
</div>
<div class="paragraph">
<p>The UimaAcronymAnnotator then accesses the data through the <code>StringMapResource</code> interface.
This single instance could be shared among multiple annotators, as will be explained later.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Because the implementation of the resource is shared,  you should insure your implementation is thread-safe, as it  could be called multiple times on multiple threads, simultaneously.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that all resource implementation classes (e.g.
StringMapResource_impl in the provided example) must be declared public must not be declared abstract, and must have public, no-args constructors, so  that they can be instantiated by the framework.
(Although Java classes in which  you do not define any constructor will, by default, have a no-args constructor that doesn&#8217;t do anything, a class in which you have defined at least one constructor does not get a default no-args constructor.)</p>
</div>
<div class="paragraph">
<p>All resource implementation classes that provide access to resource data must also implement the interface org.apache.uima.resource.SharedResourceObject.
The UIMA Framework will invoke this interface&#8217;s only method, <code>load</code>,   after this object has been instantiated.
The implementation of this method  can then read data from the specified <code>DataResource</code>  and use that data to initialize this object.
It can also do whatever resource initialization might be appropriate to do at startup time.</p>
</div>
<div class="paragraph">
<p>This annotator is illustrated in <a href="#ugr.tug.aae.fig.external_resource_binding">Figure 19</a>.
To see it in action, just run it using the Document Analyzer.
When it finishes, open up the UIMA_Seminars document in the processed results window, (double-click it), and then left-click on one of the highlighted terms, to see the expandedForm feature&#8217;s value.</p>
</div>
<div id="ugr.tug.aae.fig.external_resource_binding" class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image040.png" alt="image040">
</div>
<div class="title">Figure 19. External Resource Binding</div>
</div>
<div class="paragraph">
<p>By designing our annotator in this way, we have gained some flexibility.
We can freely replace the StringMapResource_impl class with any other implementation that implements the simple StringMapResource interface.
(For example, for very large resources we might not be able to have the entire map in memory.) We have also made our external resource dependencies explicit in the descriptor, which will help others to deploy our annotator.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.resources.sharing_among_annotators"><a class="anchor" href="#ugr.tug.aae.resources.sharing_among_annotators"></a>Sharing Resources among Annotators</h5>
<div class="paragraph">
<p>Another advantage of the Resource Manager is that it allows our data to be shared between annotators.
To demonstrate this we have developed another annotator that will use the same acronym table.
The UimaMeetingAnnotator will iterate over Meeting annotations discovered by the Meeting Detector we previously developed and attempt to determine whether the topic of the meeting is related to UIMA.
It will do this by looking for occurrences of UIMA acronyms in close proximity to the meeting annotation.
We could implement this by using the UimaAcronymAnnotator, of course, but for the sake of this example we will have the UimaMeetingAnnotator access the acronym map directly.</p>
</div>
<div class="paragraph">
<p>The Java code for the UimaMeetingAnnotator in example 6 creates a new type, UimaMeeting, if it finds a meeting within 50 characters of the UIMA acronym.</p>
</div>
<div class="paragraph">
<p>We combine three analysis engines, the UimaAcronymAnnotator to annotate UIMA acronyms, the MeetingDectector from example 4 to find meetings and finally the UimaMeetingAnnotator to annotate just meetings about UIMA.
Together these are assembled to form the new aggregate analysis engine, UimaMeetingDectector.
This aggregate and the sharing of a common resource are illustrated in <a href="#ugr.tug.aae.fig.sharing_common_resource">Figure 20</a>.</p>
</div>
<div id="ugr.tug.aae.fig.sharing_common_resource" class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image042.png" alt="image042">
</div>
<div class="title">Figure 20. Component engines of an aggregate share a common resource</div>
</div>
<div class="paragraph">
<p>The important thing to notice is in the <code>UimaMeetingDetectorAE.xml</code> aggregate descriptor.
It includes both the UimaMeetingAnnotator and the UimaAcronymAnnotator, and contains a single declaration of the UimaAcronymTableFile resource.
(The actual example has the order of the first two annotators reversed versus the above picture, which is OK since they do not depend on one another).</p>
</div>
<div class="paragraph">
<p>It also binds the resources as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image044.jpg" alt="image044">
</div>
<div class="title">Figure 21. UimaMeetingDetectorAE.xml binding a common resource</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;externalResourceBindings&gt;
  &lt;externalResourceBinding&gt;
    &lt;key&gt;UimaAcronymAnnotator/AcronymTable&lt;/key&gt;
    &lt;resourceName&gt;UimaAcronymTableFile&lt;/resourceName&gt;
  &lt;/externalResourceBinding&gt;

  &lt;externalResourceBinding&gt;
    &lt;key&gt;UimaMeetingAnnotator/UimaTermTable&lt;/key&gt;
    &lt;resourceName&gt;UimaAcronymTableFile&lt;/resourceName&gt;
  &lt;/externalResourceBinding&gt;
&lt;/externalResourceBindings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This binds the resource dependencies of both the UimaAcronymAnnotator (which uses the name AcronymTable) and UimaMeetingAnnotator (which uses UimaTermTable) to the single declared resource named UimaAcronymFile.
Therefore they will share the same instance.
Resource bindings in the aggregate descriptor <em>override</em> any resource declarations in individual annotator descriptors.</p>
</div>
<div class="paragraph">
<p>If we wanted to have the annotators use different acronym tables, we could easily do that.
We would simply have to change the resourceName elements in the bindings so that they referred to two different resources.
The Resource Manager gives us the flexibility to make this decision at deployment time, without changing any Java code.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.resources.threading"><a class="anchor" href="#ugr.tug.aae.resources.threading"></a>Threading and Shared Resources</h5>
<div class="paragraph">
<p>Sharing can also occur when multiple instances of an annotator are  created by the framework in response to run-time deployment specifications.
If an implementation class is specified in the external resource,  only one instance of that implementation class   is created for a given binding, and is shared among all annotators.
Because of this, the implementation of that shared instance must be written to be thread-safe - that is, to operate correctly when called at arbitrary times by multiple threads.
Writing thread-safe code in Java is addressed in several books, such as Brian Goetz&#8217;s <em>Java Concurrency in Practice</em>.</p>
</div>
<div class="paragraph">
<p>If no implementation class is specified, then the getResource method returns a DataResource object, from which each annotator instance can obtain their own (non-shared) input stream; so threading is not an issue in this case.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.result_specification_setting"><a class="anchor" href="#ugr.tug.aae.result_specification_setting"></a>1.5.5. Result Specifications</h4>
<div class="paragraph">
<p>Annotators often are written to do a lot of computation and produce a lot of different outputs.
For example, a tokenizer can, in addition to identifying tokens, look them up in dictionaries, create  lemma forms (dropping suffexes and prefixes), etc.
Result Specifications provide a way to dynamically specify what results are desired for a particular CAS being processed.</p>
</div>
<div class="paragraph">
<p>It is up to the annotator writer to take advantage of the result specification; using it is optional.
If it is used, the annotator writer checks if a particular output is wanted, by asking the result specification if it contains a specific Type and/or Feature.
If it does, then the annotator produces that type/feature; if not, it skips the computations for producing that type/feature.</p>
</div>
<div class="paragraph">
<p>The Result Specification querying may  include the language.
A typical use case:  The CAS contains a document written in some language, and some upstream Annotator has discovered what this language is.
The Annotator extracts the previously discovered language specification from the CAS and  then includes it when querying the Result Specification.
The exact method of encoding  language specifications in the CAS is left up to annotator developers; however, the framework provides a commonly used type for this - the org.apache.uima.tcas.DocumentAnnotation type.</p>
</div>
<div class="paragraph">
<p>The Result Specification is passed to the annotator instance by calling its setResultSpecificaiton method (this call is typically done by the framework, based on Capability specifications).  When called, the default implementation saves the result specification in an instance variable of the Annotator instance, which can be accessed by the annotator using the protected <code>getResultSpecification()</code> method.</p>
</div>
<div class="paragraph">
<p>A Result Specification is a list of output types and / or type:feature names, catagorized by language(s), which are expected to be output from (produced by) the annotator.
Annotators may use this to optimize their operations, when possible, for those cases where only particular outputs are wanted.
The interface to the Result Specification object (see the Javadocs) allows querying both types and particular features of types.</p>
</div>
<div class="paragraph">
<p>The languages specifications used by Result Specifications are the same that are specifiable in Capability Specifications; examples include "en" for English, "en-uk" for British English, etc.
There is also a language type, "x-unspecified", which is presumed if no language specification(s) are given.</p>
</div>
<div class="paragraph">
<p>If a query of the Result Specification doesn&#8217;t include a language, it is treated as if the  language "x-unspecified" was specified.
Language matching is hierarchically defaulted, in one direction: if a query includes the language "en-uk", meaning that the document being processed is in that language, it will match Result Specifications whose languages "en-uk", "en", or "x-unspecified".  In other words, if the  Result Specifications say to produce output if the actual document&#8217;s language is en-uk, or en, or x-unspecified, then having the actual document&#8217;s language be en-uk would "match" any of these Result Specifications.
However the reverse is not true: If the query asks about producing output if the actual document&#8217;s language is "x-unspecified",  then it would not match if the Result Specification said to produce output only if the  actual document is en-uk or en;  the Result Specification would need to say to  produce output for "x-unspecified).</p>
</div>
<div class="paragraph">
<p>If the Result Specification indicates it wants output produced for "en-uk", but the annotator is given a language which is unknown,  or one that is known, but isn&#8217;t "en-uk", then the query (using the language  of the document) will return false.
This is true even if the language is "en".   However, if the Result Specification indicates it wants output for "en",  and the query is for a document whose language is "en-uk" then the query will return true.</p>
</div>
<div class="paragraph">
<p>Sometimes you can specify the Result Specification; othertimes, you cannot (for instance, inside a Collection Processing Engine, you cannot). When you cannot specify it, or choose not to specify it (for example, using the form of the process(&#8230;&#8203;) call on an Analysis Engine that doesn&#8217;t include the Result Specification), a &#8220;Default&#8221; Result Specification is used.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.result_spec.default"><a class="anchor" href="#ugr.tug.aae.result_spec.default"></a>Default ResultSpecification</h5>
<div class="paragraph">
<p>The default Result Specification is taken from the Engine&#8217;s output Capability Specification.
Remember that a Capability Specification has both inputs and outputs, can specify types and / or features, and there can be more than one Capability Set.
If there is more than one set, the logical union by language of these sets is used.
Each set can have a different "language(s)" specified; the default Result Specification  will have the outputs by language(s), so that the annotator can query which outputs  should be provided for particular languages.
The methods to query the Result Specification take a type and (optionally) a feature, and optionally, a language.
If the queried type is a subtype of some otherwise matching type in the Result Specification, it will match the query.
See the Javadocs for more details on this.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.result_spec.passing_to_annotators"><a class="anchor" href="#ugr.tug.aae.result_spec.passing_to_annotators"></a>Passing Result Specifications to Annotators</h5>
<div class="paragraph">
<p>If you are not using a Collection Processing Engine, you can specify a Result Specification for your AnalysisEngine(s) by calling the <code>AnalysisEngine.setResultSpecification(ResultSpecification)</code> method.</p>
</div>
<div class="paragraph">
<p>It is also possible to pass a Result Specification on each call to <code>AnalysisEngine.process(CAS, ResultSpecification)</code>.
However, this is not recommended if your Result Specification will stay constant across multiple calls to <code>process</code>.
In that case it will be more efficient to call <code>AnalysisEngine.setResultSpecification(ResultSpecification)</code> only when the Result Specification changes.</p>
</div>
<div class="paragraph">
<p>For primitive Analysis Engines, whatever Result Specification you pass in is passed along to the annotator&#8217;s <code>setResultSpecification(ResultSpecification)</code> method.
For aggregate Analysis Engines, see below.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.result_spec.aggregates"><a class="anchor" href="#ugr.tug.aae.result_spec.aggregates"></a>Aggregates</h5>
<div class="paragraph">
<p>For aggregate engines, the Result Specification passed to the <code>AnalysisEngine.setResultSpecification(ResultSpecification)</code> method is intended to specify the set of output types/features that the aggregate should produce.
This is not necessarily equivalent to the set of output types/features that each annotator should produce.
For example, an annotator may need to produce an intermediate type that is then consumed by a downstream annotator, even though that intermediate type is not part of the Result Specification.</p>
</div>
<div class="paragraph">
<p>To handle this situation, when <code>AnalysisEngine.setResultSpecification(ResultSpecification)</code> is called on an aggregate, the framework computes the union of the passed Result Specification with the set of <em>all</em> input types and features of <em>all</em> component AnalysisEngines within that aggregate.
This forms the complete set of types and features that any component of the aggregate might need to produce.
This derived Result Specification is then intersected with the  delegate&#8217;s output capabilities, and the result is passed to the <code>AnalysisEngine.setResultSpecification(ResultSpecification)</code> of each component AnalysisEngine.
In the case of nested aggregates, this procedure is applied recursively.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.result_spec.aggregates.cpes"><a class="anchor" href="#ugr.tug.aae.result_spec.aggregates.cpes"></a>Collection Proessing Engines</h5>
<div class="paragraph">
<p>The Default Result Specification is always used for all components of a Collection Processing Engine.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.classpath_when_using_jcas"><a class="anchor" href="#ugr.tug.aae.classpath_when_using_jcas"></a>1.5.6. Class path setup when using JCas</h4>
<div class="paragraph">
<p>JCas provides Java classes that correspond to each CAS type in an application.
These classes are generated by the JCasGen utility (which can be automatically invoked from the Component Descriptor Editor).</p>
</div>
<div class="paragraph">
<p>The Java source classes generated by the JCasGen utility are typically compiled and packaged into a JAR file.
This JAR file must be present in the classpath of the UIMA application.</p>
</div>
<div class="paragraph">
<p>There can be<a href="ref.html#ugr.ref.jcas.class_loaders">issues</a> around setting up this class path, including deployment issues where class loaders are being used to isolate multiple UIMA applications inside a single running Java Virtual Machine.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.using_shell_scripts"><a class="anchor" href="#ugr.tug.aae.using_shell_scripts"></a>1.5.7. Using the Shell Scripts</h4>
<div class="paragraph">
<p>The SDK includes a <code>/bin</code> subdirectory containing shell scripts, for Windows (.bat files) and Unix (.sh files). Many of these scripts invoke sample Java programs which require a class path; they call a common shell script, <code>setUimaClassPath</code> to set up the UIMA required files and directories on the class path.</p>
</div>
<div class="paragraph">
<p>If you need to include files on the class path, the scripts will add anything you specify in the environment variables CLASSPATH or UIMA_CLASSPATH to the classpath.
So, for example, if you are running the document analyzer, and wanted it to find a Java class file named (on Windows) c:\a\b\c\myProject\myJarFile.jar, you could first issue a <code>set</code> command to set the UIMA_CLASSPATH to this file, followed by the documentAnalyzer script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>set UIMA_CLASSPATH=c:\a\b\c\myProject\myJarFile.jar
documentAnalyzer</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other environment variables are used by the shell scripts, as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Environment variables used by the shell scripts</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Environment Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UIMA_HOME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path where the UIMA SDK was installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JAVA_HOME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) Path to a Java Runtime Environment. If not set, the Java JRE that is in your system PATH is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UIMA_CLASSPATH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) if specified, a path specification to use as the default ClassPath.  You can also set the CLASSPATH variable.  If you set both, they will be concatenated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UIMA_DATAPATH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) if specified, a path specification to use as the default <a href="ref.html#ugr.ref.xml.component_descriptor.datapath">DataPath</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UIMA_LOGGER_CONFIG_FILE`</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) if specified, a path to a Java Logger properties file (see <a href="#ugr.tug.aae.configuration_logging">Section 1.2</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UIMA_JVM_OPTS`</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) if specified, the JVM arguments to be used when the Java process is started.  This can be used for example to set the maximum Java heap size or to define system properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VNS_PORT`</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) if specified, the network IP port number of the <a href="#ugr.tug.application.vns">Vinci Name Server (VNS)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ECLIPSE_HOME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) Needs to be set to the root of your Eclipse installation when using shell scripts that invoke Eclipse (e.g. <code>jcasgen_merge</code>)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aae.common_pitfalls"><a class="anchor" href="#ugr.tug.aae.common_pitfalls"></a>1.6. Common Pitfalls</h3>
<div class="paragraph">
<p>Here are some things to avoid doing in your annotator code:</p>
</div>
<div class="paragraph">
<p><strong>Do not retain references to JCas objects between calls to process() for different CASes</strong></p>
</div>
<div class="paragraph">
<p>The JCas will be cleared between calls to your annotator&#8217;s <code>process()</code> method for each new CAS.
All of the analysis results related to the previous document will be deleted to make way for analysis of a new document.
Therefore, you should never save a reference to a JCas Feature Structure object (i.e.
an instance of a class created using JCasGen) and attempt to reuse it in a future invocation of the <code>process()</code> method.
If you do so, the results will be undefined.</p>
</div>
<div class="paragraph">
<p><strong>Careless use of static data</strong></p>
</div>
<div class="paragraph">
<p>Always keep in mind that an application that uses your annotator may create multiple instances of your annotator class.
A multithreaded application may attempt to use two instances of your annotator to process two different documents simultaneously.
This will generally not cause any problems as long as your annotator instances do not share static data.</p>
</div>
<div class="paragraph">
<p>In general, you should not use static variables other than static final constants of primitive data types (String, int, float, etc). Other types of static variables may allow one annotator instance to set a value that affects another annotator instance, which can lead to unexpected effects.
Also, static references to classes that aren&#8217;t thread-safe are likely to cause errors in multithreaded applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aae.viewing_uima_objects_in_eclipse_debugger"><a class="anchor" href="#ugr.tug.aae.viewing_uima_objects_in_eclipse_debugger"></a>1.7. UIMA Objects in Eclipse Debugger</h3>
<div class="paragraph">
<p>Eclipse has a feature for viewing Java Logical Structures.
When enabled, it will permit you to see a view of UIMA objects (such as feature structure instances, CAS or JCas instances, etc.) which displays the logical subparts.
For example, here is a view of a feature structure for the RoomNumber annotation, from the tutorial example 1:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image046.jpg" alt="image046">
</div>
<div class="title">Figure 22. Screenshot of Eclipse debugger showing non-logical-structure display of a feature structure</div>
</div>
<div class="paragraph">
<p>The &#8220;annotation&#8221; object in Java shows the internals of the JCas object, not very convenient for seeing the features or the part of the input that is being annotated.
But if you turn on the Java Logical Structure mode by pushing this button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image048.jpg" alt="image048">
</div>
<div class="title">Figure 23. Screenshot of Eclipse debugger showing button to push to enable viewing logical structures</div>
</div>
<div class="paragraph">
<p>The features of the FeatureStructure instance will be shown:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.aae/image050.jpg" alt="image050">
</div>
<div class="title">Figure 24. Screenshot of Eclipse debugger showing logical structure display of an annotation</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aae.xml_intro_ae_descriptor"><a class="anchor" href="#ugr.tug.aae.xml_intro_ae_descriptor"></a>1.8. Introduction to Analysis Engine Descriptor XML Syntax</h3>
<div class="paragraph">
<p>This section is an introduction to the syntax used for Analysis Engine Descriptors.
Most users do not need to understand these details; they can use the Component Descriptor Editor Eclipse plugin to edit Analysis Engine Descriptors rather than editing the XML directly.</p>
</div>
<div class="paragraph">
<p>This section walks through the actual XML descriptor for the RoomNumberAnnotator example introduced in section <a href="#ugr.tug.aae.getting_started">Section 1.1</a>.
The discussion is divided into several logical sections of the descriptor.</p>
</div>
<div class="paragraph">
<p>The full specification for Analysis Engine Descriptors is defined in <a href="ref.html#ugr.ref.xml.component_descriptor">Component Descriptor Reference</a>.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.header_annotator_class_identification"><a class="anchor" href="#ugr.tug.aae.header_annotator_class_identification"></a>1.8.1. Header and Annotator Class Identification</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!--  Descriptor for the example RoomNumberAnnotator. --&gt;
&lt;analysisEngineDescription xmlns="http://uima.apache.org/resourceSpecifier"&gt;
  &lt;frameworkImplementation&gt;org.apache.uima.java&lt;/frameworkImplementation&gt;
  &lt;primitive&gt;true&lt;/primitive&gt;
  &lt;annotatorImplementationName&gt;
    org.apache.uima.tutorial.ex1.RoomNumberAnnotator
  &lt;/annotatorImplementationName&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The document begins with a standard XML header and a comment.
The root element of the document is named <code>&lt;analysisEngineDescription&gt;,</code> and must specify the XML namespace <code><a href="http://uima.apache.org/resourceSpecifier" class="bare">http://uima.apache.org/resourceSpecifier</a></code>.</p>
</div>
<div class="paragraph">
<p>The first subelement, <code>&lt;frameworkImplementation&gt;</code>, must contain the value <code>org.apache.uima.java</code>.
The second subelement, <code>&lt;primitive&gt;</code>, contains the Boolean value true, indicating that this XML document describes a <em>Primitive</em> Analysis Engine.
A Primitive Analysis Engine is comprised of a single annotator.
It is also possible to construct XML descriptors for non-primitive or <em>Aggregate</em> Analysis Engines; this is covered later.</p>
</div>
<div class="paragraph">
<p>The next element, <code>&lt;annotatorImplementationName&gt;</code>, contains the fully-qualified class name of our annotator class.
This is how the UIMA framework determines which annotator class to instantiate.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.xml_intro_simple_metadata_attributes"><a class="anchor" href="#ugr.tug.aae.xml_intro_simple_metadata_attributes"></a>1.8.2. Simple Metadata Attributes</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;analysisEngineMetaData&gt;
  &lt;name&gt;Room Number Annotator&lt;/name&gt;
  &lt;description&gt;An example annotator that searches for room numbers in
     the IBM Watson research buildings.&lt;/description&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;vendor&gt;The Apache Software Foundation&lt;/vendor&gt;&lt;/para&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are shown four simple metadata fields –name, description, version, and vendor.
Providing values for these fields is optional, but recommended.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.xml_intro_type_system_definition"><a class="anchor" href="#ugr.tug.aae.xml_intro_type_system_definition"></a>1.8.3. Type System Definition</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;typeSystemDescription&gt;
  &lt;imports&gt;
    &lt;import location="TutorialTypeSystem.xml"/&gt;
  &lt;/imports&gt;
&lt;/typeSystemDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This section of the XML descriptor defines which types the annotator works with.
The recommended way to do this is to <em>import</em> the type system definition from a separate file, as shown here.
The location specified here should be a relative path, and it will be resolved relative to the location of the aggregate descriptor.
It is also possible to define types directly in the Analysis Engine descriptor, but these types will not be easily shareable by others.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.xml_intro_capabilities"><a class="anchor" href="#ugr.tug.aae.xml_intro_capabilities"></a>1.8.4. Capabilities</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;capabilities&gt;
  &lt;capability&gt;
    &lt;inputs /&gt;
    &lt;outputs&gt;
      &lt;type&gt;org.apache.uima.tutorial.RoomNumber&lt;/type&gt;
      &lt;feature&gt;org.apache.uima.tutorial.RoomNumber:building&lt;/feature&gt;
    &lt;/outputs&gt;
  &lt;/capability&gt;
&lt;/capabilities&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last section of the descriptor describes the <em>Capabilities</em> of the annotator – the Types/Features it consumes (input) and the Types/Features that it produces (output). These must be the names of types and features that exist in the ANALYSIS ENGINE descriptor&#8217;s type system definition.</p>
</div>
<div class="paragraph">
<p>Our annotator outputs only one Type, RoomNumber and one feature, RoomNumber:building.
The fully-qualified names (including namespace) are needed.</p>
</div>
<div class="paragraph">
<p>The building feature is listed separately here, but clearly specifying every feature for a complex type would be cumbersome.
Therefore, a shortcut syntax exists.
The &lt;outputs&gt; section above could be replaced with the equivalent section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;outputs&gt;
  &lt;type allAnnotatorFeatures ="true"&gt;
     org.apache.uima.tutorial.RoomNumber
  &lt;/type&gt;
&lt;/outputs&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aae.xml_intro.configuration_parameters"><a class="anchor" href="#ugr.tug.aae.xml_intro.configuration_parameters"></a>1.8.5. Configuration Parameters (Optional)</h4>
<div class="sect4">
<h5 id="ugr.tug.aae.xml_intro.configuration_parameters_declarations"><a class="anchor" href="#ugr.tug.aae.xml_intro.configuration_parameters_declarations"></a>Configuration Parameter Declarations</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameters&gt;
  &lt;configurationParameter&gt;
    &lt;name&gt;Patterns&lt;/name&gt;
    &lt;description&gt;List of room number regular expression patterns.
    &lt;/description&gt;
    &lt;type&gt;String&lt;/type&gt;
    &lt;multiValued&gt;true&lt;/multiValued&gt;
    &lt;mandatory&gt;true&lt;/mandatory&gt;
  &lt;/configurationParameter&gt;
  &lt;configurationParameter&gt;
    &lt;name&gt;Locations&lt;/name&gt;
    &lt;description&gt;List of locations corresponding to the room number
       expressions specified by the Patterns parameter.
    &lt;/description&gt;
    &lt;type&gt;String&lt;/type&gt;
    &lt;multiValued&gt;true&lt;/multiValued&gt;
    &lt;mandatory&gt;true&lt;/mandatory&gt;
  &lt;/configurationParameter&gt;
&lt;/configurationParameters&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;configurationParameters&gt;</code> element contains the definitions of the configuration parameters that our annotator accepts.
We have declared two parameters.
For each configuration parameter, the following are specified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>– the name that the annotator code uses to refer to the parameter</p>
</li>
<li>
<p><strong>description</strong>– a natural language description of the intent of the parameter</p>
</li>
<li>
<p><strong>type</strong>– the data type of the parameter&#8217;s value – must be one of String, Integer, Float, or Boolean.</p>
</li>
<li>
<p><strong>multiValued</strong>– true if the parameter can take multiple-values (an array), false if the parameter takes only a single value.</p>
</li>
<li>
<p><strong>mandatory</strong>– true if a value must be provided for the parameter</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both of our parameters are mandatory and accept an array of Strings as their value.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.xml_intro_configuration_parameter_settings"><a class="anchor" href="#ugr.tug.aae.xml_intro_configuration_parameter_settings"></a>Configuration Parameter Settings</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameterSettings&gt;
  &lt;nameValuePair&gt;
    &lt;name&gt;Patterns&lt;/name&gt;
    &lt;value&gt;
      &lt;array&gt;
        &lt;string&gt;b[0-4]d-[0-2]ddb&lt;/string&gt;
        &lt;string&gt;b[G1-4][NS]-[A-Z]ddb&lt;/string&gt;
        &lt;string&gt;bJ[12]-[A-Z]ddb&lt;/string&gt;
      &lt;/array&gt;
    &lt;/value&gt;
  &lt;/nameValuePair&gt;
  &lt;nameValuePair&gt;
    &lt;name&gt;Locations&lt;/name&gt;
    &lt;value&gt;
      &lt;array&gt;
        &lt;string&gt;Watson - Yorktown&lt;/string&gt;
        &lt;string&gt;Watson - Hawthorne I&lt;/string&gt;
        &lt;string&gt;Watson - Hawthorne II&lt;/string&gt;
      &lt;/array&gt;
    &lt;/value&gt;
  &lt;/nameValuePair&gt;
&lt;/configurationParameterSettings&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.aae.xml_intro.aggregate"><a class="anchor" href="#ugr.tug.aae.xml_intro.aggregate"></a>Aggregate Analysis Engine Descriptor</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;analysisEngineDescription xmlns="http://uima.apache.org/resourceSpecifier"&gt;
  &lt;frameworkImplementation&gt;org.apache.uima.java&lt;/frameworkImplementation&gt;
  &lt;primitive&gt;false&lt;/primitive&gt;

  &lt;delegateAnalysisEngineSpecifiers&gt;
    &lt;delegateAnalysisEngine key="RoomNumber"&gt;
      &lt;import location="../ex2/RoomNumberAnnotator.xml"/&gt;
    &lt;/delegateAnalysisEngine&gt;
    &lt;delegateAnalysisEngine key="DateTime"&gt;
      &lt;import location="TutorialDateTime.xml" /&gt;
    &lt;/delegateAnalysisEngine&gt;
  &lt;/delegateAnalysisEngineSpecifiers&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first difference between this descriptor and an individual annotator&#8217;s descriptor is that the <code>&lt;primitive&gt;</code> element contains the value <code>false</code>.
This indicates that this Analysis Engine (AE) is an aggregate AE rather than a primitive AE.</p>
</div>
<div class="paragraph">
<p>Then, instead of a single annotator class name, we have a list of <code>delegateAnalysisEngineSpecifiers</code>.
Each specifies one of the components that constitute our Aggregate . We refer to each component by the relative path from this XML descriptor to the component AE&#8217;s XML descriptor.</p>
</div>
<div class="paragraph">
<p>This list of component AEs does not imply an ordering of them in the execution pipeline.
Ordering is done by another section of the descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;analysisEngineMetaData&gt;
  &lt;name&gt;Aggregate AE - Room Number and DateTime Annotators&lt;/name&gt;
  &lt;description&gt;Detects Room Numbers, Dates, and Times&lt;/description&gt;
  &lt;flowConstraints&gt;
    &lt;fixedFlow&gt;
      &lt;node&gt;RoomNumber&lt;/node&gt;
      &lt;node&gt;DateTime&lt;/node&gt;
    &lt;/fixedFlow&gt;
  &lt;/flowConstraints&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, a fixedFlow is adequate, and we specify the exact ordering in which the AEs will be executed.
In this case, it doesn&#8217;t really matter, since the RoomNumber and DateTime annotators do not have any dependencies on one another.</p>
</div>
<div class="paragraph">
<p>Finally, the descriptor has a capabilities section, which has exactly the same syntax as a primitive AE&#8217;s capabilities section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;capabilities&gt;
  &lt;capability&gt;
    &lt;inputs /&gt;
    &lt;outputs&gt;
      &lt;type allAnnotatorFeatures="true"&gt;
        org.apache.uima.tutorial.RoomNumber
      &lt;/type&gt;
      &lt;type allAnnotatorFeatures="true"&gt;
        org.apache.uima.tutorial.DateAnnot
      &lt;/type&gt;
      &lt;type allAnnotatorFeatures="true"&gt;
        org.apache.uima.tutorial.TimeAnnot
      &lt;/type&gt;
    &lt;/outputs&gt;
    &lt;languagesSupported&gt;
      &lt;language&gt;en&lt;/language&gt;
    &lt;/languagesSupported&gt;
  &lt;/capability&gt;
&lt;/capabilities&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.tug.cpe"><a class="anchor" href="#ugr.tug.cpe"></a>2. Collection Processing Engine Developer&#8217;s Guide</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The CPE (Collection Processing Engine) was an early approach to supporting some scale-out use cases.
It is an older approach that doesn&#8217;t support some of the newer features of CASes  such as multiple views and CAS Multipliers.
It has been supplanted by UIMA-AS, which has full support for the new features.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The UIMA Analysis Engine interface provides support for developing and integrating algorithms that analyze unstructured data.
Analysis Engines are designed to operate on a per-document basis.
Their interface handles one CAS at a time.
UIMA provides additional support for applying analysis engines to collections of unstructured data with its <em>Collection Processing Architecture</em>.
The Collection Processing Architecture defines additional components for reading raw data formats from data collections, preparing the data for processing by Analysis Engines, executing the analysis, extracting analysis results, and deploying the overall flow in a variety of local and distributed configurations.</p>
</div>
<div class="paragraph">
<p>The functionality defined in the Collection Processing Architecture is implemented by a <em>Collection Processing Engine</em> (CPE). A CPE includes an Analysis Engine and adds a <em>Collection Reader</em>, a <em>CAS Initializer</em> (deprecated as of version 2), and <em>CAS
    Consumers</em>.
The part of the UIMA Framework that supports the execution of CPEs is called the Collection Processing Manager, or CPM.</p>
</div>
<div class="paragraph">
<p>A Collection Reader provides the interface to the raw input data and knows how to iterate over the data collection.
Collection Readers are discussed in <a href="#ugr.tug.cpe.collection_reader.developing">Section 2.4.1</a>.
The CAS Initializer <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup> prepares an individual data item for analysis and loads it into the CAS.
CAS Initializers are discussed in <a href="#ugr.tug.cpe.cas_initializer.developing">Section 2.4.2</a> A CAS Consumer extracts analysis results from the CAS and may also perform <em>collection level
    processing</em>, or analysis over a collection of CASes.
CAS Consumers are discussed in <a href="#ugr.tug.cpe.cas_consumer.developing">Section 2.4.3</a>.</p>
</div>
<div class="paragraph">
<p>Analysis Engines and CAS Consumers are both instances of <em>CAS
    Processors</em>.
A Collection Processing Engine (CPE) may contain multiple CAS Processors.
An Analysis Engine contained in a CPE may itself be a Primitive or an Aggregate (composed of other Analysis Engines). Aggregates may contain Cas Consumers.
While Collection Readers and CAS Initializers always run in the same JVM as the CPM, a CAS Processor may be deployed in a variety of local and distributed modes, providing a number of options for scalability and robustness.
The different deployment options are covered in detail in <a href="#ugr.tug.cpe.deployment_alternatives">Section 2.5.1</a>.</p>
</div>
<div class="paragraph">
<p>Each of the components in a CPE has an interface specified by the UIMA Collection Processing Architecture and is described by a declarative XML descriptor file.
Similarly, the CPE itself has a well defined component interface and is described by a declarative XML descriptor file.</p>
</div>
<div class="paragraph">
<p>A user creates a CPE by assembling the components mentioned above.
The UIMA SDK provides a graphical tool, called the CPE Configurator, for assisting in the assembly of CPEs.
Use of this tool is summarized in <a href="#ugr.tug.cpe.cpe_configurator">Section 2.2.1</a>, and more details can be found in <a href="tools.html#ugr.tools.cpe">Collection Processing Engine Configurator User’s Guide</a>.
Alternatively, a CPE can be assembled by writing an XML CPE descriptor.
Details on the CPE descriptor, including its syntax and content, can be found in the <a href="ref.html#ugr.ref.xml.cpe_descriptor">Collection Processing Engine Descriptor Reference</a>.
The individual components have associated XML descriptors, each of which can be created and / or edited using the <a href="tools.html#ugr.tools.cde">Component Description Editor</a>.</p>
</div>
<div class="paragraph">
<p>A CPE is executed by a UIMA infrastructure component called the <em>Collection Processing Manager</em> (CPM). The CPM provides a number of services and deployment options that cover instantiation and execution of CPEs, error recovery, and local and distributed deployment of the CPE components.</p>
</div>
<div class="sect2">
<h3 id="ugr.tug.cpe.concepts"><a class="anchor" href="#ugr.tug.cpe.concepts"></a>2.1. CPE Concepts</h3>
<div class="paragraph">
<p><a href="#ugr.tug.cpe.fig.cpe_components">Figure 25</a> illustrates the data flow that occurs between the different types of components that make up a CPE.</p>
</div>
<div id="ugr.tug.cpe.fig.cpe_components" class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image002.png" alt="CPE Components and flow between them">
</div>
<div class="title">Figure 25. CPE Components</div>
</div>
<div class="paragraph">
<p>The components of a CPE are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Collection Reader –</em> interfaces to a collection of data items (e.g., documents) to be analyzed. Collection Readers return CASes that contain the documents to analyze, possibly along with additional metadata.</p>
</li>
<li>
<p><em>Analysis Engine –</em> takes a CAS, analyzes its contents, and produces an enriched CAS. Analysis Engines can be recursively composed of other Analysis Engines (called an <em>Aggregate</em> Analysis Engine). Aggregates may also contain CAS Consumers.</p>
</li>
<li>
<p><em>CAS Consumer –</em> consume the enriched CAS that was produced by the sequence of Analysis Engines before it, and produce an application-specific data structure, such as a search engine index or database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A fourth type of component, the <em>CAS Initializer,</em> may be used by a Collection Reader to populate a CAS from a document.
However, as of UIMA version 2 CAS Initializers are now deprecated in favor of a more general mechsanism, multiple Subjects of Analysis.</p>
</div>
<div class="paragraph">
<p>The Collection Processing Manager orchestrates the data flow within a CPE, monitors status, optionally manages the life-cycle of internal components and collects statistics.</p>
</div>
<div class="paragraph">
<p>CASes are not saved in a persistent way by the framework.
If you want to save CASes, then you have to save each CAS as it comes through (for example) using a CAS Consumer you write to do this, in whatever format you like.
The UIMA SDK supplies an example CAS Consumer to save CASes to XML files, either in the standard XMI format or in an older format called XCAS.
It also supplies an example CAS Consumer to extract information from CASes and store the results into a relational Database, using Java&#8217;s JDBC APIs.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cpe.configurator_and_viewer"><a class="anchor" href="#ugr.tug.cpe.configurator_and_viewer"></a>2.2. CPE Configurator and CAS viewer</h3>
<div class="sect3">
<h4 id="ugr.tug.cpe.cpe_configurator"><a class="anchor" href="#ugr.tug.cpe.cpe_configurator"></a>2.2.1. Using the CPE Configurator</h4>
<div class="paragraph">
<p>A CPE can be assembled by writing an XML CPE descriptor.
Details on the CPE descriptor, including its syntax and content, can be found in <a href="ref.html#ugr.ref.xml.cpe_descriptor">Collection Processing Engine Descriptor Reference</a>.
Rather than edit raw XML, you may develop a CPE Descriptor using the CPE Configurator tool.
The CPE Configurator tool is described briefly in this section, and in more detail in <a href="tools.html#ugr.tools.cpe">Collection Processing Engine Configurator User’s Guide</a>.</p>
</div>
<div class="paragraph">
<p>The CPE Configurator tool can be run from Eclipse (see <a href="#ugr.tug.cpe.running_cpe_configurator_from_eclipse">Section 2.2.2</a>, or using the <code>cpeGui</code> shell script (<code>cpeGui.bat</code> on Windows, <code>cpeGui.sh</code> on Unix), which is located in the <code>bin</code> directory of the UIMA SDK installation.
Executing this batch file will display the window shown here:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image004.jpg" alt="Screenshot of CPE GUI">
</div>
</div>
<div class="paragraph">
<p>The window is divided into three sections, one each for the Collection Reader,  Analysis Engines, and CAS Consumers.<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup>  In each section, you select the component(s) you want to include in the CPE by  browsing to their XML descriptors.
The configuration parameters present in the XML  descriptors will then be displayed in the GUI; these can be modified to override the values present in the descriptor.
For example, the screen shot below shows the  CPE Configurator after the following components have been chosen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Collection Reader:
   %UIMA_HOME%/examples/descriptors/collection_reader/
          FileSystemCollectionReader.xml

Analysis Engine:
   %UIMA_HOME%/examples/descriptors/analysis_engine/
          NamesAndPersonTitles_TAE.xml

CAS Consumer:
    %UIMA_HOME%/examples/descriptors/cas_consumer/
          XmiWriterCasConsumer.xml</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image006.jpg" alt="Screenshot of CPE GUI after fields filled in">
</div>
</div>
<div class="paragraph">
<p>For the File System Collection Reader, ensure that the Input Directory is set to `%UIMA_HOME%\examples\data`<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>.
The other parameters may be left blank.
For the External CAS Writer CAS Consumer, ensure that the Output Directory is set to <code>%UIMA_HOME%\examples\data\processed</code>.</p>
</div>
<div class="paragraph">
<p>After selecting each of the components and providing configuration settings, click the play (forward arrow) button at the bottom of the screen to begin processing.
A progress bar should be displayed in the lower left corner.
(Note that the progress bar will not begin to move until all components have completed their initialization, which may take several seconds.) Once processing has begun, the pause and stop buttons become enabled.</p>
</div>
<div class="paragraph">
<p>If an error occurs, you will be informed by an error dialog.
If processing completes successfully, you will be presented with a performance report.</p>
</div>
<div class="paragraph">
<p>Using the File menu, you can select <code>Save CPE Descriptor </code>to create an .xml descriptor file that defines the CPE you have constructed.
Later, you can use <code>Open CPE Descriptor</code> to restore the CPE Configurator to the saved state.
Also, CPE descriptors can be used to run a CPE from a Java program – see section <a href="#ugr.tug.cpe.running_cpe_from_application">Section 2.3</a>.
CPE Descriptors allow specifying operational parameters, such as error handling options, that are not currently available for configuration through the CPE Configurator.
For more information on manually creating a CPE Descriptor, see the <a href="ref.html#ugr.ref.xml.cpe_descriptor">Collection Processing Engine Descriptor Reference</a>.</p>
</div>
<div class="paragraph">
<p>The CPE configured above runs a simple name and title annotator on the sample data provided with the UIMA SDK and stores the results using the XMI Writer CAS Consumer.
To view the results, start the External CAS Annotation Viewer by running the <code>annotationViewer</code> batch file (<code>annotationViewer.bat</code> on Windows, <code>annotationViewer.sh</code> on Unix), which is located in the <code>bin</code> directory of the UIMA SDK installation.
Executing this batch file will display the window shown here:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image008.jpg" alt="Screenshot of Annotation Viewer results">
</div>
</div>
<div class="paragraph">
<p>Ensure that the Input Directory is the same as the Output Directory specified for the XMI Writer CAS Consumer in the CPE configured above (e.g., <code>%UIMA_HOME%\examples\data\processed</code>) and that the TAE Descriptor File is set to the Analysis Engine used in the CPE configured above (e.g., <code>examples\descriptors\analysis_engine\NamesAndPersonTitles_TAE.xml</code> ).</p>
</div>
<div class="paragraph">
<p>Click the View button to display the Analyzed Documents window:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image010.jpg" alt="Screenshot of CPE Configurator Analyzed Documents">
</div>
</div>
<div class="paragraph">
<p>Double click on any document in the list to view the analyzed document.
Double clicking the first document, IBM_LifeSciences.txt, will bring up the following window:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image012.jpg" alt="Screenshot of Document and Annotation Viewer">
</div>
</div>
<div class="paragraph">
<p>This window shows the analysis results for the document.
Clicking on any highlighted annotation causes the details for that annotation to be displayed in the right-hand pane.
Here the annotation spanning &#8220;John M. Thompson&#8221; has been clicked.</p>
</div>
<div class="paragraph">
<p>Congratulations! You have successfully configured a CPE, saved its descriptor, run the CPE, and viewed the analysis results.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cpe.running_cpe_configurator_from_eclipse"><a class="anchor" href="#ugr.tug.cpe.running_cpe_configurator_from_eclipse"></a>2.2.2. Running the CPE Configurator from Eclipse</h4>
<div class="paragraph">
<p>If you have followed the instructions in the <a href="oas.html#ugr.ovv.eclipse_setup">Setup Guide</a> and imported the example Eclipse project, then you should already have a Run configuration for the CPE Configurator tool (called <em>UIMA CPE GUI</em>) configured to run in the example project.
Simply run that configuration to start the CPE Configurator.</p>
</div>
<div class="paragraph">
<p>If you have not followed the Eclipse setup instructions and wish to run the CPE Configurator tool from Eclipse, you will need to do the following.
As installed, this Eclipse launch configuration is associated with the <code>uimaj-examples</code> project.
If you&#8217;ve not already done so, you may wish to import that project into your Eclipse workspace.
It&#8217;s located in <code>%UIMA_HOME%/docs/examples</code>.
Doing this will supply the Eclipse launcher with all the class files it needs to run the CPE configurator.
If you don&#8217;t do this, please manually add the JAR files for UIMA to the launch configuration.</p>
</div>
<div class="paragraph">
<p>Also, you need to add any projects or JAR files for any UIMA components you will be running to the launch class path.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A simpler alternative may be to change the CPE launch configuration to be based on your project.
If you do that, it will pick up all the files in your project&#8217;s class path, which you should set up to include all the UIMA framework files.
An easy way to do this is to specify in your project&#8217;s properties' build-path that the uimaj-examples project is on the build path, because the uimaj-examples project is set up to include all the UIMA framework classes in its classpath already.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, in the Eclipse menu select <em>Run → Run&#8230;&#8203;</em>, which brings up the Run configuration screen.</p>
</div>
<div class="paragraph">
<p>In the Main tab, set the main class to <code>org.apache.uima.tools.cpm.CpmFrame</code></p>
</div>
<div class="paragraph">
<p>In the arguments tab, add the following to the VM arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>-Xms128M -Xmx256M
-Duima.home="C:\Program Files\Apache\uima"</code></pre>
</div>
</div>
<div class="paragraph">
<p>(or wherever you installed the UIMA SDK)</p>
</div>
<div class="paragraph">
<p>Click the Run button to launch the CPE Configurator, and use it as previously described in this section.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cpe.running_cpe_from_application"><a class="anchor" href="#ugr.tug.cpe.running_cpe_from_application"></a>2.3. Running a CPE from Your Own Java Application</h3>
<div class="paragraph">
<p>The simplest way to run a CPE from a Java application is to first create a CPE descriptor as described in the previous section.
Then the CPE can be instantiated and run using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>      //parse CPE descriptor in file specified on command line
CpeDescription cpeDesc = UIMAFramework.getXMLParser().
        parseCpeDescription(new XMLInputSource(args[0]));

      //instantiate CPE
mCPE = UIMAFramework.produceCollectionProcessingEngine(cpeDesc);

      //Create and register a Status Callback Listener
mCPE.addStatusCallbackListener(new StatusCallbackListenerImpl());

      //Start Processing
mCPE.process();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will start the CPE running in a separate thread.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>process()</code> method for a CPE can only be called once.
If you  need to call it again, you have to instantiate a new CPE, and call that new CPE&#8217;s process method.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ugr.tug.cpe.using_listeners"><a class="anchor" href="#ugr.tug.cpe.using_listeners"></a>2.3.1. Using Listeners</h4>
<div class="paragraph">
<p>Updates of the CPM&#8217;s progress, including any errors that occur, are sent to the callback handler that is registered by the call to <code>addStatusCallbackListener</code>, above.
The callback handler is a class that implements the CPM&#8217;s <code>StatusCallbackListener</code> interface.
It responds to events by printing messages to the console.
The source code is fairly straightforward and is not included in this chapter&#8201;&#8212;&#8201;see the <code>org.apache.uima.examples.cpe.SimpleRunCPE.java</code> in the <code>%UIMA_HOME%\examples\src</code> directory for the complete code.</p>
</div>
<div class="paragraph">
<p>If you need more control over the information in the CPE descriptor, you can manually configure it via its API.
See the Javadocs for package <code>org.apache.uima.collection</code> for more details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cpe.developing_collection_processing_components"><a class="anchor" href="#ugr.tug.cpe.developing_collection_processing_components"></a>2.4. Developing Collection Processing Components</h3>
<div class="paragraph">
<p>This section is an introduction to the process of developing Collection Readers, CAS Initializers, and CAS Consumers.
The code snippets refer to the classes that can be found in <code>%UIMA_HOME%\examples\src </code>example project.</p>
</div>
<div class="paragraph">
<p>In the following sections, classes you write to represent components need to be public and have public, no-args constructors, so that they can be instantiated by the framework.
(Although Java classes in which you do not define any constructor will, by default, have a no-args constructor that doesn&#8217;t do anything, a class in which you have defined at least one constructor does not get a default no-args constructor.)</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.cpe.collection_reader.developing"><a class="anchor" href="#ugr.tug.cpe.collection_reader.developing"></a>2.4.1. Developing Collection Readers</h4>
<div class="paragraph">
<p>A Collection Reader is responsible for obtaining documents from the collection and returning each document as a CAS.
Like all UIMA components, a Collection Reader consists of two parts —the code and an XML descriptor.</p>
</div>
<div class="paragraph">
<p>A simple example of a Collection Reader is the &#8220;File System Collection
        Reader,&#8221; which simply reads documents from files in a specified directory.
The Java code is in the class <code>org.apache.uima.examples.cpe.FileSystemCollectionReader</code> and the XML descriptor is <code>%UIMA_HOME%/examples/src/main/descriptors/collection_reader/
          FileSystemCollectionReader.xml</code>.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.cpe.collection_reader.java_class"><a class="anchor" href="#ugr.tug.cpe.collection_reader.java_class"></a>Java Class for the Collection Reader</h5>
<div class="paragraph">
<p>The Java class for a Collection Reader must implement the <code>org.apache.uima.collection.CollectionReader</code> interface.
You may build your Collection Reader from scratch and implement this interface, or you may extend the convenience base class <code>org.apache.uima.collection.CollectionReader_ImplBase</code> .</p>
</div>
<div class="paragraph">
<p>The convenience base class provides default implementations for many of the methods defined in the <code>CollectionReader</code> interface, and provides abstract definitions for those methods that you are required to implement in your new Collection Reader.
Note that if you extend this base class, you do not need to declare that your new Collection Reader implements the <code>CollectionReader</code> interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Eclipse tip –if you are using Eclipse, you can quickly create the boiler plate code and stubs for all of the required methods by clicking <code>File</code>→<code>New</code>→<code>Class</code> to bring up the &#8220;New Java Class&#8221; dialogue, specifying <code>org.apache.uima.collection.CollectionReader_ImplBase</code> as the Superclass, and checking &#8220;Inherited abstract methods&#8221; in the section &#8220;Which method stubs would you like to create?&#8221;, as in the  screenshot below:</p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image014.jpg" alt="Screenshot showing Eclipse new class wizard">
</div>
</div>
<div class="paragraph">
<p>For the rest of this section we will assume that your new Collection Reader extends the <code>CollectionReader_ImplBase</code> class, and we will show examples from the <code>org.apache.uima.examples.cpe.FileSystemCollectionReader</code> . If you must inherit from a different superclass, you must ensure that your Collection Reader implements the <code>CollectionReader</code> interface – see the Javadocs for <code>CollectionReader</code> for more details.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.cpe.collection_reader.required_methods"><a class="anchor" href="#ugr.tug.cpe.collection_reader.required_methods"></a>Required Methods in the Collection Reader class</h5>
<div class="paragraph">
<p>The following abstract methods must be implemented:</p>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.collection_reader.required_methods.initialize"><a class="anchor" href="#ugr.tug.cpe.collection_reader.required_methods.initialize"></a>initialize()</h6>
<div class="paragraph">
<p>The <code>initialize()</code> method is called by the framework when the Collection Reader is first created. <code>CollectionReader_ImplBase</code> actually provides a default implementation of this method (i.e., it is not abstract), so you are not strictly required to implement this method.
However, a typical Collection Reader will implement this method to obtain parameter values and perform various initialization steps.</p>
</div>
<div class="paragraph">
<p>In this method, the Collection Reader class can access the values of its configuration parameters and perform other initialization logic.
The example File System Collection Reader reads its configuration parameters and then builds a list of files in the specified input directory, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void initialize() throws ResourceInitializationException {
  File directory = new File(
            (String)getConfigParameterValue(PARAM_INPUTDIR));
  mEncoding = (String)getConfigParameterValue(PARAM_ENCODING);
  mDocumentTextXmlTagName = (String)getConfigParameterValue(PARAM_XMLTAG);
  mLanguage = (String)getConfigParameterValue(PARAM_LANGUAGE);
  mCurrentIndex = 0;

  //get list of files (not subdirectories) in the specified directory
  mFiles = new ArrayList();
  File[] files = directory.listFiles();
  for (int i = 0; i &lt; files.length; i++) {
    if (!files[i].isDirectory()) {
      mFiles.add(files[i]);
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This is the zero-argument version of the initialize method.
There is also a method on the Collection Reader interface called <code>initialize(ResourceSpecifier, Map)</code> but it is not recommended that you override this method in your code.
That method performs internal initialization steps and then calls the zero-argument <code>initialize()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.collection_reader.hasnext"><a class="anchor" href="#ugr.tug.cpe.collection_reader.hasnext"></a>hasNext()</h6>
<div class="paragraph">
<p>The <code>hasNext()</code> method returns whether or not there are any documents remaining to be read from the collection.
The File System Collection Reader&#8217;s <code>hasNext()</code> method is very simple.
It just checks if there are any more files left to be read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public boolean hasNext() {
  return mCurrentIndex &lt; mFiles.size();
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.collection_reader.required_methods.getnext"><a class="anchor" href="#ugr.tug.cpe.collection_reader.required_methods.getnext"></a>getNext(CAS)</h6>
<div class="paragraph">
<p>The <code>getNext()</code> method reads the next document from the collection and populates a CAS.
In the simple case, this amounts to reading the file and calling the CAS&#8217;s <code>setDocumentText</code> method.
The example File System Collection Reader is slightly more complex.
It first checks for a CAS Initializer.
If the CPE includes a CAS Initializer, the CAS Initializer is used to read the document, and <code>initialize()</code> the CAS.
If the CPE does not include a CAS Initializer, the File System Collection Reader reads the document and sets the document text in the CAS.</p>
</div>
<div class="paragraph">
<p>The File System Collection Reader also stores additional metadata about the document in the CAS.
In particular, it sets the document&#8217;s language in the special built-in feature structure <a href="ref.html#ugr.ref.cas.document_annotation"><code>uima.tcas.DocumentAnnotation</code></a> and creates an instance of <code>org.apache.uima.examples.SourceDocumentInformation</code>, which stores information about the document&#8217;s source location.
This information may be useful to downstream components such as CAS Consumers.
Note that the type system descriptor for this type can be found in <code>org.apache.uima.examples.SourceDocumentInformation.xml</code>, which is located in the <code>examples/src</code> directory.</p>
</div>
<div class="paragraph">
<p>The getNext() method for the File System Collection Reader looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  public void getNext(CAS aCAS) throws IOException, CollectionException {
    JCas jcas;
    try {
      jcas = aCAS.getJCas();
    } catch (CASException e) {
      throw new CollectionException(e);
    }

    // open input stream to file
    File file = (File) mFiles.get(mCurrentIndex++);
    BufferedInputStream fis =
            new BufferedInputStream(new FileInputStream(file));
    try {
      byte[] contents = new byte[(int) file.length()];
      fis.read(contents);
      String text;
      if (mEncoding != null) {
        text = new String(contents, mEncoding);
      } else {
        text = new String(contents);
      }
      // put document in CAS
      jcas.setDocumentText(text);
    } finally {
      if (fis != null)
        fis.close();
    }

    // set language if it was explicitly specified
    //as a configuration parameter
    if (mLanguage != null) {
      ((DocumentAnnotation) jcas.getDocumentAnnotationFs()).
            setLanguage(mLanguage);
    }

    // Also store location of source document in CAS.
    // This information is critical if CAS Consumers will
    // need to know where the original document contents
    // are located.
    // For example, the Semantic Search CAS Indexer
    // writes this information into the search index that
    // it creates, which allows applications that use the
    // search index to locate the documents that satisfy
    //their semantic queries.
    SourceDocumentInformation srcDocInfo =
            new SourceDocumentInformation(jcas);
    srcDocInfo.setUri(
            file.getAbsoluteFile().toURL().toString());
    srcDocInfo.setOffsetInSource(0);
    srcDocInfo.setDocumentSize((int) file.length());
    srcDocInfo.setLastSegment(
            mCurrentIndex == mFiles.size());
    srcDocInfo.addToIndexes();
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Collection Reader can create additional annotations in the CAS at this point, in the same way that annotators create annotations.</p>
</div>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.collection_reader.required_methods.getprogress"><a class="anchor" href="#ugr.tug.cpe.collection_reader.required_methods.getprogress"></a>getProgress()</h6>
<div class="paragraph">
<p>The Collection Reader is responsible for returning progress information; that is, how much of the collection has been read thus far and how much remains to be read.
The framework defines progress very generally; the Collection Reader simply returns an array of <code>Progress</code> objects, where each object contains three fields — the amount already completed, the total amount (if known), and a unit (e.g.
entities (documents), bytes, or files). The method returns an array so that the Collection Reader can report progress in multiple different units, if that information is available.
The File System Collection Reader&#8217;s <code>getProgress()</code> method looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public Progress[] getProgress() {
  return new Progress[]{
     new ProgressImpl(mCurrentIndex,mFiles.size(),Progress.ENTITIES)};
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this particular example, the total number of files in the collection is known, but the total size of the collection is not known.
As such, a <code>ProgressImpl</code> object for <code>Progress.ENTITIES</code> is returned, but a <code>ProgressImpl</code> object for <code>Progress.BYTES</code> is not.</p>
</div>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.collection_reader.required_methods.close"><a class="anchor" href="#ugr.tug.cpe.collection_reader.required_methods.close"></a>close()</h6>
<div class="paragraph">
<p>The close method is called when the Collection Reader is no longer needed.
The Collection Reader should then release any resources it may be holding.
The FileSystemCollectionReader does not hold resources and so has an empty implementation of this method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void close() throws IOException { }</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.collection_reader.optional_methods"><a class="anchor" href="#ugr.tug.cpe.collection_reader.optional_methods"></a>Optional Methods</h6>
<div class="paragraph">
<p>The following methods may be implemented:</p>
</div>
<div class="sect6">
<h7 id="ugr.tug.cpe.collection_reader.optional_methods.reconfigure"><a class="anchor" href="#ugr.tug.cpe.collection_reader.optional_methods.reconfigure"></a>reconfigure()</h7>
<div class="paragraph">
<p>This method is called if the Collection Reader&#8217;s configuration parameters change.</p>
</div>
</div>
<div class="sect6">
<h7 id="ugr.tug.cpe.collection_reader.optional_methods.typesysteminit"><a class="anchor" href="#ugr.tug.cpe.collection_reader.optional_methods.typesysteminit"></a>typeSystemInit()</h7>
<div class="paragraph">
<p>If you are only setting the document text in the CAS, or if you are using the JCas (recommended, as in the current example, you do not have to implement this method.
If you are directly using the CAS API, this method is used in the <a href="#ugr.tug.aae.contract_for_annotator_methods">same way as it is used for an annotator</a>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.collection_reader.threading"><a class="anchor" href="#ugr.tug.cpe.collection_reader.threading"></a>Threading considerations</h6>
<div class="paragraph">
<p>Collection readers do not have to be thread safe; they are run with a single thread per instance, and only one instance per instance of the Collection Processing Manager (CPM) is made.</p>
</div>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.collection_reader.descriptor"><a class="anchor" href="#ugr.tug.cpe.collection_reader.descriptor"></a>XML Descriptor for a Collection Reader</h6>
<div class="paragraph">
<p>You can use the Component Description Editor to create and / or edit the File System Collection Reader&#8217;s descriptor.
Here is its descriptor (abbreviated somewhat), which is very similar to an Analysis Engine descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;collectionReaderDescription
          xmlns="http://uima.apache.org/resourceSpecifier"&gt;
  &lt;frameworkImplementation&gt;org.apache.uima.java&lt;/frameworkImplementation&gt;
  &lt;implementationName&gt;
    org.apache.uima.examples.cpe.FileSystemCollectionReader
  &lt;/implementationName&gt;
  &lt;processingResourceMetaData&gt;
    &lt;name&gt;File System Collection Reader&lt;/name&gt;
    &lt;description&gt;Reads files from the filesystem.&lt;/description&gt;
    &lt;version&gt;1.0&lt;/version&gt;
    &lt;vendor&gt;The Apache Software Foundation&lt;/vendor&gt;
    &lt;configurationParameters&gt;
      &lt;configurationParameter&gt;
        &lt;name&gt;InputDirectory&lt;/name&gt;
        &lt;description&gt;Directory containing input files&lt;/description&gt;
        &lt;type&gt;String&lt;/type&gt;
        &lt;multiValued&gt;false&lt;/multiValued&gt;
        &lt;mandatory&gt;true&lt;/mandatory&gt;
      &lt;/configurationParameter&gt;
      &lt;configurationParameter&gt;
        &lt;name&gt;Encoding&lt;/name&gt;
        &lt;description&gt;Character encoding for the documents.&lt;/description&gt;
        &lt;type&gt;String&lt;/type&gt;
        &lt;multiValued&gt;false&lt;/multiValued&gt;
        &lt;mandatory&gt;false&lt;/mandatory&gt;
      &lt;/configurationParameter&gt;
      &lt;configurationParameter&gt;
        &lt;name&gt;Language&lt;/name&gt;
        &lt;description&gt;ISO language code for the documents&lt;/description&gt;
        &lt;type&gt;String&lt;/type&gt;
        &lt;multiValued&gt;false&lt;/multiValued&gt;
        &lt;mandatory&gt;false&lt;/mandatory&gt;
      &lt;/configurationParameter&gt;
    &lt;/configurationParameters&gt;
    &lt;configurationParameterSettings&gt;
      &lt;nameValuePair&gt;
        &lt;name&gt;InputDirectory&lt;/name&gt;
        &lt;value&gt;
          &lt;string&gt;C:/Program Files/apache/uima/examples/data&lt;/string&gt;
        &lt;/value&gt;
      &lt;/nameValuePair&gt;
    &lt;/configurationParameterSettings&gt;

    &lt;!-- Type System of CASes returned by this Collection Reader --&gt;

    &lt;typeSystemDescription&gt;
      &lt;imports&gt;
        &lt;import name="org.apache.uima.examples.SourceDocumentInformation"/&gt;
      &lt;/imports&gt;
    &lt;/typeSystemDescription&gt;

    &lt;capabilities&gt;
      &lt;capability&gt;
        &lt;inputs/&gt;
        &lt;outputs&gt;
          &lt;type allAnnotatorFeatures="true"&gt;
            org.apache.uima.examples.SourceDocumentInformation
          &lt;/type&gt;
        &lt;/outputs&gt;
      &lt;/capability&gt;
    &lt;/capabilities&gt;
    &lt;operationalProperties&gt;
      &lt;modifiesCas&gt;true&lt;/modifiesCas&gt;
      &lt;multipleDeploymentAllowed&gt;false&lt;/multipleDeploymentAllowed&gt;
      &lt;outputsNewCASes&gt;true&lt;/outputsNewCASes&gt;
    &lt;/operationalProperties&gt;
  &lt;/processingResourceMetaData&gt;
&lt;/collectionReaderDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cpe.cas_initializer.developing"><a class="anchor" href="#ugr.tug.cpe.cas_initializer.developing"></a>2.4.2. Developing CASInitializers</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>CAS Initializers are now deprecated (as of version 2.1). For complex initialization, please use instead the capabilities of creating see <a href="#ugr.tug.mvs">additional Subjects of Analysis</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In UIMA 1.x, the CAS Initializer component was intended to be used as a plug-in to the Collection Reader for when the task of populating the CAS from a raw document is complex and might be reusable with other data collections.</p>
</div>
<div class="paragraph">
<p>A CAS Initializer Java class must implement the interface <code>org.apache.uima.collection.CasInitializer</code>, and will also generally extend from the convenience base class <code>org.apache.uima.collection.CasInitializer_ImplBase</code>.
A CAS Initializer also must have an XML descriptor, which has the exact same form as a Collection Reader Descriptor except that the outer tag is <code>&lt;casInitializerDescription&gt;</code>.</p>
</div>
<div class="paragraph">
<p>CAS Initializers have optional <code>initialize()</code>, <code>reconfigure()</code>, and <code>typeSystemInit()</code> methods, which perform the same functions as they do for Collection Readers.
The only required method for a CAS Initializer is <code>initializeCas(Object,
        CAS)</code>.
This method takes the raw document (for example, an <code>InputStream</code> object from which the document can be read) and a CAS, and populates the CAS from the document.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cpe.cas_consumer.developing"><a class="anchor" href="#ugr.tug.cpe.cas_consumer.developing"></a>2.4.3. Developing CASConsumers</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In version 2, there is no difference in capability between CAS Consumers and ordinary Analysis Engines, except for the default setting of the XML parameters for <code>multipleDeploymentAllowed</code> and <code>modifiesCas</code>.
We recommend for future work that users implement and use Analysis Engine components instead of CAS Consumers.</p>
</div>
<div class="paragraph">
<p>The rest of this section is written using the version 1 style of CAS Consumer; the methods described are also available for Analysis Engines.
Note that the  CAS Consumer <code>processCAS</code> method is equivalent to the Analysis Engine <code>process</code> method.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A CAS Consumer receives each CAS after it has been analyzed by the Analysis Engine.
CAS Consumers typically do not update the CAS; they typically extract data from the CAS and persist selected information to aggregate data structures such as search engine indexes or databases.</p>
</div>
<div class="paragraph">
<p>A CAS Consumer Java class must implement the interface <code>org.apache.uima.collection.CasConsumer</code>, and will also generally extend from the convenience base class <code>org.apache.uima.collection.CasConsumer_ImplBase</code>.
A CAS Consumer also must have an XML descriptor, which has the exact same form as a Collection Reader Descriptor except that the outer tag is <code>&lt;casConsumerDescription&gt;</code>.</p>
</div>
<div class="paragraph">
<p>CAS Consumers have optional <code>initialize()</code>, <code>reconfigure()</code>, and <code>typeSystemInit()</code> methods, which perform the same functions as they do for Collection Readers and CAS Initializers.
The only required method for a CAS Consumer is <code>processCas(CAS)</code>, which is where the CAS Consumer does the bulk of its work (i.e., consume the CAS).</p>
</div>
<div class="paragraph">
<p>The <code>CasConsumer</code> interface (as well as the version 2 Analysis Engine interface) additionally defines batch and collection level processing methods.
The CAS Consumer or Analysis Engine can implement the <code>batchProcessComplete()</code> method to perform processing that should occur at the end of each batch of CASes.
Similarly, the CAS Consumer  or Analysis Engine can implement the <code>collectionProcessComplete()</code> method to perform any collection level processing at the end of the collection.</p>
</div>
<div class="paragraph">
<p>A very simple example of a CAS Consumer, which writes an XML representation of the CAS to a file, is the XMI Writer CAS Consumer.
The Java code is in the class <code>org.apache.uima.examples.cpe.XmiWriterCasConsumer</code> and the descriptor is in <code>%UIMA_HOME%/examples/descriptors/cas_consumer/XmiWriterCasConsumer.xml</code> .</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.cpe.cas_consumer.required_methods"><a class="anchor" href="#ugr.tug.cpe.cas_consumer.required_methods"></a>Required Methods for a CAS Consumer</h5>
<div class="paragraph">
<p>When extending the convenience class <code>org.apache.uima.collection.CasConsumer_ImplBase</code>, the following abstract methods must be implemented:</p>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.cas_consumer.required_methods.initialize"><a class="anchor" href="#ugr.tug.cpe.cas_consumer.required_methods.initialize"></a>initialize()</h6>
<div class="paragraph">
<p>The <code>initialize()</code> method is called by the framework when the CAS Consumer is first created. <code>CasConsumer_ImplBase</code> actually provides a default implementation of this method (i.e., it is not abstract), so you are not strictly required to implement this method.
However, a typical CAS Consumer will implement this method to obtain parameter values and perform various initialization steps.</p>
</div>
<div class="paragraph">
<p>In this method, the CAS Consumer can access the values of its configuration parameters and perform other initialization logic.
The example XMI Writer CAS Consumer reads its configuration parameters and sets up the output directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void initialize() throws ResourceInitializationException {
  mDocNum = 0;
  mOutputDir = new File((String) getConfigParameterValue(PARAM_OUTPUTDIR));
  if (!mOutputDir.exists()) {
    mOutputDir.mkdirs();
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.cas_consumer.required_methods.processcas"><a class="anchor" href="#ugr.tug.cpe.cas_consumer.required_methods.processcas"></a>processCas()</h6>
<div class="paragraph">
<p>The <code>processCas()</code> method is where the CAS Consumer does most of its work.
In our example, the XMI Writer CAS Consumer obtains an iterator over the document metadata in the CAS (in the SourceDocumentInformation feature structure, which is created by the File System Collection Reader) and extracts the URI for the current document.
From this the output filename is constructed in the output directory and a subroutine (<code>writeXmi</code>) is called to generate the output file.
The <code>writeXmi</code> subroutine uses the <code>XmiCasSerializer</code> class provided with the UIMA SDK to serialize the CAS to the output file (see the example source code for details).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void processCas(CAS aCAS) throws ResourceProcessException {
  String modelFileName = null;

  JCas jcas;
  try {
    jcas = aCAS.getJCas();
  } catch (CASException e) {
    throw new ResourceProcessException(e);
  }

    // retreive the filename of the input file from the CAS
  FSIterator it = jcas
            .getAnnotationIndex(SourceDocumentInformation.type)
                  .iterator();
  File outFile = null;
  if (it.hasNext()) {
    SourceDocumentInformation fileLoc =
            (SourceDocumentInformation) it.next();
    File inFile;
    try {
      inFile = new File(new URL(fileLoc.getUri()).getPath());
      String outFileName = inFile.getName();
      if (fileLoc.getOffsetInSource() &gt; 0) {
        outFileName += ("_" + fileLoc.getOffsetInSource());
      }
      outFileName += ".xmi";
      outFile = new File(mOutputDir, outFileName);
      modelFileName = mOutputDir.getAbsolutePath() +
            "/" + inFile.getName() + ".ecore";
    } catch (MalformedURLException e1) {
      // invalid URL, use default processing below
    }
  }
  if (outFile == null) {
    outFile = new File(mOutputDir, "doc" + mDocNum++);
  }
  // serialize XCAS and write to output file
  try {
    writeXmi(jcas.getCas(), outFile, modelFileName);
  } catch (IOException e) {
    throw new ResourceProcessException(e);
  } catch (SAXException e) {
    throw new ResourceProcessException(e);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ugr.tug.cpe.cas_consumer.optional_methods"><a class="anchor" href="#ugr.tug.cpe.cas_consumer.optional_methods"></a>Optional Methods</h6>
<div class="paragraph">
<p>The following methods are optional in a CAS Consumer, though they are often used.</p>
</div>
<div class="sect6">
<h7 id="ugr.tug.cpe.cas_consumer.optional_methods.batchprocesscomplete"><a class="anchor" href="#ugr.tug.cpe.cas_consumer.optional_methods.batchprocesscomplete"></a>batchProcessComplete()</h7>
<div class="paragraph">
<p>The framework calls the batchProcessComplete() method at the end of each batch of CASes.
This gives the CAS Consumer or Analysis Engine  an opportunity to perform any batch level processing.
Our simple XMI Writer CAS Consumer does not perform any batch level processing, so this method is empty.
Batch size is set in the Collection Processing Engine descriptor.</p>
</div>
</div>
<div class="sect6">
<h7 id="ugr.tug.cpe.cas_consumer.optional_methods.collectionprocesscomplete"><a class="anchor" href="#ugr.tug.cpe.cas_consumer.optional_methods.collectionprocesscomplete"></a>collectionProcessComplete()</h7>
<div class="paragraph">
<p>The framework calls the collectionProcessComplete() method at the end of the collection (i.e., when all objects in the collection have been processed). At this point in time, no CAS is passed in as a parameter.
This gives the CAS Consumer or Analysis Engine an opportunity to perform collection processing over the entire set of objects in the collection.
Our simple XMI Writer CAS Consumer does not perform any collection level processing, so this method is empty.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cpe.deploying_a_cpe"><a class="anchor" href="#ugr.tug.cpe.deploying_a_cpe"></a>2.5. Deploying a CPE</h3>
<div class="paragraph">
<p>The CPM provides a number of service and deployment options that cover instantiation and execution of CPEs, error recovery, and local and distributed deployment of the CPE components.
The behavior of the CPM (and correspondingly, the CPE) is controlled by various options and parameters set in the CPE descriptor.
The current version of the CPE Configurator tool, however, supports only default error handling and deployment options.
To change these options, you must manually edit the CPE descriptor.</p>
</div>
<div class="paragraph">
<p>Eventually the CPE Configurator tool will support configuring these options and a detailed tutorial for these settings will be provided.
In the meantime, we provide only a high-level, conceptual overview of these advanced features in the rest of this chapter, and refer the advanced user to the <a href="ref.html#ugr.ref.xml.cpe_descriptor">CPE Descriptor Reference</a> for details on setting these options in the CPE Descriptor.</p>
</div>
<div class="paragraph">
<p><a href="#ugr.tug.cpe.fig.cpe_instantiation">Figure 26</a> shows a logical view of how an application uses the UIMA framework to instantiate a CPE from a CPE descriptor.
The CPE descriptor identifies the CPE components (referencing their corresponding descriptors) and specifies the various options for configuring the CPM and deploying the CPE components.</p>
</div>
<div id="ugr.tug.cpe.fig.cpe_instantiation" class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image018.png" alt="Picture of deployment of a CPE">
</div>
<div class="title">Figure 26. CPE Instantiation</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cpe.deployment_alternatives"><a class="anchor" href="#ugr.tug.cpe.deployment_alternatives"></a>2.5.1. CPE Deployment alternatives</h4>
<div class="paragraph">
<p>There are three deployment modes for CAS Processors (Analysis Engines and CAS Consumers) in a CPE:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Integrated</strong> (runs in the same Java instance as the CPM)</p>
</li>
<li>
<p><strong>Managed</strong> (runs in a separate process on the same machine), and</p>
</li>
<li>
<p><strong>Non-managed</strong> (runs in a separate process, perhaps on a different machine).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An integrated CAS Processor runs in the same JVM as the CPE.
A managed CAS Processor runs in a separate process from the CPE, but still on the same computer.
The CPE controls startup, shutdown, and recovery of a managed CAS Processor.
A non-managed CAS Processor runs as a service and may be on the same computer as the CPE or on a remote computer.
A non-managed CAS Processor <em>service</em> is started and managed independently from the CPE.</p>
</div>
<div class="paragraph">
<p>For both managed and non-managed CAS Processors, the CAS must be transmitted between separate processes and possibly between separate computers.
This is accomplished using <em>Vinci</em>, a communication protocol used by the CPM and which is provided as a part of Apache UIMA.
<a href="#ugr.tug.application.how_to_deploy_a_vinci_service">Vinci</a> handles service naming and location and data transport.
Service naming and location are provided by a <em>Vinci Naming Service</em>, or <em>VNS</em>.
For managed CAS Processors, the CPE uses its own internal VNS.
For non-managed CAS Processors, a separate VNS must be running.</p>
</div>
<div class="paragraph">
<p>The CPE Configurator tool currently only supports constructing CPEs that deploy CAS Processors in integrated mode.
To deploy CAS Processors in any other mode, the CPE descriptor must be edited by hand (better tooling may be provided later). Details on the CPE descriptor and the required settings for various CAS Processor deployment modes can be found in <a href="ref.html#ugr.ref.xml.cpe_descriptor">Collection Processing Engine Descriptor Reference</a>.
In the following sections we merely summarize the various CAS Processor deployment options.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cpe.managed_deployment"><a class="anchor" href="#ugr.tug.cpe.managed_deployment"></a>2.5.2. Deploying Managed CAS Processors</h4>
<div class="paragraph">
<p>Managed CAS Processor deployment is shown in <a href="#ugr.tug.cpe.fig.managed_deployment">CPE with Managed CAS Processors</a>.
A managed CAS Processor is deployed by the CPE as a Vinci service.
The CPE manages the lifecycle of the CAS Processor including service launch, restart on failures, and service shutdown.
A managed CAS Processor runs on the same machine as the CPE, but in a separate process.
This provides the necessary fault isolation for the CPE to protect it from non-robust CAS Processors.
A fatal failure of a managed CAS Processor does not threaten the stability of the CPE.</p>
</div>
<div id="ugr.tug.cpe.fig.managed_deployment" class="paragraph">
<div class="title">CPE with Managed CAS Processors</div>
<p>image::images/tutorials_and_users_guides/tug.cpe/image020.png[Managed deployment showing separate JVMs and CASes
            flowing between them]</p>
</div>
<div class="paragraph">
<p>The CPE communicates with managed CAS Processors using the Vinci communication protocol.
A CAS Processor is launched as a Vinci service and its <code>process()</code> method is invoked remotely via a Vinci command.
The CPE uses its own internal VNS to support managed CAS processors.
The VNS, by default, listens on port 9005.
If this port is not available, the VNS will increment its listen port until it finds one that is available.
All managed CAS Processors are internally configured to &#8220;talk&#8221; to the CPE managed VNS.
This internal VNS is transparent to the end user launching the CPE.</p>
</div>
<div class="paragraph">
<p>To deploy a managed CAS Processor, the CPE deployer must change the CPE descriptor.
The following is a section from the CPE descriptor that shows an example configuration specifying a managed CAS Processor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;casProcessor deployment="local" name="Meeting Detector TAE"&gt;
  &lt;descriptor&gt;
    &lt;include href="deploy/vinci/Deploy_MeetingDetectorTAE.xml"/&gt;
  &lt;/descriptor&gt;
  &lt;runInSeparateProcess&gt;
    &lt;exec dir="." executable="java"&gt;
      &lt;env key="CLASSPATH"
         value="src;
                C:/Program Files/apache/uima/lib/uima-core.jar;
                C:/Program Files/apache/uima/lib/uima-cpe.jar;
                C:/Program Files/apache/uima/lib/uima-examples.jar;
                C:/Program Files/apache/uima/lib/uima-adapter-vinci.jar;
                C:/Program Files/apache/uima/lib/jVinci.jar"/&gt;
      &lt;arg&gt;-DLOG=C:/Temp/service.log&lt;/arg&gt;
      &lt;arg&gt;org.apache.uima.reference_impl.collection.
         service.vinci.VinciAnalysisEnginerService_impl&lt;/arg&gt;
      &lt;arg&gt;${descriptor}&lt;/arg&gt;
    &lt;/exec&gt;
  &lt;/runInSeparateProcess&gt;
  &lt;deploymentParameters/&gt;
  &lt;filter/&gt;
  &lt;errorHandling&gt;
    &lt;errorRateThreshold action="terminate" value="1/100"/&gt;
    &lt;maxConsecutiveRestarts action="terminate" value="3"/&gt;
    &lt;timeout max="100000"/&gt;
  &lt;/errorHandling&gt;
  &lt;checkpoint batch="10000"/&gt;
&lt;/casProcessor&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to the <a href="ref.html#ugr.ref.xml.cpe_descriptor">CPE Descriptor Reference</a> for details and required settings.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cpe.deploying_nonmanaged_cas_processors"><a class="anchor" href="#ugr.tug.cpe.deploying_nonmanaged_cas_processors"></a>2.5.3. Deploying Non-managed CAS Processors</h4>
<div class="paragraph">
<p>Non-managed CAS Processor deployment is shown in <a href="#ugr.tug.cpe.fig.nonmanaged_cpe">Figure 27</a>.
In non-managed mode, the CPE supports connectivity to CAS Processors running on local or remote computers using Vinci.
Non-managed processors are different from managed processors in two aspects:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Non-managed processors are neither started nor stopped by the CPE.</p>
</li>
<li>
<p>Non-managed processors use an independent VNS, also neither started nor stopped by the CPE.</p>
</li>
</ol>
</div>
<div id="ugr.tug.cpe.fig.nonmanaged_cpe" class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image023.png" alt="Non-managed CPE deployment">
</div>
<div class="title">Figure 27. CPE with non-managed CAS Processors</div>
</div>
<div class="paragraph">
<p>While non-managed CAS Processors provide the same level of fault isolation and robustness as managed CAS Processors, error recovery support for non-managed CAS Processors is much more limited.
In particular, the CPE cannot restart a non-managed CAS Processor after an error.</p>
</div>
<div class="paragraph">
<p>Non-managed CAS Processors also require a separate Vinci Naming Service running on the network.
This VNS must be <a href="#ugr.tug.application.vns.starting">manually started</a> and monitored by the end user or application.</p>
</div>
<div class="paragraph">
<p>To deploy a non-managed CAS Processor, the CPE deployer must change the CPE descriptor.
The following is a section from the CPE descriptor that shows an example configuration for the non-managed CAS Processor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;casProcessor deployment="remote" name="Meeting Detector TAE"&gt;
  &lt;descriptor&gt;
    &lt;include href=
        "descriptors/vinciService/MeetingDetectorVinciService.xml"/&gt;
  &lt;/descriptor&gt;
  &lt;deploymentParameters/&gt;
  &lt;filter/&gt;
  &lt;errorHandling&gt;
    &lt;errorRateThreshold action="terminate" value="1/100"/&gt;
    &lt;maxConsecutiveRestarts action="terminate" value="3"/&gt;
    &lt;timeout max="100000"/&gt;
  &lt;/errorHandling&gt;
  &lt;checkpoint batch="10000"/&gt;
&lt;/casProcessor&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to the <a href="ref.html#ugr.ref.xml.cpe_descriptor">CPE Descriptor Reference</a> for details and required settings.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cpe.integrated_deployment"><a class="anchor" href="#ugr.tug.cpe.integrated_deployment"></a>2.5.4. Deploying Integrated CAS Processors</h4>
<div class="paragraph">
<p>Integrated CAS Processors are shown in <a href="#ugr.tug.cpe.fig.integrated_deployment">Figure 28</a>.
Here the CAS Processors run in the same JVM as the CPE, just like the Collection Reader and CAS Initializer.
This deployment method results in minimal CAS communication and transport overhead as the CAS is shared in the same process space of the JVM.
However, a CPE running with all integrated CAS Processors is limited in scalability by the capability of the single computer on which the CPE is running.
There is also a stability risk associated with integrated processors because a poorly written CAS Processor can cause the JVM, and hence the entire CPE, to abort.</p>
</div>
<div id="ugr.tug.cpe.fig.integrated_deployment" class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cpe/image026.png" alt="CPE with integrated CAS Processor">
</div>
<div class="title">Figure 28. CPE with integrated CAS Processor</div>
</div>
<div class="paragraph">
<p>The following is a section from a CPE descriptor that shows an example configuration for the integrated CAS Processor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;casProcessor deployment=integrated name=Meeting Detector TAE&gt;
  &lt;descriptor&gt;
    &lt;include href="descriptors/tutorial/ex4/MeetingDetectorTAE.xml"/&gt;
  &lt;/descriptor&gt;
  &lt;deploymentParameters/&gt;
  &lt;filter/&gt;
  &lt;errorHandling&gt;
    &lt;errorRateThreshold action="terminate" value="100/1000"/&gt;
    &lt;maxConsecutiveRestarts action="terminate" value="30"/&gt;
    &lt;timeout max="100000"/&gt;
  &lt;/errorHandling&gt;
  &lt;checkpoint batch="10000"/&gt;
&lt;/casProcessor&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to the <a href="ref.html#ugr.ref.xml.cpe_descriptor">CPE Descriptor Reference</a> for details and required settings.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cpe.collection_processing_examples"><a class="anchor" href="#ugr.tug.cpe.collection_processing_examples"></a>2.6. Collection Processing Examples</h3>
<div class="paragraph">
<p>The UIMA SDK includes a set of examples illustrating the three modes of deployment, integrated, managed, and non-managed.
These are in the <code>/examples/descriptors/collection_processing_engine</code> directory.
There are three CPE descriptors that run an example annotator (the Meeting Finder) in these modes.</p>
</div>
<div class="paragraph">
<p>To run either the integrated or managed examples, use the <code>runCPE</code> script in the /bin directory of the UIMA installation, passing the appropriate CPE descriptor as an argument, or if you&#8217;re using Eclipse and have the <code>uimaj-examples</code> project in your workspace, you can use the Eclipse Menu → Run → Run&#8230;&#8203; → and then pick the  launch configuration &#8220;UIMA Run CPE&#8221;.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>runCPE</code> script _ must_  be run from the <code>%UIMA_HOME%\examples</code> directory, because the example CPE descriptors use relative path names that are resolved relative to this working directory.
For instance,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>runCPE
descriptors\collection_processing_engine\MeetingFinderCPE_Integrated.xml</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run the non-managed example, there are some additional steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a VNS service by running the <code>startVNS</code> script in the <code>/bin</code> directory, or using the Eclipse launcher &#8220;UIMA Start VNS&#8221;.</p>
</li>
<li>
<p>Deploy the Meeting Detector Analysis Engine as a Vinci service, by running the <code>startVinciService</code> script in the <code>/bin</code> directory or using the Eclipse launcher for this, and passing it the location of the descriptor to deploy, in this case <code>%UIMA_HOME%/examples/deploy/vinci/Deploy_MeetingDetectorTAE.xml</code>, or if you&#8217;re using Eclipse and have the <code>uimaj-examples</code> project in your workspace, you can use the Eclipse Menu → Run → Run&#8230;&#8203; → and then pick the  launch configuration &#8220;UIMA Start Vinci Service&#8221;.</p>
</li>
<li>
<p>Now, run the runCPE script (or if in Eclipse, run the  launch configuration &#8220;UIMA Run CPE&#8221;), passing it the CPE for the non-managed version <code>(%UIMA_HOME%/examples/descriptors/collection_processing_engine/ MeetingFinderCPE_NonManaged.xml</code> ).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This assumes that the Vinci Naming Service, the runCPE application, and the <code>MeetingDetectorTAE</code> service are all running on the same machine.
Most of the scripts that need information about VNS will look for values to use in environment variables VNS_HOST and VNS_PORT; these default to &#8220;localhost&#8221; and &#8220;9000&#8221;.
You may set these to appropriate values before running the scripts, as needed; you can also pass the name of the VNS host as the second argument to the startVinciService script.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can edit the scripts and/or the XML files to specify alternatives for the VNS_HOST and VNS_PORT.
For instance, if the <code>runCPE</code> application is running on a different machine from the Vinci Naming Service, you can edit the <code>MeetingFinderCPE_NonManaged.xml</code> and change the vnsHost parameter: <code>&lt;parameter name="vnsHost"  value="localhost" type="string"/&gt;</code> to specify the VNS host instead of &#8220;localhost&#8221;.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.tug.application"><a class="anchor" href="#ugr.tug.application"></a>3. Application Developer&#8217;s Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to develop an application using the Unstructured Information Management Architecture (UIMA). The term <em>application</em> describes a program that provides end-user functionality.
A UIMA application incorporates one or more UIMA components such as Analysis Engines, Collection Processing Engines, a Search Engine, and/or a Document Store and adds application-specific logic and user interfaces.</p>
</div>
<div class="sect2">
<h3 id="ugr.tug.appication.uimaframework_class"><a class="anchor" href="#ugr.tug.appication.uimaframework_class"></a>3.1. The UIMAFramework Class</h3>
<div class="paragraph">
<p>An application developer&#8217;s starting point for accessing UIMA framework functionality is the <code>org.apache.uima.UIMAFramework</code> class.
The following is a short introduction to some important methods on this class.
Several of these methods are used in examples in the rest of this chapter.
For more details, see the Javadocs (in the docs/api directory of the UIMA SDK).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>UIMAFramework.getXMLParser(): Returns an instance of the UIMA XML Parser class, which then can be used to parse the various types of UIMA component descriptors. Examples of this can be found in the remainder of this chapter.</p>
</li>
<li>
<p>UIMAFramework.produceXXX(ResourceSpecifier): There are various produce methods that are used to create different types of UIMA components from their descriptors. The argument type, ResourceSpecifier, is the base interface that subsumes all types of component descriptors in UIMA. You can get a ResourceSpecifier from the XMLParser. Examples of produce methods are:</p>
<div class="ulist">
<ul>
<li>
<p>produceAnalysisEngine</p>
</li>
<li>
<p>produceCasConsumer</p>
</li>
<li>
<p>produceCasInitializer</p>
</li>
<li>
<p>produceCollectionProcessingEngine</p>
</li>
<li>
<p>produceCollectionReader</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are other variations of each of these methods that take additional, optional arguments.
See the Javadocs for details.
* UIMAFramework.getLogger(&lt;optional-logger-name&gt;): Gets a reference to the UIMA Logger, to which you can write log messages. If no logger name is passed, the name of the returned logger instance is &#8220;org.apache.uima&#8221;.
* UIMAFramework.getVersionString(): Gets the number of the UIMA version you are using.
* UIMAFramework.newDefaultResourceManager(): Gets an instance of the UIMA ResourceManager. The key method on ResourceManager is setDataPath, which allows you to specify the location where UIMA components will go to look for their external resources. Once you&#8217;ve obtained and initialized a ResourceManager, you can pass it to any of the produceXXX methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.application.using_aes"><a class="anchor" href="#ugr.tug.application.using_aes"></a>3.2. Using Analysis Engines</h3>
<div class="paragraph">
<p>This section describes how to add analysis capability to your application by using Analysis Engines developed using the UIMA SDK.
An <em>Analysis Engine (AE)</em> is a component that analyzes artifacts (e.g.
documents) and infers information about them.</p>
</div>
<div class="paragraph">
<p>An Analysis Engine consists of two parts - Java classes (typically packaged as one or more JAR files) and <em>AE descriptors</em> (one or more XML files). You must put the Java classes in your application&#8217;s class path, but thereafter you will not need to directly interact with them.
The UIMA framework insulates you from this by providing a standard AnalysisEngine interfaces.</p>
</div>
<div class="paragraph">
<p>The term <em>Text Analysis Engine (TAE)</em> is sometimes used to describe an Analysis Engine that analyzes a text document.
In the UIMA SDK v1.x, there was a TextAnalysisEngine interface that was commonly used.
However, as of the UIMA SDK v2.0, this interface has been deprecated and all applications should switch to using the standard AnalysisEngine interface.</p>
</div>
<div class="paragraph">
<p>The AE descriptor XML files contain the configuration settings for the Analysis Engine as well as a description of the AE&#8217;s input and output requirements.
You may need to edit these files in order to configure the AE appropriately for your application - the supplier of the AE may have provided documentation (or comments in the XML descriptor itself) about how to do this.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.instantiating_an_ae"><a class="anchor" href="#ugr.tug.application.instantiating_an_ae"></a>3.2.1. Instantiating an Analysis Engine</h4>
<div class="paragraph">
<p>The following code shows how to instantiate an AE from its XML descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  //get Resource Specifier from XML file
XMLInputSource in = new XMLInputSource("MyDescriptor.xml");
ResourceSpecifier specifier =
    UIMAFramework.getXMLParser().parseResourceSpecifier(in);

  //create AE here
AnalysisEngine ae =
    UIMAFramework.produceAnalysisEngine(specifier);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first two lines parse the XML descriptor (for AEs with multiple descriptor files, one of them is the &#8220;main&#8221; descriptor - the AE documentation should indicate which it is). The result of the parse is a <code>ResourceSpecifier</code> object.
The third line of code invokes a static factory method <code>UIMAFramework.produceAnalysisEngine</code>, which takes the specifier and instantiates an <code>AnalysisEngine</code> object.</p>
</div>
<div class="paragraph">
<p>There is one caveat to using this approach - the Analysis Engine instance that you create will not support multiple threads running through it concurrently.
If you need to support this, see <a href="#ugr.tug.applications.multi_threaded">Section 3.2.5</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.analyzing_text_documents"><a class="anchor" href="#ugr.tug.application.analyzing_text_documents"></a>3.2.2. Analyzing Text Documents</h4>
<div class="paragraph">
<p>There are two ways to use the AE interface to analyze documents.
You can either use the <em><a href="ref.html#ugr.ref.jcas">JCas</a></em> interface or you can directly use the <em><a href="ref.html#ugr.ref.cas">CAS</a></em> interface.
Besides text documents, <a href="#ugr.tug.aas">other kinds of artifacts</a> can also be analyzed.</p>
</div>
<div class="paragraph">
<p>The basic structure of your application will look similar in both cases:</p>
</div>
<div class="listingblock">
<div class="title">Using the JCas</div>
<div class="content">
<pre class="highlight"><code>  //create a JCas, given an Analysis Engine (ae)
JCas jcas = ae.newJCas();

  //analyze a document
jcas.setDocumentText(doc1text);
ae.process(jcas);
doSomethingWithResults(jcas);
jcas.reset();

  //analyze another document
jcas.setDocumentText(doc2text);
ae.process(jcas);
doSomethingWithResults(jcas);
jcas.reset();
...
  //done
ae.destroy();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using the CAS</div>
<div class="content">
<pre class="highlight"><code>//create a CAS
CAS aCasView = ae.newCAS();

//analyze a document
aCasView.setDocumentText(doc1text);
ae.process(aCasView);
doSomethingWithResults(aCasView);
aCasView.reset();

//analyze another document
aCasView.setDocumentText(doc2text);
ae.process(aCasView);
doSomethingWithResults(aCasView);
aCasView.reset();
...
//done
ae.destroy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, you create the CAS or JCas that you will use.
Then, you repeat the following four steps for each document:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put the document text into the CAS or JCas.</p>
</li>
<li>
<p>Call the AE&#8217;s process method, passing the CAS or JCas as an argument</p>
</li>
<li>
<p>Do something with the results that the AE has added to the CAS or JCas</p>
</li>
<li>
<p>Call the CAS&#8217;s or JCas&#8217;s reset() method to prepare for another analysis</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.applications.analyzing_non_text_artifacts"><a class="anchor" href="#ugr.tug.applications.analyzing_non_text_artifacts"></a>3.2.3. Analyzing Non-Text Artifacts</h4>
<div class="paragraph">
<p>Analyzing non-text artifacts is similar to analyzing text documents.
The main difference is that instead of using the <code>setDocumentText</code> method, you need to use the Sofa APIs to <a href="#ugr.tug.aas">set the artifact</a> into the CAS.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.applications.accessing_analysis_results"><a class="anchor" href="#ugr.tug.applications.accessing_analysis_results"></a>3.2.4. Accessing Analysis Results</h4>
<div class="paragraph">
<p>Annotators (and applications) access the results of analysis via the CAS, using the CAS or JCas interfaces.
These results are accessed using the CAS Indexes.
There is one built-in index for instances of the built-in type <code>uima.tcas.Annotation</code> that can be used to retrieve instances of <code>Annotation</code> or any subtype of Annotation.
You can also define additional indexes over other types.</p>
</div>
<div class="paragraph">
<p>Indexes provide a method to obtain an iterators over their contents; the iterator returns the matching elements one at time from the CAS.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.applications.accessing_results_using_jcas"><a class="anchor" href="#ugr.tug.applications.accessing_results_using_jcas"></a>Accessing Analysis Results using the JCas</h5>
<div class="paragraph">
<p>See:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ugr.tug.aae.reading_results_previous_annotators">Section 1.3.3, &#8220;Reading the Results of Previous Annotators&#8221;</a>;</p>
</li>
<li>
<p><a href="ref.html#ugr.ref.jcas">JCas Reference</a>;</p>
</li>
<li>
<p>The Javadocs for <code>org.apache.uima.jcas.JCas</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.application.accessing_results_using_cas"><a class="anchor" href="#ugr.tug.application.accessing_results_using_cas"></a>Accessing Analysis Results using the CAS</h5>
<div class="paragraph">
<p>See:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="ref.html#ugr.ref.cas">CAS Reference</a></p>
</li>
<li>
<p>The source code for <code>org.apache.uima.examples.PrintAnnotations</code>, which is in <code>examples\src.</code></p>
</li>
<li>
<p>The Javadocs for the <code>org.apache.uima.cas</code> and <code>org.apache.uima.cas.text</code> packages.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.applications.multi_threaded"><a class="anchor" href="#ugr.tug.applications.multi_threaded"></a>3.2.5. Multi-threaded Applications</h4>
<div class="paragraph">
<p>You may be running on a multi-core system, and want to run multiple CASes at once through your pipeline.
To support this, UIMA provides multiple approaches.
The most flexible and recommended way to do this is to use the features of UIMA-AS, which not only allows scale-up (multiple threads in one CPU), but also supports scale-out (exploiting a cluster of machines).</p>
</div>
<div class="paragraph">
<p>This section describes the simplest way to use an AE in a multi-threaded environment.
First, note that most Analysis Engines are written with the assumption that only one thread will be accessing  it at any one time; that is, Analysis Engines are not written to be thread safe.
The writers of these  assume that multiple instances of the Annotator Engine class will be instantiated as needed to support multiple  threads.</p>
</div>
<div class="paragraph">
<p>If your application has multiple threads that might invoke an Analysis Engine, to insure that  only one thread at a time uses a CAS and runs in the pipeline,  you can use the Java synchronized keyword to ensure that only one thread is using an AE at any given time.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public class MyApplication {
  private AnalysisEngine mAnalysisEngine;
  private CAS mCAS;

  public MyApplication() {
    //get Resource Specifier from XML file
    XMLInputSource in = new XMLInputSource("MyDescriptor.xml");
    ResourceSpecifier specifier =
        UIMAFramework.getXMLParser().parseResourceSpecifier(in);

    //create Analysis Engine here
    mAnalysisEngine = UIMAFramework.produceAnalysisEngine(specifier);
    mCAS = mAnalysisEngine.newCAS();
  }

  // Assume some other part of your multi-threaded application could
  // call analyzeDocument on different threads, asynchronously

  public synchronized void analyzeDocument(String aDoc) {
    //analyze a document
    mCAS.setDocumentText(aDoc);
    mAnalysisEngine.process();
    doSomethingWithResults(mCAS);
    mCAS.reset();
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without the synchronized keyword, this application would not be thread-safe.
If multiple threads called the analyzeDocument method simultaneously, they would both use the same CAS and clobber each others' results.
The synchronized keyword ensures that no more than one thread is executing this method at any given time.
For more information on thread synchronization in Java, see <a href="http://docs.oracle.com/javase/tutorial/essential/concurrency/" class="bare">http://docs.oracle.com/javase/tutorial/essential/concurrency/</a>.</p>
</div>
<div class="paragraph">
<p>The synchronized keyword ensures thread-safety, but does not allow you to process more than one document at a time.
If you need to process multiple documents simultaneously (for example, to make use of a multiprocessor machine), you&#8217;ll need to use more than one CAS instance.</p>
</div>
<div class="paragraph">
<p>Because CAS instances use memory and can take some time to construct, you don&#8217;t want to create a new CAS instance for each request.
Instead, you should use a feature of the UIMA SDK called the <em>CAS Pool</em>, implemented by the type <code>CasPool</code>.</p>
</div>
<div class="paragraph">
<p>A CAS Pool contains some number of CAS instances (you specify how many when you create the pool). When a thread wants to use a CAS, it <em>checks out</em> an instance from the pool.
When the thread is done using the CAS, it must <em>release</em> the CAS instance back into the pool.
If all instances are checked out, additional threads will block and wait for an instance to become available.
Here is some example code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public class MyApplication {
  private CasPool mCasPool;

  private AnalysisEngine mAnalysisEngine;

  public MyApplication()
  {
    //get Resource Specifier from XML file
    XMLInputSource in = new XMLInputSource("MyDescriptor.xml");
    ResourceSpecifier specifier =
      UIMAFramework.getXMLParser().parseResourceSpecifier(in);

    //Create multithreadable AE that will
    //Accept 3 simultaneous requests
    //The 3rd parameter specifies a timeout.
    //When the number of simultaneous requests exceeds 3,
    // additional requests will wait for other requests to finish.
    // This parameter determines the maximum number of milliseconds
    // that a new request should wait before throwing an
    // - a value of 0 will cause them to wait forever.
    mAnalysisEngine = UIMAFramework.produceAnalysisEngine(specifier,3,0);

    //create CAS pool with 3 CAS instances
    mCasPool = new CasPool(3, mAnalysisEngine);
  }

  // Notice this is no longer "synchronized"
  public void analyzeDocument(String aDoc) {
    //check out a CAS instance (argument 0 means no timeout)
    CAS cas = mCasPool.getCas(0);
    try {
      //analyze a document
      cas.setDocumentText(aDoc);
      mAnalysisEngine.process(cas);
      doSomethingWithResults(cas);
    } finally {
      //MAKE SURE we release the CAS instance
      mCasPool.releaseCas(cas);
    }
  }
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is not much more code required here than in the previous example.
First, there is one additional parameter to the AnalysisEngine producer, specifying the number of annotator instances to create.
<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>.
Then, instead of creating a single CAS in the constructor, we now create a CasPool containing 3 instances.
In the analyze method, we check out a CAS, use it, and then release it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Frequently, the two numbers (number of CASes, and the number of AEs) will be the same.
It would not make sense to have the number of CASes less than the number of AEs&#8201;&#8212;&#8201;the extra AE instances would always block waiting for a CAS from the pool.
It could make sense to have additional CASes, though&#8201;&#8212;&#8201;if you had other multi-threaded processes that were using the CASes, other than the AEs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The getCAS() method returns a CAS which is not specialized to any particular subject of analysis.
To process things other than this, please refer to <a href="#ugr.tug.aas">Chapter 5</a>.</p>
</div>
<div class="paragraph">
<p>Note the use of the <code>try</code>&#8230;&#8203;<code>finally</code> block.
This is very important, as it ensures that the CAS we have checked out will be released back into the pool, even if the analysis code throws an exception.
You should always use <code>try</code>&#8230;&#8203;<code>finally</code> when using the CAS pool; if you do not, you risk exhausting the pool and causing deadlock.</p>
</div>
<div class="paragraph">
<p>The parameter 0 passed to the <code>CasPool.getCas()</code> method is a timeout value.
If this is set to a positive integer, it is the maximum number of milliseconds that the thread will wait for an instance to become available in the pool.
If this time elapses, the getCas method will return null, and the application can do something intelligent, like ask the user to try again later.
A value of 0 will cause the thread to wait for an available CAS, potentially forever.</p>
</div>
<div class="paragraph">
<p>All of this can better be done using UIMA-AS.
Besides taking care of setting up the CAS pools, etc., UIMA-AS allows a pipe line having several delegates to be scaled-up optimally for each delegate;  one delegate might have 5 instances, while another might have 3.
It also does a different kind of initialization, in that it creates a thread pool itself, and insures that each annotator instance gets its <code>process()</code> method called using the same thread that was used for that annotator  instance&#8217;s initialization call; some annotators could be written assuming that this is the case.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.using_multiple_aes"><a class="anchor" href="#ugr.tug.application.using_multiple_aes"></a>3.2.6. Using Multiple Analysis Engines and Creating Shared CASes</h4>
<div class="paragraph">
<p>In most cases, the easiest way to use multiple Analysis Engines from within an application is to combine them into an <a href="#ugr.tug.aae.building_aggregates">aggregate AE</a>.
Be sure that you understand this method before deciding to use the more advanced feature described in this section.</p>
</div>
<div class="paragraph">
<p>If you decide that your application does need to instantiate multiple AEs and have those AEs share a single CAS, then you will no longer be able to use the various methods on the <code>AnalysisEngine</code> class that create CASes (or JCases) to create your CAS.
This is because these methods create a CAS with a data model specific to a single AE and which therefore cannot be shared by other AEs.
Instead, you create a CAS as follows:</p>
</div>
<div class="paragraph">
<p>Suppose you have two analysis engines, and one CAS Consumer, and you want to create one type system from the merge of all of their type specifications.
Then you can do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>AnalysisEngineDescription aeDesc1 =
  UIMAFramework.getXMLParser().parseAnalysisEngineDescription(...);

  AnalysisEngineDescription aeDesc2 =
  UIMAFramework.getXMLParser().parseAnalysisEngineDescription(...);

  CasConsumerDescription ccDesc =
  UIMAFramework.getXMLParser().parseCasConsumerDescription(...);

  List list = new ArrayList();

  list.add(aeDesc1);
  list.add(aeDesc2);
  list.add(ccDesc);

  CAS cas = CasCreationUtils.createCas(list);

  // (optional, if using the JCas interface)
  JCas jcas = cas.getJCas();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CasCreationUtils class takes care of the work of merging the AEs' type systems and producing a CAS for the combined type system.
If the type systems are not compatible, an exception will be thrown.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.saving_cases_to_file_systems"><a class="anchor" href="#ugr.tug.application.saving_cases_to_file_systems"></a>3.2.7. Saving CASes to file systems or general Streams</h4>
<div class="paragraph">
<p>The UIMA framework provides multiple APIs to save and restore the contents of a CAS to streams.
Two common uses of this are to save CASes to the file system, and to send CASes to other processes, running on remote systems.</p>
</div>
<div class="paragraph">
<p>The CASes can be serialized in multiple formats:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Binary formats:</p>
<div class="ulist">
<ul>
<li>
<p>plain binary: This is used to communicate with remote services, and also for interfacing with annotators written in C/C++ or related languages via the JNI Java interface, from Java</p>
</li>
<li>
<p>Compressed binary: There are two forms of <a href="ref.html#ugr.ref.compress.overview">compressed binary</a>. The recommend one is form 6, which also allows type filtering</p>
</li>
</ul>
</div>
</li>
<li>
<p>XML formats: There are two forms of this format. The preferred one is the <a href="ref.html#ugr.ref.xmi">UIMA CAS XMI</a>. An older format is also available, called XCAS.</p>
</li>
<li>
<p>JSON formats: There is a <a href="https://github.com/apache/uima-uimaj-io-jsoncas#readme">UIMA CAS JSON</a> (de)serializer for the CAS available as a separate library. The UIMA CAS JSON format is also supported by the Python library <a href="https://github.com/dkpro/dkpro-cassis#readme">DKPro Cassis</a>. There is also an <a href="ref.html#ugr.ref.json.overview">older JSON serializer</a> included in the UIMA Java SDK, but it only supports serialization.</p>
</li>
<li>
<p>Java Object serialization: There are APIs to convert a CAS to a Java object that can be serialized and deserialized using standard Java object read and write Object methods. There is also a way to include the CAS&#8217;s type system and  index definition.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these serializations has different capabilities, summarized in the table below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Serialization Capabilities</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">XCAS</th>
<th class="tableblock halign-left valign-top">XMI</th>
<th class="tableblock halign-left valign-top">JSON</th>
<th class="tableblock halign-left valign-top">Binary</th>
<th class="tableblock halign-left valign-top">Cmpr 4</th>
<th class="tableblock halign-left valign-top">Cmrp 6</th>
<th class="tableblock halign-left valign-top">JavaObj</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output Stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output Stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output Stream, File, Writer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output Stream</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output Stream, Data Output Stream, File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output Stream, Data Output Stream, File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists/Arrays inline formating?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Formated?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type Filtering?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delta Cas?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OOTS?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only send indexed + reachable FSs?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">send all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">send all</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">send all</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name Space / Schemas?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lenient available?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">optionally include embedded Type System and Indexes definition?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Just type system</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the above table, Cmpr 4 and Cmpr 6 refer to Compressed forms of the serialization, and JavaObj refers to Java Object serialization.</p>
</div>
<div class="paragraph">
<p>For the XMI and the old JSON format, lists and arrays can sometimes be formatted "inline". In this representation, the elements are formatted directly as the value of a particular feature.
This is only done if the arrays and lists are not multiply-referenced.</p>
</div>
<div class="paragraph">
<p>Type Filtering support enables only a subset of the types and/or features to be serialized.
An additional type system object is used to specify the types to be included in the serialization.
This can be useful, for instance, when sending a CAS to a remote service, where the remote service only uses a small number of the types and features, to reduce the size of the serialized CAS.</p>
</div>
<div class="paragraph">
<p>Delta Cas support makes use of a "mark" set in the CAS, and only serializes changes in the CAS, both new and modified Feature Structures, that were added or changed after the mark was set.
This is useful for remote services, supporting the use-case where a large CAS is sent to the service, which sets the mark in the received CAS, and then adds a small amount of information;  the Delta CAS then serializes only that small amount as the "reply" sent back to the sender.</p>
</div>
<div class="paragraph">
<p>OOTS means "Out of Type System" support, intended to support the use-case where a CAS is being sent to a remote application.
This supports deserializing an incoming CAS where some of the types and/or features may not be present in the receiving CAS&#8217;s type system.
A "lenient"  option on the deserialization permits the deserialization to proceed, with the out-of-type-system information preserved so that when the CAS is subsequently reserialized (in the use-case, to be  returned back to the sender), the out-of-type-system information is re-merged back into the output stream.</p>
</div>
<div class="paragraph">
<p>The Binary, Java Object, and Compressed Form 4 serializations send all the Feature Structures in the CAS, in the order they were created in the CAS.
The other methods only  send Feature Structures that are reachable, either by  their being in some CAS index, or being referenced  as a feature of another Feature Structure which is reachable.</p>
</div>
<div class="paragraph">
<p>The NameSpace/Schema support allows specifying a set of schemas, each one corresponding to a particular namespace, used in XMI serialization.</p>
</div>
<div class="paragraph">
<p>Lenient allows the receiving Type System to be missing types and/or features that being deserialized.
Normally this causes an exception, but with the lenient flag turned on, these extra types and/or features are  skipped over and ignored, with no error indicated.</p>
</div>
<div class="paragraph">
<p>Some formats optionally allow embedded type system and indexes definition to be saved;  loaders for these can use that information to replace the CAS&#8217;s type system and indexes definition, or (for compressed form 6) use the type system part to decode the serialized data.
This is described in detail in the Javadocs for CasIOUtils.
JSON serialization has several alternatives for optionally including portions of the type system, described in the reference document chapter on JSON.</p>
</div>
<div class="paragraph">
<p>To save an XMI representation of a CAS, use the <code>save</code> method in <code>CasIOUtils</code> or the <code>serialize</code> method of the class <code>org.apache.uima.util.XmlCasSerializer</code>.
To save an XCAS representation of a CAS, use the <code>save</code> method in <code>CasIOUtils</code> class or use the <code>org.apache.uima.cas.impl.XCASSerializer</code> instead; see the Javadocs for details.</p>
</div>
<div class="paragraph">
<p>All the external serialized forms (except JSON and the inline CAS approximate serialization)  can be read back in using the <code>CasIOUtils load</code> methods.
The <code>CasIOUtils load</code> methods also have API forms that support  loading type system and index definition information at the same time (from addition input sources); there is also a form for loading compressed form 6 where you can pass the type system to use for decoding, when it is different from that of the receiving CAS.
The XCAS and XMI external forms can also be read back in using the <code>deserialize</code> method of the class <code>org.apache.uima.util.XmlCasDeserializer</code>.
All of these methods deserialize into a pre-existing CAS, which you must create ahead of time.
See the Javadocs for details.</p>
</div>
<div class="paragraph">
<p>The <code>Serialization</code> class has various static methods for serializing and deserializing Java Object forms and  compressed forms, with finer control over available options.
See the Javadocs for that class for details.</p>
</div>
<div class="paragraph">
<p>Several of the APIs use or return instances of <code>SerialFormat</code>, which is an enum specifying the various forms of serialization.</p>
</div>
<div class="paragraph">
<p>Serialization often makes use of temporary extra data structures, anchored from the CAS being serialized.
These are read/write, and because of this, most serializations are synchronized to prevent multiple serializations of the same CAS from happening in parallel.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.application.using_cpes"><a class="anchor" href="#ugr.tug.application.using_cpes"></a>3.3. Using Collection Processing Engines</h3>
<div class="paragraph">
<p>A <em><a href="#ugr.tug.cpe">Collection Processing Engine (CPE)</a></em> processes collections of artifacts (documents) through the combination of the following components: a Collection Reader, an optional CAS Initializer, Analysis Engines, and CAS Consumers.</p>
</div>
<div class="paragraph">
<p>Like Analysis Engines, CPEs consist of a set of Java classes and a set of descriptors.
You need to make sure the Java classes are in your classpath, but otherwise you only deal with descriptors.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.running_a_cpe_from_a_descriptor"><a class="anchor" href="#ugr.tug.application.running_a_cpe_from_a_descriptor"></a>3.3.1. Running a Collection Processing Engine from a Descriptor</h4>
<div class="paragraph">
<p><a href="#ugr.tug.cpe.running_cpe_from_application">Section 2.3, &#8220;Running a CPE from Your Own Java Application&#8221;</a> describes how to use the APIs to read a CPE descriptor and run it from an application.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.configuring_a_cpe_descriptor_programmatically"><a class="anchor" href="#ugr.tug.application.configuring_a_cpe_descriptor_programmatically"></a>3.3.2. Configuring a Collection Processing Engine Descriptor Programmatically</h4>
<div class="paragraph">
<p>For the finest level of control over the CPE descriptor settings, the CPE offers programmatic access to the descriptor via an API.
With this API, a developer can create a complete descriptor and then save the result to a file.
This also can be used to read in a descriptor (using <code>XMLParser.parseCpeDescription`</code> as shown in the previous section), modify it, and write it back out again.
The CPE Descriptor API allows a developer to redefine default behavior related to error handling for each component, turn-on check-pointing, change performance characteristics of the CPE, and plug-in a custom timer.</p>
</div>
<div class="paragraph">
<p>Below is some example code that illustrates how this works.
See the Javadocs for package org.apache.uima.collection.metadata for more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>//Creates descriptor with default settings
CpeDescription cpe = CpeDescriptorFactory.produceDescriptor();

//Add CollectionReader
cpe.addCollectionReader([descriptor]);

//Add CasInitializer (deprecated)
cpe.addCasInitializer(&lt;cas initializer descriptor&gt;);

// Provide the number of CASes the CPE will use
cpe.setCasPoolSize(2);

//  Define and add Analysis Engine
CpeIntegratedCasProcessor personTitleProcessor =
   CpeDescriptorFactory.produceCasProcessor (Person);

// Provide descriptor for the Analysis Engine
personTitleProcessor.setDescriptor([descriptor]);

//Continue, despite errors and skip bad Cas
personTitleProcessor.setActionOnMaxError(continue);

  //Increase amount of time in ms the CPE waits for response
//from this Analysis Engine
personTitleProcessor.setTimeout(100000);

//Add Analysis Engine to the descriptor
cpe.addCasProcessor(personTitleProcessor);

//  Define and add CAS Consumer
CpeIntegratedCasProcessor consumerProcessor =
CpeDescriptorFactory.produceCasProcessor(Printer);
consumerProcessor.setDescriptor([descriptor]);

//Define batch size
consumerProcessor.setBatchSize(100);

//Terminate CPE on max errors
consumerProcessor.setActionOnMaxError(terminate);

//Add CAS Consumer to the descriptor
cpe.addCasProcessor(consumerProcessor);

//  Add Checkpoint file and define checkpoint frequency (ms)
cpe.setCheckpoint([path]/checkpoint.dat, 3000);

//  Plug in custom timer class used for timing events
cpe.setTimer(org.apache.uima.internal.util.JavaTimer);

//  Define number of documents to process
cpe.setNumToProcess(1000);

//  Dump the descriptor to the System.out
((CpeDescriptionImpl)cpe).toXML(System.out);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The CPE descriptor for the above configuration looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;cpeDescription xmlns="http://uima.apache.org/resourceSpecifier"&gt;
  &lt;collectionReader&gt;
    &lt;collectionIterator&gt;
      &lt;descriptor&gt;
        &lt;include href="[descriptor]"/&gt;
      &lt;/descriptor&gt;
      &lt;configurationParameterSettings&gt;...
      &lt;/configurationParameterSettings&gt;
    &lt;/collectionIterator&gt;

    &lt;casInitializer&gt;
      &lt;descriptor&gt;
        &lt;include href="[descriptor]"/&gt;
      &lt;/descriptor&gt;
      &lt;configurationParameterSettings&gt;...
      &lt;/configurationParameterSettings&gt;
    &lt;/casInitializer&gt;
  &lt;/collectionReader&gt;

  &lt;casProcessors casPoolSize="2" processingUnitThreadCount="1"&gt;
    &lt;casProcessor deployment="integrated" name="Person"&gt;
      &lt;descriptor&gt;
        &lt;include href="[descriptor]"/&gt;
      &lt;/descriptor&gt;
      &lt;deploymentParameters/&gt;
      &lt;errorHandling&gt;
        &lt;errorRateThreshold action="terminate" value="100/1000"/&gt;
        &lt;maxConsecutiveRestarts action="terminate" value="30"/&gt;
        &lt;timeout max="100000"/&gt;
      &lt;/errorHandling&gt;
      &lt;checkpoint batch="100" time="1000ms"/&gt;
    &lt;/casProcessor&gt;

    &lt;casProcessor deployment="integrated" name="Printer"&gt;
      &lt;descriptor&gt;
        &lt;include href="[descriptor]"/&gt;
      &lt;/descriptor&gt;
      &lt;deploymentParameters/&gt;
      &lt;errorHandling&gt;
        &lt;errorRateThreshold action="terminate"
          value="100/1000"/&gt;
        &lt;maxConsecutiveRestarts action="terminate"
          value="30"/&gt;
        &lt;timeout max="100000" default="-1"/&gt;
      &lt;/errorHandling&gt;
      &lt;checkpoint batch="100" time="1000ms"/&gt;
    &lt;/casProcessor&gt;
  &lt;/casProcessors&gt;

  &lt;cpeConfig&gt;
    &lt;numToProcess&gt;1000&lt;/numToProcess&gt;
    &lt;deployAs&gt;immediate&lt;/deployAs&gt;
    &lt;checkpoint file="[path]/checkpoint.dat" time="3000ms"/&gt;
    &lt;timerImpl&gt;
      org.apache.uima.reference_impl.util.JavaTimer
    &lt;/timerImpl&gt;
  &lt;/cpeConfig&gt;
&lt;/cpeDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.application.setting_configuration_parameters"><a class="anchor" href="#ugr.tug.application.setting_configuration_parameters"></a>3.4. Setting Configuration Parameters</h3>
<div class="paragraph">
<p><a href="#ugr.tug.aae.configuration_parameters">Configuration parameters</a> can be set using APIs as well as configured using the XML descriptor metadata specification.</p>
</div>
<div class="paragraph">
<p>There are two different places you can set the parameters via the APIs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>After reading the XML descriptor for a component, but before you produce the component itself, and</p>
</li>
<li>
<p>After the component has been produced.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Setting the parameters before you produce the component is done using the ConfigurationParameterSettings object.
You get an instance of this for a particular component by accessing that component description&#8217;s metadata.
For instance, if you produced a component description by using <code>UIMAFramework.getXMLParser().parse&#8230;&#8203;</code> method, you can use that component description&#8217;s <code>getMetaData()</code> method to get the metadata, and then the metadata&#8217;s <code>getConfigurationParameterSettings()</code> method to get the <code>ConfigurationParameterSettings</code> object.
Using that object, you can set individual parameters using the setParameterValue method.
Here&#8217;s an example, for a CAS Consumer component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Create a description object by reading the XML for the descriptor

CasConsumerDescription casConsumerDesc =
   UIMAFramework.getXMLParser().parseCasConsumerDescription(new
     XMLInputSource("descriptors/cas_consumer/InlineXmlCasConsumer.xml"));

// get the settings from the metadata
ConfigurationParameterSettings consumerParamSettings =
    casConsumerDesc.getMetaData().getConfigurationParameterSettings();

// Set a parameter value
consumerParamSettings.setParameterValue(
  InlineXmlCasConsumer.PARAM_OUTPUTDIR,
  outputDir.getAbsolutePath());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you might produce this component using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CasConsumer component =
  UIMAFramework.produceCasConsumer(casConsumerDesc);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A side effect of producing a component is calling the component&#8217;s &#8220;initialize&#8221; method, allowing it to read its configuration parameters.
If you want to change parameters after this, use</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>component.setConfigParameterValue(
    &lt;parameter-name&gt;,
    &lt;parameter-value&gt;);</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then signal the component to re-read its configuration by calling the component&#8217;s reconfigure method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>component.reconfigure();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although these examples are for a CAS Consumer component, the parameter APIs also work for other kinds of components.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.application.integrating_text_analysis_and_search"><a class="anchor" href="#ugr.tug.application.integrating_text_analysis_and_search"></a>3.5. Integrating Text Analysis and Search</h3>
<div class="paragraph">
<p>A combination of AEs with a search engine capable of indexing both words and annotations over spans of text enables what UIMA refers to as <em>semantic search</em>.</p>
</div>
<div class="paragraph">
<p>Semantic search is a search where the semantic intent of the query is specified using one or more entity or relation specifiers.
For example, one could specify that they are looking for a person (named) &#8220;Bush.&#8221; Such a query would then not return results about the kind of bushes that grow in your garden.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.building_an_index"><a class="anchor" href="#ugr.tug.application.building_an_index"></a>3.5.1. Building an Index</h4>
<div class="paragraph">
<p>To build a semantic search index using the UIMA SDK, you run a Collection Processing Engine that includes your AE along with a CAS Consumer which takes the tokens and annotatitions, together with sentence boundaries, and feeds them to a semantic searcher&#8217;s index term input.
Your AE must include an annotator that produces Tokens and Sentence annotations, along with any &#8220;semantic&#8221; annotations, because the Indexer requires this.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.application.search.configuring_indexer"><a class="anchor" href="#ugr.tug.application.search.configuring_indexer"></a>Configuring the Semantic Search CAS Indexer</h5>
<div class="paragraph">
<p>Since there are several ways you might want to build a search index from the information in the CAS produced by your AE, you need to supply the Semantic Search CAS Consumer&#8201;&#8212;&#8201;Indexer with configuration information in the form of an <em>Index Build Specification</em> file.
Apache UIMA includes code for parsing Index Build Specification files (see the Javadocs for details).
An example of an Indexing specification tailored to the AE from the tutorial in the <a href="#ugr.tug.aae">Chapter 1</a> is located in <code>examples/descriptors/tutorial/search/MeetingIndexBuildSpec.xml</code>.
It looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;indexBuildSpecification&gt;
  &lt;indexBuildItem&gt;
    &lt;name&gt;org.apache.uima.examples.tokenizer.Token&lt;/name&gt;
    &lt;indexRule&gt;
      &lt;style name="Term"/&gt;
    &lt;/indexRule&gt;
  &lt;/indexBuildItem&gt;
  &lt;indexBuildItem&gt;
    &lt;name&gt;org.apache.uima.examples.tokenizer.Sentence&lt;/name&gt;
    &lt;indexRule&gt;
      &lt;style name="Breaking"/&gt;
    &lt;/indexRule&gt;
  &lt;/indexBuildItem&gt;
  &lt;indexBuildItem&gt;
    &lt;name&gt;org.apache.uima.tutorial.Meeting&lt;/name&gt;
    &lt;indexRule&gt;
      &lt;style name="Annotation"/&gt;
    &lt;/indexRule&gt;
  &lt;/indexBuildItem&gt;
  &lt;indexBuildItem&gt;
    &lt;name&gt;org.apache.uima.tutorial.RoomNumber&lt;/name&gt;
    &lt;indexRule&gt;
      &lt;style name="Annotation"&gt;
        &lt;attributeMappings&gt;
          &lt;mapping&gt;
            &lt;feature&gt;building&lt;/feature&gt;
            &lt;indexName&gt;building&lt;/indexName&gt;
          &lt;/mapping&gt;
        &lt;/attributeMappings&gt;
      &lt;/style&gt;
    &lt;/indexRule&gt;
  &lt;/indexBuildItem&gt;
  &lt;indexBuildItem&gt;
    &lt;name&gt;org.apache.uima.tutorial.DateAnnot&lt;/name&gt;
    &lt;indexRule&gt;
      &lt;style name="Annotation"/&gt;
    &lt;/indexRule&gt;
  &lt;/indexBuildItem&gt;
  &lt;indexBuildItem&gt;
    &lt;name&gt;org.apache.uima.tutorial.TimeAnnot&lt;/name&gt;
    &lt;indexRule&gt;
      &lt;style name="Annotation"/&gt;
    &lt;/indexRule&gt;
  &lt;/indexBuildItem&gt;
&lt;/indexBuildSpecification&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The index build specification is a series of index build items, each of which identifies a <a href="ref.html#ugr.ref.cas">CAS annotation type</a> (a subtype of <code>uima.tcas.Annotation</code> and a style.</p>
</div>
<div class="paragraph">
<p>The first item in this example specifies that the annotation type <code>org.apache.uima.examples.tokenizer.Token</code> should be indexed with the &#8220;Term&#8221; style.
This means that each span of text annotated by a Token will be considered a single token for standard text search purposes.</p>
</div>
<div class="paragraph">
<p>The second item in this example specifies that the annotation type <code>org.apache.uima.examples.tokenizer.Sentence</code> should be indexed with the &#8220;Breaking&#8221; style.
This means that each span of text annotated by a Sentence will be considered a single sentence, which can affect that search engine&#8217;s algorithm for matching queries.</p>
</div>
<div class="paragraph">
<p>The remaining items all use the &#8220;Annotation&#8221; style.
This indicates that each annotation of the specified types will be stored in the index as a searchable span, with a name equal to the annotation name (without the namespace).</p>
</div>
<div class="paragraph">
<p>Also, features of annotations can be indexed using the <code>&lt;attributeMappings&gt;</code> subelement.
In the example index build specification, we declare that the <code>building</code> feature of the type <code>org.apache.uima.tutorial.RoomNumber</code> should be indexed.
The <code>&lt;indexName&gt;</code> element can be used to map the feature name to a different name in the index, but in this example we have opted to use the same name, <code>building</code>.</p>
</div>
<div class="paragraph">
<p>At the end of the batch or collection, the Semantic Search CAS Indexer builds the index.
This index can be queried with simple tokens or with XML tags.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A query on the word &#8220;UIMA&#8221; will retrieve all documents that have the occurrence of the word. But a query of the type <code>&lt;Meeting&gt;UIMA&lt;/Meeting&gt;</code> will retrieve only those documents that contain a Meeting annotation (produced by our MeetingDetector TAE, for example), where that Meeting annotation contains the word &#8220;UIMA&#8221;.</p>
</li>
<li>
<p>A query for <code>&lt;RoomNumber building="Yorktown"/&gt;</code> will return documents that have a RoomNumber annotation whose <code>building</code> feature contains the term &#8220;Yorktown&#8221;.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on the Index Build Specification format, see the <a href="ref.html#ugr.ref.javadocs">UIMA Javadocs</a> for class <code>org.apache.uima.search.IndexBuildSpecification</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.application.search.cpe_with_semantic_search_cas_consumer"><a class="anchor" href="#ugr.tug.application.search.cpe_with_semantic_search_cas_consumer"></a>Building and Running a CPE including the Semantic Search CAS Indexer</h5>
<div class="paragraph">
<p>The following steps illustrate how to build and run a CPE that uses the UIMA Meeting Detector TAE and the Simple Token and Sentence Annotator, discussed in <a href="#ugr.tug.aae">Chapter 1</a> along with a CAS Consumer called the Semantic Search CAS Indexer, to build an index that allows you to query for documents based not only on textual content but also on whether they contain mentions of Meetings detected by the TAE.</p>
</div>
<div class="paragraph">
<p>Run the CPE Configurator tool by executing the <code>cpeGui</code> shell script in the <code>bin</code> directory of the UIMA SDK.
(For instructions on using this tool, see the <a href="tools.html#ugr.tools.cpe">Collection Processing Engine Configurator User’s Guide</a>.)</p>
</div>
<div class="paragraph">
<p>In the CPE Configurator tool, select the following components by browsing to their descriptors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Collection Reader: <code>%UIMA_HOME%/examples/descriptors/collectionReader/ FileSystemCollectionReader.xml</code></p>
</li>
<li>
<p>Analysis Engine: include both of these; one produces tokens/sentences, required by the indexer in all cases and the other produces the meeting annotations of interest.</p>
<div class="ulist">
<ul>
<li>
<p><code>%UIMA_HOME%/examples/descriptors/analysis_engine/SimpleTokenAndSentenceAnnotator.xml</code></p>
</li>
<li>
<p><code>%UIMA_HOME%/examples/descriptors/tutorial/ex6/UIMAMeetingDetectorTAE.xml</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Two CAS Consumers:</p>
<div class="ulist">
<ul>
<li>
<p><code>%UIMA_HOME%/examples/descriptors/cas_consumer/SemanticSearchCasIndexer.xml</code></p>
</li>
<li>
<p><code>%UIMA_HOME%/examples/descriptors/cas_consumer/XmiWriterCasConsumer.xml</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Set up parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set the File System Collection Reader&#8217;s &#8220;Input Directory&#8221; parameter to point to the <code>%UIMA_HOME%/examples/data</code> directory.</p>
</li>
<li>
<p>Set the Semantic Search CAS Indexer&#8217;s &#8220;Indexing Specification Descriptor&#8221; parameter to point to <code>%UIMA_HOME%/examples/descriptors/tutorial/search/ MeetingIndexBuildSpec.xml</code></p>
</li>
<li>
<p>Set the Semantic Search CAS Indexer&#8217;s &#8220;Index Dir&#8221; parameter to whatever directory into which you want the indexer to write its index files.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Indexer <em>erases</em> old versions of the files it creates in this directory.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set the XMI Writer CAS Consumer&#8217;s &#8220;Output Directory&#8221; parameter to whatever directory into which you want to store the XMI files containing the results of your analysis for each document.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Click on the Run Button.
Once the run completes, a statistics dialog should appear, in which you can see how much time was spent in each of the components involved in the run.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.application.remote_services"><a class="anchor" href="#ugr.tug.application.remote_services"></a>3.6. Working with Remote Services</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This chapter describes older methods of working with Remote Services.
These approaches do not support some of the newer CAS features, such as multiple views and CAS Multipliers.
These methods have been supplanted by UIMA-AS, which has full support for the new CAS features.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The UIMA SDK allows you to easily take any Analysis Engine or CAS Consumer and deploy it as a service.
That Analysis Engine or CAS Consumer can then be called from a remote machine using various network protocols.</p>
</div>
<div class="paragraph">
<p>The UIMA SDK provides support for the following communications protocols:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vinci, a lightweight protocol, included as a part of Apache UIMA.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The UIMA framework can make use of these services in two different ways:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An Analysis Engine can create a proxy to a remote service; this proxy acts like a local component, but connects to the remote. The proxy has limited error handling and retry capabilities. The Vinci protocol is supported.</p>
</li>
<li>
<p>A Collection Processing Engine can specify non-Integrated mode (see <a href="#ugr.tug.cpe.deploying_a_cpe">Section 2.5</a>).
The CPE provides more extensive error recovery capabilities.
This mode only supports the Vinci communications protocol.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.how_to_deploy_a_vinci_service"><a class="anchor" href="#ugr.tug.application.how_to_deploy_a_vinci_service"></a>3.6.1. Deploying a UIMA Component as a Vinci Service</h4>
<div class="paragraph">
<p>There are no software prerequisites for deploying a Vinci service.
The necessary libraries are part of the UIMA SDK.
However, before you can use Vinci services you need to deploy the Vinci Naming Service (VNS), as described in section <a href="#ugr.tug.application.vns">Section 3.6.4</a>.</p>
</div>
<div class="paragraph">
<p>To deploy a service, you have to insure any components you want to include can be found on the class path.
One way to do this is to set the environment variable UIMA_CLASSPATH to the set of class paths you need for any included components.
Then run the <code>startVinciService</code> shell script, which is located in the <code>bin</code> directory, and pass it the path to a Vinci deployment descriptor, for example: <code>C:UIMA&gt;bin/startVinciService ../examples/deploy/vinci/Deploy_PersonTitleAnnotator.xml</code>.
If you are running Eclipse, and have the <code>uimaj-examples</code> project in your workspace, you can use the Eclipse Menu → Run → Run&#8230;&#8203; and then pick &#8220;UIMA Start Vinci Service&#8221;.</p>
</div>
<div class="paragraph">
<p>This example deployment descriptor looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;deployment name="Vinci Person Title Annotator Service"&gt;

  &lt;service name="uima.annotator.PersonTitleAnnotator" provider="vinci"&gt;

    &lt;parameter name="resourceSpecifierPath"
      value="C:/Program Files/apache/uima/examples/descriptors/
          analysis_engine/PersonTitleAnnotator.xml"/&gt;

    &lt;parameter name="numInstances" value="1"/&gt;

    &lt;parameter name="serverSocketTimeout" value="120000"/&gt;

  &lt;/service&gt;

&lt;/deployment&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To modify this deployment descriptor to deploy your own Analysis Engine or CAS Consumer, just replace the areas indicated in bold italics (deployment name, service name, and resource specifier path) with values appropriate for your component.</p>
</div>
<div class="paragraph">
<p>The <code>numInstances</code> parameter specifies how many instances of your Analysis Engine or CAS Consumer will be created.
This allows your service to support multiple clients concurrently.
When a new request comes in, if all of the instances are busy, the new request will wait until an instance becomes available.</p>
</div>
<div class="paragraph">
<p>The <code>serverSocketTimeout</code> parameter specifies the number of milliseconds (default = 5 minutes) that the service will wait between requests to process something.
After this amount of time, the server will presume the client may have gone away - and it &#8220;cleans up&#8221;, releasing any resources it is holding.
The next call to process on the service will result in a cycle which will cause the client to re-establish its connection with the service (some additional overhead).</p>
</div>
<div class="paragraph">
<p>There are two additional parameters that you can add to your deployment descriptor:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;parameter name="threadPoolMinSize" value="[Integer]"/&gt;</code>: Specifies the number of threads that the Vinci service creates on startup in order to serve clients' requests.</p>
</li>
<li>
<p><code>&lt;parameter name="threadPoolMaxSize" value="[Integer]"/&gt;</code>: Specifies the maximum number of threads that the Vinci service will create. When the number of concurrent requests exceeds the <code>threadPoolMinSize</code>, additional threads will be created to serve requests, until the <code>threadPoolMaxSize</code> is reached.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>startVinciService</code> script takes two additional optional parameters.
The first one overrides the value of the VNS_HOST environment variable, allowing you to specify the name server to use.
The second parameter if specified needs to be a unique (on this server) non-negative number, specifying the instance of this service.
When used, this number allows multiple instances of the same named service to be started on one server; they will all register with the Vinci name service and be made available to client requests.</p>
</div>
<div class="paragraph">
<p>Once you have deployed your component as a web service, you may call it from a remote machine.
See <a href="#ugr.tug.application.how_to_call_a_uima_service">Section 3.6.2</a> for instructions.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.how_to_call_a_uima_service"><a class="anchor" href="#ugr.tug.application.how_to_call_a_uima_service"></a>3.6.2. Calling a UIMA Service</h4>
<div class="paragraph">
<p>Once an Analysis Engine or CAS Consumer has been deployed as a service, it can be used from any UIMA application, in the exact same way that a local Analysis Engine or CAS Consumer is used.
For example, you can call an Analysis Engine service from the Document Analyzer or use the CPE Configurator to build a CPE that includes Analysis Engine and CAS Consumer services.</p>
</div>
<div class="paragraph">
<p>To do this, you use a <em>service client descriptor</em> in place of the usual Analysis Engine or CAS Consumer Descriptor.
A service client descriptor is a simple XML file that indicates the location of the remote service and a few parameters.
Example service client descriptors are provided in the UIMA SDK under the directories <code>examples/descriptors/vinciService</code>.
The  contents of these descriptors are explained below.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.application.vinci_service_client_descriptor"><a class="anchor" href="#ugr.tug.application.vinci_service_client_descriptor"></a>Vinci Service Client Descriptor</h5>
<div class="paragraph">
<p>To call a Vinci service, a similar descriptor is used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;uriSpecifier xmlns="http://uima.apache.org/resourceSpecifier"&gt;
   &lt;resourceType&gt;AnalysisEngine&lt;/resourceType&gt;
   &lt;uri&gt;uima.annot.PersonTitleAnnotator&lt;/uri&gt;
   &lt;protocol&gt;Vinci&lt;/protocol&gt;
   &lt;timeout&gt;60000&lt;/timeout&gt;
   &lt;parameters&gt;
     &lt;parameter name="VNS_HOST" value="some.internet.ip.name-or-address"/&gt;
     &lt;parameter name="VNS_PORT" value="9000"/&gt;
   &lt;/parameters&gt;
&lt;/uriSpecifier&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Vinci uses a centralized naming server, so the host where the service is deployed does not need to be specified.
Only a name (<code>uima.annot.PersonTitleAnnotator</code>) is given, which must match the name specified in the deployment descriptor used to deploy the service.</p>
</div>
<div class="paragraph">
<p>The host and/or port where your Vinci Naming Service (VNS) server is running can be specified by the optional &lt;parameter&gt; elements.
If not specified, the value is taken from the specification given your Java command line (if present) using <code>-DVNS_HOST=&lt;host&gt; </code>and <code>-DVNS_PORT=&lt;port&gt;</code> system arguments.
If not specified on the Java command line, defaults are used: localhost for the <code>VNS_HOST</code>, and <code>9000</code> for the <code>VNS_PORT</code>.
See the next section for details on setting up a VNS server.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.restrictions_on_remotely_deployed_services"><a class="anchor" href="#ugr.tug.application.restrictions_on_remotely_deployed_services"></a>3.6.3. Restrictions on remotely deployed services</h4>
<div class="paragraph">
<p>Remotely deployed services are started on remote machines, using UIMA component descriptors on those remote machines.
These descriptors supply any configuration and resource parameters for the service (configuration parameters are not transmitted from the calling instance to the remote one). Likewise, the remote descriptors supply the type system specification for the remote annotators that will be run (the type system of the calling instance is not transmitted to the remote one).</p>
</div>
<div class="paragraph">
<p>The remote service wrapper, when it receives a CAS from the caller, instantiates it for the remote service, making instances of all types which the remote service specifies.
Other instances in the incoming CAS for types which the remote service has no type specification for are kept aside, and when the remote service returns the CAS back to the caller, these type instances are re-merged back into the CAS being transmitted back to the caller.
Because of this design, a remote service which doesn&#8217;t declare a type system won&#8217;t receive any type instances.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This behavior may change in future releases, to one where configuration parameters and / or type systems are transmitted to remote services.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.application.vns"><a class="anchor" href="#ugr.tug.application.vns"></a>3.6.4. The Vinci Naming Services (VNS)</h4>
<div class="paragraph">
<p>Vinci consists of components for building network-accessible services, clients for accessing those services, and an infrastructure for locating and managing services.
The primary infrastructure component is the Vinci directory, known as VNS (for Vinci Naming Service).</p>
</div>
<div class="paragraph">
<p>On startup, Vinci services locate the VNS and provide it with information that is used by VNS during service discovery.
Vinci service provides the name of the host machine on which it runs, and the name of the service.
The VNS internally creates a binding for the service name and returns the port number on which the Vinci service will wait for client requests.
This VNS stores its bindings in a filesystem in a file called vns.services.</p>
</div>
<div class="paragraph">
<p>In Vinci, services are identified by their service name.
If there is more than one physical service with the same service name, then Vinci assumes they are equivalent and will route queries to them randomly, provided that they are all running on different hosts.
You should therefore use a unique service name if you don&#8217;t want to conflict with other services listed in whatever VNS you have configured jVinci to use.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.application.vns.starting"><a class="anchor" href="#ugr.tug.application.vns.starting"></a>Starting VNS</h5>
<div class="paragraph">
<p>To run the VNS use the <code>startVNS</code> script found in the <code>bin</code> directory of the UIMA installation,  or launch it from Eclipse.
If you&#8217;ve installed the <code>uimaj-examples</code> project, it will supply a pre-configured launch script you can access in Eclipse by selecting Menu → Run → Run&#8230;&#8203; and picking &#8220;UIMA Start VNS&#8221;.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>VNS runs on port 9000 by default so please make sure this port is available.
If you see the following exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>java.net.BindException: Address already in use:

JVM_Bind</code></pre>
</div>
</div>
<div class="paragraph">
<p>it indicates that another process is running on port 9000.
In this case, add the parameter <code>-p &lt;port&gt;</code> to the <code>startVNS</code> command, using <code>&lt;port&gt;</code> to specify an alternative port to use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When started, the VNS produces output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[10/6/04 3:44 PM | main] WARNING: Config file doesn't exist,
            creating a new empty config file!
[10/6/04 3:44 PM | main] Loading config file : .vns.services
[10/6/04 3:44 PM | main] Loading workspaces file : .vns.workspaces
[10/6/04 3:44 PM | main] ====================================
(WARNING) Unexpected exception:
java.io.FileNotFoundException: .vns.workspaces (The system cannot find
the file specified)
  at java.io.FileInputStream.open(Native Method)
  at java.io.FileInputStream.&lt;init&gt;(Unknown Source)
  at java.io.FileInputStream.&lt;init&gt;(Unknown Source)
  at java.io.FileReader.&lt;init&gt;(Unknown Source)
  at org.apache.vinci.transport.vns.service.VNS.loadWorkspaces(VNS.java:339
  at org.apache.vinci.transport.vns.service.VNS.startServing(VNS.java:237)
  at org.apache.vinci.transport.vns.service.VNS.main(VNS.java:179)
[10/6/04 3:44 PM | main] WARNING: failed to load workspace.
[10/6/04 3:44 PM | main] VNS Workspace : null
[10/6/04 3:44 PM | main] Loading counter file : .vns.counter
[10/6/04 3:44 PM | main] Could not load the counter file : .vns.counter
[10/6/04 3:44 PM | main] Starting backup thread,
            using files .vns.services.bak
and .vns.services
[10/6/04 3:44 PM | main] Serving on port : 9000
[10/6/04 3:44 PM | Thread-0] Backup thread started
[10/6/04 3:44 PM | Thread-0] Saving to config file : .vns.services.bak
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; VNS is up and running! &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Type 'quit' and hit ENTER to terminate VNS &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
[10/6/04 3:44 PM | Thread-0] Config save required 10 millis.
[10/6/04 3:44 PM | Thread-0] Saving to config file : .vns.services
[10/6/04 3:44 PM | Thread-0] Config save required 10 millis.
[10/6/04 3:44 PM | Thread-0] Saving counter file : .vns.counter</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Disregard the <em>java.io.FileNotFoundException: .\vns.workspaces (The system cannot find the file specified).</em>
It is just a complaint, not a serious problem.
VNS Workspace is a feature of the VNS that is not critical.
The important information to note is <code>[10/6/04 3:44 PM | main] Serving on port : 9000</code> which states the actual port where VNS will listen for incoming requests.
All Vinci services and all clients connecting to services must provide the VNS port on the command line IF the port is not a default.
Again the default port is 9000.
Please see <a href="#ugr.tug.application.launching_vinci_services">Section 3.6.4.3</a> below for details about the command line and parameters.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.application.vns_files"><a class="anchor" href="#ugr.tug.application.vns_files"></a>VNS Files</h5>
<div class="paragraph">
<p>The VNS maintains two external files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vns.services</code></p>
</li>
<li>
<p><code>vns.counter</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These files are generated by the VNS in the same directory where the VNS is launched from.
Since these files may contain old information it is best to remove them before starting the VNS.
This step ensures that the VNS has always the newest information and will not attempt to connect to a service that has been shutdown.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.application.launching_vinci_services"><a class="anchor" href="#ugr.tug.application.launching_vinci_services"></a>Launching Vinci Services</h5>
<div class="paragraph">
<p>When launching Vinci service, you must indicate which VNS the service will connect to.
A Vinci service is typically started using the script <code>startVinciService</code>, found in the <code>bin</code> directory of the UIMA installation.
(If you&#8217;re using Eclipse and have the <code>uimaj-examples</code> project in the workspace, you will also find an Eclipse launcher named &#8220;UIMA Start Vinci Service&#8221; you can use.)   For the script, the environmental variable VNS_HOST should be set to the name or IP address of the machine hosting the Vinci Naming Service.
The default is localhost, the machine the service is deployed on.
This name can also be passed as the second argument to the startVinciService script.
The default port for VNS is 9000 but can be overriden with the VNS_PORT environmental variable.</p>
</div>
<div class="paragraph">
<p>If you write your own startup script, to define Vinci&#8217;s default VNS you must provide the following JVM parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>java -DVNS_HOST=localhost -DVNS_PORT=9000 ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above setting is for the VNS running on the same machine as the service.
Of course one can deploy the VNS on a different machine and the JVM parameter will need to be changed to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>java -DVNS_HOST=&lt;host&gt; -DVNS_PORT=9000 ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>where &#8220;&lt;host&gt;&#8221; is a machine name or its IP where the VNS is running.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>VNS runs on port 9000 by default.
If you see the following exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>(WARNING) Unexpected exception:
org.apache.vinci.transport.ServiceDownException:
          VNS inaccessible: java.net.Connect
Exception: Connection refused: connect</code></pre>
</div>
</div>
<div class="paragraph">
<p>then, perhaps the VNS is not running OR the VNS is running but it is using a different port.
To correct the latter, set the environmental variable VNS_PORT to the correct port before starting the service.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get the right port check the VNS output for something similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[10/6/04 3:44 PM | main] Serving on port : 9000</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is printed by the VNS on startup.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.configuring_timeout_settings"><a class="anchor" href="#ugr.tug.configuring_timeout_settings"></a>3.6.5. Configuring Timeout Settings</h4>
<div class="paragraph">
<p>UIMA has several timeout specifications, summarized here.
The timeouts associated with remote  services are discussed below.
In addition there are timeouts that can be specified for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Acquiring an empty CAS from a CAS Pool:</strong> See <a href="#ugr.tug.applications.multi_threaded">Section 3.2.5</a>.</p>
</li>
<li>
<p><strong>Reassembling chunks of a large document</strong> See <a href="ref.html#ugr.ref.xml.cpe_descriptor.descriptor.operational_parameters">Operational Parameters</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If your application uses remote UIMA services it is important to consider how to set the <em>timeout</em> values appropriately.
This is particularly important if your service can take a long time to process each request.</p>
</div>
<div class="paragraph">
<p>There are two types of timeout settings in UIMA, the <em>client timeout</em> and the <em>server socket timeout</em>.
The client timeout is usually the most important, it specifies how long that client is willing to wait for the service to process each CAS.
The client timeout can be specified for Vinci.
The server socket timeout (Vinci only) specifies how long the service holds the connection open between calls from the client.
After this amount of time, the server will presume the client may have gone away - and it &#8220;cleans up&#8221;, releasing any resources it is holding.
The next call to process on the service will cause the client to re-establish its connection with the service (some additional overhead).</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.setting_client_timeout"><a class="anchor" href="#ugr.tug.setting_client_timeout"></a>Setting the Client Timeout</h5>
<div class="paragraph">
<p>The way to set the client timeout is different depending on what deployment mode you use in your CPE (if any).</p>
</div>
<div class="paragraph">
<p>If you are using the default &#8220;integrated&#8221; deployment mode in your CPE, or if you are not using a CPE at all, then the client timeout is specified in your Service Client Descriptor (see <a href="#ugr.tug.application.how_to_call_a_uima_service">Section 3.6.2</a>). For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;uriSpecifier xmlns="http://uima.apache.org/resourceSpecifier"&gt;
   &lt;resourceType&gt;AnalysisEngine&lt;/resourceType&gt;
   &lt;uri&gt;uima.annot.PersonTitleAnnotator&lt;/uri&gt;
   &lt;protocol&gt;Vinci&lt;/protocol&gt;
   &lt;timeout&gt;60000&lt;/timeout&gt;
   &lt;parameters&gt;
     &lt;parameter name="VNS_HOST" value="some.internet.ip.name-or-address"/&gt;
     &lt;parameter name="VNS_PORT" value="9000"/&gt;
   &lt;/parameters&gt;
&lt;/uriSpecifier&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The client timeout in this example is <code>60000</code>.
This value specifies the number of milliseconds that the client will wait for the service to respond to each request.
In this example, the client will wait for one minute.</p>
</div>
<div class="paragraph">
<p>If the service does not respond within this amount of time, processing of the current CAS will abort.
If you called the <code>AnalysisEngine.process</code> method directly from your application, an Exception will be thrown.
If you are running a CPE, what happens next is dependent on the error handling settings in your CPE descriptor (see <a href="ref.html#ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.error_handling">CAS Processor Error Handling</a>).
The default action is for the CPE to terminate, but you can override this.</p>
</div>
<div class="paragraph">
<p>If you are using the &#8220;managed&#8221; or &#8220;non-managed&#8221; deployment mode in your CPE, then the client timeout is specified in your CPE desciptor&#8217;s <code>errorHandling</code> element.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;errorHandling&gt;
  &lt;maxConsecutiveRestarts .../&gt;
  &lt;errorRateThreshold .../&gt;
  &lt;timeout max="60000"/&gt;
&lt;/errorHandling&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in the previous example, the client timeout is set to <code>60000</code>, and this specifies the number of milliseconds that the client will wait for the service to respond to each request.</p>
</div>
<div class="paragraph">
<p>If the service does not respond within the specified amount of time, the action is determined by the settings for <code>maxConsecutiveRestarts</code> and <code>errorRateThreshold</code>.
These settings support such things as restarting the process (for &#8220;managed&#8221; deployment mode), dropping and reestablishing the connection (for &#8220;non-managed&#8221; deployment mode), and removing the offending service from the pipeline.
See <a href="ref.html#ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.error_handling">CAS Processor Error Handling</a>) for details.</p>
</div>
<div class="paragraph">
<p>Note that the client timeout does not apply to the <code>GetMetaData</code> request that is made when the client first connects to the service.
This call is typically very fast and does not need a large timeout (the default is 60 seconds).  However, if many clients are competing for a small number of services, it may be necessary to increase this value.
See <a href="ref.html#ugr.ref.xml.component_descriptor.service_client">Service Client Descriptors</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.setting_server_socket_timeout"><a class="anchor" href="#ugr.tug.setting_server_socket_timeout"></a>Setting the Server Socket Timeout</h5>
<div class="paragraph">
<p>The Server Socket Timeout applies only to Vinci services, and is specified in the Vinci deployment descriptor as discussed in section <a href="#ugr.tug.application.how_to_deploy_a_vinci_service">Section 3.6.1</a>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;deployment name="Vinci Person Title Annotator Service"&gt;

  &lt;service name="uima.annotator.PersonTitleAnnotator" provider="vinci"&gt;

    &lt;parameter name="resourceSpecifierPath"
      value="C:/Program Files/apache/uima/examples/descriptors/
          analysis_engine/PersonTitleAnnotator.xml"/&gt;

    &lt;parameter name="numInstances" value="1"/&gt;

    &lt;parameter name="serverSocketTimeout" value="120000"/&gt;

  &lt;/service&gt;

&lt;/deployment&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server socket timeout here is set to <code>120000</code> milliseconds, or two minutes.
This parameter specifies how long the service will wait between requests to process something.
After this amount of time, the server will presume the client may have gone away - and it &#8220;cleans up&#8221;, releasing any resources it is holding.
The next call to process on the service will cause the client to re-establish its connection with the service (some additional overhead). The service may print a &#8220;Read Timed Out&#8221; message to the console when the server socket timeout elapses.</p>
</div>
<div class="paragraph">
<p>In most cases, it is not a problem if the server socket timeout elapses.
The client will simply reconnect.
However, if you notice &#8220;Read Timed Out&#8221; messages on your server console, followed by other connection problems, it is possible that the client is having trouble reconnecting for some reason.
In this situation it may help increase the stability of your application if you increase the server socket timeout so that it does not elapse during actual processing.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.application.increasing_performance_using_parallelism"><a class="anchor" href="#ugr.tug.application.increasing_performance_using_parallelism"></a>3.7. Increasing performance using parallelism</h3>
<div class="paragraph">
<p>There are several ways to exploit parallelism to increase performance in the UIMA Framework.
These range from running with additional threads within one Java virtual machine on one host (which might be a multi-processor or hyper-threaded host) to deploying analysis engines on a set of remote machines.</p>
</div>
<div class="paragraph">
<p>The Collection Processing facility in UIMA provides the ability to scale the pipe-line of analysis engines.
This scale-out runs multiple threads within the Java virtual machine running the CPM, one for each pipe in the pipe-line.
To activate it, in the <code>&lt;casProcessors&gt;</code> descriptor element, set the attribute <code>processingUnitThreadCount</code>, which specifies the number of replicated processing pipelines, to a value greater than 1, and insure that the size of the CAS pool is equal to or greater than this number (the attribute of <code>&lt;casProcessors&gt;</code> to set is <code>casPoolSize</code>). For more details on these settings, see <a href="ref.html#ugr.ref.xml.cpe_descriptor.descriptor.cas_processors">CAS Processors</a>.</p>
</div>
<div class="paragraph">
<p>For deployments that incorporate remote analysis engines in the Collection Manager pipe-line, running on multiple remote hosts, scale-out is supported which uses the Vinci naming service.
If multiple instances of a service with the same name, but running on different hosts, are registered with the Vinci Name Server, it will assign these instances to incoming requests.</p>
</div>
<div class="paragraph">
<p>There are two modes supported: a &#8220;random&#8221; assignment, and a &#8220;exclusive&#8221; one.
The &#8220;random&#8221; mode distributes load using an algorithm that selects a service instance at random.
The UIMA framework supports this only for the case where all of the instances are running on unique hosts; the framework does not support starting 2 or more instances on the same host.</p>
</div>
<div class="paragraph">
<p>The exclusive mode dedicates a particular remote instance to each Collection Manager pip-line instance.
This mode is enabled by adding a configuration parameter in the &lt;casProcessor&gt; section of the CPE descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;deploymentParameters&gt;
  &lt;parameter name="service-access" value="exclusive" /&gt;
&lt;/deploymentParameters&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this is not specified, the &#8220;random&#8221; mode is used.</p>
</div>
<div class="paragraph">
<p>In addition, remote UIMA engine services can be started with a parameter that specifies the number of instances the service should support (see the <code>&lt;parameter name="numInstances"&gt;</code> XML element in remote deployment descriptor <a href="#ugr.tug.application.remote_services">Section 3.6</a> Specifying more than one causes the service wrapper for the analysis engine to use multi-threading (within the single Java Virtual Machine – which can take advantage of multi-processor and hyper-threaded architectures).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When using Vinci in &#8220;exclusive&#8221; mode (see service access under <a href="ref.html#ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.deployment_parameters">Individual Deployment Parameters</a>), only one thread is used.
To achieve multi-processing on a server in this case, use multiple instances of the service, instead of multiple threads (see <a href="#ugr.tug.application.how_to_deploy_a_vinci_service">Section 3.6.1</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.application.jmx"><a class="anchor" href="#ugr.tug.application.jmx"></a>3.8. Monitoring AE Performance using JMX</h3>
<div class="paragraph">
<p>UIMA supports remote monitoring of Analysis Engine performance via the Java Management Extensions (JMX) API.
When you run a UIMA with a JVM that supports JMX, the UIMA framework will automatically detect the presence of JMX and will register <em>MBeans</em> that provide access to the performance statistics.</p>
</div>
<div class="paragraph">
<p>Note: I local monitoring does not work out-of-the-box, you can configure your application for remote monitoring (even when on the same host) by specifying a unique port number, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>-Dcom.sun.management.jmxremote.port=1098
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, you can use any JMX client to view the statistics.
Simply open a command prompt, make sure the JDK <code>bin</code> directory is in your path, and execute the <code>jconsole</code> command.
This should bring up a window allowing you to select one of the local JMX-enabled applications currently running, or to enter a remote (or local) host and port, e.g. <code>localhost:1098`</code>.
The next screen will show a summary of information about the Java process that you connected to.
Click on the &#8220;MBeans&#8221; tab, then expand &#8220;org.apache.uima&#8221; in the tree at the left.
You should see a view like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.application/image006.jpg" alt="Screenshot of JMX console monitoring UIMA components">
</div>
</div>
<div class="paragraph">
<p>Each of the nodes under &#8220;`org.apache.uima`&#8221; in the tree represents one of the UIMA Analysis Engines in the application that you connected to.
You can select one of the analysis engines to view its performance statistics in the view at the right.</p>
</div>
<div class="paragraph">
<p>Probably the most useful statistic is &#8220;CASes Per Second&#8221;, which is the number of CASes that this AE has processed divided by the amount of time spent in the AE&#8217;s process method, in seconds.
Note that this is the total elapsed time, not CPU time.
Even so, it can be useful to compare the &#8220;CASes Per Second&#8221; numbers of all of your Analysis Engines to discover where the bottlenecks occur in your application.</p>
</div>
<div class="paragraph">
<p>The <code>AnalysisTime</code>, <code>BatchProcessCompleteTime</code>, and <code>CollectionProcessCompleteTime</code> properties show the total elapsed time, in milliseconds, that has been spent in the AnalysisEngine&#8217;s <code>process()</code>, <code>batchProcessComplete()</code>, and <code>collectionProcessComplete()</code> methods, respectively.
(Note that for CAS Multipliers, time spent in the <code>hasNext()</code> and <code>next()</code> methods is also counted towards the AnalysisTime.)</p>
</div>
<div class="paragraph">
<p>Note that once your UIMA application terminates, you can no longer view the statistics through the JMX console.
If you want to use JMX to view processes that have completed, you will need to write your application so that the JVM remains running after processing completes, waiting for some user signal before terminating.</p>
</div>
<div class="paragraph">
<p>It is possible to override the default JMX MBean names UIMA uses, for example to better organize the UIMA MBeans with respect to MBeans exposed by other parts of your application.
This is done using the <code>AnalysisEngine.PARAM_MBEAN_NAME_PREFIX</code> additional parameter  when creating your AnalysisEngine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  //set up Map with custom JMX MBean name prefix
  Map paramMap = new HashMap();
  paramMap.put(AnalysisEngine.PARAM_MBEAN_NAME_PREFIX,
               "org.myorg:category=MyApp");

  // create Analysis Engine
  AnalysisEngine ae =
      UIMAFramework.produceAnalysisEngine(specifier, paramMap);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similary, you can use the <code>AnalysisEngine.PARAM_MBEAN_SERVER</code> parameter to specify a particular instance of a JMX MBean Server with which UIMA should register the MBeans.
If no specified then the default is to register with the platform MBeanServer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tug.application.pto"><a class="anchor" href="#_tug.application.pto"></a>3.9. Performance Tuning Options</h3>
<div class="paragraph">
<p>There are a small number of performance tuning options available to influence the runtime behavior of UIMA applications.
Performance tuning options need to be set programmatically when an analysis engine is created.
You simply create a Java Properties object with the relevant options and pass it to the UIMA framework on the call to create an analysis engine.
Below is an example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>	  	  XMLParser parser = UIMAFramework.getXMLParser();
	      ResourceSpecifier spec = parser.parseResourceSpecifier(
	            new XMLInputSource(descriptorFile));
	      // Create a new properties object to hold the settings.
	      Properties performanceTuningSettings = new Properties();
	      // Set the initial CAS heap size.
	      performanceTuningSettings.setProperty(
	            UIMAFramework.CAS_INITIAL_HEAP_SIZE,
	            "1000000");
	      // Create a wrapper properties object that can
	      // be passed to the framework.
	      Properties additionalParams = new Properties();
	      // Set the performance tuning properties as value to
	      // the appropriate parameter.
	      additionalParams.put(
	            Resource.PARAM_PERFORMANCE_TUNING_SETTINGS,
	            performanceTuningSettings);
	      // Create the analysis engine with the parameters.
	      // The second, unused argument here is a custom
	      // resource manager.
	      this.ae = UIMAFramework.produceAnalysisEngine(
	          spec, null, additionalParams);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following options are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>UIMAFramework.PROCESS_TRACE_ENABLED</code>: enable the process trace mechanism (true/false).  When enabled, UIMA tracks the time spent in individual components of an aggregate  AE or CPE. For more information, see the API documentation of <code>org.apache.uima.util.ProcessTrace</code>.</p>
</li>
<li>
<p><code>UIMAFramework.SOCKET_KEEPALIVE_ENABLED</code>: enable socket KeepAlive (true/false).  This setting is currently only supported by Vinci clients. Defaults to <code>true</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.tug.fc"><a class="anchor" href="#ugr.tug.fc"></a>4. Flow Controller Developer&#8217;s Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Flow Controller is a component that plugs into an Aggregate Analysis Engine.
When a CAS is input to the Aggregate, the Flow Controller determines the order in which the components of that aggregate are invoked on that CAS.
The ability to provide your own Flow Controller implementation is new as of release 2.0 of UIMA.</p>
</div>
<div class="paragraph">
<p>Flow Controllers may decide the flow dynamically, based on the contents of the CAS.
So, as just one example, you could develop a Flow Controller that first sends each CAS to a Language Identification Annotator and then, based on the output of the Language Identification Annotator, routes that CAS to an Annotator that is specialized for that particular language.</p>
</div>
<div class="sect2">
<h3 id="ugr.tug.fc.developing_fc_code"><a class="anchor" href="#ugr.tug.fc.developing_fc_code"></a>4.1. Developing the Flow Controller Code</h3>
<div class="sect3">
<h4 id="ugr.tug.fc.fc_interface_overview"><a class="anchor" href="#ugr.tug.fc.fc_interface_overview"></a>4.1.1. Flow Controller Interface Overview</h4>
<div class="paragraph">
<p>Flow Controller implementations should extend from the <code>JCasFlowController_ImplBase</code> or <code>CasFlowController_ImplBase</code> classes, depending on which CAS interface they prefer to use.
As with other types of components, the Flow Controller ImplBase classes define optional <code>initialize</code>, <code>destroy</code>, and <code>reconfigure</code> methods.
They also define the required method <code>computeFlow</code>.</p>
</div>
<div class="paragraph">
<p>The <code>computeFlow</code> method is called by the framework whenever a new CAS enters the Aggregate Analysis Engine.
It is given the CAS as an argument and must return an object which implements the <code>Flow</code> interface (the Flow object). The Flow Controller developer must define this object.
It is the object that is responsible for routing this particular CAS through the components of the Aggregate Analysis Engine.
For convenience, the framework provides basic implementation of flow objects in the classes CasFlow_ImplBase and JCasFlow_ImplBase; use the JCas one if you are using the JCas interface to the CAS.</p>
</div>
<div class="paragraph">
<p>The framework then uses the Flow object and calls its <code>next()</code> method, which returns a <code>Step</code> object (implemented by the UIMA Framework) that indicates what to do next with this CAS next.
There are three types of steps currently supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SimpleStep</code>, which specifies a single Analysis Engine that should receive the CAS next.</p>
</li>
<li>
<p><code>ParallelStep</code>, which specifies that multiple Analysis Engines should receive the CAS next, and that the relative order in which these Analysis Engines execute does not matter. Logically, they can run in parallel. The runtime is not obligated to actually execute them in parallel, however, and the current implementation will execute them serially in an arbitrary order.</p>
</li>
<li>
<p><code>FinalStep</code>, which indicates that the flow is completed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After executing the step, the framework will call the Flow object&#8217;s <code>next()</code> method again to determine the next destination, and this will be repeated until the Flow Object indicates that processing is complete by returning a <code>FinalStep</code>.</p>
</div>
<div class="paragraph">
<p>The Flow Controller has access to a <code>FlowControllerContext</code>, which is a subtype of <code>UimaContext</code>.
In addition to the configuration parameter and resource access provided by a <code>UimaContext</code>, the <code>FlowControllerContext</code> also gives access to the metadata for all of the Analysis Engines that the Flow Controller can route CASes to.
Most Flow Controllers will need to use this information to make routing decisions.
You can get a handle to the <code>FlowControllerContext</code> by calling the <code>getContext()</code> method defined in <code>JCasFlowController_ImplBase</code> and <code>CasFlowController_ImplBase</code>.
Then, the <code>FlowControllerContext.getAnalysisEngineMetaDataMap</code> method can be called to get a map containing an entry for each of the Analysis Engines in the Aggregate.
The keys in this map are the same as the delegate analysis engine keys specified in the aggregate descriptor, and the values are the corresponding <code>AnalysisEngineMetaData</code> objects.</p>
</div>
<div class="paragraph">
<p>Finally, the Flow Controller has optional methods <code>addAnalysisEngines</code> and <code>removeAnalysisEngines</code>.
These methods are intended to notify the Flow Controller if new Analysis Engines are available to route CASes to, or if previously available Analysis Engines are no longer available.
However, the current version of the Apache UIMA framework does not support dynamically adding or removing Analysis Engines to/from an aggregate, so these methods are not currently called.
Future versions may support this feature.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.fc.example_code"><a class="anchor" href="#ugr.tug.fc.example_code"></a>4.1.2. Example Code</h4>
<div class="paragraph">
<p>This section walks through the source code of an example Flow Controller that simluates a simple version of the &#8220;Whiteboard&#8221; flow model.
At each step of the flow, the Flow Controller looks it all of the available Analysis Engines that have not yet run on this CAS, and picks one whose input requirements are satisfied.</p>
</div>
<div class="paragraph">
<p>The Java class for the example is <code>org.apache.uima.examples.flow.WhiteboardFlowController</code> and the source code is included in the UIMA SDK under the <code>examples/src</code> directory.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.fc.whiteboard"><a class="anchor" href="#ugr.tug.fc.whiteboard"></a>The WhiteboardFlowController Class</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public class WhiteboardFlowController
          extends CasFlowController_ImplBase {
  public Flow computeFlow(CAS aCAS)
          throws AnalysisEngineProcessException {
    WhiteboardFlow flow = new WhiteboardFlow();
    // As of release 2.3.0, the following is not needed,
    //   because the framework does this automatically
    // flow.setCas(aCAS);

    return flow;
  }

  class WhiteboardFlow extends CasFlow_ImplBase {
     // Discussed Later
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>WhiteboardFlowController</code> extends from <code>CasFlowController_ImplBase</code> and implements the <code>computeFlow</code> method.
The implementation of the <code>computeFlow</code> method is very simple; it just constructs a new <code>WhiteboardFlow</code> object that will be responsible for routing this CAS.
The framework will add a handle to that CAS which it will later use to make its routing decisions.</p>
</div>
<div class="paragraph">
<p>Note that we will have one instance of <code>WhiteboardFlow</code> per CAS, so if there are multiple CASes being simultaneously processed there will not be any confusion.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.fc.whiteboardflow"><a class="anchor" href="#ugr.tug.fc.whiteboardflow"></a>The WhiteboardFlow Class</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>class WhiteboardFlow extends CasFlow_ImplBase {
  private Set mAlreadyCalled = new HashSet();

  public Step next() throws AnalysisEngineProcessException {
    // Get the CAS that this Flow object is responsible for routing.
    // Each Flow instance is responsible for a single CAS.
    CAS cas = getCas();

    // iterate over available AEs
    Iterator aeIter = getContext().getAnalysisEngineMetaDataMap().
        entrySet().iterator();
    while (aeIter.hasNext()) {
      Map.Entry entry = (Map.Entry) aeIter.next();
      // skip AEs that were already called on this CAS
      String aeKey = (String) entry.getKey();
      if (!mAlreadyCalled.contains(aeKey)) {
        // check for satisfied input capabilities
        //(i.e. the CAS contains at least one instance
        // of each required input
        AnalysisEngineMetaData md =
            (AnalysisEngineMetaData) entry.getValue();
        Capability[] caps = md.getCapabilities();
        boolean satisfied = true;
        for (int i = 0; i &lt; caps.length; i++) {
          satisfied = inputsSatisfied(caps[i].getInputs(), cas);
          if (satisfied)
            break;
        }
        if (satisfied) {
          mAlreadyCalled.add(aeKey);
          if (mLogger.isLoggable(Level.FINEST)) {
            getContext().getLogger().log(Level.FINEST,
                "Next AE is: " + aeKey);
          }
          return new SimpleStep(aeKey);
        }
      }
    }
    // no appropriate AEs to call - end of flow
    getContext().getLogger().log(Level.FINEST, "Flow Complete.");
    return new FinalStep();
  }

  private boolean inputsSatisfied(TypeOrFeature[] aInputs, CAS aCAS) {
      //implementation detail; see the actual source code
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each instance of the <code>WhiteboardFlowController</code> is responsible for routing a single CAS.
A handle to the CAS instance is available by calling the <code>getCas()</code> method, which is a standard method defined on the <code>CasFlow_ImplBase </code>superclass.</p>
</div>
<div class="paragraph">
<p>Each time the <code>next</code> method is called, the Flow object iterates over the metadata of all of the available Analysis Engines (obtained via the call to <code>getContext().
          getAnalysisEngineMetaDataMap)</code> and sees if the input types declared in an AnalysisEngineMetaData object are satisfied by the CAS (that is, the CAS contains at least one instance of each declared input type). The exact details of checking for instances of types in the CAS are not discussed here – see the WhiteboardFlowController.java file for the complete source.</p>
</div>
<div class="paragraph">
<p>When the Flow object decides which AnalysisEngine should be called next, it indicates this by creating a SimpleStep object with the key for that AnalysisEngine and returning it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>return new SimpleStep(aeKey);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Flow object keeps a list of which Analysis Engines it has invoked in the <code>mAlreadyCalled</code> field, and never invokes the same Analysis Engine twice.
Note this is not a hard requirement.
It is acceptable to design a FlowController that invokes the same Analysis Engine more than once.
However, if you do this you must make sure that the flow will eventually terminate.</p>
</div>
<div class="paragraph">
<p>If there are no Analysis Engines left whose input requirements are satisfied, the Flow object signals the end of the flow by returning a FinalStep object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>return new FinalStep();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, note the use of the logger to write tracing messages indicating the decisions made by the Flow Controller.
This is a good practice that helps with debugging if the Flow Controller is behaving in an unexpected way.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.fc.creating_fc_descriptor"><a class="anchor" href="#ugr.tug.fc.creating_fc_descriptor"></a>4.2. Creating the Flow Controller Descriptor</h3>
<div class="paragraph">
<p>To create a Flow Controller Descriptor in the CDE, use File →New →Other →UIMA →Flow Controller Descriptor File:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.fc/image002.jpg" alt="Screenshot of Eclipse new object wizard showing Flow Controller">
</div>
</div>
<div class="paragraph">
<p>This will bring up the Overview page for the Flow Controller Descriptor:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.fc/image004.jpg" alt="Screenshot of Component Descriptor Editor Overview page for new Flow Controller">
</div>
</div>
<div class="paragraph">
<p>Type in the Java class name that implements the Flow Controller, or use the &#8220;Browse&#8221; button to select it.
You must select a Java class that implements the <code>FlowController</code> interface.</p>
</div>
<div class="paragraph">
<p>Flow Controller Descriptors are very similar to Primitive Analysis Engine Descriptors –for example you can specify configuration parameters and external resources if you wish.</p>
</div>
<div class="paragraph">
<p>If you wish to edit a Flow Controller Descriptor by hand, see <a href="ref.html#ugr.ref.xml.component_descriptor.flow_controller">Flow Controller Descriptor Reference</a> for the syntax.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.fc.adding_fc_to_aggregate"><a class="anchor" href="#ugr.tug.fc.adding_fc_to_aggregate"></a>4.3. Adding a Flow Controller to an Aggregate Analysis Engine</h3>
<div class="paragraph">
<p>To use a Flow Controller you must add it to an Aggregate Analysis Engine.
You can only have one Flow Controller per Aggregate Analysis Engine.
In the Component Descriptor Editor, the Flow Controller is specified on the Aggregate page, as a choice in the flow control kind - pick &#8220;User-defined Flow&#8221;.
When you do, the Browse and Search buttons underneath become active, and allow you to specify an existing Flow Controller Descriptor, which when you select it, will be imported into the aggregate descriptor.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.fc/image006.jpg" alt="Screenshot of Component Descriptor Editor Aggregate page showing selecting user-defined flow">
</div>
</div>
<div class="paragraph">
<p>The key name is created automatically from the name element in the Flow Controller Descriptor being imported.
If you need to change this name, you can do so by switching to the &#8220;Source&#8221; view using the bottom tabs, and editing the name in the XML source.</p>
</div>
<div class="paragraph">
<p>If you edit your Aggregate Analysis Engine Descriptor by hand, the syntax for adding a Flow Controller is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  &lt;delegateAnalysisEngineSpecifiers&gt;
    ...
  &lt;/delegateAnalysisEngineSpecifiers&gt;
  &lt;flowController key=[String]&gt;
    &lt;import .../&gt;
  &lt;/flowController&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As usual, you can <a href="ref.html#ugr.ref.xml.component_descriptor.imports">import</a> either by location or  by name.</p>
</div>
<div class="paragraph">
<p>The key that you assign to the FlowController can be used elsewhere in the Aggregate Analysis Engine Descriptor&#8201;&#8212;&#8201;in parameter overrides, resource bindings, and Sofa mappings.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.fc.adding_fc_to_cpe"><a class="anchor" href="#ugr.tug.fc.adding_fc_to_cpe"></a>4.4. Adding a Flow Controller to a Collection Processing Engine</h3>
<div class="paragraph">
<p>Flow Controllers cannot be added directly to Collection Processing Engines.
To use a Flow Controller in a CPE you first need to wrap the part of your CPE that requires complex flow control into an Aggregate Analysis Engine, and then add the Aggregate Analysis Engine to your CPE.
The CPE&#8217;s deployment and error handling options can then only be configured for the entire Aggregate Analysis Engine as a unit.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.fc.using_fc_with_cas_multipliers"><a class="anchor" href="#ugr.tug.fc.using_fc_with_cas_multipliers"></a>4.5. Using Flow Controllers with CAS Multipliers</h3>
<div class="paragraph">
<p>If you want your Flow Controller to work inside an Aggregate Analysis Engine that contains a <a href="#ugr.tug.cm">CAS Multiplier</a>, there are additional things you must consider.</p>
</div>
<div class="paragraph">
<p>When your Flow Controller routes a CAS to a CAS Multiplier, the CAS Multiplier may produce new CASes that then will also need to be routed by the Flow Controller.
When a new output CAS is produced, the framework will call the <code>newCasProduced</code> method on the Flow object that was managing the flow of the parent CAS  (the one that was input to the CAS Multiplier). The <code>newCasProduced</code> method must create a new Flow  object that will be responsible for routing the new output CAS.</p>
</div>
<div class="paragraph">
<p>In the <code>CasFlow_ImplBase</code> and <code>JCasFlow_ImplBase</code> classes, the <code>newCasProduced</code> method is defined to throw an exception indicating that the Flow Controller does not handle CAS Multipliers.
If you want your Flow Controller to properly deal with CAS Multipliers you must override this method.</p>
</div>
<div class="paragraph">
<p>If your Flow class extends <code>CasFlow_ImplBase</code>, the method signature to override is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>protected Flow newCasProduced(CAS newOutputCas, String producedBy)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your Flow class extends <code>JCasFlow_ImplBase</code>, the method signature to override is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>protected Flow newCasProduced(JCas newOutputCas, String producedBy)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, there is a variant of <code>FinalStep</code> which can only be specified for output CASes produced by CAS Multipliers within the Aggregate Analysis Engine containing the Flow Controller.
This version of <code>FinalStep</code> is produced by the calling the constructor with a <code>true</code> argument, and it causes the CAS to be immediately released back to the pool.
No further processing will be done on it and it will not be output from the aggregate.
This is the way that you can build an Aggregate Analysis Engine that outputs some new CASes but not others.
Note that if you never want any new CASes to be output from the Aggregate Analysis Engine, you don&#8217;t need to use this; instead just declare <code>&lt;outputsNewCASes&gt;false&lt;/outputsNewCASes&gt;</code> in your <a href="#ugr.tug.cm.aggregate_cms">Aggregate Analysis Engine Descriptor</a>.</p>
</div>
<div class="paragraph">
<p>For more information on how CAS Multipliers interact with Flow Controllers, <a href="#ugr.tug.cm.cm_and_fc">Section 7.3.2</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.fc.continuing_when_exceptions_occur"><a class="anchor" href="#ugr.tug.fc.continuing_when_exceptions_occur"></a>4.6. Continuing the Flow When Exceptions Occur</h3>
<div class="paragraph">
<p>If an exception occurs when processing a CAS, the framework may call the method</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>boolean continueOnFailure(String failedAeKey, Exception failure)</code></pre>
</div>
</div>
<div class="paragraph">
<p>on the Flow object that was managing the flow of that CAS.
If this method returns <code>true</code>, then the framework may continue to call the <code>next()</code> method to continue routing the CAS.
If this method returns <code>false</code> (the default), the framework will not make any more calls to the <code>next()</code> method.</p>
</div>
<div class="paragraph">
<p>In the case where the last Step was a ParallelStep, if at least one of the destinations resulted in a failure, then <code>continueOnFailure</code> will be called to report one of the failures.
If this method returns true, but one of the other destinations in the ParallelStep resulted in a failure, then the <code>continueOnFailure</code> method will be called again to report the next failure.
This continues until either this method returns false or there are no more failures.</p>
</div>
<div class="paragraph">
<p>Note that it is possible for processing of a CAS to be aborted without this method being called.
This method is only called when an attempt is being made to continue processing of the CAS following an exception, which may be an application configuration decision.</p>
</div>
<div class="paragraph">
<p>In any case, if processing is aborted by the framework for any reason, including because <code>continueOnFailure</code> returned false, the framework will call the <code>Flow.aborted()</code> method to allow the Flow object to clean up any resources.</p>
</div>
<div class="paragraph">
<p>For an example of how to continue after an exception, see the example code <code>org.apache.uima.examples.flow.AdvancedFixedFlowController</code>, in the <code>examples/src</code> directory of the UIMA SDK.
This exampe also demonstrates the use of <code>ParallelStep</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.tug.aas"><a class="anchor" href="#ugr.tug.aas"></a>5. Annotations, Artifacts, and Sofas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Up to this point, the documentation has focused on analyzing strings of Unicode text, producing subtypes of Annotations which reference offsets in those strings.
This chapter generalizes this concept and shows how other kinds of artifacts can be handled, including non-text things like audio and images, and how you can define your own kinds of &#8220;annotations&#8221; for these.</p>
</div>
<div class="sect2">
<h3 id="ugr.tug.aas.terminology"><a class="anchor" href="#ugr.tug.aas.terminology"></a>5.1. Terminology</h3>
<div class="sect3">
<h4 id="ugr.tug.aas.artifact"><a class="anchor" href="#ugr.tug.aas.artifact"></a>5.1.1. Artifact</h4>
<div class="paragraph">
<p>The Artifact is the unstructured thing being analyzed by an annotator.
It could be an HTML web page, an image, a video stream, a recorded audio conversation, an MPEG-4 stream, etc.
Artifacts are often restructured in the course of processing to facilitate particular kinds of analysis.
For instance, an HTML page may be converted into a &#8220;de-tagged&#8221; version.
Annotators at different places in the pipeline may be analyzing different versions of the artifact.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aas.sofa"><a class="anchor" href="#ugr.tug.aas.sofa"></a>5.1.2. Subject of Analysis — Sofa</h4>
<div class="paragraph">
<p>Each representation of an Artifact is called a Subject of Analysis, abbreviated using the acronym &#8220;Sofa&#8221; which stands for <em>S</em>ubject _
        OF<em>_A</em>nalysis.
Annotation metadata, which have explicit designations of sub-regions of the artifact to which they apply, are always associated with a particular Sofa.
For instance, an annotation over text specifies two features, the begin and end, which represent the character offsets into the text string Sofa being analyzed.</p>
</div>
<div class="paragraph">
<p>Other examples of representations of Artifacts, which could be Sofas include: An HTML web page, a detagged web page, the translated text of that document, an audio or video stream, closed-caption text from a video stream, etc.</p>
</div>
<div class="paragraph">
<p>Often, there is one Sofa being analyzed in a CAS.
The next chapter will show how UIMA facilitates working with multiple representations of an artifact at the same time, in the same CAS.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aas.sofa_data_formats"><a class="anchor" href="#ugr.tug.aas.sofa_data_formats"></a>5.2. Formats of Sofa Data</h3>
<div class="paragraph">
<p>Sofa data can be Java Unicode Strings, Feature Structure arrays of primitive types, or a URI which references remote data available via a network connection.</p>
</div>
<div class="paragraph">
<p>The arrays of primitive types can be things like byte arrays or float arrays, and are intended to be used for artifacts like audio data, image data, etc.</p>
</div>
<div class="paragraph">
<p>The URI form holds a URI specification String.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Sofa data can be "serialized" using an XML format; when it is, the String data  being serialized must not include invalid XML characters.
See <a href="#ugr.tug.xmi_emf.xml_character_issues">Section 8.3.1</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aas.setting_accessing_sofa_data"><a class="anchor" href="#ugr.tug.aas.setting_accessing_sofa_data"></a>5.3. Setting and Accessing Sofa Data</h3>
<div class="sect3">
<h4 id="ugr.tug.aas.setting_sofa_data"><a class="anchor" href="#ugr.tug.aas.setting_sofa_data"></a>5.3.1. Setting Sofa Data</h4>
<div class="paragraph">
<p>When a CAS is created, you can set its Sofa Data, just one time; this property insures that metadata describing regions of the Sofa remain valid.
As a consequence, the following methods that set data for a given Sofa can only be called once for a given Sofa.</p>
</div>
<div class="paragraph">
<p>The following methods on the CAS set the Sofa Data to one of the 3 formats.
Assume that the variable &#8220;aCas&#8221; holds a reference to a CAS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>aCas.setSofaDataString(document_text_string, mime_type_string);
aCas.setSofaDataArray(feature_structure_primitive_array, mime_type_string);
aCas.setSofaDataURI(uri_string, mime_type_string);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, the method <code>aCas.setDocumentText(document_text_string)</code> may still be used, and is equivalent to <code>setSofaDataString(string,
        "text")</code>.
The mime type is currently not used by the UIMA framework, but may be set and retrieved by user code.</p>
</div>
<div class="paragraph">
<p>Feature Structure primitive arrays are all the UIMA Array types except arrays of Feature Structures, Strings, and Booleans.
Typically, these are arrays of bytes, but can be other types, such as floats, longs, etc.</p>
</div>
<div class="paragraph">
<p>The URI string should conform to the standard URI format.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aas.accessing_sofa_data"><a class="anchor" href="#ugr.tug.aas.accessing_sofa_data"></a>5.3.2. Accessing Sofa Data</h4>
<div class="paragraph">
<p>The analysis algorithms typically work with the Sofa data.
The following methods on the CAS access the Sofa Data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>String           aCas.getDocumentText();
String           aCas.getSofaDataString();
FeatureStructure aCas.getSofaDataArray();
String           aCas.getSofaDataURI();
String           aCas.getSofaMimeType();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getDocumentText</code> and <code>getSofaDataString</code> return the same text string.
The <code>getSofaDataURI</code> returns the URI itself, not the data the URI is pointing to.
You can use standard Java I/O capabilities to get the data associated with the URI, or use the UIMA Framework Streaming method described next.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aas.accessing_sofa_data_using_java_stream"><a class="anchor" href="#ugr.tug.aas.accessing_sofa_data_using_java_stream"></a>5.3.3. Accessing Sofa Data using a Java Stream</h4>
<div class="paragraph">
<p>The framework provides a consistent method for accessing the Sofa data, independent of it being stored locally, or accessed remotely using the URI.
Get a Java InputStream instance from the Sofa data using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>InputStream inputStream = aCas.getSofaDataStream();</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If the data is local, this method returns a ByteArrayInputStream. This stream provides bytes.</p>
<div class="ulist">
<ul>
<li>
<p>If the Sofa data was set using setDocumentText or setSofaDataString, the String is converted to bytes by using the UTF-8 encoding.</p>
</li>
<li>
<p>If the Sofa data was set as a DataArray, the bytes in the data array are serialized, high-byte first.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the Sofa data was specified as a URI, this method returns the handle from url.openStream(). Java offers built-in support for several URI schemes including &#8220;FILE:&#8221;, &#8220;HTTP:&#8221;, &#8220;FTP:&#8221; and has an extensible mechanism, <code>URLStreamHandlerFactory</code>, for customizing access to an arbitrary URI. See more details at <a href="http://java.sun.com/j2se/1.5.0/docs/api/java/net/URLStreamHandlerFactory.html" class="bare">http://java.sun.com/j2se/1.5.0/docs/api/java/net/URLStreamHandlerFactory.html</a> .</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aas.sofa_fs"><a class="anchor" href="#ugr.tug.aas.sofa_fs"></a>5.4. The Sofa Feature Structure</h3>
<div class="paragraph">
<p>Information about a Sofa is contained in a special built-in Feature Structure of type <code>uima.cas.Sofa</code>.
This feature structure is created and managed by the UIMA Framework; users must not create it directly.
Although these Sofa type instances are implemented as standard feature structures, <em>generic CAS APIs can not be used to create Sofas or set their features</em>.
Instead, Sofas are created implicitly by the creation of new CAS views.
Similarly, Sofa features are set by CAS methods such as <code>cas.setDocumentText()</code>.</p>
</div>
<div class="paragraph">
<p>Features of the Sofa type include</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SofaID: Every Sofa in a CAS has a unique SofaID. SofaIDs are the primary handle for access. This ID is often the same as the name string given to the Sofa by the developer, but it can be see <a href="#ugr.tug.mvs.sofa_name_mapping">mapped to a different name</a>.</p>
</li>
<li>
<p>Mime type: This string feature can be used to describe the type of the data represented by a Sofa. It is not used by the framework; the framework provides APIs to set and get its value.</p>
</li>
<li>
<p>Sofa Data: The Sofa data itself. This data can be resident in the CAS or it can be a reference to data outside the CAS.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aas.annotations"><a class="anchor" href="#ugr.tug.aas.annotations"></a>5.5. Annotations</h3>
<div class="paragraph">
<p>Annotators add meta data about a Sofa to the CAS.
It is often useful to have this metadata denote a region of the Sofa to which it applies.
For instance, assuming the Sofa is a String, the metadata might describe a particular substring as the name of a person.
The built-in UIMA type, uima.tcas.Annotation, has two extra features that enable this - the begin and end features - which denote a character position offset into the text string being analyzed.</p>
</div>
<div class="paragraph">
<p>The concept of &#8220;annotations&#8221; can be generalized for non-string kinds of Sofas.
For instance, an audio stream might have an audio annotation which describes sounds regions in terms of floating point time offsets in the Sofa.
An image annotation might use two pairs of x,y coordinates to define the region the annotation applies to.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.aas.built_in_annotation_types"><a class="anchor" href="#ugr.tug.aas.built_in_annotation_types"></a>5.5.1. Built-in Annotation types</h4>
<div class="paragraph">
<p>The built-in CAS type, <code>uima.tcas.Annotation</code>, is just one kind of definition of an Annotation.
It was designed for annotating text strings, and has begin and end features which describe which substring of the Sofa being annotated.</p>
</div>
<div class="paragraph">
<p>For applications which have other kinds of Sofas, the UIMA developer will design their own kinds of Annotation types, as needed to describe an annotation, by declaring new types which are subtypes of <code>uima.cas.AnnotationBase</code>.
For instance, for images, you might have the concept of a rectangular region to which the annotation applies.
In this case, you might describe the region with 2 pairs of x, y coordinates.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.aas.annotations_associated_sofa"><a class="anchor" href="#ugr.tug.aas.annotations_associated_sofa"></a>5.5.2. Annotations have an associated Sofa</h4>
<div class="paragraph">
<p>Annotations are always associated with a particular Sofa.
In subsequent chapters, you will learn how there can be multiple Sofas associated with an artifact; which Sofa an annotation refers to is described by the Annotation feature structure itself.</p>
</div>
<div class="paragraph">
<p>All annotation types extend from the built-in type uima.cas.AnnotationBase.
This type has one feature, a reference to the Sofa associated with the annotation.
This value is currently used by the Framework to support the getCoveredText() method on the annotation instance - this returns the portion of a text Sofa that the annotation spans.
It also is used to insure that the Annotation is indexed only in the CAS View associated with this Sofa.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.aas.annotationbase"><a class="anchor" href="#ugr.tug.aas.annotationbase"></a>5.6. AnnotationBase</h3>
<div class="paragraph">
<p>A built-in type, <code>uima.cas.AnnotationBase</code>, is provided by UIMA to allow users to extend the Annotation capabilities to different kinds of Annotations.
The <code>AnnotationBase</code> type has one feature, named <code>sofa</code>, which holds a reference to the <code>Sofa</code> feature structure with which this annotation is associated.
The <code>sofa</code> feature is automatically set when creating an annotation  (meaning — any type derived from the built-in <code>uima.cas.AnnotationBase</code> type); it should not be set by the user.</p>
</div>
<div class="paragraph">
<p>There is one method, <code>getView</code>(), provided by <code>AnnotationBase</code> that returns the CAS View for the Sofa the annotation is pointing at.
Note that this method always returns a CAS, even when applied to JCas annotation instances.</p>
</div>
<div class="paragraph">
<p>The built-in type <code>uima.tcas.Annotation</code> extends <code>uima.cas.AnnotationBase</code> and adds two features, a begin and an end feature, which are suitable for identifying a span in a text string that the annotation applies to.
Users may define other extensions to <code>AnnotationBase</code> with alternative specifications that can denote a particular region within the subject of analysis, as appropriate to their application.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.tug.mvs"><a class="anchor" href="#ugr.tug.mvs"></a>6. Multiple CAS Views of an Artifact</h2>
<div class="sectionbody">
<div class="paragraph">
<p>UIMA provides an extension to the basic model of the CAS which supports analysis of multiple views of the same artifact, all contained with the CAS.
This chapter describes the concepts, terminology, and the API and XML extensions that enable this.</p>
</div>
<div class="paragraph">
<p>Multiple CAS Views can simplify things when different versions of the artifact are needed at different stages of the analysis.
They are also key to enabling multimodal analysis where the initial artifact is transformed from one modality to another, or where the artifact itself is multimodal, such as the audio, video and closed-captioned text associated with an MPEG object.
Each representation of the artifact can be analyzed independently with the standard UIMA programming model; in addition, multi-view components and applications can be constructed.</p>
</div>
<div class="paragraph">
<p>UIMA supports this by augmenting the CAS with additional light-weight CAS objects, one for each view, where these objects share most of the same underlying CAS, except for two things: each view has its own set of indexed Feature Structures, and each view has its own subject of analysis (Sofa) - its own version of the artifact being analyzed.
The Feature Structure instances themselves are in the shared part of the CAS; only the entries in the indexes are unique for each CAS view.</p>
</div>
<div class="paragraph">
<p>All of these CAS view objects are kept together with the CAS, and passed as a unit between components in a UIMA application.
APIs exist which allow components and applications to switch among the various view objects, as needed.</p>
</div>
<div class="paragraph">
<p>Feature Structures may be indexed in multiple views, if necessary.
New methods on CAS Views facilitate adding or removing Feature Structures to or from their index repositories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>aView.addFsToIndexes(aFeatureStructure)
aView.removeFsFromIndexes(aFeatureStructure)</code></pre>
</div>
</div>
<div class="paragraph">
<p>specify the view in which this Feature Structure should be added to or removed from the indexes.</p>
</div>
<div class="sect2">
<h3 id="ugr.tug.mvs.cas_views_and_sofas"><a class="anchor" href="#ugr.tug.mvs.cas_views_and_sofas"></a>6.1. CAS Views and Sofas</h3>
<div class="paragraph">
<p><a href="#ugr.tug.aas.sofa">Sofas</a> and CAS Views are linked.
In this implementation, every CAS view has one associated Sofa, and every Sofa has one associated CAS View.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.naming_views_sofas"><a class="anchor" href="#ugr.tug.mvs.naming_views_sofas"></a>6.1.1. Naming CAS Views and Sofas</h4>
<div class="paragraph">
<p>The developer assigns a name to the View / Sofa, which is a simple string (following the rules for Java identifiers, usually without periods, but see special exception below). These names are declared in the component XML metadata, and are used during assembly and by the runtime to enable switching among multiple Views of the CAS at the same time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The name is called the Sofa name, for historical reasons, but it applies equally to the View.
In the rest of this chapter, we&#8217;ll refer to it as the Sofa name.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some applications contain components that expect a variable number of Sofas as input or output.
An example of a component that takes a variable number of input Sofas could be one that takes several translations of a document and merges them, where each translation was in a separate Sofa.</p>
</div>
<div class="paragraph">
<p>You can specify a variable number of input or output sofa names, where each name has the same base part, by writing the base part of the name (with no periods), followed by a period character and an asterisk character (.<strong>). These denote sofas that have names matching the base part up to the period; for example, names such as <code>base_name_part.TTX_3d</code> would match a specification of <code>base_name_part.</strong></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.multi_view_and_single_view"><a class="anchor" href="#ugr.tug.mvs.multi_view_and_single_view"></a>6.1.2. Multi-View, Single-View components &amp; applications</h4>
<div class="paragraph">
<p>Components and applications can be written to be Multi-View or Single-View.
Most components used as primitive building blocks are expected to be Single-View.
UIMA provides capabilities to combine these kinds of components with Multi-View components when assembling analysis aggregates or applications.</p>
</div>
<div class="paragraph">
<p>Single-View components and applications use only one subject of analysis, and one CAS View.
The code and descriptors for these components do not use the facilities described in this chapter.</p>
</div>
<div class="paragraph">
<p>Conversely, Multi-View components and applications are aware of the possibility of multiple Views and Sofas, and have code and XML descriptors that create and manipulate them.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.mvs.multi_view_components"><a class="anchor" href="#ugr.tug.mvs.multi_view_components"></a>6.2. Multi-View Components</h3>
<div class="sect3">
<h4 id="ugr.tug.mvs.deciding_multi_view"><a class="anchor" href="#ugr.tug.mvs.deciding_multi_view"></a>6.2.1. How UIMA decides if a component is Multi-View</h4>
<div class="paragraph">
<p>Every UIMA component has an associated XML Component Descriptor.
Multi-View components are identified simply as those whose descriptors declare one or more Sofa names in their Capability sections, as inputs or outputs.
If a Component Descriptor does not mention any input or output Sofa names, the framework treats that component as a Single-View component.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.additional_capabilities"><a class="anchor" href="#ugr.tug.mvs.additional_capabilities"></a>6.2.2. Multi-View: additional capabilities</h4>
<div class="paragraph">
<p>Additional capabilities provided for components and applications aware of the possibilities of multiple Views and Sofas include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating new Views, and for each, setting up the associated Sofa data</p>
</li>
<li>
<p>Getting a reference to an existing View and its associated Sofa, by name</p>
</li>
<li>
<p>Specifying a view in which to index a particular Feature Structure instance</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.component_xml_metadata"><a class="anchor" href="#ugr.tug.mvs.component_xml_metadata"></a>6.2.3. Component XML metadata</h4>
<div class="paragraph">
<p>Each Multi-View component that creates a Sofa or wants to switch to a specific previously created Sofa must declare the name for the Sofa in the capabilities section.
For example, a component expecting as input a web document in html format and creating a plain text document for further processing might declare:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;capabilities&gt;
  &lt;capability&gt;
    &lt;inputs/&gt;
    &lt;outputs/&gt;
    &lt;inputSofas&gt;
      &lt;sofaName&gt;rawContent&lt;/sofaName&gt;
    &lt;/inputSofas&gt;
    &lt;outputSofas&gt;
      &lt;sofaName&gt;detagContent&lt;/sofaName&gt;
    &lt;/outputSofas&gt;
  &lt;/capability&gt;
&lt;/capabilities&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Details on this specification are found in <a href="ref.html#ugr.ref.xml.component_descriptor">Component Descriptor Reference</a>.
The Component Descriptor Editor supports Sofa declarations on the <a href="tools.html#ugr.tools.cde.capabilitie">Capabilites Page</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.mvs.sofa_capabilities_and_apis_for_apps"><a class="anchor" href="#ugr.tug.mvs.sofa_capabilities_and_apis_for_apps"></a>6.3. Sofa Capabilities and APIs for Applications</h3>
<div class="paragraph">
<p>In addition to components, applications can make use of these capabilities.
When an application creates a new CAS, it also creates the initial view of that CAS - and this view is the object that is returned from the create call.
Additional views beyond this first one can be dynamically created at any time.
The application can use the Sofa APIs described in <a href="#ugr.tug.aas">Chapter 5</a> to specify the data to be analyzed.</p>
</div>
<div class="paragraph">
<p>If an Application creates a new CAS, the initial CAS that is created will be a view named &#8220;_InitialView&#8221;.
This name can be used in the application and in Sofa Mapping (see the next section) to refer to this otherwise unnamed view.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.mvs.sofa_name_mapping"><a class="anchor" href="#ugr.tug.mvs.sofa_name_mapping"></a>6.4. Sofa Name Mapping</h3>
<div class="paragraph">
<p>Sofa Name mapping is the mechanism which enables UIMA component developers to choose locally meaningful Sofa names in their source code and let aggregate, collection processing engine developers, and application developers connect output Sofas created in one component to input Sofas required in another.</p>
</div>
<div class="paragraph">
<p>At a given aggregation level, the assembler or application developer defines names for all the Sofas, and then specifies how these names map to the contained components, using the Sofa Map.</p>
</div>
<div class="paragraph">
<p>Consider annotator code to create a new CAS view:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CAS viewX = cas.createView("X");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or code to get an existing CAS view:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CAS viewX = cas.getView("X");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without Sofa name mapping the SofaID for the new Sofa will be &#8220;X&#8221;.
However, if a name mapping for &#8220;X&#8221; has been specified by the aggregate or CPE calling this annotator, the actual SofaID in the CAS can be different.</p>
</div>
<div class="paragraph">
<p>All Sofas in a CAS must have unique names.
This is accomplished by mapping all declared Sofas as described in the following sections.
An attempt to create a Sofa with a SofaID already in use will throw an exception.</p>
</div>
<div class="paragraph">
<p>Sofa name mapping must not use the &#8220;.&#8221; (period) character.
Runtime Sofa mapping maps names up to the &#8220;.&#8221; and appends the period and the following characters to the mapped name.</p>
</div>
<div class="paragraph">
<p>To get a Java Iterator for all the views in a CAS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Iterator allViews = cas.getViewIterator();</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get a Java Iterator for selected views in a CAS, for example, views whose name  is either exactly equal to namePrefix or is of the form namePrefix.suffix, where suffix  can be any String:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Iterator someViews = cas.getViewIterator(String namePrefix);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Sofa name mapping is applied to namePrefix.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sofa name mappings are not currently supported for remote Analysis Engines.
See <a href="#ugr.tug.mvs.name_mapping_remote_services">Section 6.4.5</a>.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.name_mapping_aggregate"><a class="anchor" href="#ugr.tug.mvs.name_mapping_aggregate"></a>6.4.1. Name Mapping in an Aggregate Descriptor</h4>
<div class="paragraph">
<p>For each component of an Aggregate, name mapping specifies the conversion between component Sofa names and names at the aggregate level.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example.
Consider two Multi-View annotators to be assembled into an aggregate which takes an audio segment consisting of spoken English and produces a German text translation.</p>
</div>
<div class="paragraph">
<p>The first annotator takes an audio segment as input Sofa and produces a text transcript as output Sofa.
The annotator designer might choose these Sofa names to be &#8220;AudioInput&#8221; and &#8220;TranscribedText&#8221;.</p>
</div>
<div class="paragraph">
<p>The second annotator is designed to translate text from English to German.
This developer might choose the input and output Sofa names to be &#8220;EnglishDocument&#8221; and &#8220;GermanDocument&#8221;, respectively.</p>
</div>
<div class="paragraph">
<p>In order to hook these two annotators together, the following section would be added to the top level of the aggregate descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;sofaMappings&gt;
  &lt;sofaMapping&gt;
    &lt;componentKey&gt;SpeechToText&lt;/componentKey&gt;
    &lt;componentSofaName&gt;AudioInput&lt;/componentSofaName&gt;
    &lt;aggregateSofaName&gt;SegementedAudio&lt;/aggregateSofaName&gt;
  &lt;/sofaMapping&gt;
  &lt;sofaMapping&gt;
    &lt;componentKey&gt;SpeechToText&lt;/componentKey&gt;
    &lt;componentSofaName&gt;TranscribedText&lt;/componentSofaName&gt;
    &lt;aggregateSofaName&gt;EnglishTranscript&lt;/aggregateSofaName&gt;
  &lt;/sofaMapping&gt;
  &lt;sofaMapping&gt;
    &lt;componentKey&gt;EnglishToGermanTranslator&lt;/componentKey&gt;
    &lt;componentSofaName&gt;EnglishDocument&lt;/componentSofaName&gt;
    &lt;aggregateSofaName&gt;EnglishTranscript&lt;/aggregateSofaName&gt;
  &lt;/sofaMapping&gt;
  &lt;sofaMapping&gt;
    &lt;componentKey&gt;EnglishToGermanTranslator&lt;/componentKey&gt;
    &lt;componentSofaName&gt;GermanDocument&lt;/componentSofaName&gt;
    &lt;aggregateSofaName&gt;GermanTranslation&lt;/aggregateSofaName&gt;
  &lt;/sofaMapping&gt;
&lt;/sofaMappings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Component Descriptor Editor supports <a href="tools.html#ugr.tools.cde.capabilities.sofa_name_mapping">Sofa name mapping</a> in aggregates and simplifies the task.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.name_mapping_cpe"><a class="anchor" href="#ugr.tug.mvs.name_mapping_cpe"></a>6.4.2. Name Mapping in a CPEDescriptor</h4>
<div class="paragraph">
<p>The CPE descriptor aggregates together a Collection Reader and CAS Processors (Annotators and CAS Consumers).
<a href="ref.html#ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.sofa_name_mappings">Sofa mappings</a> can be added to the following elements of CPE descriptors: <code>&lt;collectionIterator&gt;</code>, <code>&lt;casInitializer&gt;</code> and the <code>&lt;casProcessor&gt;</code>.
To be consistent with the organization of CPE descriptors, the maps for the CPE descriptor are distributed among the XML markup for each of the parts (collectionIterator, casInitializer, casProcessor). Because of this the <code>&lt;componentKey&gt;</code> element is not needed.
Finally, rather than sub-elements for the parts, the XML markup for these uses attributes.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example.
Let&#8217;s use the aggregate from the previous section in a collection processing engine.
Here we will add a Collection Reader that outputs audio segments in an output Sofa named &#8220;nextSegment&#8221;.
Remember to declare an output Sofa nextSegment in the collection reader description.
We&#8217;ll add a CAS Consumer in the next section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;collectionReader&gt;
  &lt;collectionIterator&gt;
    &lt;descriptor&gt;
    . . .
    &lt;/descriptor&gt;
    &lt;configurationParameterSettings&gt;...&lt;/configurationParameterSettings&gt;
    &lt;sofaNameMappings&gt;
      &lt;sofaNameMapping componentSofaName="nextSegment"
                       cpeSofaName="SegementedAudio"/&gt;
      &lt;/sofaNameMappings&gt;
  &lt;/collectionIterator&gt;
  &lt;casInitializer/&gt;
&lt;collectionReader&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point the CAS Processor section for the aggregate does not need any Sofa mapping because the aggregate input Sofa has the same name, &#8220;SegementedAudio&#8221;, as is being produced by the Collection Reader.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.specifying_cas_view_for_process"><a class="anchor" href="#ugr.tug.mvs.specifying_cas_view_for_process"></a>6.4.3. Specifying the CAS View delivered to a Components Process Method</h4>
<div class="paragraph">
<p>All components receive a Sofa named &#8220;_InitialView&#8221;, or a Sofa that is mapped to this name.</p>
</div>
<div class="paragraph">
<p>For example, assume that the CAS Consumer to be used in our CPE is a Single-View component that expects the analysis results associated with the input CAS, and that we want it to use the results from the translated German text Sofa.
The following mapping added to the CAS Processor section for the CPE will instruct the CPE to get the CAS view for the German text Sofa and pass it to the CAS Consumer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;casProcessor&gt;
  . . .
  &lt;sofaNameMappings&gt;
    &lt;sofaNameMapping componentSofaName="_InitialView"
                           cpeSofaName="GermanTranslation"/&gt;
  &lt;sofaNameMappings&gt;
&lt;/casProcessor&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An alternative syntax for this kind of mapping is to simply leave out the component sofa name in this case.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.name_mapping_application"><a class="anchor" href="#ugr.tug.mvs.name_mapping_application"></a>6.4.4. Name Mapping in a UIMA Application</h4>
<div class="paragraph">
<p>Applications which instantiate UIMA components directly using the UIMAFramework methods can also create a top level Sofa mapping using the &#8220;additional parameters&#8221; capability.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>//create a "root" UIMA context for your whole application

UimaContextAdmin rootContext =
   UIMAFramework.newUimaContext(UIMAFramework.getLogger(),
      UIMAFramework.newDefaultResourceManager(),
      UIMAFramework.newConfigurationManager());

input = new XMLInputSource("test.xml");
desc = UIMAFramework.getXMLParser().parseAnalysisEngineDescription(input);

//setup sofa name mappings using the api

HashMap sofamappings = new HashMap();
sofamappings.put("localName1", "globalName1");
sofamappings.put("localName2", "globalName2");

//create a UIMA Context for the new AE we are about to create

//first argument is unique key among all AEs used in the application
UimaContextAdmin childContext = rootContext.createChild("myAE", sofamap);

//instantiate AE, passing the UIMA Context through the additional
//parameters map

Map additionalParams = new HashMap();
additionalParams.put(Resource.PARAM_UIMA_CONTEXT, childContext);

AnalysisEngine ae =
        UIMAFramework.produceAnalysisEngine(desc,additionalParams);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Sofa mappings are applied from the inside out, i.e., local to global.
First, any aggregate mappings are applied, then any CPE mappings, and finally, any specified using this &#8220;additional parameters&#8221; capability.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.name_mapping_remote_services"><a class="anchor" href="#ugr.tug.mvs.name_mapping_remote_services"></a>6.4.5. Name Mapping for Remote Services</h4>
<div class="paragraph">
<p>Currently, no client-side Sofa mapping information is passed from a UIMA client to a remote service.
This can cause complications for UIMA services in a Multi-View application.</p>
</div>
<div class="paragraph">
<p>Remote Multi-View services will work only if the service is Single-View, or if the  Sofa names expected by the service exactly match the Sofa names produced by the client.</p>
</div>
<div class="paragraph">
<p>If your application requires Sofa mappings for a remote Analysis Engine, you can wrap your remotely deployed AE in an aggregate (on the remote side), and specify the necessary Sofa mappings in the descriptor for that aggregate.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.mvs.jcas_extensions_for_multi_views"><a class="anchor" href="#ugr.tug.mvs.jcas_extensions_for_multi_views"></a>6.5. JCas extensions for Multiple Views</h3>
<div class="paragraph">
<p>The JCas interface to the CAS can be used with any / all views.
You can always get a JCas object from an existing CAS object by using the method getJCas(); this call will create the JCas if it doesn&#8217;t already exist.
If it does exist, it just returns the existing JCas that corresponds to the CAS.</p>
</div>
<div class="paragraph">
<p>JCas implements the getView(&#8230;&#8203;) method, enabling switching to other named views, just like the corresponding method on the CAS.
The JCas version, however, returns JCas objects, instead of CAS objects, corresponding to the view.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.mvs.sample_application"><a class="anchor" href="#ugr.tug.mvs.sample_application"></a>6.6. Sample Multi-View Application</h3>
<div class="paragraph">
<p>The UIMA SDK contains a simple Sofa example application which demonstrates many Sofa specific concepts and methods.
The source code for the application driver is in <code>examples/src/org/apache/uima/examples/SofaExampleApplication.java</code> and the Multi-View annotator is given in <code>SofaExampleAnnotator.java</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>This sample application demonstrates a language translator annotator which expects an input text Sofa with an English document and creates an output text Sofa containing a German translation.
Some of the key Sofa concepts illustrated here include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sofa creation.</p>
</li>
<li>
<p>Access of multiple CAS views.</p>
</li>
<li>
<p>Unique feature structure index space for each view.</p>
</li>
<li>
<p>Feature structures containing cross references between annotations in different CAS views.</p>
</li>
<li>
<p>The strong affinity of annotations with a specific Sofa.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.sample_application.descriptor"><a class="anchor" href="#ugr.tug.mvs.sample_application.descriptor"></a>6.6.1. Annotator Descriptor</h4>
<div class="paragraph">
<p>The annotator descriptor in <code>examples/descriptors/analysis_engine/SofaExampleAnnotator.xml</code> declares an input Sofa named &#8220;EnglishDocument&#8221; and an output Sofa named &#8220;GermanDocument&#8221;.
A custom type &#8220;CrossAnnotation&#8221; is also defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;typeDescription&gt;
  &lt;name&gt;sofa.test.CrossAnnotation&lt;/name&gt;
  &lt;description/&gt;
  &lt;supertypeName&gt;uima.tcas.Annotation&lt;/supertypeName&gt;
  &lt;features&gt;
    &lt;featureDescription&gt;
      &lt;name&gt;otherAnnotation&lt;/name&gt;
      &lt;description/&gt;
      &lt;rangeTypeName&gt;uima.tcas.Annotation&lt;/rangeTypeName&gt;
    &lt;/featureDescription&gt;
  &lt;/features&gt;
&lt;/typeDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CrossAnnotation</code> type is derived from <code>uima.tcas.Annotation </code>and includes one new feature: a reference to another annotation.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.sample_application.setup"><a class="anchor" href="#ugr.tug.mvs.sample_application.setup"></a>6.6.2. Application Setup</h4>
<div class="paragraph">
<p>The application driver instantiates an analysis engine, <code>seAnnotator</code>, from the annotator descriptor, obtains a new CAS using that engine&#8217;s CAS definition, and creates the expected input Sofa using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CAS cas = seAnnotator.newCAS();
CAS aView = cas.createView("EnglishDocument");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since <code>seAnnotator</code> is a primitive component, and no Sofa mapping has been defined, the SofaID will be &#8220;EnglishDocument&#8221;.
Local Sofa data is set using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>aView.setDocumentText("this beer is good");</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point the CAS contains all necessary inputs for the translation annotator and its process method is called.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.sample_application.annotator_processing"><a class="anchor" href="#ugr.tug.mvs.sample_application.annotator_processing"></a>6.6.3. Annotator Processing</h4>
<div class="paragraph">
<p>Annotator processing consists of parsing the English document into individual words, doing word-by-word translation and concatenating the translations into a German translation.
Analysis metadata on the English Sofa will be an annotation for each English word.
Analysis metadata on the German Sofa will be a <code>CrossAnnotation</code> for each German word, where the <code>otherAnnotation</code> feature will be a reference to the associated English annotation.</p>
</div>
<div class="paragraph">
<p>Code of interest includes two CAS views:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// get View of the English text Sofa
englishView = aCas.getView("EnglishDocument");

// Create the output German text Sofa
germanView = aCas.createView("GermanDocument");</code></pre>
</div>
</div>
<div class="paragraph">
<p>the indexing of annotations with the appropriate view:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>englishView.addFsToIndexes(engAnnot);
. . .
germanView.addFsToIndexes(germAnnot);</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the combining of metadata belonging to different Sofas in the same feature structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// add link to English text
germAnnot.setFeatureValue(other, engAnnot);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.mvs.sample_application.accessing_results"><a class="anchor" href="#ugr.tug.mvs.sample_application.accessing_results"></a>6.6.4. Accessing the results of analysis</h4>
<div class="paragraph">
<p>The application needs to get the results of analysis, which may be in different views.
Analysis results for each Sofa are dumped independently by iterating over all annotations for each associated CAS view.
For the English Sofa:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>for (Annotation annot : aView.getAnnotationIndex()) {
  System.out.println(" " + annot.getType().getName()
                         + ": " + annot.getCoveredText());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Iterating over all German annotations looks the same, except for the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>if (annot.getType() == cross) {
  AnnotationFS crossAnnot =
          (AnnotationFS) annot.getFeatureValue(other);
  System.out.println("   other annotation feature: "
          + crossAnnot.getCoveredText());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of particular interest here is the built-in Annotation type method <code>getCoveredText()</code>.
This method uses the &#8220;begin&#8221; and &#8220;end&#8221; features of the annotation to create a substring from the CAS document.
The SofaRef feature of the annotation is used to identify the correct Sofa&#8217;s data from which to create the substring.</p>
</div>
<div class="paragraph">
<p>The example program output is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>---Printing all annotations for English Sofa---
uima.tcas.DocumentAnnotation: this beer is good
uima.tcas.Annotation: this
uima.tcas.Annotation: beer
uima.tcas.Annotation: is
uima.tcas.Annotation: good

---Printing all annotations for German Sofa---
uima.tcas.DocumentAnnotation: das bier ist gut
sofa.test.CrossAnnotation: das
 other annotation feature: this
sofa.test.CrossAnnotation: bier
 other annotation feature: beer
sofa.test.CrossAnnotation: ist
 other annotation feature: is
sofa.test.CrossAnnotation: gut
 other annotation feature: good</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.mvs.views_api_summary"><a class="anchor" href="#ugr.tug.mvs.views_api_summary"></a>6.7. Views API Summary</h3>
<div class="paragraph">
<p>The recommended way to deliver a particular CAS view to a <em>Single-View</em> component is to use by Sofa-mapping in the CPE and/or aggregate descriptors.</p>
</div>
<div class="paragraph">
<p>For _Multi-View _ components or applications, the following methods are used to create or get a reference to a CAS view for a particular Sofa:</p>
</div>
<div class="paragraph">
<p>Creating a new View:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>JCas newView = aJCas.createView(String localNameOfTheViewBeforeMapping);
CAS  newView = aCAS .createView(String localNameOfTheViewBeforeMapping);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Getting a View from a CAS or JCas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>JCas myView = aJCas.getView(String localNameOfTheViewBeforeMapping);
CAS  myView = aCAS .getView(String localNameOfTheViewBeforeMapping);
Iterator allViews = aCasOrJCas.getViewIterator();
Iterator someViews = aCasOrJCas.getViewIterator(String localViewNamePrefix);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following methods are useful for all annotators and applications:</p>
</div>
<div class="paragraph">
<p>Setting Sofa data for a CAS or JCas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>aCasOrJCas.setDocumentText(String docText);
aCasOrJCas.setSofaDataString(String docText, String mimeType);
aCasOrJCas.setSofaDataArray(FeatureStructure array, String mimeType);
aCasOrJCas.setSofaDataURI(String uri, String mimeType);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Getting Sofa data for a particular CAS or JCas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>String doc = aCasOrJCas.getDocumentText();
String doc = aCasOrJCas.getSofaDataString();
FeatureStructure array = aCasOrJCas.getSofaDataArray();
String uri = aCasOrJCas.getSofaDataURI();
InputStream is = aCasOrJCas.getSofaDataStream();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.tug.cm"><a class="anchor" href="#ugr.tug.cm"></a>7. CAS Multiplier Developer&#8217;s Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The UIMA analysis components (Annotators and CAS Consumers) described previously in this manual all take a single CAS as input, optionally make modifications to it, and output that same CAS.
This chapter describes an advanced feature that became available in the UIMA SDK v2.0: a new type of analysis component called a <em>CAS Multiplier</em>, which can create new CASes during processing.</p>
</div>
<div class="paragraph">
<p>CAS Multipliers are often used to split a large artifact into manageable pieces.
This is a common requirement of audio and video analysis applications, but can also occur in text analysis on very large documents.
A CAS Multiplier would take as input a single CAS representing the large artifact (perhaps by a remote reference to the actual data&#8201;&#8212;&#8201;see <a href="#ugr.tug.aas.sofa_data_formats">Section 5.2</a>) and produce as output a series of new CASes each of which contains only a small portion of the original artifact.</p>
</div>
<div class="paragraph">
<p>CAS Multipliers are not limited to dividing an artifact into smaller pieces, however.
A CAS Multiplier can also be used to combine smaller segments together to form larger segments.
In general, a CAS Multiplier is used to <em>change</em> the segmentation of a series of CASes; that is, to change how a stream of data is divided among discrete CAS objects.</p>
</div>
<div class="sect2">
<h3 id="ugr.tug.cm.developing_multiplier_code"><a class="anchor" href="#ugr.tug.cm.developing_multiplier_code"></a>7.1. Developing the CAS Multiplier Code</h3>
<div class="sect3">
<h4 id="ugr.tug.cm.cm_interface_overview"><a class="anchor" href="#ugr.tug.cm.cm_interface_overview"></a>7.1.1. CAS Multiplier Interface Overview</h4>
<div class="paragraph">
<p>CAS Multiplier implementations should extend from the <code>JCasMultiplier_ImplBase</code> or <code>CasMultiplier_ImplBase</code> classes, depending on which CAS interface they prefer to use.
As with other types of analysis components, the CAS Multiplier ImplBase classes define optional <code>initialize</code>, <code>destroy</code>, and <code>reconfigure</code> methods.
There are then three required methods: <code>process</code>, <code>hasNext</code>, and <code>next</code>.
The framework interacts with these methods as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The framework calls the CAS Multiplier&#8217;s <code>process</code> method, passing it an input CAS. The process method returns, but may hold on to a reference to the input CAS.</p>
</li>
<li>
<p>The framework then calls the CAS Multiplier&#8217;s <code>hasNext</code> method. The CAS Multiplier should return <code>true</code> from this method if it intends to output one or more new CASes (for instance, segments of this CAS), and <code>false</code> if not.</p>
</li>
<li>
<p>If <code>hasNext</code> returned true, the framework will call the CAS Multiplier&#8217;s <code>next</code> method. The CAS Multiplier creates a new CAS (we will see how in a moment), populates it, and returns it from the <code>next</code> method.</p>
</li>
<li>
<p>Steps 2 and 3 continue until <code>hasNext</code> returns false. If the framework detects a situation where it needs to cancel this CAS Multiplier, it will stop calling the <code>hasNext</code> and <code>next</code> methods, and when another top-level CAS comes along it will call the annotator&#8217;s <code>process</code> method again. User&#8217;s annotator code should interpret this as a signal to cleanup  processing related to the previous CAS and then start processing with the new CAS.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>From the time when <code>process</code> is called until the <code>hasNext</code> method returns false (or <code>process</code> is called again),  the CAS Multiplier &#8220;owns&#8221; the CAS that was passed to its <code>process</code> method.
The CAS Multiplier can store a reference to this CAS in a local field and can read from it or write to it during this time.
Once the ending condition occurs, the CAS Multiplier gives up ownership of the input CAS and should no longer retain a reference to it.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cm.how_to_get_empty_cas_instance"><a class="anchor" href="#ugr.tug.cm.how_to_get_empty_cas_instance"></a>7.1.2. How to Get an Empty CAS Instance</h4>
<div class="paragraph">
<p>The CAS Multiplier&#8217;s <code>next</code> method must return a CAS instance that represents a new representation of the input artifact.
Since CAS instances are managed by the framework, the CAS Multiplier cannot actually create a new CAS; instead it should request an empty CAS by calling the method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CAS getEmptyCAS()</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>JCas getEmptyJCas()</code></pre>
</div>
</div>
<div class="paragraph">
<p>which are defined on the <code>CasMultiplier_ImplBase</code> and <code>JCasMultiplier_ImplBase</code> classes, respectively.</p>
</div>
<div class="paragraph">
<p>Note that if it is more convenient you can request an empty CAS during the <code>process</code> or <code>hasNext</code> methods, not just during the <code>next</code> method.</p>
</div>
<div class="paragraph">
<p>By default, a CAS Multiplier is only allowed to hold one output CAS instance at a time.
You must return the CAS from the <code>next</code> method before you can request a second CAS.
If you try to call getEmptyCAS a second time you will get an Exception.
You can change this default behavior by overriding the method <code>getCasInstancesRequired</code> to return the number of CAS instances that you need.
Be aware that CAS instances consume a significant amount of memory, so setting this to a large value will cause your application to use a lot of RAM.
So, for example, it is not a good practice to attempt to generate a large number of new CASes in the CAS Multiplier&#8217;s <code>process</code> method.
Instead, you should spread your processing out across the calls to the <code>hasNext</code> or <code>next</code> methods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can only call <code>getEmptyCAS()</code> or <code>getEmptyJCas()</code> from your CAS Multiplier&#8217;s <code>process</code>, <code>hasNext</code>, or <code>next</code> methods.
You cannot call it from other methods such as <code>initialize</code>.
This is because the Aggregate AE&#8217;s Type System is not available until all of the components of the aggregate have finished their initialization.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Type System of the empty CAS will contain all of the type definitions for all  components of the outermost Aggregate Analysis Engine or Collection Processing Engine that contains your CAS Multiplier.
Therefore downstream components that receive  these CASes can add new instances of any type that they define.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Be careful to keep the Feature Structures that belong to each CAS separate.
You  cannot create references from a Feature Structure in one CAS to a Feature Structure in another CAS.
You also cannot add a Feature Structure created in one CAS to the indexes of a different CAS.
If you attempt to do this, the results are undefined.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cm.example_code"><a class="anchor" href="#ugr.tug.cm.example_code"></a>7.1.3. Example Code</h4>
<div class="paragraph">
<p>This section walks through the source code of an example CAS Multiplier that breaks text documents into smaller pieces.
The Java class for the example is <code>org.apache.uima.examples.casMultiplier.SimpleTextSegmenter</code> and the source code is included in the UIMA SDK under the <code>examples/src</code> directory.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.cm.example_code.overall_structure"><a class="anchor" href="#ugr.tug.cm.example_code.overall_structure"></a>Overall Structure</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public class SimpleTextSegmenter extends JCasMultiplier_ImplBase {
  private String mDoc;
  private int mPos;
  private int mSegmentSize;
  private String mDocUri;

  public void initialize(UimaContext aContext)
          throws ResourceInitializationException
  { ... }

  public void process(JCas aJCas) throws AnalysisEngineProcessException
  { ... }

  public boolean hasNext() throws AnalysisEngineProcessException
  { ... }

  public AbstractCas next() throws AnalysisEngineProcessException
  { ... }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SimpleTextSegmenter</code> class extends <code>JCasMultiplier_ImplBase</code> and implements the optional <code>initialize</code> method as well as the required <code>process</code>, <code>hasNext</code>, and <code>next</code> methods.
Each method is described below.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.cm.example_code.initialize"><a class="anchor" href="#ugr.tug.cm.example_code.initialize"></a>Initialize Method</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void initialize(UimaContext aContext) throws
                    ResourceInitializationException {
  super.initialize(aContext);
  mSegmentSize = ((Integer)aContext.getConfigParameterValue(
                            "segmentSize")).intValue();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Like an Annotator, a CAS Multiplier can override the initialize method and read configuration parameter values from the UimaContext.
The SimpleTextSegmenter defines one parameter, &#8220;Segment
          Size&#8221;, which determines the approximate size (in characters) of each segment that it will produce.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.cm.example_code.process"><a class="anchor" href="#ugr.tug.cm.example_code.process"></a>Process Method</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void process(JCas aJCas)
       throws AnalysisEngineProcessException {
  mDoc = aJCas.getDocumentText();
  mPos = 0;
  // retreive the filename of the input file from the CAS so that it can
  // be added to each segment
  FSIterator it = aJCas.
          getAnnotationIndex(SourceDocumentInformation.type).iterator();
  if (it.hasNext()) {
    SourceDocumentInformation fileLoc =
          (SourceDocumentInformation)it.next();
    mDocUri = fileLoc.getUri();
  }
  else {
    mDocUri = null;
  }
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The process method receives a new JCas to be processed(segmented) by this CAS Multiplier.
The SimpleTextSegmenter extracts some information from this JCas and stores it in fields (the document text is stored in the field mDoc and the source URI in the field mDocURI). Recall that the CAS Multiplier is considered to &#8220;own&#8221; the JCas from the time when process is called until the time when hasNext returns false.
Therefore it is acceptable to retain references to objects from the JCas in a CAS Multiplier, whereas this should never be done in an Annotator.
The CAS Multiplier could have chosen to store a reference to the JCas itself, but that was not necessary for this example.</p>
</div>
<div class="paragraph">
<p>The CAS Multiplier also initializes the mPos variable to 0.
This variable is a position into the document text and will be incremented as each new segment is produced.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.cm.example_code.hasnext"><a class="anchor" href="#ugr.tug.cm.example_code.hasnext"></a>HasNext Method</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public boolean hasNext() throws AnalysisEngineProcessException {
  return mPos &lt; mDoc.length();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The job of the hasNext method is to report whether there are any additional output CASes to produce.
For this example, the CAS Multiplier will break the entire input document into segments, so we know there will always be a next segment until the very end of the document has been reached.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.cm.example_code.next"><a class="anchor" href="#ugr.tug.cm.example_code.next"></a>Next Method</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public AbstractCas next() throws AnalysisEngineProcessException {
  int breakAt = mPos + mSegmentSize;
  if (breakAt &gt; mDoc.length())
    breakAt = mDoc.length();

  // search for the next newline character.
  // Note: this example segmenter implementation
  // assumes that the document contains many newlines.
  // In the worst case, if this segmenter
  // is run on a document with no newlines,
  // it will produce only one segment containing the
  // entire document text.
  // A better implementation might specify a maximum segment size as
  // well as a minimum.

  while (breakAt &lt; mDoc.length() &amp;&amp;
         mDoc.charAt(breakAt - 1) != '\n')
    breakAt++;

  JCas jcas = getEmptyJCas();
  try {
    jcas.setDocumentText(mDoc.substring(mPos, breakAt));
    // if original CAS had SourceDocumentInformation,
          also add SourceDocumentInformatio
    // to each segment
    if (mDocUri != null) {
      SourceDocumentInformation sdi =
          new SourceDocumentInformation(jcas);
      sdi.setUri(mDocUri);
      sdi.setOffsetInSource(mPos);
      sdi.setDocumentSize(breakAt - mPos);
      sdi.addToIndexes();

      if (breakAt == mDoc.length()) {
        sdi.setLastSegment(true);
      }
    }

    mPos = breakAt;
    return jcas;
  } catch (Exception e) {
    jcas.release();
    throw new AnalysisEngineProcessException(e);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>next</code> method actually produces the next segment and returns it.
The framework guarantees that it will not call <code>next</code> unless <code>hasNext</code> has returned true since the last call to <code>process</code> or <code>next</code> .</p>
</div>
<div class="paragraph">
<p>Note that in order to produce a segment, the CAS Multiplier must get an empty JCas to populate.
This is done by the line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>JCas jcas = getEmptyJCas();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This requests an empty JCas from the framework, which maintains a pool of JCas instances to draw from.</p>
</div>
<div class="paragraph">
<p>Also, note the use of the <code>try&#8230;&#8203;catch</code> block to ensure that a JCas is released back to the pool if an exception occurs.
This is very important to allow a CAS Multiplier to recover from errors.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cm.creating_cm_descriptor"><a class="anchor" href="#ugr.tug.cm.creating_cm_descriptor"></a>7.2. Creating the CAS Multiplier Descriptor</h3>
<div class="paragraph">
<p>There is not a separate type of descriptor for a CAS Multiplier.
CAS Multiplier are considered a type of Analysis Engine, and so their descriptors use the same syntax as any other Analysis Engine Descriptor.</p>
</div>
<div class="paragraph">
<p>The descriptor for the <code>SimpleTextSegmenter</code> is located in the <code>examples/descriptors/cas_multiplier/SimpleTextSegmenter.xml</code> directory of the UIMA SDK.</p>
</div>
<div class="paragraph">
<p>The Analysis Engine Description, in its &#8220;Operational Properties&#8221; section, now contains a new &#8220;outputsNewCASes&#8221; property which takes a Boolean value.
If the Analysis Engine is a CAS Multiplier, this property should be set to true.</p>
</div>
<div class="paragraph">
<p>If you use the CDE, be sure to check the &#8220;Outputs new CASes&#8221; box in the Runtime Information section on the Overview page, as shown here:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./tug/images/tutorials_and_users_guides/tug.cas_multiplier/image002.jpg" alt="image002">
</div>
<div class="title">Figure 29. Screen shot of Component Descriptor Editor on Overview showing checking of "Outputs new CASes" box</div>
</div>
<div class="paragraph">
<p>If you edit the Analysis Engine Descriptor by hand, you need to add a <code>&lt;outputsNewCASes&gt;</code> element to your descriptor as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;operationalProperties&gt;
  &lt;modifiesCas&gt;false&lt;/modifiesCas&gt;
  &lt;multipleDeploymentAllowed&gt;true&lt;/multipleDeploymentAllowed&gt;
  &lt;outputsNewCASes&gt;true&lt;/outputsNewCASes&gt;
&lt;/operationalProperties&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The &#8220;modifiedCas&#8221; operational property refers to the input CAS, not the new output CASes produced.
So our example SimpleTextSegmenter has modifiesCas set to false since it doesn&#8217;t modify the input CAS.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cm.using_cm_in_aae"><a class="anchor" href="#ugr.tug.cm.using_cm_in_aae"></a>7.3. Using a CAS Multiplier in an Aggregate Analysis Engine</h3>
<div class="paragraph">
<p>You can include a CAS Multiplier as a component in an Aggregate Analysis Engine.
For example, this allows you to construct an Aggregate Analysis Engine that takes each input CAS, breaks it up into segments, and runs a series of Annotators on each segment.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.cm.adding_cm_to_aggregate"><a class="anchor" href="#ugr.tug.cm.adding_cm_to_aggregate"></a>7.3.1. Adding the CAS Multiplier to the Aggregate</h4>
<div class="paragraph">
<p>Since CAS Multiplier are considered a type of Analysis Engine, adding them to an aggregate works the same way as for other Analysis Engines.
Using the CDE, you just click the &#8220;Add&#8230;&#8203;&#8221; button in the Component Engines view and browse to the Analysis Engine Descriptor of your CAS Multiplier.
If editing the aggregate descriptor directly, just <code>import</code> the Analysis Engine Descriptor of your CAS Multiplier as usual.</p>
</div>
<div class="paragraph">
<p>An example descriptor for an Aggregate Analysis Engine containing a CAS Multiplier is provided in <code>examples/descriptors/cas_multiplier/SegmenterAndTokenizerAE.xml</code>.
This Aggregate runs the <code>SimpleTextSegmenter</code> example to break a large document into segments, and then runs each segment through the <code>SimpleTokenAndSentenceAnnotator</code>.
Try running it in the Document Analyzer tool with a large text file as input, to see that it outputs multiple output CASes, one for each segment produced by the <code>SimpleTextSegmenter</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cm.cm_and_fc"><a class="anchor" href="#ugr.tug.cm.cm_and_fc"></a>7.3.2. CAS Multipliers and Flow Control</h4>
<div class="paragraph">
<p>CAS Multipliers are only supported in the context of Fixed Flow or custom Flow Control.
If you use the built-in &#8220;Fixed Flow&#8221; for your Aggregate Analysis Engine, you can position the CAS Multiplier anywhere in that flow.
Processing then works as follows: When a CAS is input to the Aggregate AE, that CAS is routed to the components in the order specified by the Fixed Flow, until that CAS reaches a CAS Multiplier.</p>
</div>
<div class="paragraph">
<p>Upon reaching a CAS Multiplier, if that CAS Multiplier produces new output CASes, then each output CAS from that CAS Multiplier will continue through the flow, starting at the node immediately after the CAS Multiplier in the Fixed Flow.
No further processing will be done on the original input CAS after it has reached a CAS Multiplier –it will <em>not</em> continue in the flow.</p>
</div>
<div class="paragraph">
<p>If the CAS Multiplier does <em>not</em> produce any output CASes for a given input CAS, then that input CAS <em>will</em> continue in the flow.
This behavior is appropriate, for example, for a CAS Multiplier that may segment an input CAS into pieces but only does so if the input CAS is larger than a certain size.</p>
</div>
<div class="paragraph">
<p>It is possible to put more than one CAS Multiplier in your flow.
In this case, when a new CAS output from the first CAS Multiplier reaches the second CAS Multiplier and if the second CAS Multiplier produces output CASes, then no further processing will occur on the input CAS, and any new output CASes produced by the second CAS Multiplier will continue the flow starting at the node after the second CAS Multiplier.</p>
</div>
<div class="paragraph">
<p>This default behavior can be customized.
The <code>FixedFlowController</code> component that implement&#8217;s UIMA&#8217;s default flow defines a configuration parameter <code>ActionAfterCasMultiplier</code> that can take the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>continue</code>– the CAS continues on to the next element in the flow</p>
</li>
<li>
<p><code>stop</code>– the CAS will no longer continue in the flow, and will be returned from the aggregate if possible.</p>
</li>
<li>
<p><code>drop</code>– the CAS will no longer continue in the flow, and will be dropped (not returned from the aggregate) if possible.</p>
</li>
<li>
<p><code>dropIfNewCasProduced</code> (the default) – if the CAS multiplier produced a new CAS as a result of processing this CAS, then this CAS will be dropped. If not, then this CAS will continue.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can override this parameter in your Aggregate Analysis Engine the same way you would override a parameter in a delegate Analysis Engine.
But to do so you must first explicitly identify that you are using the <code>FixedFlowController</code> implementation by importing its descriptor into your aggregate as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;flowController key="FixedFlowController"&gt;
          &lt;import name="org.apache.uima.flow.FixedFlowController"/&gt;
        &lt;/flowController&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parameter could then be overriden as, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameters&gt;
          &lt;configurationParameter&gt;
            &lt;name&gt;ActionForIntermediateSegments&lt;/name&gt;
            &lt;type&gt;String&lt;/type&gt;
            &lt;multiValued&gt;false&lt;/multiValued&gt;
            &lt;mandatory&gt;false&lt;/mandatory&gt;
            &lt;overrides&gt;
              &lt;parameter&gt;
                FixedFlowController/ActionAfterCasMultiplier
              &lt;/parameter&gt;
            &lt;/overrides&gt;
          &lt;/configurationParameter&gt;
        &lt;/configurationParameters&gt;

       &lt;configurationParameterSettings&gt;
         &lt;nameValuePair&gt;
           &lt;name&gt;ActionForIntermediateSegments&lt;/name&gt;
           &lt;value&gt;
             &lt;string&gt;drop&lt;/string&gt;
           &lt;/value&gt;
         &lt;/nameValuePair&gt;
       &lt;/configurationParameterSettings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This overriding can also be done using the Component Descriptor Editor tool.
An example of an Analysis Engine that overrides this parameter can be found in <code>examples/descriptors/cas_multiplier/Segment_Annotate_Merge_AE.xml</code>.
For more information about how to specify a flow controller as part of your Aggregate Analysis Engine descriptor, see <a href="#ugr.tug.fc.adding_fc_to_aggregate">Section 4.3</a>.</p>
</div>
<div class="paragraph">
<p>If you would like to further customize the flow, you will need to implement a custom FlowController as described in <a href="#ugr.tug.fc">Chapter 4</a>.
For example, you could implement a flow where a CAS that is input to a CAS Multiplier will be processed further by <em>some</em> downstream components, but not others.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cm.aggregate_cms"><a class="anchor" href="#ugr.tug.cm.aggregate_cms"></a>7.3.3. Aggregate CAS Multipliers</h4>
<div class="paragraph">
<p>An important consideration when you put a CAS Multiplier inside an Aggregate Analysis Engine is whether you want the Aggregate to also function as a CAS Multiplier&#8201;&#8212;&#8201;that is, whether you want the new output CASes produced within the Aggregate to be output from the Aggregate.
This is controlled by the <code>&lt;outputsNewCASes&gt;</code> element in the Operational Properties of your Aggregate Analysis Engine descriptor.
The syntax is the same as what was described in <a href="#ugr.tug.cm.creating_cm_descriptor">Section 7.2</a> .</p>
</div>
<div class="paragraph">
<p>If you set this property to <code>true</code>, then any new output CASes produced by a CAS Multiplier inside this Aggregate will be output from the Aggregate.
Thus the Aggregate will function as a CAS Multiplier and can be used in any of the ways in which a primitive CAS Multiplier can be used.</p>
</div>
<div class="paragraph">
<p>If you set the &lt;outputsNewCASes&gt; property to <code>false</code> , then any new output CASes produced by a CAS Multiplier inside the Aggregate will be dropped (i.e.
the CASes will be released back to the pool) once they have finished being processed.
Such an Aggregate Analysis Engine functions just like a &#8220;normal&#8221; non-CAS-Multiplier Analysis Engine; the fact that CAS Multiplication is occurring inside it is hidden from users of that Analysis Engine.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to output some new Output CASes and not others, you need to implement a custom Flow Controller that makes this decision&#8201;&#8212;&#8201;see <a href="#ugr.tug.fc.using_fc_with_cas_multipliers">Section 4.5</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cm.using_cm_in_cpe"><a class="anchor" href="#ugr.tug.cm.using_cm_in_cpe"></a>7.4. Using a CAS Multiplier in a Collection Processing Engine</h3>
<div class="paragraph">
<p>It is currently a limitation that CAS Multiplier cannot be deployed directly in a Collection Processing Engine.
The only way that you can use a CAS Multiplier in a CPE is to first wrap it in an Aggregate Analysis Engine whose <code>outputsNewCASes </code>property is set to <code>false</code>, which in effect hides the existence of the CAS Multiplier from the CPE.</p>
</div>
<div class="paragraph">
<p>Note that you can build an Aggregate Analysis Engine that consists of CAS Multipliers and Annotators, followed by CAS Consumers.
This can simulate what a CPE would do, but without the deployment and error handling options that the CPE provides.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cm.calling_cm_from_app"><a class="anchor" href="#ugr.tug.cm.calling_cm_from_app"></a>7.5. Calling a CAS Multiplier from an Application</h3>
<div class="sect3">
<h4 id="ugr.tug.cm.retrieving_output_cases"><a class="anchor" href="#ugr.tug.cm.retrieving_output_cases"></a>7.5.1. Retrieving Output CASes from the CAS Multiplier</h4>
<div class="paragraph">
<p>The <code>AnalysisEngine</code> interface has the following methods that allow you to interact with CAS Multiplier:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CasIterator processAndOutputNewCASes(CAS)</code></p>
</li>
<li>
<p><code>JCasIterator processAndOutputNewCASes(JCas)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From your application, you call <code>processAndOutputNewCASes</code> and pass it the input CAS.
An iterator is returned that allows you to step through each of the new output CASes that are produced by the Analysis Engine.</p>
</div>
<div class="paragraph">
<p>It is very important to realize that CASes are pooled objects and so your application must release each CAS (by calling the <code>CAS.release()</code> method) that it obtains from the CasIterator <em>before</em> it calls the <code>CasIterator.next</code> method again.
Otherwise, the CAS pool will be exhausted and a deadlock will occur.</p>
</div>
<div class="paragraph">
<p>The example code in the class <code>org.apache.uima.examples.casMultiplier.
        CasMultiplierExampleApplication</code> illusrates this.
Here is the main processing loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CasIterator casIterator = ae.processAndOutputNewCASes(initialCas);
while (casIterator.hasNext()) {
  CAS outCas = casIterator.next();

  //dump the document text and annotations for this segment
  System.out.println("********* NEW SEGMENT *********");
  System.out.println(outCas.getDocumentText());
  PrintAnnotations.printAnnotations(outCas, System.out);

  //release the CAS (important)
  outCas.release();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that as defined by the CAS Multiplier contract in <a href="#ugr.tug.cm.cm_interface_overview">Section 7.1.1</a>, the CAS Multiplier owns the input CAS (<code>initialCas</code> in the example) until the last new output CAS has been produced.
This means that the application should not try to make changes to <code>initialCas</code> until after the <code>CasIterator.hasNext</code> method has returned false, indicating that the segmenter has finished.</p>
</div>
<div class="paragraph">
<p>Note that the processing time of the Analysis Engine is spread out over the calls to the <code>CasIterator&#8217;s hasNext</code> and <code>next</code> methods.
That is, the next output CAS may not actually be produced and annotated until the application asks for it.
So the application should not expect calls to the <code>CasIterator</code> to necessarily complete quickly.</p>
</div>
<div class="paragraph">
<p>Also, calls to the <code>CasIterator</code> may throw Exceptions indicating an error has occurred during processing.
If an Exception is thrown, all processing of the input CAS will stop, and no more output CASes will be produced.
There is currently no error recovery mechanism that will allow processing to continue after an exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cm.using_cm_with_other_aes"><a class="anchor" href="#ugr.tug.cm.using_cm_with_other_aes"></a>7.5.2. Using a CAS Multiplier with other Analysis Engines</h4>
<div class="paragraph">
<p>In your application you can take the output CASes from a CAS Multiplier and pass them to the <code>process</code> method of other Analysis Engines.
However there are some special considerations regarding the Type System of these CASes.</p>
</div>
<div class="paragraph">
<p>By default, the output CASes of a CAS Multiplier will have a Type System that contains all of the types and features declared by any component in the outermost Aggregate Analysis Engine or Collection Processing Engine that contains the CAS Multiplier.
If in your application you create a CAS Multiplier and another Analysis Engine, where these are not enclosed in an aggregate, then the output CASes from the CAS Multiplier will not support any types or features that are  declared in the latter Analysis Engine but not in the CAS Multiplier.</p>
</div>
<div class="paragraph">
<p>This can be remedied by forcing the CAS Multiplier and Analysis Engine to share a single <code>UimaContext</code> when they are created, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>//create a "root" UIMA context for your whole application

UimaContextAdmin rootContext =
   UIMAFramework.newUimaContext(UIMAFramework.getLogger(),
      UIMAFramework.newDefaultResourceManager(),
      UIMAFramework.newConfigurationManager());

XMLInputSource input = new XMLInputSource("MyCasMultiplier.xml");
AnalysisEngineDescription desc = UIMAFramework.getXMLParser().
        parseAnalysisEngineDescription(input);

//create a UIMA Context for the new AE we are about to create

//first argument is unique key among all AEs used in the application
UimaContextAdmin childContext = rootContext.createChild(
        "myCasMultiplier", Collections.EMPTY_MAP);

//instantiate CAS Multiplier AE, passing the UIMA Context through the
//additional parameters map

Map additionalParams = new HashMap();
additionalParams.put(Resource.PARAM_UIMA_CONTEXT, childContext);

AnalysisEngine casMultiplierAE = UIMAFramework.produceAnalysisEngine(
        desc,additionalParams);

//repeat for another AE
XMLInputSource input2 = new XMLInputSource("MyAE.xml");
AnalysisEngineDescription desc2 = UIMAFramework.getXMLParser().
        parseAnalysisEngineDescription(input2);

UimaContextAdmin childContext2 = rootContext.createChild(
        "myAE", Collections.EMPTY_MAP);

Map additionalParams2 = new HashMap();
additionalParams2.put(Resource.PARAM_UIMA_CONTEXT, childContext2);

AnalysisEngine myAE = UIMAFramework.produceAnalysisEngine(
        desc2, additionalParams2);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.cm.using_cm_to_merge_cases"><a class="anchor" href="#ugr.tug.cm.using_cm_to_merge_cases"></a>7.6. Using a CAS Multiplier to Merge CASes</h3>
<div class="paragraph">
<p>A CAS Multiplier can also be used to combine smaller CASes together to form larger CASes.
In this section we describe how this works and walk through an example.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.cm.overview_of_how_to_merge_cases"><a class="anchor" href="#ugr.tug.cm.overview_of_how_to_merge_cases"></a>7.6.1. Overview of How to Merge CASes</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When the framework first calls the CAS Multiplier&#8217;s <code>process</code> method, the CAS Multiplier requests an empty CAS (which we&#8217;ll call the "merged CAS") and copies relevant data from the input CAS into the merged CAS. The class <code>org.apache.uima.util.CasCopier</code> provides utilities for copying Feature Structures between CASes.</p>
</li>
<li>
<p>When the framework then calls the CAS Multiplier&#8217;s <code>hasNext</code> method, the CAS Multiplier returns <code>false</code> to indicate that it has no output at this time.</p>
</li>
<li>
<p>When the framework calls <code>process</code> again with a new input CAS, the CAS Multiplier copies data from that input CAS into the merged CAS, combining it with the data that was previously copied.</p>
</li>
<li>
<p>Eventually, when the CAS Multiplier decides that it wants to output the merged CAS, it returns <code>true</code> from the <code>hasNext</code> method, and then when the framework subsequently calls the <code>next</code> method, the CAS Multiplier returns the merged CAS.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is no explicit call to flush out any pending CASes from a CAS Multiplier when collection processing completes.
It is up to the application to provide some mechanism to let a CAS Multiplier recognize the last CAS in a collection so that it can ensure that its final output CASes are complete.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cm.example_cas_merger"><a class="anchor" href="#ugr.tug.cm.example_cas_merger"></a>7.6.2. Example CAS Merger</h4>
<div class="paragraph">
<p>An example CAS Multiplier that merges CASes can be found is provided in the UIMA SDK.
The Java class for this example is <code>org.apache.uima.examples.casMultiplier.SimpleTextMerger</code> and the source code is located under the <code>examples/src</code> directory.</p>
</div>
<div class="sect4">
<h5 id="ugr.tug.cm.example_cas_merger.process"><a class="anchor" href="#ugr.tug.cm.example_cas_merger.process"></a>Process Method</h5>
<div class="paragraph">
<p>Almost all of the code for this example is in the <code>process</code> method.
The first part of the <code>process</code> method shows how to copy Feature Structures from the input CAS to the "merged CAS":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void process(JCas aJCas) throws AnalysisEngineProcessException {
    // procure a new CAS if we don't have one already
    if (mMergedCas == null) {
      mMergedCas = getEmptyJCas();
    }

    // append document text
    String docText = aJCas.getDocumentText();
    int prevDocLen = mDocBuf.length();
    mDocBuf.append(docText);

    // copy specified annotation types
    // CasCopier takes two args: the CAS to copy from.
    //                           the CAS to copy into.
    CasCopier copier = new CasCopier(aJCas.getCas(), mMergedCas.getCas());

    // needed in case one annotation is in two indexes (could
    // happen if specified annotation types overlap)
    Set copiedIndexedFs = new HashSet();
    for (int i = 0; i &lt; mAnnotationTypesToCopy.length; i++) {
      Type type = mMergedCas.getTypeSystem()
          .getType(mAnnotationTypesToCopy[i]);
      FSIndex index = aJCas.getCas().getAnnotationIndex(type);
      Iterator iter = index.iterator();
      while (iter.hasNext()) {
        FeatureStructure fs = (FeatureStructure) iter.next();
        if (!copiedIndexedFs.contains(fs)) {
          Annotation copyOfFs = (Annotation) copier.copyFs(fs);
          // update begin and end
          copyOfFs.setBegin(copyOfFs.getBegin() + prevDocLen);
          copyOfFs.setEnd(copyOfFs.getEnd() + prevDocLen);
          mMergedCas.addFsToIndexes(copyOfFs);
          copiedIndexedFs.add(fs);
        }
      }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CasCopier</code> class is used to copy Feature Structures of certain types (specified by a configuration parameter) to the merged CAS.
The <code>CasCopier</code> does deep copies, meaning that if the copied FeatureStructure references another FeatureStructure, the referenced FeatureStructure will also be copied.</p>
</div>
<div class="paragraph">
<p>This example also merges the document text using a separate <code>StringBuffer</code>.
Note that we cannot append document text to the Sofa data of the merged CAS because Sofa data cannot be modified once it is set.</p>
</div>
<div class="paragraph">
<p>The remainder of the <code>process</code> method determines whether it is time to output a new CAS.
For this example, we are attempting to merge all CASes that are segments of one original artifact.
This is done by checking the <code>SourceDocumentInformation</code> Feature Structure in the CAS to see if its <code>lastSegment</code> feature is set to <code>true</code>.
That feature (which is set by the example <code>SimpleTextSegmenter</code> discussed previously) marks the CAS as being the last segment of an artifact, so when the CAS Multiplier sees this segment it knows it is time to produce an output CAS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// get the SourceDocumentInformation FS,
// which indicates the sourceURI of the document
// and whether the incoming CAS is the last segment
FSIterator it = aJCas
        .getAnnotationIndex(SourceDocumentInformation.type).iterator();
if (!it.hasNext()) {
  throw new RuntimeException("Missing SourceDocumentInformation");
}
SourceDocumentInformation sourceDocInfo =
      (SourceDocumentInformation) it.next();
if (sourceDocInfo.getLastSegment()) {
  // time to produce an output CAS
  // set the document text
  mMergedCas.setDocumentText(mDocBuf.toString());

  // add source document info to destination CAS
  SourceDocumentInformation destSDI =
      new SourceDocumentInformation(mMergedCas);
  destSDI.setUri(sourceDocInfo.getUri());
  destSDI.setOffsetInSource(0);
  destSDI.setLastSegment(true);
  destSDI.addToIndexes();

  mDocBuf = new StringBuffer();
  mReadyToOutput = true;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When it is time to produce an output CAS, the CAS Multiplier makes final updates to the merged CAS (setting the document text and adding a <code>SourceDocumentInformation</code> FeatureStructure), and then sets the <code>mReadyToOutput</code> field to true.
This field is then used in the <code>hasNext</code> and <code>next</code> methods.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.tug.cm.example_cas_merger.hasnext_and_next"><a class="anchor" href="#ugr.tug.cm.example_cas_merger.hasnext_and_next"></a>HasNext and Next Methods</h5>
<div class="paragraph">
<p>These methods are relatively simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public boolean hasNext() throws AnalysisEngineProcessException {
    return mReadyToOutput;
  }

  public AbstractCas next() throws AnalysisEngineProcessException {
    if (!mReadyToOutput) {
      throw new RuntimeException("No next CAS");
    }
    JCas casToReturn = mMergedCas;
    mMergedCas = null;
    mReadyToOutput = false;
    return casToReturn;
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the merged CAS is ready to be output, <code>hasNext</code> will return true, and <code>next</code> will return the merged CAS, taking care to set the <code>mMergedCas</code> field to <code>null</code> so that the next call to <code>process</code> will start with a fresh CAS.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.tug.cm.using_the_simple_text_merger_in_an_aggregate_ae"><a class="anchor" href="#ugr.tug.cm.using_the_simple_text_merger_in_an_aggregate_ae"></a>7.6.3. Using the SimpleTextMerger in an Aggregate Analysis Engine</h4>
<div class="paragraph">
<p>An example descriptor for an Aggregate Analysis Engine that uses the <code>SimpleTextMerger</code> is provided in <code>examples/descriptors/cas_multiplier/Segment_Annotate_Merge_AE.xml</code>.
This Aggregate first runs the <code>SimpleTextSegmenter</code> example to break a large document into segments.
It then runs each segment through the example tokenizer and name recognizer annotators.
Finally it runs the <code>SimpleTextMerger</code> to reassemble the segments back into one CAS.
The <code>Name</code> annotations are copied to the final merged CAS but the <code>Token</code> annotations are not.</p>
</div>
<div class="paragraph">
<p>This example illustrates how you can break large artifacts into pieces for more efficient processing and then reassemble a single output CAS containing only the results most useful to the application.
Intermediate results such as tokens, which may consume a lot of space, need not be retained over the entire input artifact.</p>
</div>
<div class="paragraph">
<p>The intermediate segments are dropped and are never output from the Aggregate Analysis Engine.
This is done by configuring the Fixed Flow Controller as described in <a href="#ugr.tug.cm.cm_and_fc">Section 7.3.2</a>, above.</p>
</div>
<div class="paragraph">
<p>Try running this Analysis Engine in the Document Analyzer tool with a large text file as input, to see that  it outputs just one CAS per input file, and that the final CAS contains only the <code>Name</code> annotations.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.tug.xmi_emf"><a class="anchor" href="#ugr.tug.xmi_emf"></a>8. XMI and EMF Interoperability</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ugr.tug.xmi_emf.overview"><a class="anchor" href="#ugr.tug.xmi_emf.overview"></a>8.1. Overview</h3>
<div class="paragraph">
<p>In traditional object-oriented terms, a UIMA Type System is a class model and a UIMA CAS is an object graph.
There are established standards in this area –specifically, #UML&#8482; is an #
      OMG&#8482; standard for class models and XMI (XML Metadata Interchange) is an OMG standard for the XML representation of object graphs.</p>
</div>
<div class="paragraph">
<p>Furthermore, the Eclipse Modeling Framework (EMF) is an open-source framework for model-based application development, and it is based on UML and XMI.
In EMF, you define class models using a metamodel called Ecore, which is similar to UML.
EMF provides tools for converting a UML model to Ecore.
EMF can then generate Java classes from your model, and supports persistence of those classes in the XMI format.</p>
</div>
<div class="paragraph">
<p>The UIMA SDK provides tools for interoperability with XMI and EMF.
These tools allow conversions of UIMA Type Systems to and from Ecore models, as well as conversions of UIMA CASes to and from XMI format.
This provides a number of advantages, including:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>You can define a model using a UML Editor, such as Rational Rose or EclipseUML, and then automatically convert it to a UIMA Type System.</p>
</div>
<div class="paragraph">
<p>You can take an existing UIMA application, convert its type system to Ecore, and save the CASes it produces to XMI.
This data is now in a form where it can easily be ingested by an EMF-based application.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>More generally, we are adopting the well-documented, open standard XMI as the standard way to represent UIMA-compliant analysis results (replacing the UIMA-specific XCAS format). This use of an open standard enables other applications to more easily produce or consume these UIMA analysis results.</p>
</div>
<div class="paragraph">
<p>For more information on XMI, see Grose et al. <em>Mastering XMI. Java Programming with XMI, XML, and
      UML.</em> John Wiley &amp; Sons, Inc.
2002.</p>
</div>
<div class="paragraph">
<p>For more information on EMF, see Budinsky et al. <em>Eclipse Modeling Framework 2.0.</em> Addison-Wesley.
2006.</p>
</div>
<div class="paragraph">
<p>For details of how the UIMA CAS is represented in <a href="ref.html#ugr.ref.xmi">XMI format</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.xmi_emf.converting_ecore_to_from_uima_type_system"><a class="anchor" href="#ugr.tug.xmi_emf.converting_ecore_to_from_uima_type_system"></a>8.2. Converting an Ecore Model to or from a UIMA Type System</h3>
<div class="paragraph">
<p>The UIMA SDK provides the following two classes:</p>
</div>
<div class="paragraph">
<p><strong><code><strong>Ecore2UimaTypeSystem:</strong></code></strong> converts from an .ecore model developed using EMF to a UIMA-compliant TypeSystem descriptor.
This is a Java class that can be run as a standalone program or invoked from another Java application.
To run as a standalone program, execute:</p>
</div>
<div class="paragraph">
<p><code>java org.apache.uima.ecore.Ecore2UimaTypeSystem &lt;ecore
      file&gt; &lt;output file&gt;</code></p>
</div>
<div class="paragraph">
<p>The input .ecore file will be converted to a UIMA TypeSystem descriptor and written to the specified output file.
You can then use the resulting TypeSystem descriptor in your UIMA application.</p>
</div>
<div class="paragraph">
<p><strong><code><strong>UimaTypeSystem2Ecore:</strong></code></strong> converts from a UIMA TypeSystem descriptor to an .ecore model.
This is a Java class that can be run as a standalone program or invoked from another Java application.
To run as a standalone program, execute:</p>
</div>
<div class="paragraph">
<p><code>java org.apache.uima.ecore.UimaTypeSystem2Ecore
      &lt;TypeSystem descriptor&gt; &lt;output file&gt;</code></p>
</div>
<div class="paragraph">
<p>The input UIMA TypeSystem descriptor will be converted to an Ecore model file and written to the specified output file.
You can then use the resulting Ecore model in EMF applications.
The converted type system will include any <code>&lt;import&#8230;&#8203;&gt;</code>ed TypeSystems; the fact that they were imported is currently not preserved.</p>
</div>
<div class="paragraph">
<p>To run either of these converters, your classpath will need to include the UIMA jar files as well as the following jar files from the EMF distribution: common.jar, ecore.jar, and ecore.xmi.jar.</p>
</div>
<div class="paragraph">
<p>Also, note that the uima-core.jar file contains the Ecore model file uima.ecore, which defines the built-in UIMA types.
You may need to use this file from your EMF applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.xmi_emf.using_xmi_cas_serialization"><a class="anchor" href="#ugr.tug.xmi_emf.using_xmi_cas_serialization"></a>8.3. Using XMI CAS Serialization</h3>
<div class="paragraph">
<p>The UIMA SDK provides XMI support through the following two classes:</p>
</div>
<div class="paragraph">
<p><strong><code><strong>XmiCasSerializer:</strong></code></strong> can be run from within a UIMA application to write out a CAS to the standard XMI format.
The XMI that is generated will be compliant with the Ecore model generated by <code>UimaTypeSystem2Ecore</code>.
An EMF application could use this Ecore model to ingest and process the XMI produced by the XmiCasSerializer.</p>
</div>
<div class="paragraph">
<p><strong><code><strong>XmiCasDeserializer:</strong></code></strong> can be run from within a UIMA application to read in an XMI document and populate a CAS.
The XMI must conform to the Ecore model generated by <code>UimaTypeSystem2Ecore</code>.</p>
</div>
<div class="paragraph">
<p>Also, the uimaj-examples Eclipse project contains some example code that shows how to use the serializer and deserializer:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><code>org.apache.uima.examples.xmi.XmiWriterCasConsumer:</code> This is a CAS Consumer that writes each CAS to an output file in XMI format.
It is analogous to the XCasWriter CAS Consumer that has existed in prior UIMA versions, except that it uses the XMI serialization format.</p>
</div>
<div class="paragraph">
<p><code>org.apache.uima.examples.xmi.XmiCollectionReader:</code> This is a Collection Reader that reads a directory of XMI files and deserializes each of them into a CAS.
For example, this would allow you to build a Collection Processing Engine that reads XMI files, which could contain some previous analysis results, and then do further analysis.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Finally, in under the folder <code>uimaj-examples/ecore_src</code> is the class <code>org.apache.uima.examples.xmi.XmiEcoreCasConsumer</code>, which writes each CAS to XMI format and also saves the Type System as an Ecore file.
Since this uses the <code>UimaTypeSystem2Ecore</code> converter, to compile it you must add to your classpath the EMF jars common.jar, ecore.jar, and ecore.xmi.jar – see ecore_src/readme.txt for instructions.</p>
</div>
<div class="sect3">
<h4 id="ugr.tug.xmi_emf.xml_character_issues"><a class="anchor" href="#ugr.tug.xmi_emf.xml_character_issues"></a>8.3.1. Character Encoding Issues with XML Serialization</h4>
<div class="paragraph">
<p>Note that not all valid Unicode characters are valid XML characters, at least not in XML 1.0.
Moreover, it is possible to create characters in Java that are not even valid Unicode characters, let alone XML characters.
As UIMA character data is translated directly into XML character data on serialization, this may lead to issues.
UIMA will therefore check that the character data that is being serialized is valid for the version of XML being used.
If  non-serializable character data is encountered during serialization, an exception is thrown and serialization fails (to avoid creating invalid XML data).  UIMA does not simply replace the offending characters with some valid replacement character; the assumption being that most applications would not like to have their data modified automatically.</p>
</div>
<div class="paragraph">
<p>If you know you are going to use XML serialization, and you would like to avoid such issues on serialization, you should check any character data you create in UIMA ahead of time.
Issues most often arise with the document text, as documents may originate at various sources, and may be of varying quality.
So it&#8217;s a particularly good idea to check the document text for characters that will cause issues for serialization.</p>
</div>
<div class="paragraph">
<p>UIMA provides a handful of functions to assist you in checking Java character data.
Those methods are located in <code>org.apache.uima.internal.util.XMLUtils.checkForNonXmlCharacters()</code>, with several overloads.
Please check the javadocs for further information.</p>
</div>
<div class="paragraph">
<p>Please note that these issues are not specific to XMI serialization, they apply to the older XCAS format in the same way.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.tug.type_mapping"><a class="anchor" href="#ugr.tug.type_mapping"></a>9. Managing different Type Systems</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ugr.tug.type_mapping.type_merging"><a class="anchor" href="#ugr.tug.type_mapping.type_merging"></a>9.1. Annotators, Type Merging, and Remotes</h3>
<div class="paragraph">
<p>UIMA supports combining Annotators that have different type systems.
This is normally done by <em><a href="ref.html#ugr.ref.cas.typemerging">merging</a></em> the two type systems when the Annotators are first loaded and instantiated.
The merge process produces a logical Union of the two; types having the same name have their feature sets combined.
The combining rules say that the range of same-named feature slots must be the same.
This combined type system is then used for the CAS that will be passed to all of the annotators.</p>
</div>
<div class="paragraph">
<p>This approach (of merging the type systems together) works well for annotators that are run together in one UIMA pipeline instantiation in one machine.
Extensions are needed when UIMA is scaled out where the pipeline includes remote annotators, acting as servers, serving potentially multiple clients, each of which might have a different type system.
Clients, when initializing, query all their remote server parts to get their type system definition, and merges them together with its own  to make the type system for the CAS that will be sent among all of those annotators.
The Client&#8217;s TypeSystem is the union of all of its annotators, even when some of the them are remote.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.type_mapping.remote_support"><a class="anchor" href="#ugr.tug.type_mapping.remote_support"></a>9.2. Supporting Remote Annotators</h3>
<div class="paragraph">
<p>Servers, in providing service to multiple clients, may receive CASes from different Clients having different type systems.
UIMA has implemented several different approaches to support this.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Base UIMA includes support for the VINCI protocol (but this is older, and do not support newer features of the CAS like CAS Multipliers and multiple Views).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For Vinci and UIMA-AS	using XMI, the "reachable" Feature Structures (only) are sent.
A reachable  Feature Structure is one that is indexed, or is reachable via a  reference from another reachable Feature Structure.
The receiving service&#8217;s  type system is guaranteed to be a subset of the sender.
Special code in the  deserializer saves aside any types and features not present in the server&#8217;s type system and re-merges these values back when returning the CAS to the client.</p>
</div>
<div class="paragraph">
<p>UIMA-AS supports in addition binary CAS serialization protocols.
The binary support is typically compressed.
This compression can greatly reduce the size of data, compared with plain binary serialization.
The compressed form also supports having a target type system which is  different from the source&#8217;s, as long as it is compatible.</p>
</div>
<div class="paragraph">
<p>Delta CAS support is available for XMI, binary and compressed binary  protocols, used by UIMA-AS.
The Delta CAS refers to the CAS returned from the service back to the client - only the new Feature Structures added by the service, plus any modifications to existing feature structures and/or indexes, are returned.
This can greatly reduce the size of the returned data.
Delta CAS support is automatically used with more recent versions of UIMA-AS.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.type_mapping.allowed_differences"><a class="anchor" href="#ugr.tug.type_mapping.allowed_differences"></a>9.3. Type filtering support in Binary Compressed Serialization/Deserialization</h3>
<div class="paragraph">
<p>The built-in support for Binary Compressed Serialization/Deserialization supports filtering between non-identical type systems.
The filtering is designed so that things (types and/or features) that are defined in one type system but not in another are not sent (when serializing) nor received  (when deserializing).  When deserializing, non-received features receive 0  as their value.
For built-in types, like integer, float, etc., this is the  number 0; for other kinds of things, this is usually a "null" value.</p>
</div>
<div class="paragraph">
<p>Some kinds of type mappings cannot be supported, and will signal errors.
The two types being mapped between must be "mergable" according to the normal type merger rules (see above); otherwise, errors are signaled.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.type_mapping.compressed"><a class="anchor" href="#ugr.tug.type_mapping.compressed"></a>9.4. Remote Services support with Compressed Binary Serialization</h3>
<div class="paragraph">
<p>Uncompressed Binary Serialization protocols for communicating to  remote UIMA-AS services require that the Client and Server&#8217;s type systems be identical.
Compressed Binary Serialization protocols support Server type systems which are a subset of the Clients.
Types and/or features  not in the Server&#8217;s type system are not sent to the Server.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.tug.type_filtering.compressed_file"><a class="anchor" href="#ugr.tug.type_filtering.compressed_file"></a>9.5. Compressed Binary serialization to/from files</h3>
<div class="paragraph">
<p>Compressed binary serialization to a file can specify a target type system which is a subset of the original type system.
The serialization will then exclude types and features not in the target, when  serializing.
You can use this to filter the CAS to serialize out just the parts you want to.</p>
</div>
<div class="paragraph">
<p>Compressed binary deserialization from a file must specify as the target type system the one that went with the target when it was serialized.
The source type system can be different; if it is missing types/features, these will be  filtered during deserialization.
If it has additional features, these will be  set to 0 (the default value) in the CAS heap.
For numeric features, this means the value will be 0 (including floating point 0); for feature structure references and strings, the value will be null.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Note that AnalysisComponent is not specific to <code>JCas</code>. There is a method <code>getRequiredCasInterface()</code> which the user would have to implement to return <code>JCas.class</code>. Then in the <code>process(AbstractCas cas)</code> method, they would need to typecast <code>CAS</code> to type <code>JCas</code>.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Although Java classes in which you do not define any constructor will, by default, have a no-args constructor that doesn&#8217;t do anything, a class in which you have defined at least one constructor does not get a default no-args constructor.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. Version 1 of UIMA specified an additional parameter, the ResultSpecification. This provides a           specification of which types and features are desired to be computed and "output" from this annotator. Its           use is optional; many annotators ignore it.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. CAS Initializers are deprecated in favor of a more general mechanism,     multiple subjects of analysis.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. There is also a fourth pane,         for the CAS Initializer, but it is hidden by default.  To enable it click the         View  CAS Initializer Panel menu item.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. Replace         %UIMA_HOME% with the path to where you installed UIMA.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. Both the UIMA Collection Processing Manager framework and the remote deployment services framework have implementations which use CAS pools in this manner, and thereby relieve the annotator developer of the necessity to make their annotators thread-safe.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.5.0<br>
Last updated 2023-11-01 17:37:27 +0100
</div>
</div>
</body>
</html>