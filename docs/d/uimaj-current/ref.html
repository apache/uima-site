<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Apache UIMA™ Development Community">
<title>Apache UIMA™ - References</title>
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Apache UIMA™ - References</h1>
<div class="details">
<span id="author" class="author">Apache UIMA™ Development Community</span><br>
<span id="revnumber">version 3.5.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">UIMA References</div>
<ul class="sectlevel1">
<li><a href="#ugr.ref.javadocs">1. Javadocs</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.javadocs.libraries">1.1. Using named Eclipse User Libraries</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xml.component_descriptor">2. Component Descriptor Reference</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.xml.component_descriptor.notation">2.1. Notation</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.imports">2.2. Imports</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.type_system">2.3. Type System Descriptors</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.xml.component_descriptor.type_system.imports">2.3.1. Imports</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.type_system.types">2.3.2. Types</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.type_system.features">2.3.3. Features</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.type_system.string_subtypes">2.3.4. String Subtypes</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xml.component_descriptor.aes">2.4. Analysis Engine Descriptors</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.xml.component_descriptor.aes.primitive">2.4.1. Primitive Analysis Engine Descriptors</a>
<ul class="sectlevel4">
<li><a href="#ugr.ref.xml.component_descriptor.aes.primitive.basic">Basic Structure</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.metadata">Analysis Engine MetaData</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.type_system">Type System Definition</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.type_priority">Type Priority Definition</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.index">Index Definition</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.capabilities">Capabilities</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.operational_properties">OperationalProperties</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.primitive.external_resource_dependencies">External Resource Dependencies</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.primitive.resource_manager_configuration">Resource Manager Configuration</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.environment_variable_references">Environment Variable References</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.aggregate">2.4.2. Aggregate Analysis Engine Descriptors</a>
<ul class="sectlevel4">
<li><a href="#ugr.ref.xml.component_descriptor.aes.aggregate.delegates">Delegate Analysis Engine Specifiers</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_controller">FlowController</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints">FlowConstraints</a>
<ul class="sectlevel5">
<li><a href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints.fixed_flow">Fixed Flow</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints.capability_language_flow">Capability Language Flow</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.aggregate.external_resource_bindings">External Resource Bindings</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.aggregate.sofa_mappings">Sofa Mappings</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.configuration_parameters">2.4.3. Configuration Parameters</a>
<ul class="sectlevel4">
<li><a href="#ugr.ref.xml.component_descriptor.aes.configuration_parameter_declaration">Configuration Parameter Declaration</a>
<ul class="sectlevel5">
<li><a href="#ugr.ref.xml.component_descriptor.aes.configuration_parameter_declaration.example">Example</a></li>
</ul>
</li>
<li><a href="#ugr.ref.aes.configuration_parameter_settings">Configuration Parameter Settings</a>
<ul class="sectlevel5">
<li><a href="#ugr.ref.xml.component_descriptor.aes.configuration_parameter_settings.example">Example</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.aggregate.configuration_parameter_overrides">Configuration Parameter Overrides</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.external_configuration_parameter_overrides">External Configuration Parameter Overrides</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.external_configuration_parameter_access">Direct Access to External Configuration Parameters</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.aes.other_uses_for_external_configuration_parameters">Other Uses for External Configuration Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ugr.ref.xml.component_descriptor.flow_controller">2.5. Flow Controller Descriptors</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.collection_processing_parts">2.6. Collection Processing Component Descriptors</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.xml.component_descriptor.collection_processing_parts.collection_reader">2.6.1. Collection Reader Descriptors</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.collection_processing_parts.cas_initializer">2.6.2. CAS Initializer Descriptors (deprecated)</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.collection_processing_parts.cas_consumer">2.6.3. CAS Consumer Descriptors</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xml.component_descriptor.service_client">2.7. Service Client Descriptors</a></li>
<li><a href="#ugr.ref.xml.component_descriptor.custom_resource_specifiers">2.8. Custom Resource Specifiers</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xml.cpe_descriptor">3. Collection Processing Engine Descriptor Reference</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.xml.cpe_descriptor.overview">3.1. CPE Overview</a></li>
<li><a href="#ugr.ref.xml.cpe_descriptor.notation">3.2. Notation</a></li>
<li><a href="#ugr.ref.xml.cpe_descriptor.imports">3.3. Imports</a></li>
<li><a href="#ugr.ref.xml.cpe_descriptor.descriptor.resource_manager_configuration">3.4. Resource Manager Configuration</a></li>
<li><a href="#ugr.ref.xml.cpe_descriptor.descriptor.example">3.5. Example CPE Descriptor</a></li>
</ul>
</li>
<li><a href="#ugr.ref.cas">4. CAS Reference</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.cas.javadocs">4.1. Javadocs</a></li>
<li><a href="#ugr.ref.cas.overview">4.2. CAS Overview</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.cas.type_system">4.2.1. The Type System</a></li>
<li><a href="#ugr.ref.cas.creating_accessing_manipulating_data">4.2.2. Creating, accessing and manipulating data</a></li>
<li><a href="#ugr.ref.cas.creating_using_indexes">4.2.3. Creating and using indexes</a></li>
</ul>
</li>
<li><a href="#ugr.ref.cas.builtin_types">4.3. Built-in CAS Types</a></li>
<li><a href="#ugr.ref.cas.accessing_the_type_system">4.4. Accessing the type system</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.cas.type_system.printer_example">4.4.1. TypeSystemPrinter example</a></li>
<li><a href="#ugr.ref.cas.cas_apis_create_modify_feature_structures">4.4.2. Using the CAS APIs to create and modify feature structures</a></li>
</ul>
</li>
<li><a href="#ugr.ref.cas.creating_feature_structures">4.5. Creating feature structures</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.cas.updating_indexed_feature_structures">4.5.1. Updating indexed feature structures</a></li>
</ul>
</li>
<li><a href="#ugr.ref.cas.accessing_modifying_feature_structures">4.6. Accessing or modifying feature structures</a></li>
<li><a href="#ugr.ref.cas.indexes_and_iterators">4.7. Indexes and Iterators</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.cas.index.built_in_indexes">4.7.1. Built-in Indexes</a></li>
<li><a href="#ugr.ref.cas.index.adding_to_indexes">4.7.2. Adding Feature Structures to the Indexes</a></li>
<li><a href="#ugr.ref.cas.index.iterators">4.7.3. Iterators over UIMA Indexes</a></li>
<li><a href="#ugr.ref.cas.index.annotation_index">4.7.4. Special iterators for Annotation types</a></li>
<li><a href="#ugr.ref.cas.index.constraints_and_filtered_iterators">4.7.5. Constraints and Filtered iterators</a></li>
</ul>
</li>
<li><a href="#ugr.ref.cas.guide_to_javadocs">4.8. The CAS API&#8217;s&#8201;&#8212;&#8201;a guide to the Javadocs</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.cas.javadocs.cas_package">4.8.1. APIs in the CAS package</a></li>
</ul>
</li>
<li><a href="#ugr.ref.cas.typemerging">4.9. Type Merging</a></li>
<li><a href="#ugr.ref.cas.limitedmultipleaccess">4.10. Limited multi-thread access to read-only CASs</a></li>
</ul>
</li>
<li><a href="#ugr.ref.jcas">5. JCas Reference</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.jcas.name_spaces">5.1. Name Spaces</a></li>
<li><a href="#ugr.ref.jcas.use_of_description">5.2. XML description element</a></li>
<li><a href="#ugr.ref.jcas.mapping_built_ins">5.3. Mapping built-in CAS types to Java types</a></li>
<li><a href="#ugr.ref.jcas.augmenting_generated_code">5.4. Augmenting the generated Java Code</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.jcas.keeping_augmentations_when_regenerating">5.4.1. Keeping hand-coded augmentations when regenerating</a></li>
<li><a href="#ugr.ref.jcas.additional_constructors">5.4.2. Additional Constructors</a>
<ul class="sectlevel4">
<li><a href="#ugr.ref.jcas.using_readobject">Using readObject</a></li>
</ul>
</li>
<li><a href="#ugr.ref.jcas.modifying_generated_items">5.4.3. Modifying generated items</a></li>
</ul>
</li>
<li><a href="#ugr.ref.jcas.merging_types_from_other_specs">5.5. Merging types</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.jcas.merging_types.aggregates_and_cpes">5.5.1. Aggregate AEs and CPEs as sources of types</a></li>
<li><a href="#ugr.ref.jcas.merging_types.jcasgen_support">5.5.2. JCasGen support for type merging</a></li>
<li><a href="#ugr.ref.jcas.impact_of_type_merging_on_composability">5.5.3. Type Merging impacts on Composability</a></li>
<li><a href="#ugr.ref.jcas.documentannotation_issues">5.5.4. Adding Features to DocumentAnnotation</a></li>
</ul>
</li>
<li><a href="#ugr.ref.jcas.using_within_an_annotator">5.6. Using JCas within an Annotator</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.jcas.new_instances">5.6.1. Creating new instances using the Java &#8220;new&#8221; operator</a></li>
<li><a href="#ugr.ref.jcas.getters_and_setters">5.6.2. Getters and Setters</a></li>
<li><a href="#ugr.ref.jcas.obtaining_refs_to_indexes">5.6.3. Obtaining references to Indexes</a></li>
<li><a href="#ugr.ref.jcas.adding_removing_instances_to_indexes">5.6.4. Adding (and removing) instances to (from) indexes</a></li>
<li><a href="#ugr.ref.jcas.using_iterators">5.6.5. Using Iterators</a></li>
<li><a href="#ugr.ref.jcas.class_loaders">5.6.6. Class Loaders in UIMA</a>
<ul class="sectlevel4">
<li><a href="#ugr.ref.jcas.class_loaders.optional">Use of Class Loaders is optional</a></li>
</ul>
</li>
<li><a href="#ugr.ref.jcas.accessing_jcas_objects_outside_uima_components">5.6.7. Issues accessing JCas objects outside of UIMA Engine Components</a></li>
</ul>
</li>
<li><a href="#ugr.ref.jcas.setting_up_classpath">5.7. Setting up Classpath for JCas</a></li>
<li><a href="#ugr.ref.jcas.pear_support">5.8. PEAR isolation</a></li>
</ul>
</li>
<li><a href="#ugr.ref.pear">6. PEAR Reference</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.pear.packaging_a_component">6.1. Packaging a UIMA component</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.pear.creating_pear_structure">6.1.1. Creating the PEAR structure</a></li>
<li><a href="#ugr.ref.pear.populating_pear_structure">6.1.2. Populating the PEAR structure</a>
<ul class="sectlevel4">
<li><a href="#ugr.ref.pear.package_type.standard">Standard Type</a></li>
<li><a href="#ugr.ref.pear.package_type.service">Service Type</a></li>
<li><a href="#ugr.ref.pear.package_type.network">Network Type</a></li>
</ul>
</li>
<li><a href="#ugr.ref.pear.creating_installation_descriptor">6.1.3. Creating the installation descriptor</a></li>
<li><a href="#ugr.ref.pear.installation_descriptor">6.1.4. Documented template for the installation descriptor:</a>
<ul class="sectlevel4">
<li><a href="#ugr.ref.pear.installation_descriptor.submitted_component">The SUBMITTED_COMPONENT section</a></li>
<li><a href="#ugr.ref.pear.installation_descriptor.id_name_desc">The ID, NAME, and DESC tags</a></li>
<li><a href="#ugr.ref.pear.installation_descriptor.deployment_type">Tags related to deployment types</a>
<ul class="sectlevel5">
<li><a href="#ugr.ref.pear.installation_descriptor.deployment_type.standard">Standard Type</a></li>
<li><a href="#ugr.ref.pear.installation_descriptor.deployment_type.service">Service Type</a></li>
<li><a href="#ugr.ref.pear.installation_descriptor.deployment_type.network">Network Type</a></li>
</ul>
</li>
<li><a href="#ugr.ref.pear.installation_descriptor.collection_reader_cas_consumer">The Collection Reader and CAS Consumer tags</a></li>
<li><a href="#ugr.ref.pear.installation_descriptor.installation">The INSTALLATION section</a></li>
</ul>
</li>
<li><a href="#ugr.ref.pear.packaging_into_1_file">6.1.5. Packaging the PEAR structure into one file</a></li>
</ul>
</li>
<li><a href="#ugr.ref.pear.installing">6.2. Installing a PEAR package</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.pear.installing_pear_using_api">6.2.1. Installing a PEAR file using the PEAR APIs</a></li>
</ul>
</li>
<li><a href="#ugr.ref.pear.specifier">6.3. PEAR package descriptor</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xmi">7. XMI CAS Serialization Reference</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.xmi.xmi_tag">7.1. XMI Tag</a></li>
<li><a href="#ugr.ref.xmi.feature_structures">7.2. Feature Structures</a></li>
<li><a href="#ugr.ref.xmi.primitive_features">7.3. Primitive Features</a></li>
<li><a href="#ugr.ref.xmi.reference_features">7.4. Reference Features</a></li>
<li><a href="#ugr.ref.xmi.array_and_list_features">7.5. Array and List Features</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.xmi.array_and_list_features.as_multi_valued_properties">7.5.1. Arrays and Lists as Multi-Valued Properties</a></li>
<li><a href="#ugr.ref.xmi.array_and_list_features.as_1st_class_objects">7.5.2. Arrays and Lists as First-Class Objects</a></li>
<li><a href="#ugr.ref.xmi.null_array_list_elements">7.5.3. Null Array/List Elements</a></li>
</ul>
</li>
<li><a href="#ugr.ref.xmi.sofas_views">7.6. Subjects of Analysis (Sofas) and Views</a></li>
<li><a href="#ugr.ref.xmi.linking_to_ecore_type_system">7.7. Linking an XMI Document to its Ecore Type System</a></li>
<li><a href="#ugr.ref.xmi.delta">7.8. Delta CAS XMI Format</a></li>
</ul>
</li>
<li><a href="#ugr.ref.compress">8. Compressed Binary CASes</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.compress.overview">8.1. Binary CAS Compression overview</a></li>
<li><a href="#ugr.ref.compress.usage">8.2. Using Compressed Binary CASes</a></li>
<li><a href="#ugr.ref.compress.simple_deltas">8.3. Simple Delta CAS serialization</a></li>
<li><a href="#ugr.ref.compress.use_cases">8.4. Use Case cookbook</a></li>
</ul>
</li>
<li><a href="#ugr.ref.json">9. JSON Serialization of CASs and UIMA Description objects</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.json.overview">9.1. JSON serialization support overview</a></li>
<li><a href="#_ug.ref.json.cas">9.2. JSON CAS Serialization</a>
<ul class="sectlevel3">
<li><a href="#_ug.ref.json.cas.bigpic">9.2.1. The Big Picture</a></li>
<li><a href="#_ug.ref.json.cas.context">9.2.2. The _context section</a>
<ul class="sectlevel4">
<li><a href="#_ug.ref.json.cas.context.omit">Omitting parts of the _context section</a></li>
</ul>
</li>
<li><a href="#_ug.ref.json.cas.featurestructures">9.2.3. Serializing Feature Structures</a>
<ul class="sectlevel4">
<li><a href="#_ug.ref.json.cas.featurestructures.embedding">Embedding normally referenced values</a></li>
<li><a href="#_ug.ref.json.cas.featurestructures.dynamicstatic">Dynamic vs Static multiple-references and embedding</a></li>
<li><a href="#_ug.ref.json.cas.featurestructures.embeddedarrayslists">Embedded Arrays and Lists</a></li>
<li><a href="#_ug.ref.json.cas.featurestructures.null">Omitting null values</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ug.ref.json.cas.featurestructures.organization">9.3. Organizing the Feature Structures</a></li>
<li><a href="#_ug.ref.json.cas.features">9.4. Additional JSON CAS Serialization features</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.json.delta">9.4.1. Delta CAS</a></li>
</ul>
</li>
<li><a href="#ugr.ref.json.usage">9.5. Using JSON CAS serialization</a></li>
<li><a href="#ugr.ref.json.descriptionserialization">9.6. JSON serialization for UIMA descriptors</a></li>
</ul>
</li>
<li><a href="#ugr.ref.config">10. UIMA Setup and Configuration</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.config.properties">10.1. UIMA JVM Configuration Properties</a></li>
<li><a href="#ugr.ref.config.protect_index">10.2. Configuring index protection</a></li>
<li><a href="#ugr.ref.config.property_table">10.3. Properties Table</a></li>
</ul>
</li>
<li><a href="#ugr.ref.resources">11. UIMA Resources</a>
<ul class="sectlevel2">
<li><a href="#ugr.ref.resources.overview">11.1. What is a UIMA Resource?</a>
<ul class="sectlevel3">
<li><a href="#ugr.ref.resources.resource_inner_implementations">11.1.1. Resource Inner Implementations</a></li>
</ul>
</li>
<li><a href="#ugr.ref.resources.sharing_across_pipelines">11.2. Sharing Resources, even across pipelines</a></li>
<li><a href="#ugr.ref.resources.external_resource_multiple_parameterized_instances">11.3. External Resources support for multiple Parameterized Instances</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Copyright © 2006, 2021 The Apache Software Foundation</p>
</div>
<div class="paragraph">
<p>Copyright © 2004, 2006 International Business Machines Corporation</p>
</div>
<h4 id="_license_and_disclaimer" class="discrete">License and Disclaimer</h4>
<div class="paragraph">
<p>The ASF licenses this documentation to you under the Apache License, Version 2.0 (the "License");
you may not use this documentation except in compliance with the License.  You may obtain a copy of
the License at</p>
</div>
<div class="paragraph text-center">
<p><a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a></p>
</div>
<div class="paragraph">
<p>Unless required by applicable law or agreed to in writing, this documentation and its contents are
distributed under the License on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied.  See the License for the specific language governing permissions and
limitations under the License.</p>
</div>
<h4 id="_trademarks" class="discrete">Trademarks</h4>
<div class="paragraph">
<p>All terms mentioned in the text that are known to be trademarks or service marks have been
appropriately capitalized.  Use of such terms in this book should not be regarded as affecting the
validity of the the trademark or service mark.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.javadocs"><a class="anchor" href="#ugr.ref.javadocs"></a>1. Javadocs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The details of all the public APIs for UIMA are contained in the API Javadocs.
These are located in the docs/api directory; the top level to open in your browser is called link:api/index.html.</p>
</div>
<div class="paragraph">
<p>Eclipse supports the ability to attach the Javadocs to your project.
The Javadoc should already be attached to the <code>uimaj-examples</code> project, if you followed the setup instructions in the <a href="oas.html#ugr.ovv.eclipse_setup.example_code">setup guide</a>.
To attach Javadocs to your own Eclipse project, use the following instructions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>As an alternative, you can add the UIMA source to the UIMA binary distribution; if you do this you not only will have the Javadocs automatically available (you can skip the following setup), you will have the ability to step through the UIMA framework code while debugging.
To add the source, follow the instructions as described in the <a href="oas.html#ugr.ovv.eclipse_setup.adding_source">setup guide</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To add the Javadocs, open a project which is referring to the UIMA APIs in its class path, and open the project properties.
Then pick Java Build Path.
Pick the "Libraries" tab and select one of the UIMA library entries (if you don&#8217;t have, for instance, uima-core.jar in this list, it&#8217;s unlikely your code will compile). Each library entry has a small "&gt;" sign on its left - click that to expand the view to see the Javadoc location.
If you highlight that and press edit - you can add a reference to the Javadocs, in the following dialog:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./ref/images/references/ref.javadocs/image002.jpg" alt="Screenshot of attaching Javadoc to source in Eclipse">
</div>
</div>
<div class="paragraph">
<p>Once you do this, Eclipse can show you Javadocs for UIMA APIs as you work.
To see the Javadoc for a UIMA API, you can hover over the API class or method, or select it and press shift-F2, or use the menu Navigate →Open External Javadoc, or open the Javadoc view (<em>Window → Show View → Other → Java → Javadoc</em>).</p>
</div>
<div class="paragraph">
<p>In a similar manner, you can attach the source for the UIMA framework, if you download the source distribution.
The source corresponding to particular releases is available from the Apache UIMA web site (<a href="http://uima.apache.org" class="bare">http://uima.apache.org</a>) on the downloads page.</p>
</div>
<div class="sect2">
<h3 id="ugr.ref.javadocs.libraries"><a class="anchor" href="#ugr.ref.javadocs.libraries"></a>1.1. Using named Eclipse User Libraries</h3>
<div class="paragraph">
<p>You can also create a named "user library" in Eclipse containing the UIMA Jars, and attach the Javadocs (or optionally, the sources); this named library is saved in the Eclipse workspace.
Once created, it can be added to the classpath of newly created Eclipse projects.</p>
</div>
<div class="paragraph">
<p>Use the menu option <em>Project → Properties → Java Build Path</em>, and then pick the <em>Libraries_- tab, and click the </em>Add Library<em> button.
Then select </em>User Libraries<em>, click </em>Next__, and pick the library you created for the UIMA Jars.</p>
</div>
<div class="paragraph">
<p>To create this library in the workspace, use the same menu picks as above, but after you select the User Libraries and click "Next", you can click the "New Library&#8230;&#8203;" button to define your new library.
You use the "Add Jars" button and multi-select all the Jars in the lib directory of the UIMA binary distribution.
Then you add the Javadoc attachment for each Jar.
The path to use is <code>file:/</code>&#8201;&#8212;&#8201;insert the path to your install of UIMA&#8201;&#8212;&#8201;<code>/docs/api</code>.
After you do this for the first Jar, you can copy this string to the clipboard and paste it into the rest of the Jars.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.xml.component_descriptor"><a class="anchor" href="#ugr.ref.xml.component_descriptor"></a>2. Component Descriptor Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter is the reference guide for the UIMA SDK&#8217;s Component Descriptor XML schema.
A <em>Component Descriptor</em> (also sometimes called a <em>Resource Specifier</em> in the code) is an XML file that either (a) completely describes a component, including all information needed to construct the component and interact with it, or (b) specifies how to connect to and interact with an existing component that has been published as a remote service. <em>Component</em> (also called <em>Resource</em>) is a general term for modules produced by UIMA developers and used by UIMA applications.
The types of Components are: Analysis Engines, Collection Readers, CAS Initializers
<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, CAS Consumers, and Collection Processing Engines.
However, Collection Processing Engine Descriptors are significantly different in format and are covered in a <a href="#ugr.ref.xml.cpe_descriptor">separate chapter</a>.</p>
</div>
<div class="paragraph">
<p><a href="#ugr.ref.xml.component_descriptor.notation">Section 2.1</a> describes the notation used in this chapter.</p>
</div>
<div class="paragraph">
<p><a href="#ugr.ref.xml.component_descriptor.imports">Section 2.2</a> describes the UIMA SDK&#8217;s <em>import</em> syntax, used to allow XML descriptors to import information from other XML files, to allow sharing of information between several XML descriptors.</p>
</div>
<div class="paragraph">
<p><a href="#ugr.ref.xml.component_descriptor.aes">Section 2.4</a> describes the XML format for <em>Analysis Engine Descriptors</em>.
These are descriptors that completely describe Analysis Engines, including all information needed to construct and interact with them.</p>
</div>
<div class="paragraph">
<p><a href="#ugr.ref.xml.component_descriptor.collection_processing_parts">Section 2.6</a> describes the XML format for <em>Collection Processing Component Descriptors</em>.
This includes Collection Iterator, CAS Initializer, and CAS Consumer Descriptors.</p>
</div>
<div class="paragraph">
<p><a href="#ugr.ref.xml.component_descriptor.service_client">Section 2.7</a> describes the XML format for <em>Service Client Descriptors</em>, which specify how to connect to and interact with resources deployed as remote services.</p>
</div>
<div class="paragraph">
<p><a href="#ugr.ref.xml.component_descriptor.custom_resource_specifiers">Section 2.8</a> describes the XML format for <em>Custom Resource Specifiers</em>, which allow you to plug in your own Java class as a UIMA Resource.</p>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.component_descriptor.notation"><a class="anchor" href="#ugr.ref.xml.component_descriptor.notation"></a>2.1. Notation</h3>
<div class="paragraph">
<p>This chapter uses an informal notation to specify the syntax of Component Descriptors.
The formal syntax is defined by an XML schema definition, which is contained in the file <code>resourceSpecifierSchema.xsd</code>,   located in the <code>uima-core.jar</code> file.</p>
</div>
<div class="paragraph">
<p>The notation used in this chapter is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An ellipsis (&#8230;&#8203;) inside an element body indicates that the substructure of that element has been omitted (to be described in another section of this chapter). An example of this would be:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;analysisEngineMetaData&gt;
...
&lt;/analysisEngineMetaData&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>An ellipsis immediately after an element indicates that the element type may be may be repeated arbitrarily many times.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;parameter&gt;[String]&lt;/parameter&gt;
&lt;parameter&gt;[String]&lt;/parameter&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>indicates that there may be arbitrarily many parameter elements in this context.</p>
</div>
</li>
<li>
<p>Bracketed expressions (e.g. <code>[String]</code>) indicate the type of value that may be used at that location.</p>
</li>
<li>
<p>A vertical bar, as in <code>true|false</code>, indicates alternatives. This can be applied to literal values, bracketed type names, and elements.</p>
</li>
<li>
<p>Which elements are optional and which are required is specified in prose, not in the syntax definition.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.component_descriptor.imports"><a class="anchor" href="#ugr.ref.xml.component_descriptor.imports"></a>2.2. Imports</h3>
<div class="paragraph">
<p>The UIMA SDK defines a particular syntax for XML descriptors to import information from other XML files.
When one of the following appears in an XML descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;import location="[URL]" /&gt; or
&lt;import name="[Name]" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>it indicates that information from a separate XML file is being imported.
Note that imports are allowed only in certain places in the descriptor.
In the remainder of this chapter, it will be indicated at which points imports are allowed.</p>
</div>
<div class="paragraph">
<p>If an import specifies a <code>location</code> attribute, the value of that attribute specifies the URL at which the XML file to import will be found.
This can be a relative URL, which will be resolved relative to the descriptor containing the <code>import</code> element, or an absolute URL.
Relative URLs can be written without a protocol/scheme (e.g., &#8220;file:&#8221;), and without a host machine name.
In this case the relative URL might look something like <code>org/apache/myproj/MyTypeSystem.xml.</code></p>
</div>
<div class="paragraph">
<p>An absolute URL is written with one of the following prefixes, followed by a path such as <code>org/apache/myproj/MyTypeSystem.xml</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>file:/</code> ← has no network address</p>
</li>
<li>
<p><code>file:///</code> ← has an empty network address</p>
</li>
<li>
<p><code>file://some.network.address/</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about URLs, please read the javadoc information for the Java class &#8220;URL&#8221;.</p>
</div>
<div class="paragraph">
<p>If an import specifies a <code>name</code> attribute, the value of that attribute should take the form of a Java-style dotted name (e.g. <code>org.apache.myproj.MyTypeSystem</code>). An .xml file with this name will be searched for in the classpath or datapath (described below). As in Java, the dots in the name will be converted to file path separators.
So an import specifying the example name in this paragraph will result in a search for <code>org/apache/myproj/MyTypeSystem.xml</code> in the classpath or datapath.</p>
</div>
<div class="paragraph">
<p>The datapath works similarly to the classpath but can be set programmatically through the resource manager API.
Application developers can specify a datapath during initialization, using the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ResourceManager resMgr = UIMAFramework.newDefaultResourceManager();
resMgr.setDataPath(yourPathString);
AnalysisEngine ae =
  UIMAFramework.produceAnalysisEngine(desc, resMgr, null);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default datapath for the entire JVM can be set via the <code>uima.datapath</code> Java system property, but this feature should only be used for standalone applications that don&#8217;t need to run in the same JVM as other code that may need a different datapath.</p>
</div>
<div class="paragraph">
<p>The value of a name or location attribute may be parameterized with references to external override variables using the <code>${variable-name}</code> syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;import location="Annotator${with}ExternalOverrides.xml" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a variable is undefined the value is left unmodified and a warning message identifies the missing variable.</p>
</div>
<div class="paragraph">
<p>Previous versions of UIMA also supported XInclude.
That support didn&#8217;t work in many situations, and it is no longer supported.
To include other files, please use &lt;import&gt;.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.component_descriptor.type_system"><a class="anchor" href="#ugr.ref.xml.component_descriptor.type_system"></a>2.3. Type System Descriptors</h3>
<div class="paragraph">
<p>A Type System Descriptor is used to define the types and features that can be represented in the CAS.
A Type System Descriptor can be imported into an Analysis Engine or Collection Processing Component Descriptor.</p>
</div>
<div class="paragraph">
<p>The basic structure of a Type System Descriptor is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;typeSystemDescription xmlns="http://uima.apache.org/resourceSpecifier"&gt;

  &lt;name&gt; [String] &lt;/name&gt;
  &lt;description&gt;[String]&lt;/description&gt;
  &lt;version&gt;[String]&lt;/version&gt;
  &lt;vendor&gt;[String]&lt;/vendor&gt;

  &lt;imports&gt;
    &lt;import ...&gt;
    ...
  &lt;/imports&gt;

  &lt;types&gt;
    &lt;typeDescription&gt;
      ...
    &lt;/typeDescription&gt;

    ...

  &lt;/types&gt;

&lt;/typeSystemDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of the subelements are optional.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.type_system.imports"><a class="anchor" href="#ugr.ref.xml.component_descriptor.type_system.imports"></a>2.3.1. Imports</h4>
<div class="paragraph">
<p>The <code>imports</code> section allows this descriptor to import types from other type system descriptors.
The import syntax is described in <a href="#ugr.ref.xml.component_descriptor.imports">Section 2.2</a>.
A type system may import any number of other type systems and then define additional types which refer to imported types.
Circular imports are allowed.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.type_system.types"><a class="anchor" href="#ugr.ref.xml.component_descriptor.type_system.types"></a>2.3.2. Types</h4>
<div class="paragraph">
<p>The <code>types</code> element contains zero or more <code>typeDescription</code> elements.
Each <code>typeDescription</code> has the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;typeDescription&gt;
  &lt;name&gt;[TypeName]&lt;/name&gt;
  &lt;description&gt;[String]&lt;/description&gt;
  &lt;supertypeName&gt;[TypeName]&lt;/supertypeName&gt;
  &lt;features&gt;
    ...
  &lt;/features&gt;
&lt;/typeDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name element contains the name of the type.
A <code>[TypeName]</code> is a dot-separated list of names, where each name consists of a letter followed by any number of letters, digits, or underscores. <code>TypeNames</code> are case sensitive.
Letter and digit are as defined by Java; therefore, any Unicode letter or digit may be used (subject to the character encoding defined by the descriptor file&#8217;s XML header). The name following the final dot is considered to be the &#8220;short name&#8221; of the type; the preceding portion is the namespace (analogous to the package.class syntax used in Java). Namespaces beginning with uima are reserved and should not be used.
Examples of valid type names are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>test.TokenAnnotation</p>
</li>
<li>
<p>org.myorg.TokenAnnotation</p>
</li>
<li>
<p>com.my_company.proj123.TokenAnnotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These would all be considered distinct types since they have different namespaces.
Best practice here is to follow the normal Java naming conventions of having namespaces be all lowercase, with the short type names having an initial capital, but this is not mandated, so <code>ABC.mYtyPE</code> is an allowed type name.
While type names without namespaces (e.g. <code>TokenAnnotation</code> alone) are allowed, but discouraged because naming conflicts can then result when combining annotators that use different type systems.</p>
</div>
<div class="paragraph">
<p>The <code>description</code> element contains a textual description of the type.
The <code>supertypeName</code> element contains the name of the type from which it inherits (this can be set to the name of another user-defined type, or it may be set to any built-in type which may be subclassed, such as <code>uima.tcas.Annotation</code> for a new annotation type or <code>uima.cas.TOP</code> for a new type that is not an annotation). All three of these elements are required.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.type_system.features"><a class="anchor" href="#ugr.ref.xml.component_descriptor.type_system.features"></a>2.3.3. Features</h4>
<div class="paragraph">
<p>The <code>features</code> element of a <code>typeDescription</code> is required only if the type we are specifying introduces new features.
If the <code>features</code> element is present, it contains zero or more <code>featureDescription</code> elements, each of which has the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;featureDescription&gt;
  &lt;name&gt;[Name]&lt;/name&gt;
  &lt;description&gt;[String]&lt;/description&gt;
  &lt;rangeTypeName&gt;[Name]&lt;/rangeTypeName&gt;
  &lt;elementType&gt;[Name]&lt;/elementType&gt;
  &lt;multipleReferencesAllowed&gt;true|false&lt;/multipleReferencesAllowed&gt;
&lt;/featureDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A feature&#8217;s name follows the same rules as a type short name –a letter followed by any number of letters, digits, or underscores.
Feature names are case sensitive.</p>
</div>
<div class="paragraph">
<p>The feature&#8217;s <code>rangeTypeName</code> specifies the type of value that the feature can take.
This may be the name of any type defined in your type system, or one of the predefined types.
All of the predefined types have names that are prefixed with <code>uima.cas</code> or <code>uima.tcas</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>uima.cas.TOP
uima.cas.String
uima.cas.Long
uima.cas.FSArray
uima.cas.StringList
uima.tcas.Annotation.</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a complete list of predefined types, see the CAS API documentation.</p>
</div>
<div class="paragraph">
<p>The <code>elementType</code> of a feature is optional, and applies only when the <code>rangeTypeName</code> is <code>uima.cas.FSArray</code> or <code>uima.cas.FSList</code> The <code>elementType</code> specifies what type of value can be assigned as an element of the array or list.
This must be the name of a non-primitive type.
If omitted, it defaults to <code>uima.cas.TOP</code>, meaning that any FeatureStructure can be assigned as an element the array or list.
Note: depending on the CAS Interface that you use in your code, this constraint may or may not be enforced.
Note: At run time, the elementType is available from a runtime Feature object  (using the <code>a_feature_object.getRange().getComponentType()</code> method)  only when specified for the <code>uima.cas.FSArray</code> ranges; it isn&#8217;t available for <code>uima.cas.FSList</code> ranges.</p>
</div>
<div class="paragraph">
<p>The <code>multipleReferencesAllowed</code> feature is optional, and applies only when the <code>rangeTypeName</code> is an array or list type (it applies to arrays and lists of primitive as well as non-primitive types). Setting this to false (the default) indicates that this feature has exclusive ownership of the array or list, so changes to the array or list are localized.
Setting this to true indicates that the array or list may be shared, so changes to it may affect other objects in the CAS.
Note: there is currently no guarantee that the framework will enforce this restriction.
However, this setting may affect how the CAS is serialized.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.type_system.string_subtypes"><a class="anchor" href="#ugr.ref.xml.component_descriptor.type_system.string_subtypes"></a>2.3.4. String Subtypes</h4>
<div class="paragraph">
<p>There is one other special type that you can declare&#8201;&#8212;&#8201;a subset of the String type that specifies a restricted set of allowed values.
This is useful for features that can have only certain String values, such as parts of speech.
Here is an example of how to declare such a type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;typeDescription&gt;
  &lt;name&gt;PartOfSpeech&lt;/name&gt;
  &lt;description&gt;A part of speech.&lt;/description&gt;
  &lt;supertypeName&gt;uima.cas.String&lt;/supertypeName&gt;
  &lt;allowedValues&gt;
    &lt;value&gt;
      &lt;string&gt;NN&lt;/string&gt;
      &lt;description&gt;Noun, singular or mass.&lt;/description&gt;
    &lt;/value&gt;
    &lt;value&gt;
      &lt;string&gt;NNS&lt;/string&gt;
      &lt;description&gt;Noun, plural.&lt;/description&gt;
    &lt;/value&gt;
    &lt;value&gt;
      &lt;string&gt;VB&lt;/string&gt;
      &lt;description&gt;Verb, base form.&lt;/description&gt;
    &lt;/value&gt;
    ...
  &lt;/allowedValues&gt;
&lt;/typeDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.component_descriptor.aes"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes"></a>2.4. Analysis Engine Descriptors</h3>
<div class="paragraph">
<p>Analysis Engine (AE) descriptors completely describe Analysis Engines.
There are two basic types of Analysis Engines&#8201;&#8212;&#8201;<em>Primitive</em> and <em>Aggregate</em>.
A <em>Primitive</em> Analysis Engine is a container for a single <em>annotator</em>, where as an <em>Aggregate</em> Analysis Engine is composed of a collection of other Analysis Engines.
(For more information on this and other terminology, see the <a href="oas.html#ugr.ovv.conceptual">Conceptual Overview</a>.</p>
</div>
<div class="paragraph">
<p>Both Primitive and Aggregate Analysis Engines have descriptors, and the two types of descriptors have some similarities and some differences. <a href="#ugr.ref.xml.component_descriptor.aes.primitive">Section 2.4.1</a> discusses Primitive Analysis Engine descriptors. <a href="#ugr.ref.xml.component_descriptor.aes.aggregate">Section 2.4.2</a> then  describes how Aggregate Analysis Engine descriptors are different.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.aes.primitive"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.primitive"></a>2.4.1. Primitive Analysis Engine Descriptors</h4>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.primitive.basic"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.primitive.basic"></a>Basic Structure</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;analysisEngineDescription
        xmlns="http://uima.apache.org/resourceSpecifier"&gt;
  &lt;frameworkImplementation&gt;org.apache.uima.java&lt;/frameworkImplementation&gt;

  &lt;primitive&gt;true&lt;/primitive&gt;
  &lt;annotatorImplementationName&gt; [String] &lt;/annotatorImplementationName&gt;

  &lt;analysisEngineMetaData&gt;
    ...
  &lt;/analysisEngineMetaData&gt;

  &lt;externalResourceDependencies&gt;
    ...
  &lt;/externalResourceDependencies&gt;

  &lt;resourceManagerConfiguration&gt;
    ...
  &lt;/resourceManagerConfiguration&gt;

&lt;/analysisEngineDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The document begins with a standard XML header.
The recommended root tag is <code>&lt;analysisEngineDescription&gt;</code>, although <code>&lt;taeDescription&gt;</code> is also allowed for backwards compatibility.</p>
</div>
<div class="paragraph">
<p>Within the root element we declare that we are using the XML namespace <code><a href="http://uima.apache.org/resourceSpecifier" class="bare">http://uima.apache.org/resourceSpecifier</a>.</code> It is required that this namespace be used; otherwise, the descriptor will not be able to be validated for errors.</p>
</div>
<div class="paragraph">
<p>The first subelement, <code>&lt;frameworkImplementation&gt;,</code> currently must have the value <code>org.apache.uima.java</code>, or <code>org.apache.uima.cpp</code>.
In future versions, there may be other framework implementations, or perhaps implementations produced by other vendors.</p>
</div>
<div class="paragraph">
<p>The second subelement, <code>&lt;primitive&gt;,</code> contains the Boolean value <code>true</code>, indicating that this XML document describes a <em>Primitive</em> Analysis Engine.</p>
</div>
<div class="paragraph">
<p>The next subelement,<code>
          &lt;annotatorImplementationName&gt;</code> is how the UIMA framework determines which annotator class to use.
This should contain a fully-qualified Java class name for Java implementations, or the name of a .dll or .so file for C++ implementations.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;analysisEngineMetaData&gt;</code> object contains descriptive information about the analysis engine and what it does.
It is described in <a href="#ugr.ref.xml.component_descriptor.aes.metadata">Section 2.4.1.2</a>.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;externalResourceDependencies&gt;</code> and <code>&lt;resourceManagerConfiguration&gt;</code> elements declare the external resource files that the analysis engine relies upon.
They are optional and are described in <a href="#ugr.ref.xml.component_descriptor.aes.primitive.external_resource_dependencies">Section 2.4.1.8</a> and <a href="#ugr.ref.xml.component_descriptor.aes.primitive.resource_manager_configuration">Section 2.4.1.9</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.metadata"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.metadata"></a>Analysis Engine MetaData</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;analysisEngineMetaData&gt;
  &lt;name&gt; [String] &lt;/name&gt;
  &lt;description&gt;[String]&lt;/description&gt;
  &lt;version&gt;[String]&lt;/version&gt;
  &lt;vendor&gt;[String]&lt;/vendor&gt;

  &lt;configurationParameters&gt; ...  &lt;/configurationParameters&gt;

  &lt;configurationParameterSettings&gt;
    ...
  &lt;/configurationParameterSettings&gt;

  &lt;typeSystemDescription&gt; ... &lt;/typeSystemDescription&gt;

  &lt;typePriorities&gt; ... &lt;/typePriorities&gt;

  &lt;fsIndexCollection&gt; ... &lt;/fsIndexCollection&gt;

  &lt;capabilities&gt; ... &lt;/capabilities&gt;

  &lt;operationalProperties&gt; ... &lt;/operationalProperties&gt;

&lt;/analysisEngineMetaData&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>analysisEngineMetaData</code> element contains four simple string fields –<code>name</code>, <code>description</code>, <code>version</code>, and <code>vendor</code>.
Only the <code>name</code> field is required, but providing values for the other fields is recommended.
The <code>name</code> field is just a descriptive name meant to be read by users; it does not need to be unique across all Analysis Engines.</p>
</div>
<div class="paragraph">
<p>Configuration parameters are described in <a href="#ugr.ref.xml.component_descriptor.aes.configuration_parameters">Section 2.4.3</a>.</p>
</div>
<div class="paragraph">
<p>The other sub-elements –<code>typeSystemDescription</code>, <code>typePriorities</code>, <code>fsIndexes</code>, <code>capabilities</code> and <code>operationalProperties</code> are described in the following sections.
The only one of these that is required is <code>capabilities</code>; the others are optional.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.type_system"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.type_system"></a>Type System Definition</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;typeSystemDescription&gt;

  &lt;name&gt; [String] &lt;/name&gt;
  &lt;description&gt;[String]&lt;/description&gt;
  &lt;version&gt;[String]&lt;/version&gt;
  &lt;vendor&gt;[String]&lt;/vendor&gt;

  &lt;imports&gt;
    &lt;import ...&gt;
    ...
  &lt;/imports&gt;

  &lt;types&gt;
    &lt;typeDescription&gt;
      ...
    &lt;/typeDescription&gt;

    ...

  &lt;/types&gt;

&lt;/typeSystemDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>typeSystemDescription</code> element defines a type system for an Analysis Engine.
The syntax for the element is described in <a href="#ugr.ref.xml.component_descriptor.type_system">Section 2.3</a>.</p>
</div>
<div class="paragraph">
<p>The recommended usage is to <code>import</code> an external type system, using the import syntax described in <a href="#ugr.ref.xml.component_descriptor.imports">Section 2.2</a> of this chapter.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;typeSystemDescription&gt;
  &lt;imports&gt;
    &lt;import location="MySharedTypeSystem.xml"&gt;
  &lt;/imports&gt;
&lt;/typeSystemDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows several AEs to share a single type system definition.
The file <code>MySharedTypeSystem.xml</code> would then contain the full type system information, including the <code>name</code>, <code>description</code>, <code>vendor</code>, <code>version</code>, and <code>types</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.type_priority"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.type_priority"></a>Type Priority Definition</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;typePriorities&gt;
  &lt;name&gt; [String] &lt;/name&gt;
  &lt;description&gt;[String]&lt;/description&gt;
  &lt;version&gt;[String]&lt;/version&gt;
  &lt;vendor&gt;[String]&lt;/vendor&gt;

  &lt;imports&gt;
    &lt;import ...&gt;
    ...
  &lt;/imports&gt;

  &lt;priorityLists&gt;
    &lt;priorityList&gt;
      &lt;type&gt;[TypeName]&lt;/type&gt;
      &lt;type&gt;[TypeName]&lt;/type&gt;
        ...
    &lt;/priorityList&gt;

    ...

  &lt;/priorityLists&gt;
&lt;/typePriorities&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;typePriorities&gt;</code> element contains zero or more <code>&lt;priorityList&gt;</code> elements; each <code>&lt;priorityList&gt;</code> contains zero or more types.
Like a type system, a type priorities definition may also declare a name, description, version, and vendor, and may import other type priorities.
See <a href="#ugr.ref.xml.component_descriptor.imports">Section 2.2</a> for the import syntax.</p>
</div>
<div class="paragraph">
<p>Type priority is used when iterating over feature structures in the CAS.
For example, if the CAS contains a <code>Sentence</code> annotation and a <code>Paragraph</code> annotation with the same span of text (i.e.
a one-sentence paragraph), which annotation should be returned first by an iterator? Probably the Paragraph, since it is conceptually &#8220;bigger,&#8221; but the framework does not know that and must be explicitly told that the Paragraph annotation has priority over the Sentence annotation, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;typePriorities&gt;
  &lt;priorityList&gt;
    &lt;type&gt;org.myorg.Paragraph&lt;/type&gt;
    &lt;type&gt;org.myorg.Sentence&lt;/type&gt;
  &lt;/priorityList&gt;
&lt;/typePriorities&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of the <code>&lt;priorityList&gt;</code> elements defined in the descriptor (and in all component descriptors of an aggregate analysis engine descriptor) are merged to produce a single priority list.</p>
</div>
<div class="paragraph">
<p>Subtypes of types specified here are also ordered, unless overridden by another user-specified type ordering.
For example, if you specify type A comes before type B, then subtypes of A will come before subtypes of B, unless there is an overriding specification which declares some subtype of B comes before some subtype of A.</p>
</div>
<div class="paragraph">
<p>If there are inconsistencies between the priority list (type A declared before type B in one priority list, and type B declared before type A in another), the framework will throw an exception.</p>
</div>
<div class="paragraph">
<p>User defined indexes may declare if they wish to use the type priority or not; see the next section.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.index"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.index"></a>Index Definition</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;fsIndexCollection&gt;

  &lt;name&gt;[String]&lt;/name&gt;
  &lt;description&gt;[String]&lt;/description&gt;
  &lt;version&gt;[String]&lt;/version&gt;
  &lt;vendor&gt;[String]&lt;/vendor&gt;

  &lt;imports&gt;
    &lt;import ...&gt;
    ...
  &lt;/imports&gt;

  &lt;fsIndexes&gt;

    &lt;fsIndexDescription&gt;
      ...
    &lt;/fsIndexDescription&gt;

    &lt;fsIndexDescription&gt;
      ...
    &lt;/fsIndexDescription&gt;

  &lt;/fsIndexes&gt;

&lt;/fsIndexCollection&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>fsIndexCollection</code> element declares <em><a href="#ugr.ref.cas.indexes_and_iterators">Feature Structure Indexes</a></em>, each of which defined an index that holds feature structures of a given type.
Information in the CAS is always accessed through an index.
There is a built-in default annotation index declared which can be used to access instances of type <code>uima.tcas.Annotation</code> (or its subtypes), sorted based on their <code>begin</code> and <code>end</code> features, and the type priority ordering (if specified).  For all other types, there is a default, unsorted (bag) index.
If there is a need for a specialized index it must be declared in this element of the descriptor.</p>
</div>
<div class="paragraph">
<p>Like type systems and type priorities, an <code>fsIndexCollection</code> can declare a <code>name</code>, <code>description</code>, <code>vendor</code>, and <code>version</code>, and may import other <code>fsIndexCollection</code>s.
The import syntax is described in <a href="#ugr.ref.xml.component_descriptor.imports">Section 2.2</a>.</p>
</div>
<div class="paragraph">
<p>An <code>fsIndexCollection</code> may also define zero or more <code>fsIndexDescription</code> elements, each of which defines a single index.
Each <code>fsIndexDescription</code> has the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;fsIndexDescription&gt;

  &lt;label&gt;[String]&lt;/label&gt;
  &lt;typeName&gt;[TypeName]&lt;/typeName&gt;
  &lt;kind&gt;sorted|bag|set&lt;/kind&gt;

  &lt;keys&gt;

    &lt;fsIndexKey&gt;
      &lt;featureName&gt;[Name]&lt;/featureName&gt;
      &lt;comparator&gt;standard|reverse&lt;/comparator&gt;
    &lt;/fsIndexKey&gt;

    &lt;fsIndexKey&gt;
      &lt;typePriority/&gt;
    &lt;/fsIndexKey&gt;

    ...

  &lt;/keys&gt;
&lt;/fsIndexDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>label</code> element defines the name by which applications and annotators refer to this index.
The <code>typeName</code> element contains the name of the type that will be contained in this index.
This must match one of the type names defined in the <code>&lt;typeSystemDescription&gt;</code>.</p>
</div>
<div class="paragraph">
<p>There are three possible values for the <code>&lt;kind&gt;</code> of index.
Sorted indexes enforce an ordering of feature structures, based on defined keys.
Bag indexes do not enforce ordering, and have no defined keys.
Set indexes do not enforce ordering, but use defined keys to specify equivalence classes;  addToIndexes will not add a Feature Structure to a set index if its keys  match those of an entry of the same type already in the index.
If the <code>&lt;kind&gt;</code>element is omitted, it will default to sorted, which is the most common type of index.</p>
</div>
<div class="paragraph">
<p>Prior to version 2.7.0, the bag and sorted indexes stored duplicate entries for the same identical FS, if it was added to the indexes multiple times.
As of version 2.7.0, this  is changed; a second or subsequent add to index operation has no effect.
This has the consequence that a remove operation now guarantees that the particular FS is removed  (as opposed to only being able to say that one (of perhaps many duplicate entries) is removed). Since sending to remote annotators only adds entries to indexes at most once, this  behavior is consistent with that.</p>
</div>
<div class="paragraph">
<p>Note that even after this change, there is still a distinct difference in meaning for bag and set indexes.
The set index uses equal defined key values plus the type of the Feature Structure to determine equivalence classes for Feature Structures, and will not add a Feature Structure if it has equal key values and the same type to an entry already in there.</p>
</div>
<div class="paragraph">
<p>It is possible, however, that users may be depending on having multiple instances of  the identical FeatureStructure in the indicies.
Therefore, UIMA uses  a JVM defined property, "uima.allow_duplicate_add_to_indexes", which (if defined whend UIMA is loaded) will restore the previous behavior.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If duplicates are allowed, then the proper way to update an indexed Feature Structure is to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>remove <strong>all</strong> instances of the FS to be updated</p>
</li>
<li>
<p>update the features</p>
</li>
<li>
<p>re-add the Feature Structure to the indexes (perhaps multiple times, depending on the details of your logic).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>There is usually no need to explicitly declare a Bag index in your descriptor.
As of UIMA v2.1, if you do not declare any index for a type (or any of its  supertypes), a Bag index will be automatically created if an instance of that type is added to the indexes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An Sorted or Set index may define zero or more <em>keys</em>.
These keys determine the sort order of the feature structures within a sorted index, and partially determine equality for set indexes (the equality measure always includes testing that the types are the same).  Bag indexes do not use keys, and  equality is determined by Feature Structure identity (that is, two elements are considered equal if and only if they are exactly the same feature structure, located in the same place in the CAS). Keys are ordered by precedence&#8201;&#8212;&#8201;the first key is evaluated first, and subsequent keys are evaluated only if necessary.</p>
</div>
<div class="paragraph">
<p>Each key is represented by an <code>fsIndexKey</code> element.
Most <code>fsIndexKeys</code> contains a <code>featureName</code> and a <code>comparator</code>.
The <code>featureName</code> must match the name of one of the features for the type specified in the <code>&lt;typeName&gt;</code> element for this index.
The comparator defines how the features will be compared&#8201;&#8212;&#8201;a value of <code>standard</code> means that features will be compared using the standard comparison for their data type (e.g.
for numerical types, smaller values precede larger values, and for string types, Unicode string comparison is performed). A value of <code>reverse</code> means that features will be compared using the reverse of the standard comparison (e.g.
for numerical types, larger values precede smaller values, etc.). For Set indexes, the comparator direction is ignored&#8201;&#8212;&#8201;the keys are only used for the equality testing.</p>
</div>
<div class="paragraph">
<p>Each key used in comparisons must refer to a feature whose range type is Boolean, Byte, Short, Integer, Long, Float, Double, or String.</p>
</div>
<div class="paragraph">
<p>There is a second type of a key, one which contains only the <code>&lt;typePriority/&gt;</code>.
When this key is used, it indicates that Feature Structures will be compared using the type priorities declared in the <code>&lt;typePriorities&gt;</code> section of the descriptor.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.capabilities"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.capabilities"></a>Capabilities</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;capabilities&gt;
  &lt;capability&gt;

    &lt;inputs&gt;
      &lt;type allAnnotatorFeatures="true|false"[TypeName]&lt;/type&gt;
      ...
      &lt;feature&gt;[TypeName]:[Name]&lt;/feature&gt;
      ...
    &lt;/inputs&gt;

    &lt;outputs&gt;
      &lt;type allAnnotatorFeatures="true|false"[TypeName]&lt;/type&gt;
      ...
      &lt;feature&gt;[TypeName]:[Name]&lt;/feature&gt;
      ...
    &lt;/output&gt;

    &lt;inputSofas&gt;
      &lt;sofaName&gt;[name]&lt;/sofaName&gt;
      ...
    &lt;/inputSofas&gt;

    &lt;outputSofas&gt;
      &lt;sofaName&gt;[name]&lt;/sofaName&gt;
      ...
    &lt;/outputSofas&gt;

    &lt;languagesSupported&gt;
      &lt;language&gt;[ISO Language ID]&lt;/language&gt;
        ...
    &lt;/languagesSupported&gt;
  &lt;/capability&gt;

  &lt;capability&gt;
    ...
  &lt;/capability&gt;

  ...

&lt;/capabilities&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The capabilities definition is used by the UIMA Framework in several ways, including setting up the Results Specification for process calls, routing control for aggregates based on language, and as part of the Sofa mapping function.</p>
</div>
<div class="paragraph">
<p>The <code>capabilities</code> element contains one or more <code>capability</code> elements.
In Version 2 and onwards, only one capability set should be used (multiple sets will continue to work for a while, but they&#8217;re not logically consistently supported).</p>
</div>
<div class="paragraph">
<p>Each <code>capability</code> contains <code>inputs</code>, <code>outputs</code>, <code>languagesSupported, inputSofas, and outputSofas</code>.
Inputs and outputs element are required (though they may be empty); <code>&lt;languagesSupported&gt;, &lt;inputSofas</code>&gt;, and <code>&lt;outputSofas&gt;</code> are optional.</p>
</div>
<div class="paragraph">
<p>Both inputs and outputs may contain a mixture of type and feature elements.</p>
</div>
<div class="paragraph">
<p><code>&lt;type&#8230;&#8203;&gt;</code> elements contain the name of one of the types defined in the type system or one of the built in types.
Declaring a type as an input means that this component expects instances of this type to be in the CAS when it receives it to process.
Declaring a type as an output means that this component creates new instances of this type in the CAS.</p>
</div>
<div class="paragraph">
<p>There is an optional attribute <code>allAnnotatorFeatures</code>, which defaults to false if omitted.
The Component Descriptor Editor tool defaults this to true when a new type is added to the list of inputs and/or outputs.
When this attribute is true, it specifies that all of the type&#8217;s features are also declared as input or output.
Otherwise, the features that are required as inputs or populated as outputs must be explicitly specified in feature elements.</p>
</div>
<div class="paragraph">
<p><code>&lt;feature&#8230;&#8203;&gt;</code> elements contain the &#8220;fully-qualified&#8221; feature name, which is the type name followed by a colon, followed by the feature name, e.g. <code>org.myorg.TokenAnnotation:lemma</code>. <code>&lt;feature&#8230;&#8203;&gt;</code> elements in the <code>&lt;inputs&gt;</code> section must also have a corresponding type declared as an input.
In output sections, this is not required.
If the type is not specified as an output, but a feature for that type is, this means that existing instances of the type have the values of the specified features updated.
Any type mentioned in a <code>&lt;feature&gt;</code> element must be either specified as an input or an output or both.</p>
</div>
<div class="paragraph">
<p><code>language </code>elements contain one of the ISO language identifiers, such as <code>en</code> for English, or <code>en-US</code> for the United States dialect of English.</p>
</div>
<div class="paragraph">
<p>The list of language codes can be found here: <a href="http://www.ics.uci.edu/pub/ietf/http/related/iso639.txt" class="bare">http://www.ics.uci.edu/pub/ietf/http/related/iso639.txt</a> and the country codes here: <a href="http://www.chemie.fu-berlin.de/diverse/doc/ISO_3166.html" class="bare">http://www.chemie.fu-berlin.de/diverse/doc/ISO_3166.html</a></p>
</div>
<div class="paragraph">
<p><code>&lt;inputSofas&gt;</code> and <code>&lt;outputSofas&gt;</code> declare sofa names used by this component.
All Sofa names must be unique within a particular capability set.
A Sofa name must be an input or an output, and cannot be both.
It is an error to have a Sofa name declared as an input in one capability set, and also have it declared as an output in another capability set.</p>
</div>
<div class="paragraph">
<p>A <code>&lt;sofaName&gt;</code> is written as a simple Java-style identifier, without any periods in the name, except that it may be written to end in &#8220;`.<strong>`&#8221;.
If written in this manner, it specifies a set of Sofa names, all of which start with the base name (the part before the .</strong>) followed by a period and then an arbitrary Java identifier (without periods). This form is used to specify in the descriptor that the component could generate an arbitrary number of Sofas, the exact names and numbers of which are unknown before the component is run.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.operational_properties"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.operational_properties"></a>OperationalProperties</h5>
<div class="paragraph">
<p>Components can specify specific operational properties that can be useful in deployment.
The following are available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;operationalProperties&gt;
  &lt;modifiesCas&gt; true|false &lt;/modifiesCas&gt;
  &lt;multipleDeploymentAllowed&gt; true|false &lt;/multipleDeploymentAllowed&gt;
  &lt;outputsNewCASes&gt; true|false &lt;/outputsNewCASes&gt;
&lt;/operationalProperties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ModifiesCas</code>, if false, indicates that this component does not modify the CAS.
If it is not specified, the default value is true except for CAS Consumer components.</p>
</div>
<div class="paragraph">
<p><code>multipleDeploymentAllowed</code>, if true, allows the component to be deployed multiple times to increase performance through scale-out techniques.
If it is not specified, the default value is true, except for CAS Consumer and Collection Reader components.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you wrap one or more CAS Consumers inside an aggregate as the only components, you must explicitly specify in the aggregate the <code>multipleDeploymentAllowed</code> property as false (assuming the CAS Consumer components take the default here); otherwise the framework will complain about inconsistent settings for these.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code><a href="tug.html#ugr.tug.cm">outputsNewCASes</a></code>, if true, allows the component to create new CASes during processing, for example to break a large artifact into smaller pieces.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.primitive.external_resource_dependencies"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.primitive.external_resource_dependencies"></a>External Resource Dependencies</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;externalResourceDependencies&gt;
  &lt;externalResourceDependency&gt;
    &lt;key&gt;[String]&lt;/key&gt;
    &lt;description&gt;[String] &lt;/description&gt;
    &lt;interfaceName&gt;[String]&lt;/interfaceName&gt;
    &lt;optional&gt;true|false&lt;/optional&gt;
  &lt;/externalResourceDependency&gt;

  &lt;externalResourceDependency&gt;
    ...
  &lt;/externalResourceDependency&gt;

  ...

&lt;/externalResourceDependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A primitive annotator may declare zero or more <code>&lt;externalResourceDependency&gt;</code> elements.
Each dependency has the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>key</code>– the string by which the annotator code will attempt to access the resource. Must be unique within this annotator.</p>
</li>
<li>
<p><code>description</code>– a textual description of the dependency.</p>
</li>
<li>
<p><code>interfaceName</code>– the fully-qualified name of the Java interface through which the annotator will access the data. This is optional. If not specified, the annotator can only get an InputStream to the data.</p>
</li>
<li>
<p><code>optional</code>– whether the resource is optional. If false, an exception will be thrown if no resource is assigned to satisfy this dependency. Defaults to false.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.primitive.resource_manager_configuration"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.primitive.resource_manager_configuration"></a>Resource Manager Configuration</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;resourceManagerConfiguration&gt;

  &lt;name&gt;[String]&lt;/name&gt;
  &lt;description&gt;[String]&lt;/description&gt;
  &lt;version&gt;[String]&lt;/version&gt;
  &lt;vendor&gt;[String]&lt;/vendor&gt;

  &lt;imports&gt;
    &lt;import ...&gt;
    ...
  &lt;/imports&gt;

  &lt;externalResources&gt;

    &lt;externalResource&gt;
      &lt;name&gt;[String]&lt;/name&gt;
      &lt;description&gt;[String]&lt;/description&gt;
      &lt;fileResourceSpecifier&gt;
        &lt;fileUrl&gt;[URL]&lt;/fileUrl&gt;
      &lt;/fileResourceSpecifier&gt;
      &lt;implementationName&gt;[String]&lt;/implementationName&gt;
    &lt;/externalResource&gt;
    ...
  &lt;/externalResources&gt;

  &lt;externalResourceBindings&gt;
    &lt;externalResourceBinding&gt;
      &lt;key&gt;[String]&lt;/key&gt;
      &lt;resourceName&gt;[String]&lt;/resourceName&gt;
    &lt;/externalResourceBinding&gt;
    ...
  &lt;/externalResourceBindings&gt;

&lt;/resourceManagerConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This element declares external resources and binds them to annotators' external resource dependencies.</p>
</div>
<div class="paragraph">
<p>The <code>resourceManagerConfiguration</code> element may optionally contain an <code>import</code>, which allows resource definitions to be stored in a separate (shareable) file.
See <a href="#ugr.ref.xml.component_descriptor.imports">Section 2.2</a> for details.</p>
</div>
<div class="paragraph">
<p>The <code>externalResources</code> element contains zero or more <code>externalResource</code> elements, each of which consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code>&#8201;&#8212;&#8201;the name of the resource. This name is referred to in the bindings (see below). Resource names need to be unique within any Aggregate Analysis Engine or Collection Processing Engine, so the Java-like <code>org.myorg.mycomponent.MyResource</code> syntax is recommended.</p>
</li>
<li>
<p><code>description</code>&#8201;&#8212;&#8201;English description of the resource.</p>
</li>
<li>
<p>Resource Specifier&#8201;&#8212;&#8201;Declares the location of the resource. There are different possibilities for how this is done (see below).</p>
</li>
<li>
<p><code>implementationName</code>--  The fully-qualified name of the Java class that will be instantiated from the resource data. This is optional; if not specified, the resource will be accessible as an input stream to the raw data. If specified, the Java class must implement the <code>interfaceName</code> that is specified in the External Resource Dependency to which it is bound.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One possibility for the resource specifier is a <code>&lt;fileResourceSpecifier&gt;</code>, as shown above.
This simply declares a URL to the resource data.
This support is built on the Java class URL and its method <code>URL.openStream()</code>; it supports the protocols <code>file</code>, <code>http</code> and <code>jar</code> (for referring to files in jars) by default, and you can plug in handlers for other protocols.
The URL has to start with file: (or some other protocol). It is relative to either the classpath or the <code>data path</code>.
The data path works like the classpath but can be set programmatically via <code>ResourceManager.setDataPath()</code>.
Setting the Java System property <code>uima.datapath</code> also works.</p>
</div>
<div class="paragraph">
<p><code>file:com/apache.d.txt</code> is a relative path; relative paths for resources are resolved using the classpath and/or the datapath.
For the file protocol, URLs starting with <code>file:/</code> or <code>file:///</code> are absolute.
Note that <code>file://org/apache/d.txt</code> is NOT an absolute path starting with <code>org</code>.
The &#8220;//&#8221; indicates that what follows is a host name.
Therefore if you try to use this URL it will complain that it can&#8217;t connect to the host <code>org</code>.</p>
</div>
<div class="paragraph">
<p>The URL value may contain references to external override variables using the <code>${variable-name}</code> syntax,  e.g. <code>file:com/${dictUrl}.txt</code>.
If a variable is undefined the value is left unmodified and a warning message identifies the missing variable.</p>
</div>
<div class="paragraph">
<p>Another option is a <code>&lt;fileLanguageResourceSpecifier&gt;</code>, which is intended to support resources, such as dictionaries, that depend on the language of the document being processed.
Instead of a single URL, a prefix and suffix are specified, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;fileLanguageResourceSpecifier&gt;
  &lt;fileUrlPrefix&gt;file:FileLanguageResource_implTest_data_&lt;/fileUrlPrefix&gt;
  &lt;fileUrlSuffix&gt;.dat&lt;/fileUrlSuffix&gt;
&lt;/fileLanguageResourceSpecifier&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The URL of the actual resource is then formed by concatenating the prefix, the language of the document (as an ISO language code, e.g. <code>en</code> or <code>en-US</code>– see <a href="#ugr.ref.xml.component_descriptor.aes.capabilities">Section 2.4.1.6</a> for more information), and the suffix.</p>
</div>
<div class="paragraph">
<p>A third option is a <code>customResourceSpecifier</code>, which allows you to plug in an arbitrary Java class.
See <a href="#ugr.ref.xml.component_descriptor.custom_resource_specifiers">Section 2.8</a> for more information.</p>
</div>
<div class="paragraph">
<p>The <code>externalResourceBindings</code> element declares which resources are bound to which dependencies.
Each <code>externalResourceBinding</code> consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>key</code>-- identifies the dependency. For a binding declared in a primitive analysis engine descriptor, this must match the value of the <code>key</code> element of one of the <code>externalResourceDependency</code> elements. Bindings may also be specified in aggregate analysis engine descriptors, in which case a compound key is used&#8201;&#8212;&#8201;see <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.external_resource_bindings">Section 2.4.2.4</a> .</p>
</li>
<li>
<p><code>resourceName</code>&#8201;&#8212;&#8201;the name of the resource satisfying the dependency. This must match the value of the <code>name</code> element of one of the <code>externalResource</code> declarations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A given resource dependency may only be bound to one external resource; one external resource may be bound to many dependencies&#8201;&#8212;&#8201;to allow resource sharing.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.environment_variable_references"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.environment_variable_references"></a>Environment Variable References</h5>
<div class="paragraph">
<p>In several places throughout the descriptor, it is possible to reference environment variables.
In Java, these are actually references to Java system properties.
To reference system environment variables from a Java analysis engine you must pass the environment variables into the Java virtual machine by using the <code>-D</code> option on the <code>java</code> command line.</p>
</div>
<div class="paragraph">
<p>The syntax for environment variable references is <code>&lt;envVarRef&gt;[VariableName]&lt;/envVarRef&gt;</code> , where [VariableName] is any valid Java system property name.
Environment variable references are valid in the following places:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The value of a configuration parameter (String-valued parameters only)</p>
</li>
<li>
<p>The <code>&lt;annotatorImplementationName&gt;</code> element of a primitive AE descriptor</p>
</li>
<li>
<p>The <code>&lt;name&gt;</code> element within <code>&lt;analysisEngineMetaData&gt;</code></p>
</li>
<li>
<p>Within a <code>&lt;fileResourceSpecifier&gt;</code> or <code>&lt;fileLanguageResourceSpecifier&gt;</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if the value of a configuration parameter were specified as: <code>&lt;string&gt;&lt;envVarRef&gt;TEMP_DIR&lt;/envVarRef&gt;/temp.dat&lt;/string&gt;</code> , and the value of the <code>TEMP_DIR</code> Java System property were <code>c:/temp</code>, then the configuration parameter&#8217;s value would evaluate to <code>c:/temp/temp.dat</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Component Descriptor Editor does not support  environment variable references.
If you need to, however, you  can use the <code>source</code> tab view in the CDE to manually add this notation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.aes.aggregate"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.aggregate"></a>2.4.2. Aggregate Analysis Engine Descriptors</h4>
<div class="paragraph">
<p>Aggregate Analysis Engines do not contain an annotator, but instead contain one or more component (also called <em>delegate</em>) analysis engines.</p>
</div>
<div class="paragraph">
<p>Aggregate Analysis Engine Descriptors maintain most of the same structure as Primitive Analysis Engine Descriptors.
The differences are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An Aggregate Analysis Engine Descriptor contains the element <code>&lt;primitive&gt;false&lt;/primitive&gt;</code> rather than <code>&lt;primitive&gt;true&lt;/primitive&gt;</code>.</p>
</li>
<li>
<p>An Aggregate Analysis Engine Descriptor must not include a <code>&lt;annotatorImplementationName&gt;</code> element.</p>
</li>
<li>
<p>In place of the <code>&lt;annotatorImplementationName&gt;</code>, an Aggregate Analysis Engine Descriptor must have a <code>&lt;delegateAnalysisEngineSpecifiers&gt;</code> element. See <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.delegates">Section 2.4.2.1</a>.</p>
</li>
<li>
<p>An Aggregate Analysis Engine Descriptor may provide a <code>&lt;flowController&gt;</code> element immediately following the <code>&lt;delegateAnalysisEngineSpecifiers&gt;</code>. <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_controller">Section 2.4.2.2</a>.</p>
</li>
<li>
<p>Under the analysisEngineMetaData element, an Aggregate Analysis Engine Descriptor may specify an additional element&#8201;&#8212;&#8201;<code>&lt;flowConstraints&gt;</code>. See <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints">Section 2.4.2.3</a>. Typically only one of <code>&lt;flowController&gt;</code> and <code>&lt;flowConstraints&gt;</code> are specified. If both are specified, the <code>&lt;flowController&gt;</code> takes precedence, and the flow controller implementation can use the information in specified in the <code>&lt;flowConstraints&gt;</code> as part of its configuration input.</p>
</li>
<li>
<p>An aggregate Analysis Engine Descriptors must not contain a <code>&lt;typeSystemDescription&gt;</code> element. The Type System of the Aggregate Analysis Engine is derived by merging the Type System of the Analysis Engines that the aggregate contains.</p>
</li>
<li>
<p>Within aggregate Analysis Engine Descriptors, <code>&lt;configurationParameter&gt;</code> elements may define <code>&lt;overrides&gt;</code>. See <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.configuration_parameter_overrides">Section 2.4.3.3</a> .</p>
</li>
<li>
<p>External Resource Bindings can bind resources to dependencies declared by any delegate AE within the aggregate. See <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.external_resource_bindings">Section 2.4.2.4</a>.</p>
</li>
<li>
<p>An additional optional element, <code>&lt;sofaMappings&gt;</code>, may be included.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.aggregate.delegates"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.aggregate.delegates"></a>Delegate Analysis Engine Specifiers</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;delegateAnalysisEngineSpecifiers&gt;

  &lt;delegateAnalysisEngine key="[String]"&gt;
    &lt;analysisEngineDescription&gt;...&lt;/analysisEngineDescription&gt; |
    &lt;import .../&gt;
  &lt;/delegateAnalysisEngine&gt;

  &lt;delegateAnalysisEngine key="[String]"&gt;
    ...
  &lt;/delegateAnalysisEngine&gt;

  ...

&lt;/delegateAnalysisEngineSpecifiers&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>delegateAnalysisEngineSpecifiers</code> element contains one or more <code>delegateAnalysisEngine</code> elements.
Each of these must have a unique key, and must contain either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A complete <code>analysisEngineDescription</code> element describing the delegate analysis engine <strong>OR</strong></p>
</li>
<li>
<p>An <code>import</code> element giving the name or location of the XML descriptor for the delegate analysis engine (see <a href="#ugr.ref.xml.component_descriptor.imports">Section 2.2</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The latter is the much more common usage, and is the only form supported by the Component Descriptor Editor tool.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.aggregate.flow_controller"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_controller"></a>FlowController</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;flowController key="[String]"&gt;
    &lt;flowControllerDescription&gt;...&lt;/flowControllerDescription&gt; |
    &lt;import .../&gt;
  &lt;/flowController&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The optional <code>flowController</code> element identifies the descriptor of the FlowController component that will be used to determine the order in which delegate Analysis Engine are called.</p>
</div>
<div class="paragraph">
<p>The <code>key</code> attribute is optional, but recommended; it assigns the FlowController an identifier that can be used for configuration parameter overrides, Sofa mappings, or external resource bindings.
The key must not be the same as any of the delegate analysis engine keys.</p>
</div>
<div class="paragraph">
<p>As with the <code>delegateAnalysisEngine</code> element, the <code>flowController</code> element may contain either a complete <code>flowControllerDescription</code> or an <code>import</code>, but the import is recommended.
The Component Descriptor Editor tool only supports imports here.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints"></a>FlowConstraints</h5>
<div class="paragraph">
<p>If a <code>&lt;flowController&gt;</code> is not specified, the order in which delegate Analysis Engines are called within the aggregate Analysis Engine is specified using the <code>&lt;flowConstraints&gt;</code> element, which must occur immediately following the <code>configurationParameterSettings</code> element.
If a <code>&lt;flowController&gt;</code> is specified, then the <code>&lt;flowConstraints&gt;</code> are optional.
They can be used to pass an ordering of delegate keys to the <code>&lt;flowController&gt;</code>.</p>
</div>
<div class="paragraph">
<p>There are two options for flow constraints&#8201;&#8212;&#8201;<code>&lt;fixedFlow&gt;</code> or <code>&lt;capabilityLanguageFlow&gt;</code>.
Each is discussed in a separate section below.</p>
</div>
<div class="sect5">
<h6 id="ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints.fixed_flow"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints.fixed_flow"></a>Fixed Flow</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;flowConstraints&gt;
  &lt;fixedFlow&gt;
    &lt;node&gt;[String]&lt;/node&gt;
    &lt;node&gt;[String]&lt;/node&gt;
    ...
  &lt;/fixedFlow&gt;
&lt;/flowConstraints&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>flowConstraints</code> element must be included immediately following the <code>configurationParameterSettings</code> element.</p>
</div>
<div class="paragraph">
<p>Currently the <code>flowConstraints</code> element must contain a <code>fixedFlow</code> element.
Eventually, other types of flow constraints may be possible.</p>
</div>
<div class="paragraph">
<p>The <code>fixedFlow</code> element contains one or more <code>node</code> elements, each of which contains an identifier which must match the key of a delegate analysis engine specified in the <code>delegateAnalysisEngineSpecifiers</code> element.</p>
</div>
</div>
<div class="sect5">
<h6 id="ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints.capability_language_flow"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.aggregate.flow_constraints.capability_language_flow"></a>Capability Language Flow</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;flowConstraints&gt;
  &lt;capabilityLanguageFlow&gt;
    &lt;node&gt;[String]&lt;/node&gt;
    &lt;node&gt;[String]&lt;/node&gt;
    ...
  &lt;/capabilityLanguageFlow&gt;
&lt;/flowConstraints&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use <code>&lt;capabilityLanguageFlow&gt;</code>, the delegate Analysis Engines named by the <code>&lt;node&gt;</code> elements are called in the given order, except that a delegate Analysis Engine is skipped if any of the following are true (according to that Analysis Engine&#8217;s declared output capabilities):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It cannot produce any of the aggregate Analysis Engine&#8217;s output capabilities for the language of the current document.</p>
</li>
<li>
<p>All of the output capabilities have already been produced by an earlier Analysis Engine in the flow.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if two annotators produce <code>org.myorg.TokenAnnotation</code> feature structures for the same language, these feature structures will only be produced by the first annotator in the list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The flow analysis uses the specific types that are specified in the output capabilities, without any expansion for subtypes.
So, if you expect a type TT and another type SubTT (which is a subtype of TT) in the output, you must include both of them in the output capabilities.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.aggregate.external_resource_bindings"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.aggregate.external_resource_bindings"></a>External Resource Bindings</h5>
<div class="paragraph">
<p>Aggregate analysis engine descriptors can declare resource bindings that bind resources to dependencies declared in any of the delegate analysis engines (or their subcomponents, recursively) within that aggregate.
This allows resource sharing.
Any binding at this level overrides (supersedes) any binding specified by a contained component or their subcomponents, recursively.</p>
</div>
<div class="paragraph">
<p>For example, consider an aggregate Analysis Engine Descriptor that contains delegate Analysis Engines with keys <code>annotator1</code> and <code>annotator2</code> (as declared in the <code>&lt;delegateAnalysisEngine&gt;</code> element – see <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.delegates">Section 2.4.2.1</a>), where <code>annotator1</code> declares a resource dependency with key <code>myResource</code> and <code>annotator2</code> declares a resource dependency with key <code>someResource</code> .</p>
</div>
<div class="paragraph">
<p>Within that aggregate Analysis Engine Descriptor, the following <code>resourceManagerConfiguration</code> would bind both of those dependencies to a single external resource file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;resourceManagerConfiguration&gt;

  &lt;externalResources&gt;
    &lt;externalResource&gt;
      &lt;name&gt;ExampleResource&lt;/name&gt;
      &lt;fileResourceSpecifier&gt;
        &lt;fileUrl&gt;file:MyResourceFile.dat&lt;/fileUrl&gt;
      &lt;/fileResourceSpecifier&gt;
    &lt;/externalResource&gt;
  &lt;/externalResources&gt;

  &lt;externalResourceBindings&gt;
    &lt;externalResourceBinding&gt;
      &lt;key&gt;annotator1/myResource&lt;/key&gt;
      &lt;resourceName&gt;ExampleResource&lt;/resourceName&gt;
    &lt;/externalResourceBinding&gt;
    &lt;externalResourceBinding&gt;
      &lt;key&gt;annotator2/someResource&lt;/key&gt;
      &lt;resourceName&gt;ExampleResource&lt;/resourceName&gt;
    &lt;/externalResourceBinding&gt;
  &lt;/externalResourceBindings&gt;

&lt;/resourceManagerConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax for the <code>externalResources</code> declaration is exactly the same as described previously.
In the resource bindings note the use of the compound keys, e.g. <code>annotator1/myResource</code>.
This identifies the resource dependency key <code>myResource</code> within the annotator with key <code>annotator1</code>.
Compound resource dependencies can be multiple levels deep to handle nested aggregate analysis engines.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.aggregate.sofa_mappings"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.aggregate.sofa_mappings"></a>Sofa Mappings</h5>
<div class="paragraph">
<p>Sofa mappings are specified between Sofa names declared in this aggregate descriptor as part of the <code>&lt;capability&gt;</code> section, and the Sofa names declared in the delegate components.
For purposes of the mapping, all the declarations of Sofas in any of the capability sets contained within the <code>&lt;capabilities&gt; </code>element are considered together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;sofaMappings&gt;
  &lt;sofaMapping&gt;
    &lt;componentKey&gt;[keyName]&lt;/componentKey&gt;
    &lt;componentSofaName&gt;[sofaName]&lt;/componentSofaName&gt;
    &lt;aggregateSofaName&gt;[sofaName]&lt;/aggregateSofaName&gt;
  &lt;/sofaMapping&gt;
  ...
&lt;/sofaMappings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The &lt;componentSofaName&gt; may be omitted in the case where the component is not aware of Multiple Views or Sofas.
In this case, the UIMA framework will arrange for the specified &lt;aggregateSofaName&gt; to be the one visible to the delegate component.</p>
</div>
<div class="paragraph">
<p>The &lt;componentKey&gt; is the key name for the component as specified in the list of delegate components for this aggregate.</p>
</div>
<div class="paragraph">
<p>The sofaNames used must be declared as input or output sofas in some capability set.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.aes.configuration_parameters"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.configuration_parameters"></a>2.4.3. Configuration Parameters</h4>
<div class="paragraph">
<p>Configuration parameters may be declared and set in both Primitive and  Aggregate descriptors.
Parameters set in an aggregate may override parameters set in one or more of its delegates.</p>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.configuration_parameter_declaration"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.configuration_parameter_declaration"></a>Configuration Parameter Declaration</h5>
<div class="paragraph">
<p>Configuration Parameters are made available to annotator implementations and applications by the following interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>`AnnotatorContext`<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> (passed as an argument to the initialize() method of a version 1 annotator)</p>
</li>
<li>
<p><code>ConfigurableResource</code> (every Analysis Engine implements this interface)</p>
</li>
<li>
<p><code>UimaContext</code> (passed as an argument to the initialize() method of a version 2 annotator) (you can get this from any resource, including Analysis Engines, using the method <code>getUimaContext</code>()).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use AnnotatorContext within version 1 annotators and UimaContext for version 2 annotators and outside of annotators (for instance, in CasConsumers, or the containing application) to access configuration parameters.</p>
</div>
<div class="paragraph">
<p>Configuration parameters are set from the corresponding elements in the XML descriptor for the application.
If you need to programmatically change parameter settings within an application, you can use methods in ConfigurableResource; if you do this, you need to call reconfigure() afterwards to have the UIMA framework notify all the contained analysis components that the parameter configuration has changed (the analysis engine&#8217;s reinitialize() methods will be called). Note that in the current implementation, only integrated deployment components have configuration parameters passed to them; remote components obtain their parameters from their remote startup environment.
This will likely change in the future.</p>
</div>
<div class="paragraph">
<p>There are two ways to specify the <code>&lt;configurationParameters&gt;</code> section – as a list of configuration parameters or a list of groups.
A list of parameters, which are not part of any group, looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameters&gt;
  &lt;configurationParameter&gt;
    &lt;name&gt;[String]&lt;/name&gt;
    &lt;externalOverrideName&gt;[String]&lt;/externalOverrideName&gt;
    &lt;description&gt;[String]&lt;/description&gt;
    &lt;type&gt;String|Integer|Long|Float|Double|Boolean&lt;/type&gt;
    &lt;multiValued&gt;true|false&lt;/multiValued&gt;
    &lt;mandatory&gt;true|false&lt;/mandatory&gt;
    &lt;overrides&gt;
      &lt;parameter&gt;[String]&lt;/parameter&gt;
      &lt;parameter&gt;[String]&lt;/parameter&gt;
        ...
    &lt;/overrides&gt;
  &lt;/configurationParameter&gt;
  &lt;configurationParameter&gt;
    ...
  &lt;/configurationParameter&gt;
    ...
&lt;/configurationParameters&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each configuration parameter, the following are specified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>– the name by which the annotator code refers to the parameter. All parameters declared in an analysis engine descriptor must have distinct names. (required). The name is composed of normal Java identifier characters.</p>
</li>
<li>
<p><strong>externalOverrideName</strong>– the name of a property in an external settings file that if defined overrides any value set in this descriptor or in its parent. See <a href="#ugr.ref.xml.component_descriptor.aes.external_configuration_parameter_overrides">Section 2.4.3.4</a> for a discussion of external configuration parameter overrides. (optional)</p>
</li>
<li>
<p><strong>description</strong>– a natural language description of the intent of the parameter (optional)</p>
</li>
<li>
<p><strong>type</strong>– the data type of the parameter&#8217;s value – must be one of <code>String</code>, <code>Integer</code>, <code>Long</code>, <code>Float</code>, <code>Double</code>, or <code>Boolean</code> (required).</p>
</li>
<li>
<p><strong>multiValued</strong>–<code>true</code> if the parameter can take multiple-values (an array), <code>false</code> if the parameter takes only a single value (optional, defaults to false).</p>
</li>
<li>
<p><strong>mandatory</strong>–<code>true</code> if a value must be provided for the parameter (optional, defaults to false).</p>
</li>
<li>
<p><strong>overrides</strong>– this is used only in aggregate Analysis Engines, but is included here for completeness. See <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.configuration_parameter_overrides">Section 2.4.3.3</a> for a discussion of configuration parameter overriding in aggregate Analysis Engines. (optional).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A list of groups looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameters defaultGroup="[String]"
    searchStrategy="none|default_fallback|language_fallback" &gt;

  &lt;commonParameters&gt;
    [zero or more parameters]
  &lt;/commonParameters&gt;

  &lt;configurationGroup names="name1 name2 name3 ..."&gt;
    [zero or more parameters]
  &lt;/configurationGroup&gt;

  &lt;configurationGroup names="name4 name5 ..."&gt;
    [zero or more parameters]
  &lt;/configurationGroup&gt;

  ...

&lt;/configurationParameters&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both the<code> &lt;commonParameters&gt;</code> and <code>&lt;configurationGroup&gt;</code> elements contain zero or more <code>&lt;configurationParameter&gt;</code> elements, with the same syntax described above.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;commonParameters&gt;</code> element declares parameters that exist in all groups.
Each <code>&lt;configurationGroup&gt;</code> element has a names attribute, which contains a list of group names separated by whitespace (space or tab characters). Names consist of any number of non-whitespace characters; however the Component Descriptor Editor tool restricts this to be normal Java identifiers, including the period (.) and the dash (-). One configuration group will be created for each name, and all of the groups will contain the same set of parameters.</p>
</div>
<div class="paragraph">
<p>The <code>defaultGroup</code> attribute specifies the name of the group to be used in the case where an annotator does a lookup for a configuration parameter without specifying a group name.
It may also be used as a fallback if the annotator specifies a group that does not exist – see below.</p>
</div>
<div class="paragraph">
<p>The <code>searchStrategy</code> attribute determines the action to be taken when the context is queried for the value of a parameter belonging to a particular configuration group, if that group does not exist or does not contain a value for the requested parameter.
There are currently three possible values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none</strong>– there is no fallback; return null if there is no value in the exact group specified by the user.</p>
</li>
<li>
<p><strong>default_fallback</strong>– if there is no value found in the specified group, look in the default group (as defined by the <code>default</code> attribute)</p>
</li>
<li>
<p><strong>language_fallback</strong>– this setting allows for a specific use of configuration parameter groups where the groups names correspond to ISO language and country codes (for an example, see below). The fallback sequence is: <code>&lt;lang&gt;_&lt;country&gt;_&lt;region&gt; → &lt;lang&gt;_&lt;country&gt; → &lt;lang&gt; → &lt;default&gt;.</code></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="ugr.ref.xml.component_descriptor.aes.configuration_parameter_declaration.example"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.configuration_parameter_declaration.example"></a>Example</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameters defaultGroup="en"
        searchStrategy="language_fallback"&gt;

  &lt;commonParameters&gt;
    &lt;configurationParameter&gt;
      &lt;name&gt;DictionaryFile&lt;/name&gt;
      &lt;description&gt;Location of dictionary for this
           language&lt;/description&gt;
      &lt;type&gt;String&lt;/type&gt;
      &lt;multiValued&gt;false&lt;/multiValued&gt;
      &lt;mandatory&gt;false&lt;/mandatory&gt;
    &lt;/configurationParameter&gt;
  &lt;/commonParameters&gt;

  &lt;configurationGroup names="en de en-US"/&gt;

  &lt;configurationGroup names="zh"&gt;
    &lt;configurationParameter&gt;
      &lt;name&gt;DBC_Strategy&lt;/name&gt;
      &lt;description&gt;Strategy for dealing with double-byte
          characters.&lt;/description&gt;
      &lt;type&gt;String&lt;/type&gt;
      &lt;multiValued&gt;false&lt;/multiValued&gt;
      &lt;mandatory&gt;false&lt;/mandatory&gt;
    &lt;/configurationParameter&gt;
  &lt;/configurationGroup&gt;

&lt;/configurationParameters&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we are declaring a <code>DictionaryFile</code> parameter that can have a different value for each of the languages that our AE supports – English (general), German, U.S.
English, and Chinese.
For Chinese only, we also declare a <code>DBC_Strategy</code> parameter.</p>
</div>
<div class="paragraph">
<p>We are using the <code>language_fallback</code> search strategy, so if an annotator requests the dictionary file for the <code>en-GB</code> (British English) group, we will fall back to the more general <code>en</code> group.</p>
</div>
<div class="paragraph">
<p>Since we have defined <code>en</code> as the default group, this value will be returned if the context is queried for the <code>DictionaryFile</code> parameter without specifying any group name, or if a nonexistent group name is specified.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.aes.configuration_parameter_settings"><a class="anchor" href="#ugr.ref.aes.configuration_parameter_settings"></a>Configuration Parameter Settings</h5>
<div class="paragraph">
<p>For configuration parameters that are not part of any group, the <code>&lt;configurationParameterSettings&gt;</code> element looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameterSettings&gt;
  &lt;nameValuePair&gt;
    &lt;name&gt;[String]&lt;/name&gt;
    &lt;value&gt;
      &lt;string&gt;[String]&lt;/string&gt;  |
      &lt;integer&gt;[Integer]&lt;/integer&gt; |
      &lt;float&gt;[Float]&lt;/float&gt; |
      &lt;boolean&gt;true|false&lt;/boolean&gt;  |
      &lt;array&gt; ... &lt;/array&gt;
    &lt;/value&gt;
  &lt;/nameValuePair&gt;

  &lt;nameValuePair&gt;
    ...
  &lt;/nameValuePair&gt;
  ...
&lt;/configurationParameterSettings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are zero or more <code>nameValuePair</code> elements.
Each <code>nameValuePair</code> contains a name (which refers to one of the configuration parameters) and a value for that parameter.</p>
</div>
<div class="paragraph">
<p>The <code>value</code> element contains an element that matches the type of the parameter.
For single-valued parameters, this is either <code>&lt;string&gt;</code>, <code>&lt;integer&gt;</code> , <code>&lt;float&gt;</code>, or <code>&lt;boolean&gt;</code>.
For multi-valued parameters, this is an <code>&lt;array&gt;</code> element, which then contains zero or more instances of the appropriate type of primitive value, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;array&gt;&lt;string&gt;One&lt;/string&gt;&lt;string&gt;Two&lt;/string&gt;&lt;/array&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For parameters declared in configuration groups the <code>&lt;configurationParameterSettings&gt;</code> element looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameterSettings&gt;

  &lt;settingsForGroup name="[String]"&gt;
    [one or more &lt;nameValuePair&gt; elements]
  &lt;/settingsForGroup&gt;

  &lt;settingsForGroup name="[String]"&gt;
    [one or more &lt;nameValuePair&gt; elements]
  &lt;/settingsForGroup&gt;

...

&lt;/configurationParameterSettings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where each <code>&lt;settingsForGroup&gt;</code> element has a name that matches one of the configuration groups declared under the <code>&lt;configurationParameters&gt;</code> element and contains the parameter settings for that group.</p>
</div>
<div class="sect5">
<h6 id="ugr.ref.xml.component_descriptor.aes.configuration_parameter_settings.example"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.configuration_parameter_settings.example"></a>Example</h6>
<div class="paragraph">
<p>Here are the settings that correspond to the parameter declarations in the previous example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameterSettings&gt;

  &lt;settingsForGroup name="en"&gt;
    &lt;nameValuePair&gt;
      &lt;name&gt;DictionaryFile&lt;/name&gt;
      &lt;value&gt;&lt;string&gt;resourcesEnglishdictionary.dat&gt;&lt;/string&gt;&lt;/value&gt;
    &lt;/nameValuePair&gt;
  &lt;/settingsForGroup&gt;

  &lt;settingsForGroup name="en-US"&gt;
    &lt;nameValuePair&gt;
      &lt;name&gt;DictionaryFile&lt;/name&gt;
      &lt;value&gt;&lt;string&gt;resourcesEnglish_USdictionary.dat&lt;/string&gt;&lt;/value&gt;
    &lt;/nameValuePair&gt;
  &lt;/settingsForGroup&gt;

  &lt;settingsForGroup name="de"&gt;
    &lt;nameValuePair&gt;
      &lt;name&gt;DictionaryFile&lt;/name&gt;
      &lt;value&gt;&lt;string&gt;resourcesDeutschdictionary.dat&lt;/string&gt;&lt;/value&gt;
    &lt;/nameValuePair&gt;
  &lt;/settingsForGroup&gt;

  &lt;settingsForGroup name="zh"&gt;
    &lt;nameValuePair&gt;
      &lt;name&gt;DictionaryFile&lt;/name&gt;
      &lt;value&gt;&lt;string&gt;resourcesChinesedictionary.dat&lt;/string&gt;&lt;/value&gt;
    &lt;/nameValuePair&gt;

    &lt;nameValuePair&gt;
      &lt;name&gt;DBC_Strategy&lt;/name&gt;
      &lt;value&gt;&lt;string&gt;default&lt;/string&gt;&lt;/value&gt;
    &lt;/nameValuePair&gt;

  &lt;/settingsForGroup&gt;

&lt;/configurationParameterSettings&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.aggregate.configuration_parameter_overrides"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.aggregate.configuration_parameter_overrides"></a>Configuration Parameter Overrides</h5>
<div class="paragraph">
<p>In an aggregate Analysis Engine Descriptor, each <code>&lt;configurationParameter&gt; </code>element should contain an <code>&lt;overrides&gt;</code> element, with the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;overrides&gt;

  &lt;parameter&gt;
    [delegateAnalysisEngineKey]/[parameterName]
  &lt;/parameter&gt;

  &lt;parameter&gt;
    [delegateAnalysisEngineKey]/[parameterName]
  &lt;/parameter&gt;
  ...

&lt;/overrides&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since aggregate Analysis Engines have no code associated with them, the only way in which their configuration parameters can affect their processing is by overriding the parameter values of one or more delegate analysis engines.
The <code>&lt;overrides&gt; </code>element determines which parameters, in which delegate Analysis Engines, are overridden by this configuration parameter.</p>
</div>
<div class="paragraph">
<p>For example, consider an aggregate Analysis Engine Descriptor that contains delegate Analysis Engines with keys <code>annotator1</code> and <code>annotator2</code> (as declared in the &lt;delegateAnalysisEngine&gt; element – see <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.delegates">Section 2.4.2.1</a>) and also declares a configuration parameter as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;configurationParameter&gt;
  &lt;name&gt;AggregateParam&lt;/name&gt;
  &lt;type&gt;String&lt;/type&gt;
  &lt;overrides&gt;
    &lt;parameter&gt;annotator1/param1&lt;/parameter&gt;
    &lt;parameter&gt;annotator2/param2&lt;/parameter&gt;
  &lt;/overrides&gt;
&lt;/configurationParameter&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value of the <code>AggregateParam</code> parameter (whether assigned in the aggregate descriptor or at runtime by an application) will override the value of parameter <code>param1</code> in <code>annotator1</code> and also override the value of parameter <code>param2</code> in <code>annotator2</code>.
No other parameters will be affected.
Note that <code>AggregateParam</code> may itself be overridden by a parameter in an outer aggregate that has this aggregate as one of its delegates.</p>
</div>
<div class="paragraph">
<p>Prior to release 2.4.1, if an aggregate Analysis Engine descriptor declared a configuration parameter with no explicit overrides, that parameter would override any parameters having the same name within any delegate analysis engine.
Starting with release 2.4.1, support for this usage has been dropped.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.external_configuration_parameter_overrides"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.external_configuration_parameter_overrides"></a>External Configuration Parameter Overrides</h5>
<div class="paragraph">
<p>External parameter overrides are usually declared in primitive descriptors as a way to easily modify the parameters in some or all of an application&#8217;s annotators.
By using external settings files and shared parameter names the configuration information can be specified without regard for a particular descriptor hierachy.</p>
</div>
<div class="paragraph">
<p>Configuration parameter declarations in primitive and aggregate descriptors may include an <code>&lt;externalOverrideName&gt;</code> element,  which specifies the name of a property that may be defined in an external settings file.
If this element is present, and if a entry can be found for its name in a settings files, then this value overrides the value otherwise specified for this parameter.</p>
</div>
<div class="paragraph">
<p>The value overrides any value set in this descriptor or set by an override in a parent aggregate.
In primitive descriptors the value set by an external override is always applied.
In aggregate descriptors the value set by an external override applies to the aggregate parameter, and is passed down to the overridden delegate parameters in the usual way, i.e.
only if the delegate&#8217;s parameter has not been set by an external override.</p>
</div>
<div class="paragraph">
<p>Im the absence of external overrides,             parameter evaluation can be viewed as proceeding from the primitive descriptor up through any aggregates containing overrides, taking the last setting found.
With external overrides the search ends with the first external override found that has a value assigned by a settings file.</p>
</div>
<div class="paragraph">
<p>The same external name may be used for multiple parameters;  the effect of this is that one setting will override multiple parameters.</p>
</div>
<div class="paragraph">
<p>The settings for all descriptors in a pipeline are usually loaded from one or more files whose names are obtained from the Java system property <em>UimaExternalOverrides</em>.
The value of the property must be a comma-separated list of resource names.
If the name has a prefix of "file:" or no prefix, the filesystem is searched.
If the name has a prefix of "path:" the rest must be a Java-style dotted name, similar to the name attribute for descriptor imports.
The dots are replaced by file separators and a suffix of ".settings" is appended before searching the datapath and classpath.
e.g. <code>-DUimaExternalOverrides=/data/file1.settings,file:relative/file2.settings,path:org.apache.uima.resources.file3</code>.</p>
</div>
<div class="paragraph">
<p>Override settings may also be specified when creating an analysis engine by putting a <code>Settings</code> object in the additional parameters map for the <code>produceAnalysisEngine</code> method.
In this case the Java system property <em>UimaExternalOverrides</em> is ignored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  // Construct an analysis engine that uses two settings files
  Settings extSettings =
      UIMAFramework.getResourceSpecifierFactory().createSettings();
  for (String fname : new String[] { "externalOverride.settings",
                                     "default.settings" }) {
    FileInputStream fis = new FileInputStream(fname);
    extSettings.load(fis);
    fis.close();
  }
  Map&lt;String,Object&gt; aeParms = new HashMap&lt;String,Object&gt;();
  aeParms.put(Resource.PARAM_EXTERNAL_OVERRIDE_SETTINGS, extSettings);
  AnalysisEngine ae = UIMAFramework.produceAnalysisEngine(desc, aeParms);</code></pre>
</div>
</div>
<div class="paragraph">
<p>These external settings consist of key - value pairs stored in a  file using the UTF-8 character encoding, and written in a style similar to that  of Java properties files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Leading whitespace is ignored.</p>
</li>
<li>
<p>Comment lines start with '#' or '!'.</p>
</li>
<li>
<p>The key and value are separated by whitespace, '=' or ':'.</p>
</li>
<li>
<p>Keys must contain at least one character and only letters, digits, or the characters '. / - ~ _'.</p>
</li>
<li>
<p>If a line ends with '\' it is extended with the following line (after removing any leading whitespace.)</p>
</li>
<li>
<p>Whitespace is trimmed from both keys and values.</p>
</li>
<li>
<p>Duplicate key values are ignored –once a value is assigned to a key it cannot be changed.</p>
</li>
<li>
<p>Values may reference other settings using the syntax '${key}'.</p>
</li>
<li>
<p>Array values are represented as a list of strings separated by commas or line breaks, and bracketed by the '[ ]' characters. The value must start with an '[' and is terminated by the first unescaped ']' which must be at the end of a line. The elements of an array (and hence the array size) may be indirectly specified using the '${key}' syntax but the brackets '[ ]' must be explicitly specified.</p>
</li>
<li>
<p>In values the special characters '$ { } [ , ] \' are treated as regular characters if preceeded by the escape character '\'.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>key1  :  value1
 key2 =  value  2
  key3   element2, element3, element4
 # Next assignment is ignored as key3 has already been set
key3  :   value ignored
key4  =  [ array element1, ${key3}, element5
           element6 ]
key5     value with a reference ${key1} to key1
key6  :  long value string \
         continued from previous line (with leading whitespace stripped)
key7  =  value without a reference \${not-a-key}
key8     \[ value that is not an array ]
key9  :  [ array element1\, with embedded comma, element2 ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple settings files are allowed; they are loaded in order, such that early ones take precedence over later ones, following the first-assignment-wins rule.
So, if you have lots of settings, you can put the defaults in one file, and then in a earlier file, override just the ones you need to.</p>
</div>
<div class="paragraph">
<p>An external override name may be specified for a parameter declared in a group, but if the parameter is in the common group or the group is declared with multiple names, the external name is shared amongst all, i.e.
these parameters cannot be given group-specific values.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.external_configuration_parameter_access"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.external_configuration_parameter_access"></a>Direct Access to External Configuration Parameters</h5>
<div class="paragraph">
<p>Annotators and flow controllers can directly access these shared configuration parameters from their UimaContext.
Direct access means an access where the key to select the shared parameter is the  parameter name as specified in the external configuration settings file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>String value = aContext.getSharedSettingValue(paramName);
String values[] = aContext.getSharedSettingArray(arrayParamName);
String allNames[] = aContext.getSharedSettingNames();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java code called by an annotator or flow controller in the same thread or a child thread can use the <code>UimaContextHolder</code> to get the annotator&#8217;s UimaContext and hence access the shared configuration parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>UimaContext uimaContext = UimaContextHolder.getUimaContext();
if (uimaContext != null) {
  value = uimaContext.getSharedSettingValue(paramName);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The UIMA framework puts the context in an InheritableThreadLocal variable.
The value will be null if <code>getUimaContext</code> is not invoked by an annotator or flow controller on the same thread or a child thread.</p>
</div>
<div class="paragraph">
<p>Since UIMA 3.2.1, the context is stored in the InheritableThreadLocal as a weak reference.
This ensures that any long-running threads spawned while the context is set do not  prevent garbage-collection of the context when the context is destroyed.
If a child thread should really retain a strong reference to the context, it should obtain the context and store it in a field or in another ThreadLocal variable.
For backwards compatibility, the old behavior of using a strong reference by default can be enabled by setting the system property <code>uima.context_holder_reference_type</code> to <code>STRONG</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.xml.component_descriptor.aes.other_uses_for_external_configuration_parameters"><a class="anchor" href="#ugr.ref.xml.component_descriptor.aes.other_uses_for_external_configuration_parameters"></a>Other Uses for External Configuration Parameters</h5>
<div class="paragraph">
<p>Explicit references to shared configuration parameters can be specified as part of the value of the name and location attributes of the <code>import</code> element and in the value of the fileUrl for a <code>fileResourceSpecifier</code>			(see <a href="#ugr.ref.xml.component_descriptor.imports">Section 2.2</a> and <a href="#ugr.ref.xml.component_descriptor.aes.primitive.resource_manager_configuration">Section 2.4.1.9</a>).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.component_descriptor.flow_controller"><a class="anchor" href="#ugr.ref.xml.component_descriptor.flow_controller"></a>2.5. Flow Controller Descriptors</h3>
<div class="paragraph">
<p>The basic structure of a Flow Controller Descriptor is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" ?&gt;
&lt;flowControllerDescription
    xmlns="http://uima.apache.org/resourceSpecifier"&gt;

  &lt;frameworkImplementation&gt;org.apache.uima.java&lt;/frameworkImplementation&gt;

  &lt;implementationName&gt;[ClassName]&lt;/implementationName&gt;

  &lt;processingResourceMetaData&gt;
    ...
  &lt;/processingResourceMetaData&gt;

  &lt;externalResourceDependencies&gt;
    ...
  &lt;/externalResourceDependencies&gt;

  &lt;resourceManagerConfiguration&gt;
    ...
  &lt;/resourceManagerConfiguration&gt;

&lt;/flowControllerDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>frameworkImplementation</code> element must always be set to the value <code>org.apache.uima.java</code>.</p>
</div>
<div class="paragraph">
<p>The <code>implementationName</code> element must contain the fully-qualified class name of the Flow Controller implementation.
This must name a class that implements the <code>FlowController</code> interface.</p>
</div>
<div class="paragraph">
<p>The <code>processingResourceMetaData</code> element contains essentially the same information as a Primitive Analysis Engine Descriptor&#8217;s <code>analysisEngineMetaData</code> element, described in <a href="#ugr.ref.xml.component_descriptor.aes.metadata">Section 2.4.1.2</a>.</p>
</div>
<div class="paragraph">
<p>The <code>externalResourceDependencies</code> and <code>resourceManagerConfiguration</code> elements are exactly the same as in Primitive Analysis Engine Descriptors (see <a href="#ugr.ref.xml.component_descriptor.aes.primitive.external_resource_dependencies">Section 2.4.1.8</a> and <a href="#ugr.ref.xml.component_descriptor.aes.primitive.resource_manager_configuration">Section 2.4.1.9</a>).</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.component_descriptor.collection_processing_parts"><a class="anchor" href="#ugr.ref.xml.component_descriptor.collection_processing_parts"></a>2.6. Collection Processing Component Descriptors</h3>
<div class="paragraph">
<p>There are three types of Collection Processing Components –Collection Readers, CAS Initializers (deprecated as of UIMA Version 2), and CAS Consumers.
Each type of component has a corresponding descriptor.
The structure of these descriptors is very similar to that of primitive Analysis Engine Descriptors.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.collection_processing_parts.collection_reader"><a class="anchor" href="#ugr.ref.xml.component_descriptor.collection_processing_parts.collection_reader"></a>2.6.1. Collection Reader Descriptors</h4>
<div class="paragraph">
<p>The basic structure of a Collection Reader descriptor is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" ?&gt;
&lt;collectionReaderDescription
    xmlns="http://uima.apache.org/resourceSpecifier"&gt;

  &lt;frameworkImplementation&gt;org.apache.uima.java&lt;/frameworkImplementation&gt;
  &lt;implementationName&gt;[ClassName]&lt;/implementationName&gt;

  &lt;processingResourceMetaData&gt;
    ...
  &lt;/processingResourceMetaData&gt;

  &lt;externalResourceDependencies&gt;
   ...
  &lt;/externalResourceDependencies&gt;

  &lt;resourceManagerConfiguration&gt;

   ...

  &lt;/resourceManagerConfiguration&gt;

&lt;/collectionReaderDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>frameworkImplementation</code> element must always be set to the value <code>org.apache.uima.java</code>.</p>
</div>
<div class="paragraph">
<p>The <code>implementationName</code> element contains the fully-qualified class name of the Collection Reader implementation.
This must name a class that implements the <code>CollectionReader</code> interface.</p>
</div>
<div class="paragraph">
<p>The <code>processingResourceMetaData</code> element contains essentially the same information as a Primitive Analysis Engine Descriptor&#8217;s' <code>analysisEngineMetaData</code> element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;processingResourceMetaData&gt;

  &lt;name&gt; [String] &lt;/name&gt;
  &lt;description&gt;[String]&lt;/description&gt;
  &lt;version&gt;[String]&lt;/version&gt;
  &lt;vendor&gt;[String]&lt;/vendor&gt;

  &lt;configurationParameters&gt;
     ...
  &lt;/configurationParameters&gt;

  &lt;configurationParameterSettings&gt;
    ...
  &lt;/configurationParameterSettings&gt;

  &lt;typeSystemDescription&gt;
   ...
  &lt;/typeSystemDescription&gt;

  &lt;typePriorities&gt;
   ...
  &lt;/typePriorities&gt;

  &lt;fsIndexes&gt;
   ...
  &lt;/fsIndexes&gt;

  &lt;capabilities&gt;
   ...
  &lt;/capabilities&gt;

&lt;/processingResourceMetaData&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The contents of these elements are the same as that described in <a href="#ugr.ref.xml.component_descriptor.aes.metadata">Section 2.4.1.2</a>, with the exception that the capabilities section should not declare any inputs (because the Collection Reader is always the first component to receive the CAS).</p>
</div>
<div class="paragraph">
<p>The <code>externalResourceDependencies</code> and <code>resourceManagerConfiguration</code> elements are exactly the same as in the Primitive Analysis Engine Descriptors (see <a href="#ugr.ref.xml.component_descriptor.aes.primitive.external_resource_dependencies">Section 2.4.1.8</a> and <a href="#ugr.ref.xml.component_descriptor.aes.primitive.resource_manager_configuration">Section 2.4.1.9</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.collection_processing_parts.cas_initializer"><a class="anchor" href="#ugr.ref.xml.component_descriptor.collection_processing_parts.cas_initializer"></a>2.6.2. CAS Initializer Descriptors (deprecated)</h4>
<div class="paragraph">
<p>The basic structure of a CAS Initializer Descriptor is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;casInitializerDescription
    xmlns="http://uima.apache.org/resourceSpecifier"&gt;

  &lt;frameworkImplementation&gt;org.apache.uima.java&lt;/frameworkImplementation&gt;
  &lt;implementationName&gt;[ClassName] &lt;/implementationName&gt;

  &lt;processingResourceMetaData&gt;
    ...
  &lt;/processingResourceMetaData&gt;

  &lt;externalResourceDependencies&gt;
    ...
  &lt;/externalResourceDependencies&gt;

  &lt;resourceManagerConfiguration&gt;
    ...
  &lt;/resourceManagerConfiguration&gt;

&lt;/casInitializerDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>frameworkImplementation</code> element must always be set to the value <code>org.apache.uima.java</code>.</p>
</div>
<div class="paragraph">
<p>The <code>implementationName</code> element contains the fully-qualified class name of the CAS Initializer implementation.
This must name a class that implements the <code>CasInitializer</code> interface.</p>
</div>
<div class="paragraph">
<p>The <code>processingResourceMetaData</code> element contains essentially the same information as a Primitive Analysis Engine Descriptor&#8217;s' <code>analysisEngineMetaData</code> element, as described in <a href="#ugr.ref.xml.component_descriptor.aes.metadata">Section 2.4.1.2</a>, with the exception of some changes to the capabilities section.
A CAS Initializer&#8217;s capabilities element looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;capabilities&gt;
  &lt;capability&gt;
    &lt;outputs&gt;
      &lt;type allAnnotatorFeatures="true|false"&gt;[String]&lt;/type&gt;
      &lt;type&gt;[TypeName]&lt;/type&gt;
      ...
      &lt;feature&gt;[TypeName]:[Name]&lt;/feature&gt;
      ...
    &lt;/outputs&gt;

    &lt;outputSofas&gt;
      &lt;sofaName&gt;[name]&lt;/sofaName&gt;
      ...
    &lt;/outputSofas&gt;

    &lt;mimeTypesSupported&gt;
      &lt;mimeType&gt;[MIME Type]&lt;/mimeType&gt;
      ...
    &lt;/mimeTypesSupported&gt;
  &lt;/capability&gt;

  &lt;capability&gt;
    ...
  &lt;/capability&gt;
  ...
&lt;/capabilities&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The differences between a CAS Initializer&#8217;s capabilities declaration and an Analysis Engine&#8217;s capabilities declaration are that the CAS Initializer does not declare any input CAS types and features or input Sofas (because it is always the first to operate on a CAS), it doesn&#8217;t have a language specifier, and that the CAS Initializer may declare a set of MIME types that it supports for its input documents.
Examples include: text/plain, text/html, and application/pdf.
For a list of MIME types see <a href="http://www.iana.org/assignments/media-types/" class="bare">http://www.iana.org/assignments/media-types/</a>.
This information is currently only for users' information, the framework does not use it for anything.
This may change in future versions.</p>
</div>
<div class="paragraph">
<p>The <code>externalResourceDependencies</code> and <code>resourceManagerConfiguration</code> elements are exactly the same as in the Primitive Analysis Engine Descriptors (see <a href="#ugr.ref.xml.component_descriptor.aes.primitive.external_resource_dependencies">Section 2.4.1.8</a> and <a href="#ugr.ref.xml.component_descriptor.aes.primitive.resource_manager_configuration">Section 2.4.1.9</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.xml.component_descriptor.collection_processing_parts.cas_consumer"><a class="anchor" href="#ugr.ref.xml.component_descriptor.collection_processing_parts.cas_consumer"></a>2.6.3. CAS Consumer Descriptors</h4>
<div class="paragraph">
<p>The basic structure of a CAS Consumer Descriptor is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;casConsumerDescription
    xmlns="http://uima.apache.org/resourceSpecifier"&gt;

  &lt;frameworkImplementation&gt;org.apache.uima.java&lt;/frameworkImplementation&gt;

  &lt;implementationName&gt;[ClassName]&lt;/implementationName&gt;

  &lt;processingResourceMetaData&gt;
    ...
  &lt;/processingResourceMetaData&gt;

  &lt;externalResourceDependencies&gt;
    ...
  &lt;/externalResourceDependencies&gt;

  &lt;resourceManagerConfiguration&gt;
    ...
  &lt;/resourceManagerConfiguration&gt;
&lt;/casConsumerDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>frameworkImplementation</code> element currently must  have the value <code>org.apache.uima.java</code>, or <code>org.apache.uima.cpp</code>.</p>
</div>
<div class="paragraph">
<p>The next subelement,<code>
          &lt;annotatorImplementationName&gt;</code> is how the UIMA framework determines which annotator class to use.
This should contain a fully-qualified Java class name for Java implementations, or the name of a .dll or .so file for C++ implementations.</p>
</div>
<div class="paragraph">
<p>The <code>frameworkImplementation</code> element must always be set to the value <code>org.apache.uima.java</code>.</p>
</div>
<div class="paragraph">
<p>The <code>implementationName</code> element must contain the fully-qualified class name of the CAS Consumer implementation, or the name  of a .dll or .so file for C++ implementations.
For Java, the named class must implement the <code>CasConsumer</code> interface.</p>
</div>
<div class="paragraph">
<p>The <code>processingResourceMetaData</code> element contains essentially the same information as a Primitive Analysis Engine Descriptor&#8217;s <code>analysisEngineMetaData</code> element, described in <a href="#ugr.ref.xml.component_descriptor.aes.metadata">Section 2.4.1.2</a>, except that the CAS Consumer Descriptor&#8217;s <code>capabilities</code> element should not declare outputs or outputSofas (since CAS Consumers do not modify the CAS).</p>
</div>
<div class="paragraph">
<p>The <code>externalResourceDependencies</code> and <code>resourceManagerConfiguration</code> elements are exactly the same as in Primitive Analysis Engine Descriptors (see <a href="#ugr.ref.xml.component_descriptor.aes.primitive.external_resource_dependencies">Section 2.4.1.8</a> and <a href="#ugr.ref.xml.component_descriptor.aes.primitive.resource_manager_configuration">Section 2.4.1.9</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.component_descriptor.service_client"><a class="anchor" href="#ugr.ref.xml.component_descriptor.service_client"></a>2.7. Service Client Descriptors</h3>
<div class="paragraph">
<p>Service Client Descriptors specify only a location of a remote service.
They are therefore much simpler in structure.
In the UIMA SDK, a Service Client Descriptor that refers to a valid Analysis Engine or CAS Consumer service can be used in place of the actual Analysis Engine or CAS Consumer Descriptor.
The UIMA SDK will handle the details of calling the remote service.
(For details on <em>deploying</em> an Analysis Engine or CAS Consumer as a service, see <a href="tug.html#ugr.tug.application.remote_services">Working with Remote Services</a>.</p>
</div>
<div class="paragraph">
<p>The UIMA SDK is extensible to support different types of remote services.
In future versions, there may be different variations of service client descriptors that cater to different types of services.
For now, the only type of service client descriptor is the <code>uriSpecifier</code>, which supports the Vinci protocol.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;uriSpecifier xmlns="http://uima.apache.org/resourceSpecifier"&gt;
  &lt;resourceType&gt;AnalysisEngine | CasConsumer &lt;/resourceType&gt;
  &lt;uri&gt;[URI]&lt;/uri&gt;
  &lt;protocol&gt;Vinci&lt;/protocol&gt;
  &lt;timeout&gt;[Integer]&lt;/timeout&gt;
  &lt;parameters&gt;
    &lt;parameter name="VNS_HOST" value="some.internet.ip.name-or-address"/&gt;
    &lt;parameter name="VNS_PORT" value="9000"/&gt;
    &lt;parameter name="GetMetaDataTimeout" value="[Integer]"/&gt;
  &lt;/parameters&gt;
&lt;/uriSpecifier&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>resourceType</code> element is required for new descriptors, but is currently allowed to be omitted for backward compatibility.
It specifies the type of component (Analysis Engine or CAS Consumer) that is implemented by the service endpoint described by this descriptor.</p>
</div>
<div class="paragraph">
<p>The <code>uri</code> element contains the URI for the web service.
(Note that in the case of Vinci, this will be the service name, which is looked up in the Vinci Naming Service.)</p>
</div>
<div class="paragraph">
<p>The <code>protocol</code> element may be set to Vinci; other protocols may be added later.
These specify the particular data transport format that will be used.</p>
</div>
<div class="paragraph">
<p>The <code>timeout</code> element is optional.
If present, it specifies the number of milliseconds to wait for a request to be processed before an exception is thrown.
A value of zero or less will wait forever.
If no timeout is specified, a default value (currently 60 seconds) will be used.</p>
</div>
<div class="paragraph">
<p>The parameters element is optional.
If present, it can specify values for each of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VNS_HOST</code>: host name for the Vinci naming service.</p>
</li>
<li>
<p><code>VNS_PORT</code>: port number for the Vinci naming service.</p>
</li>
<li>
<p><code>GetMetaDataTimeout</code>: timeout period (in milliseconds) for the GetMetaData call. If not specified, the default is 60 seconds. This may need to be set higher if there are a lot of clients competing for connections to the service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the <code>VNS_HOST</code> and <code>VNS_PORT</code> are not specified in the descriptor, the values used for these comes from parameters passed on the Java command line using the <code>-DVNS_HOST=&lt;host&gt;</code> and/or <code>-DVNS_PORT=&lt;port&gt;</code> system arguments.
If not present, and a system argument is also not present, the values for these default to <code>localhost</code> for the <code>VNS_HOST</code> and <code>9000</code> for the <code>VNS_PORT</code>.</p>
</div>
<div class="paragraph">
<p>For details on how to deploy and call Analysis Engine and CAS Consumer services, see <a href="tug.html#ugr.tug.application.remote_services">Working with Remote Services</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.component_descriptor.custom_resource_specifiers"><a class="anchor" href="#ugr.ref.xml.component_descriptor.custom_resource_specifiers"></a>2.8. Custom Resource Specifiers</h3>
<div class="paragraph">
<p>A Custom Resource Specifier allows you to plug in your own Java class as a UIMA Resource.
For example you can support a new service protocol by plugging in a Java class that implements the UIMA <code>AnalysisEngine</code> interface and communicates with the remote service.</p>
</div>
<div class="paragraph">
<p>A Custom Resource Specifier has the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;customResourceSpecifier xmlns="http://uima.apache.org/resourceSpecifier"&gt;
  &lt;resourceClassName&gt;[Java Class Name]&lt;/resourceClassName&gt;
  &lt;parameters&gt;
    &lt;parameter name="[String]" value="[String]"/&gt;
    &lt;parameter name="[String]" value="[String]"/&gt;
  &lt;/parameters&gt;
&lt;/customResourceSpecifier&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>resourceClassName</code> element must contain the fully-qualified name of a Java class that can be found in the classpath (including the UIMA extension classpath, if you have specified one using the <code>ResourceManager.setExtensionClassPath</code> method).  This class must implement the UIMA <code>Resource</code> interface.</p>
</div>
<div class="paragraph">
<p>When an application calls the <code>UIMAFramework.produceResource</code> method and passes a <code>CustomResourceSpecifier</code>, the UIMA framework will load the named class and call its <code>initialize(ResourceSpecifier,Map)</code> method, passing the <code>CustomResourceSpecifier</code>	as the first argument.
Your class can override the <code>initialize</code> method and use the <code>CustomResourceSpecifier</code> API to get access to the <code>parameter</code> names and values  specified in the XML.</p>
</div>
<div class="paragraph">
<p>If you are using a custom resource specifier to plug in a class that implements a new service protocol, your class must also implement the <code>AnalysisEngine</code> interface.
Generally it should also extend <code>AnalysisEngineImplBase</code>.
The key methods that should be implemented are <code>getMetaData</code>, <code>processAndOutputNewCASes</code>, <code>collectionProcessComplete</code>, and <code>destroy</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.xml.cpe_descriptor"><a class="anchor" href="#ugr.ref.xml.cpe_descriptor"></a>3. Collection Processing Engine Descriptor Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A UIMA <em>Collection Processing Engine</em> (CPE) is a combination of UIMA components assembled to analyze a collection of artifacts.
A CPE is an instantiation of the UIMA <em>Collection Processing Architecture</em>, which defines the collection processing components, interfaces, and APIs.
A CPE is executed by a UIMA framework component called the <em>Collection Processing Manager</em> (CPM), which provides a number of services for deploying CPEs, running CPEs, and handling errors.</p>
</div>
<div class="paragraph">
<p>A CPE can be assembled programmatically within a Java application, or it can be assembled declaratively via a CPE configuration specification, called a CPE Descriptor.
This chapter describes the format of the CPE Descriptor.</p>
</div>
<div class="paragraph">
<p>Details about the CPE, including its function, sub-components, APIs, and related tools, can be found in <a href="tug.html#ugr.tools.cpe">Collection Processing Engine Developer&#8217;s Guide</a>.
Here we briefly summarize the CPE to define terms and provide context for the later sections that describe the CPE Descriptor.</p>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.cpe_descriptor.overview"><a class="anchor" href="#ugr.ref.xml.cpe_descriptor.overview"></a>3.1. CPE Overview</h3>
<div id="ugr.ref.xml.cpe_descriptor.overview.fig.runtime" class="imageblock">
<div class="content">
<img src="./ref/images/references/ref.xml.cpe_descriptor/image002.png" alt="CPE Runtime Overview diagram">
</div>
<div class="title">Figure 1. CPE Runtime Overview</div>
</div>
<div class="paragraph">
<p>An illustration of the CPE runtime is shown in <a href="#ugr.ref.xml.cpe_descriptor.overview.fig.runtime">Figure 1</a>.
Some of the CPE components, such as the <em>queues</em> and <em>processing pipelines</em>, are internal to the CPE, but their behavior and deployment may be configured using the CPE Descriptor.
Other CPE components, such as the <em>Collection Reader</em> and <em>CAS Processors</em>, are defined and configured externally from the CPE and then plugged in to the CPE to create the overall engine.
The parts of a CPE are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Collection Reader</dt>
<dd>
<p>understands the native data collection format and iterates over the collection producing subjects of analysis</p>
</dd>
<dt class="hdlist1">CAS Initializer<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></dt>
<dd>
<p>initializes a CAS with a subject of analysis</p>
</dd>
<dt class="hdlist1">Artifact Producer</dt>
<dd>
<p>asynchronously pulls CASes from the Collection Reader, creates batches of CASes and puts them into the work queue</p>
</dd>
<dt class="hdlist1">Work Queue</dt>
<dd>
<p>shared queue containing batches of CASes queued by the Artifact Producer for analysis by Analysis Engines</p>
</dd>
<dt class="hdlist1">B1-Bn</dt>
<dd>
<p>individual batches containing 1 or more CASes</p>
</dd>
<dt class="hdlist1">AE1-AEn</dt>
<dd>
<p>Analysis Engines arranged by a CPE descriptor</p>
</dd>
<dt class="hdlist1">Processing Pipelines</dt>
<dd>
<p>each pipeline runs in a separate thread and contains a replicated set of the Analysis Engines running in the defined sequence</p>
</dd>
<dt class="hdlist1">Output Queue</dt>
<dd>
<p>holds batches of CASes with analysis results intended for CAS Consumers</p>
</dd>
<dt class="hdlist1">CAS Consumers</dt>
<dd>
<p>perform collection level analysis over the CASes and extract analysis results, e.g., creating indexes or databases</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.cpe_descriptor.notation"><a class="anchor" href="#ugr.ref.xml.cpe_descriptor.notation"></a>3.2. Notation</h3>
<div class="paragraph">
<p>CPE Descriptors are XML files.
This chapter uses an informal notation to specify the syntax of CPE Descriptors.</p>
</div>
<div class="paragraph">
<p>The notation used in this chapter is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An ellipsis (&#8230;&#8203;) inside an element body indicates that the substructure of that element has been omitted (to be described in another section of this chapter). An example of this would be:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;collectionReader&gt;
...
&lt;/collectionReader&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>An ellipsis immediately after an element indicates that the element type may be repeated arbitrarily many times. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;parameter&gt;[String]&lt;/parameter&gt;
&lt;parameter&gt;[String]&lt;/parameter&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>indicates that there may be arbitrarily many parameter elements in this context.</p>
</div>
</li>
<li>
<p>An ellipsis inside an element means details of the attributes associated with that element are defined later, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;casProcessor ...&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Bracketed expressions (e.g. <code>[String]</code>) indicate the type of value that may be used at that location.</p>
</li>
<li>
<p>A vertical bar, as in <code>true|false</code>, indicates alternatives. This can be applied to literal values, bracketed type names, and elements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Which elements are optional and which are required is specified in prose, not in the syntax definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.cpe_descriptor.imports"><a class="anchor" href="#ugr.ref.xml.cpe_descriptor.imports"></a>3.3. Imports</h3>
<div class="paragraph">
<p>As of version 2.2, a CPE Descriptor can use the same <code>import</code> mechanism as other component descriptors.
This allows referring to <a href="#ugr.ref.xml.component_descriptor">component descriptors</a> using either relative paths (resolved relative to the location of the CPE descriptor) or the classpath/datapath.</p>
</div>
<div class="paragraph">
<p>The follwing older syntax is still supported, but <em>not recommended</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;descriptor&gt;
    &lt;include href="[URL or File]"/&gt;
&lt;/descriptor&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>[URL or File]</code> attribute is a URL or a filename for the descriptor of the incorporated component.
The argument is first attempted to be resolved as a URL.</p>
</div>
<div class="paragraph">
<p>Relative paths in an <code>include</code> are resolved relative to the current working directory  (NOT the CPE descriptor location as is the case for <code>import</code>).  A filename relative to another directory can be specified using the <code>CPM_HOME</code> variable, e.g.,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;descriptor&gt;
    &lt;include href="${CPM_HOME}/desc_dir/descriptor.xml"/&gt;
&lt;/descriptor&gt;
---- In this case, the value for the `CPM_HOME` variable must be provided to the CPE by specifying it on the Java command line, e.g.,
[source]</code></pre>
</div>
</div>
<div class="paragraph">
<p>java -DCPM_HOME="C:/Program Files/apache/uima/cpm" &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[[ugr.ref.xml.cpe_descriptor.descriptor]]
== CPE Descriptor Overview

A CPE Descriptor consists of information describing the following four main elements.

. The __Collection Reader__, which is responsible for gathering artifacts and initializing the Common Analysis Structure (CAS) used to support processing in the UIMA collection processing engine.
. The __CAS Processors__, responsible for analyzing individual artifacts, analyzing across artifacts, and extracting analysis results. CAS Processors include _Analysis Engines_ and __CAS Consumers__.
. Operational parameters of the _Collection Processing Manager_ (CPM), such as checkpoint frequency and deployment mode.
. Resource Manager Configuration (optional).

The CPE Descriptor has the following high level skeleton:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0"?&gt;
&lt;cpeDescription&gt;
   &lt;collectionReader&gt;
&#8230;&#8203;
   &lt;/collectionReader&gt;
   &lt;casProcessors&gt;
&#8230;&#8203;
   &lt;/casProcessors&gt;
   &lt;cpeConfig&gt;
&#8230;&#8203;
   &lt;/cpeConfig&gt;
   &lt;resourceManagerConfiguration&gt;
&#8230;&#8203;
   &lt;/resourceManagerConfiguration&gt;
&lt;/cpeDescription&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Details of each of the four main elements are described in the sections that follow.

[[ugr.ref.xml.cpe_descriptor.descriptor.collection_reader]]
== Collection Reader

The `&lt;collectionReader&gt;` section identifies the Collection Reader and optional CAS Initializer that are to be used in the CPE.
The Collection Reader is responsible for retrieval of artifacts from a collection outside of the CPE, and the optional CAS Initializer (deprecated as of UIMA Version 2) is responsible for initializing the CAS with the artifact.

A Collection Reader may initialize the CAS itself, in which case it does not require a CAS Initializer.
This should be clearly specified in the documentation for the Collection Reader.
Specifying a CAS Initializer for a Collection Reader that does not make use of a CAS Initializer will not cause an error, but the specified CAS Initializer will not be used.

The complete structure of the `&lt;collectionReader&gt;` section is:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;collectionReader&gt;
  &lt;collectionIterator&gt;
    &lt;descriptor&gt;
      &lt;import &#8230;&#8203;&gt; | &lt;include &#8230;&#8203;/&gt;
    &lt;/descriptor&gt;
    &lt;configurationParameterSettings&gt;&#8230;&#8203;&lt;/configurationParameterSettings&gt;
    &lt;sofaNameMappings&gt;&#8230;&#8203;&lt;/sofaNameMappings&gt;
  &lt;/collectionIterator&gt;
&lt;/collectionReader&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The `&lt;collectionIterator&gt;` identifies the descriptor for the xref:ref.adoc#ugr.ref.xml.component_descriptor.collection_processing_parts.collection_reader[Collection Reader].
The `&lt;configurationParameterSettings&gt;` and the `&lt;sofaNameMappings&gt;` elements are described in the next section.

[[ugr.ref.xml.cpe_descriptor.descriptor.collection_reader.error_handling]]
=== Error handling for Collection Readers

The CPM will abort if the Collection Reader throws a large number of consecutive exceptions (default = 100). This default can by changed by using the Java initialization parameter `-DMaxCRErrorThreshold=xxx.`

[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors]]
== CAS Processors

The `&lt;casProcessors&gt;` section identifies the components that perform the analysis on the input data, including CAS analysis (Analysis Engines) and analysis results extraction (CAS Consumers). The CAS Consumers may also perform collection level analysis, where the analysis is performed (or aggregated) over multiple CASes.
The basic structure of the CAS Processors section is:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;casProcessors
    dropCasOnException="true|false"
    casPoolSize="[Number]"
    processingUnitThreadCount="[Number]"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;casProcessor ...&gt;
      ...
&lt;/casProcessor&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>  &lt;casProcessor ...&gt;
        ...
  &lt;/casProcessor&gt;
    ...
&lt;/casProcessors&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>The `&lt;casProcessors&gt;` section has two mandatory attributes and one optional attribute that configure the characteristics of the CAS Processor flow in the CPE.
The first mandatory attribute is a casPoolSize, which defines the fixed number of CAS instances that the CPM will create and use during processing.
All CAS instances are maintained in a CAS Pool with a check-in and check-out access.
Each CAS is checked-out from the CAS Pool by the Collection Reader and initialized with an initial subject of analysis.
The CAS is checked-in into the CAS Pool when it is completely processed, at the end of the processing chain.
A larger CAS Pool size will result in more memory being used by the CPM.
CAS objects can be large and care should be taken to determine the optimum size of the CAS Pool, weighing memory tradeoffs with performance.

The second mandatory `&lt;casProcessors&gt;` attribute is ``processingUnitThreadCount``, which specifies the number of replicated __Processing Pipelines__.
Each Processing Pipeline runs in its own thread.
The CPM takes CASes from the work queue and submits each CAS to one of the Processing Pipelines for analysis.
A Processing Pipeline contains one or more Analysis Engines invoked in a given sequence.
If more than one Processing Pipeline is specified, the CPM replicates instances of each Analysis Engine defined in the CPE descriptor.
Each Processing Pipeline thread runs independently, consuming CASes from work queue and depositing CASes with analysis results onto the output queue.
On multiprocessor machines, multiple Processing Pipelines can run in parallel, improving overall throughput of the CPM.

[NOTE]
====
The number of Processing Pipelines should be equal to or greater than CAS Pool size.
====

Elements in the pipeline (each represented by a &lt;casProcessor&gt; element) may indicate that they do not permit multiple deployment in their Analysis Engine descriptor.
If so, even though multiple pipelines are being used, all CASes passing through the pipelines will be routed through one instance of these marked Engines.

The final, optional, &lt;casProcessors&gt; attribute is ``dropCasOnException``.
It defines a policy that determines what happens with the CAS when an exception happens during processing.
If the value of this attribute is set to true and an exception happens, the CPM will notify all see xref:tug.adoc#ugr.tug.cpe.using_listeners[registered listeners] of the exception, clear the CAS and check the CAS back into the CAS Pool so that it can be re-used.
The presumption is that an exception may leave the CAS in an inconsistent state and therefore that CAS should not be allowed to move through the processing chain.
When this attribute is omitted the CPM's default is the same as specifying `dropCasOnException="false"`.

[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual]]
=== Specifying an Individual CAS Processor

The CAS Processors that make up the Processing Pipeline and the CAS Consumer pipeline are specified with the `&lt;casProcessor&gt;` entity, which appears within the `&lt;casProcessors&gt;` entity.
It may appear multiple times, once for each CAS Processor specified for this CPE.

The order of the `&lt;casProcessor&gt;` entities with the `&lt;casProcessors&gt;` section specifies the order in which the CAS Processors will run.
Although CAS Consumers are usually put at the end of the pipeline, they need not be.
Also, Aggregate Analysis Engines may include CAS Consumers.

The overall format of the `&lt;casProcessor&gt;` entity is:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;casProcessor deployment="local|remote|integrated" name="[String]" &gt;
    &lt;descriptor&gt;
      &lt;import &#8230;&#8203;&gt; | &lt;include &#8230;&#8203;/&gt;
    &lt;/descriptor&gt;
    &lt;configurationParameterSettings&gt;&#8230;&#8203;&lt;/configurationParameterSettings&gt;
    &lt;sofaNameMappings&gt;&#8230;&#8203;&lt;/sofaNameMappings&gt;
    &lt;runInSeparateProcess&gt;&#8230;&#8203;&lt;/runInSeparateProcess&gt;
    &lt;deploymentParameters&gt;&#8230;&#8203;&lt;/deploymentParameters&gt;
    &lt;filter/&gt;
    &lt;errorHandling&gt;&#8230;&#8203;&lt;/errorHandling&gt;
    &lt;checkpoint batch="Number"/&gt;
&lt;/casProcessor&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The `&lt;casProcessor&gt;` element has two mandatory attributes, `deployment` and `name`.
The mandatory `name` attribute specifies a unique string identifying the CAS Processor.

The mandatory `deployment` attribute specifies the CAS Processor deployment mode.
Currently, three deployment options are supported:

integrated::
indicates _integrated_ deployment of the CAS Processor.
The CPM deploys and collocates the CAS Processor in the same process space as the CPM.
This type of deployment is recommended to increase the performance of the CPE.
However, it is NOT recommended to deploy annotators containing JNI this way.
Such CAS Processors may cause a fatal exception and force the JVM to exit without cleanup (bringing down the CPM). Any UIMA SDK compliant pure Java CAS Processors may be safely deployed this way.
+
The descriptor for an integrated deployment can, in fact, be a remote service descriptor.
When used this way, however, the CPM error recovery  options (see below) operate in the integrated mode, which means that many  of the retry options are not available.

remote::
indicates _non-managed_ deployment of the CAS Processor.
The CAS Processor descriptor referenced in the `&lt;descriptor&gt;` element must be a Vinci __Service Client Descriptor__, which identifies a xref:tug.adoc#ugr.tug.application.remote_services[remotely deployed CAS Processor service]. The CPM assumes that the CAS Processor is already running as a remote service and will connect to it using the URI provided in the client service descriptor.
The lifecycle of a remotely deployed CAS Processor is not managed by the CPM, so appropriate infrastructure should be in place to start/restart such CAS Processors when necessary.
This deployment provides fault isolation and is implementation (i.e., programming language) neutral.

local::
indicates _managed_ deployment of the CAS Processor.
The CAS Processor descriptor referenced in the `&lt;descriptor&gt;` element must be a Vinci __Service Deployment Descriptor__, which configures a CAS Processor for deployment as a xref:tug.adoc#ugr.tug.application.remote_services[Vinci service].
The CPM deploys the CAS Processor in a separate process and manages the life cycle (start/stop) of the CAS Processor.
Communication between the CPM and the CAS Processor is done with Vinci.
When the CPM completes processing, the process containing the CAS Processor is terminated.
This deployment mode insulates the CPM from the CAS Processor, creating a more robust deployment at the cost of a small communication overhead.
On multiprocessor machines, the separate processes may run concurrently and improve overall throughput.

A number of elements may appear within the `&lt;casProcessor&gt;` element.

[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.descriptor]]
==== &lt;descriptor&gt; Element

The `&lt;descriptor&gt;` element is mandatory.
It identifies the descriptor for the referenced xref:ref.adoc#ugr.ref.xml.component_descriptor.aes[CAS Processor].

* For _``__remote__``_ CAS Processors, the referenced descriptor must be a Vinci __Service Client Descriptor__, which identifies a remotely deployed CAS Processor service.
* For _local_ CAS Processors, the referenced descriptor must be a Vinci __Service Deployment Descriptor__.
* For _integrated_ CAS Processors, the referenced descriptor must be an Analysis Engine Descriptor (primitive or aggregate).

See the xref:tug.adoc#ugr.tug.application.remote_services[Remote Services Guide] for more information on creating these descriptors and deploying services.

[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.configuration_parameter_settings]]
==== &lt;configurationParameterSettings&gt; Element

This element provides a way to override the contained Analysis Engine's parameters settings.
Any entry specified here must already be defined; values specified replace the corresponding values for each parameter. _For Cas Processors, this mechanism
            is only available when they are deployed in "`integrated`"
            mode._ For Collection Readers and Initializers, it always is available.

The content of this element is identical to the component descriptor for specifying parameters (in the case where no parameter groups are specified)footnote:[An earlier UIMA version required these to have a suffix of _p, e.g., string_p. This is no longer required, but this format is accepted, also, for backward compatibility.].

Here is an example:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;configurationParameterSettings&gt;
  &lt;nameValuePair&gt;
    &lt;name&gt;CivilianTitles&lt;/name&gt;
    &lt;value&gt;
      &lt;array&gt;
        &lt;string&gt;Mr.&lt;/string&gt;
        &lt;string&gt;Ms.&lt;/string&gt;
        &lt;string&gt;Mrs.&lt;/string&gt;
        &lt;string&gt;Dr.&lt;/string&gt;
      &lt;/array&gt;
    &lt;/value&gt;
  &lt;/nameValuePair&gt;
  &#8230;&#8203;
&lt;/configurationParameterSettings&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.sofa_name_mappings]]
==== &lt;sofaNameMappings&gt; Element

This optional element provides a mapping from defined Sofa names in the component, or the default Sofa name (if the component does not declare any Sofa names). The form of this element is:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;sofaNameMappings&gt;
  &lt;sofaNameMapping cpeSofaName="a_CPE_name"
                   componentSofaName="a_component_Name"/&gt;
  &#8230;&#8203;
&lt;/sofaNameMappings&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>There can be any number of `&lt;sofaNameMapping&gt;` elements contained in the `&lt;sofaNameMappings&gt;` element.
The `componentSofaName` attribute is optional; leave it out to specify a mapping for the `\_InitialView` - that is, for Single-View components.

[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.run_in_separate_process]]
==== &lt;runInSeparateProcess&gt; Element

The `&lt;runInSeparateProcess&gt;` element is mandatory for `local` CAS Processors, but should not appear for `remote` or `integrated` CAS Processors.
It enables the CPM to create external processes using the provided runtime environment.
Applications launched this way communicate with the CPM using the Vinci protocol and connectivity is enabled by a local instance of the VNS that the CPM manages.
Since communication is based on Vinci, the application need not be implemented in Java.
Any language for which Vinci provides support may be used to create an application, and the CPM will seamlessly communicate with it.
The overall structure of this element is:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;runInSeparateProcess&gt;
    &lt;exec dir="[String]" executable="[String]"&gt;
        &lt;env key="[String]" value ="[String]"/&gt;
        &#8230;&#8203;
        &lt;arg&gt;[String]&lt;/arg&gt;
        &#8230;&#8203;
    &lt;/exec&gt;
&lt;/runInSeparateProcess&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The `&lt;exec&gt;` element provides information about how to execute the referenced CAS Processor.
Two attributes are defined for the `&lt;exec&gt;` element.
The `dir` attribute is currently not used -- it is reserved for future functionality.
The `executable` attribute specifies the actual Vinci service executable that will be run by the CPM, e.g., `java`, a batch script, an application (`.exe`), etc.
The executable must be specified with a fully qualified path, or be found in the `PATH` of the CPM.

The `&lt;exec&gt;` element has two elements within it that define parameters used to construct the command line for executing the CAS Processor.
These elements must be listed in the order in which they should be defined for the CAS Processor.

The optional `&lt;env&gt;` element is used to set an environment variable.
The variable `key` will be set to ``value``.
For example,

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;env key="CLASSPATH" value="C:Javalib"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>will set the environment variable `CLASSPATH` to the value `C:\Javalib`.
The `&lt;env&gt;` element may be repeated to set multiple environment variables.
All of the key/value pairs will be added to the environment by the CPM prior to launching the executable.

[NOTE]
====
The CPM actually adds ALL system environment variables when it launches the program.
It queries the Operating System for its current system variables and one by one adds them to the program's process configuration.
====

The `&lt;arg&gt;` element is used to specify arbitrary string arguments that will appear on the command line when the CPM runs the command specified in the `executable` attribute.

For example, the following would be used to invoke the UIMA Java implementation of the Vinci service wrapper on a Java CAS Processor:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;runInSeparateProcess&gt;
    &lt;exec executable="java"&gt;
        &lt;arg&gt;-DVNS_HOST=localhost&lt;/arg&gt;
        &lt;arg&gt;-DVNS_PORT=9099&lt;/arg&gt;
        &lt;arg&gt;org.apache.uima.reference_impl.analysis_engine.service.
vinci.VinciAnalysisEngineService_impl&lt;/arg&gt;
        &lt;arg&gt;C:uimadescdeployCasProcessor.xml&lt;/arg&gt;
    &lt;/exec&gt;
&lt;runInSeparateProcess&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>This will cause the CPM to run the following command line when starting the CAS Processor:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>java -DVNS_HOST=localhost -DVNS_PORT=9099
  org.apache.uima.reference_impl.analysis_engine.service.vinci.\\
              VinciAnalysisEngineService_impl
  C:uimadescdeployCasProcessor.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The first argument specifies that the Vinci Naming Service is running on the ``localhost``.
The second argument specifies that the Vinci Naming Service port number is ``9099``.
The third argument (split over 2 lines in this documentation)  identifies the UIMA implementation of the Vinci service wrapper.
This class contains the `main` method that will execute.
That main method in turn takes a single argument -- the filename for the CAS Processor service deployment descriptor.
Thus the last argument identifies the Vinci service deployment descriptor file for the CAS Processor.
Since this is the same descriptor file specified earlier in the `&lt;descriptor&gt;` element, the string `${descriptor}` can be used to refer to the descriptor, e.g.:

[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;arg&gt;${descriptor}&lt;/arg&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The CPM will expand this out to the service deployment descriptor file referenced in the `&lt;descriptor&gt;` element.

[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.deployment_parameters]]
==== &lt;deploymentParameters&gt; Element

The `&lt;deploymentParameters&gt;` element defines a number of deployment parameters that control how the CPM will interact with the CAS Processor.
This element has the following overall form:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;deploymentParameters&gt;
    &lt;parameter name="[String]" value="&#8230;&#8203;" type="string|integer" /&gt;
    &#8230;&#8203;
&lt;/deploymentParameters&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The `name` attribute identifies the parameter, the `value` attribute specifies the value that will be assigned to the parameter, and the `type` attribute indicates the type of the parameter, either `string` or ``integer``.
The available parameters include:

service-access::
string parameter whose value must be "`exclusive`", if present.
This parameter is only effective for remote deployments.
It modifies the Vinci service connections to be preallocated and dedicated, one service instance per pipe-line.
It is only relevant for non-Integrated deployement modes.
If there are fewer services instances that are available (and alive -- responding to a `ping` request) than there are pipelines, the number of pipelines (the number of concurrent threads) is reduced to match the number of available instances.
If not specified, the VNS is queried each time a service is needed, and a "`random`" instance is assigned from the pool of available instances.
If a services dies during processing, the CPM will use its normal error handling procedures to attempt to reconnect.
The number of attempts is specified in the CPE descriptor for each Cas Processor using the `&lt;maxConsecutiveRestarts value="10" action="kill-pipeline" waitTimeBetweenRetries="50"/&gt;` xml element.
The "`value`" attribute is the number of reconnection tries; the "`action`" says what to do if the retries exceed the limit.
The "`kill-pipeline`" action stops the pipeline that was associated with the failing service (other pipelines will continue to work). The CAS in process within a killed pipeline will be dropped.
These events are communicated to the application using the normal event listener mechanism.
The `waitTimeBetweenRetries` says how many milliseconds to wait inbetween attempts to reconnect.

vnsHost::
(Deprecated) string parameter specifying the VNS host, e.g., `localhost` for local CAS Processors, host name or IP address of VNS host for remote CAS Processors.
This parameter is deprecated; use the parameter specification instead inside the Vinci __Service Client Descriptor__, if needed.
It is ignored for integrated and local deployments.
If present, for remote deployments, it specifies the VNS Host to use, unless that is specified in the Vinci __Service Client Descriptor__.

vnsPort::
(Deprecated) integer parameter specifying the VNS port number.
This parameter is deprecated; use the parameter specification instead inside the Vinci _Service Client
Descriptor,_ if needed.
It is ignored for integrated and local deployments.
If present, for remote deployments, it specifies the VNS Port number to use, unless that is specified in the Vinci _Service Client Descriptor._

For example, the following parameters might be used with a CAS Processor deployed in local mode:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;deploymentParameters&gt;
  &lt;parameter name="service-access" value="exclusive" type="string"/&gt;
&lt;/deploymentParameters&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.filter]]
==== &lt;filter&gt; Element

The &lt;filter&gt; element is a required element but currently should be left empty.
This element is reserved for future use.

[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.error_handling]]
==== &lt;errorHandling&gt; Element

The mandatory `&lt;errorHandling&gt;` element defines error and restart policies for the CAS Processor.
Each CAS Processor may define different actions in the event of errors and restarts.
The CPM monitors and logs errant behaviors and attempts to recover the component based on the policies specified in this element.

There are two kinds of faults:

. One kind only occurs with non-integrated CAS Processors –this fault is either a timeout attempting to launch or connect to the non-integrated component, or some other kind of connection related exception (for instance, the network connection might timeout or get reset).
. The other kind happens when the CAS Processor component (an Annotator, for example) throws any kind of exception. This kind may occur with any kind of deployment, integrated or not.

The &lt;errorHandling&gt; has specifications for each of these kinds of faults.
The format of this element is:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;errorHandling&gt;
  &lt;maxConsecutiveRestarts action="continue|disable|terminate"
                           value="[Number]"/&gt;
  &lt;errorRateThreshold action="continue|disable|terminate" value="[Rate]"/&gt;
  &lt;timeout max="[Number]"/&gt;
&lt;/errorHandling&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The mandatory `&lt;maxConsecutiveRestarts&gt;` element applies only to faults of the first kind, and therefore, only applies to non-integrated deployments.
If such a fault occurs, a retry is attempted, up to `value="[Number]"` of times.
This retry resets the connection (if one was made) and attempts to reconnect and perhaps re-launch (see below for details). The original CAS (not a partially updated one) is sent to the CAS Processor as part of the retry, once the deployed component has been successfully restarted or reconnected to.

The `action` attribute specifies the action to take when the threshold specified by the `value="[Number]"` is exceeded.
The possible actions are:

continue::
skip any further processing for this CAS by this CAS Processor, and pass the CAS to the next CAS Processor in the Pipeline.
+
The "`restart`" action is done, because it is needed for the next CAS.
+
If the ``dropCasOnException="true"``, the CPM will NOT pass the CAS to the next CAS Processor in the chain.
Instead, the CPM will abort processing of this CAS, release the CAS back to the CAS Pool and will process the next CAS in the queue.
+
The counter counting the restarts toward the threshold is only reset after a CAS is successfully processed.

disable::
the current CAS is handled just as in the `continue` case, but in addition, the CAS Processor is marked so that its _process()_ method will not be called again (i.e., it will be "`skipped`" for future CASes)

terminate::
the CPM will terminate all processing and exit.

The definition of an error for the `&lt;maxConsecutiveRestarts&gt;` element differs slightly for each of the three CAS Processor deployment modes:

local::
Local CAS Processors experience two general error types:
+

* launch errors –errors associated with launching a process
* processing errors –errors associated with sending Vinci commands to the process

+
A launch error is defined by a failure of the process to successfully register with the local VNS within a default time window.
The current timeout is 15 minutes.
Multiple local CAS Processors are launched sequentially, with a subsequent processor launched immediately after its previous processor successfully registers with the VNS.
+
A processing error is detected if a connection to the CAS Processor is lost or if the processing time exceeds a specified timeout value.
+
For local CAS Processors, the &lt;maxConsecutiveRestarts&gt; element specifies the number of consecutive attempts made to launch the CAS Processor at CPM startup or after the CPM has lost a connection to the CAS Processor.

remote::
For remote CAS Processors, the &lt;maxConsecutiveRestarts&gt; element applies to errors from sending Vinci commands.
An error is detected if a connection to the CAS Processor is lost, or if the processing time exceeds the timeout value specified in the &lt;timeout&gt; element (see below).

integrated::
Although mandatory, the &lt;maxConsecutiveRestarts&gt; element is NOT used for integrated CAS Processors, because Integrated CAS Processors are not re-instantiated/restarted on exceptions.
This setting is ignored by the CPM for Integrated CAS Processors but it is required.
Future version of the CPM will make this element mandatory for remote and local CAS Processors only.

The mandatory `&lt;errorRateThreshold&gt;` element is used for all faults – both those above, and exceptions thrown by the CAS Processor itself.
It specifies the number of retries for exceptions thrown by the CAS Processor itself, a maximum error rate, and the corresponding action to take when this rate is exceeded.
The `value` attribute specifies the error rate in terms of errors per sample size in the form "``N/M``", where `N` is the number of errors and `M` is the sample size, defined in terms of the number of documents.

The first number is used also to indicate the maximum number of retries.
If this number is less than the ``&lt;maxConsecutiveRestarts
            value="[Number]"&gt;, ``it will override, reducing the number of "`restarts`" attempted.
A retry is done only if the ``dropCasOnException ``is false.
If it is set to true, no retry occurs, but the error is counted.

When the number of counted errors exceeds the sample size, an action specified by the `action` attribute is taken.
The possible actions and their meaning are the same as described above for the `&lt;maxConsecutiveRestarts&gt;` element:

* `continue`
* `disable`
* `terminate`

The `dropCasOnException="true"` attribute of the `&lt;casProcessors&gt;` element modifies the action taken for continue and disable, in the same manner as above.
For example:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;errorRateThreshold value="3/1000" action="disable"/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>specifies that each error thrown by the CAS Processor itself will be retried up to 3 times (if `dropCasOnException` is false) and the CAS Processor will be disabled if the error rate exceeds 3 errors in 1000 documents.

If a document causes an error and the error rate threshold for the CAS Processor is not exceeded, the CPM increments the CAS Processor's error count and retries processing that document (if `dropCasOnException` is false). The retry means that the CPM calls the CAS Processor's process() method again, passing in as an argument the same CAS that previously caused an exception.

[NOTE]
====
The CPM does not attempt to rollback any partial changes that may have been applied to the CAS in the previous process() call.
====

Errors are accumulated across documents.
For example, assume the error rate threshold is ``3/1000``.
The same document may fail three times before finally succeeding on the fourth try, but the error count is now 3.
If one more error occurs within the current sample of 1000 documents, the error rate threshold will be exceeded and the specified action will be taken.
If no more errors occur within the current sample, the error counter is reset to 0 for the next sample of 1000 documents.

The `&lt;timeout&gt;` element is a mandatory element.
Although mandatory for all CAS Processors, this element is only relevant for local and remote CAS Processors.
For integrated CAS Processors, this element is ignored.
In the current CPM implementation the integrated CAS Processor process() method is not subject to timeouts.

The `max` attribute specifies the maximum amount of time in milliseconds the CPM will wait for a process() method to complete When exceeded, the CPM will generate an exception and will treat this as an error subject to the threshold defined in the `&lt;errorRateThreshold&gt;` element above, including doing retries.

[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.error_handling.timeout_retry_action]]
===== Retry action taken on a timeout

The action taken depends on whether the CAS Processor is local (managed) or remote (unmanaged). Local CAS Processors (which are services) are killed and restarted, and a new connection to them is established.
For remote CAS Processors, the connection to them is dropped, and a new connection is reestablished (which may actually connect to a different instance of the remote services, if it has multiple instances).

[[ugr.ref.xml.cpe_descriptor.descriptor.cas_processors.individual.checkpoint]]
==== &lt;checkpoint&gt; Element

The `&lt;checkpoint&gt;` element is an optional element used to improve the performance of CAS Consumers.
It has a single attribute, ``batch``, which specifies the number of CASes in a batch, e.g.:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;checkpoint batch="1000"&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sets the batch size to 1000 CASes.
The batch size is the interval used to mark a point in processing requiring special handling.
The CAS Processor's `batchProcessComplete()` method will be called by the CPM when this mark is reached so that the processor can take appropriate action.
This mark could be used as a mechanism to buffer up results in CAS Consumers and perform time-consuming operations, such as check-pointing, that should not be done on a per-document basis.

[[ugr.ref.xml.cpe_descriptor.descriptor.operational_parameters]]
== CPE Operational Parameters

The parameters for configuring the overall CPE and CPM are specified in the `&lt;cpeConfig&gt;` section.
The overall format of this section is:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;cpeConfig&gt;
  &lt;startAt&gt;[NumberOrID]&lt;/startAt&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;numToProcess&gt;[Number]&lt;/numToProcess&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;outputQueue dequeueTimeout="[Number]" queueClass="[ClassName]" /&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;checkpoint file="[File]" time="[Number]" batch="[Number]"/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;timerImpl&gt;[ClassName]&lt;/timerImpl&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;deployAs&gt;vinciService|interactive|immediate|single-threaded
&lt;/deployAs&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/cpeConfig&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>This section of the CPE descriptor allows for defining the starting entity, the number of entities to process, a checkpoint file and frequency, a pluggable timer, an optional output queue implementation, and finally a mode of operation.
The mode of operation determines how the CPM interacts with users and other systems.

The `&lt;startAt&gt;` element is an optional argument.
It defines the starting entity in the collection at which the CPM should start processing.

The implementation in the CPM passes this argument to the Collection Reader as the value of the parameter "``startNumber``".
The CPM does not do anything else with this parameter; in particular, the CPM has no ability to skip to a specific document - that function, if available, is only provided by a particular Collection Reader implementation.

If the `&lt;startAt&gt;` element is used, the Collection Reader descriptor must define a single-valued configuration parameter with the name ``startNumber``.
It can declare this value to be of any type; the value passed in this XML element must be convertible to that type.

A typical use is to declare this to be an integer type, and to pass the sequential document number where processing should start.
An alternative implementation might take a specific document ID; the collection reader could search through its collection until it reaches this ID and then start there.

This parameter will only make sense if the particular collection reader is implemented to use the `startNumber` configuration parameter.

The `&lt;numToProcess&gt;` element is an optional element.
It specifies the total number of entities to process.
Use -1 to indicate ALL.
If not defined, the number of entities to process will be taken from the Collection Reader configuration.
If present, this value overrides the Collection Reader configuration.

The `&lt;outputQueue&gt;` element is an optional element.
It enables plugging in a custom implementation for the Output Queue.
When omitted, the CPM will use a default output queue that is based on First-in First-out (FIFO) model.

The UIMA SDK provides a second implementation for the Output Queue that can be plugged in to the CPM, named "``org.apache.uima.collection.impl.cpm.engine.SequencedQueue``".

This implementation supports handling very large documents that are split into "`chunks`"; it provides a delivery mechanism that insures the sequential order of the chunks using information carried in the CAS metadata.
This metadata, which is required for this implementation to work correctly, must be added as an instance of a Feature Structure of type `org.apache.es.tt.DocumentMetaData` and referred to by an additional feature named `esDocumentMetaData` in the special instance of `uima.tcas.DocumentAnnotation` that is associated with the CAS.
This is usually done by the Collection Reader; the instance contains the following features:

sequenceNumber::
[Number] the sequential number of a chunk, starting at 1.
If not a chunk (i.e.
complete document), the value should be 0.

documentId::
[Number] current document id.
Chunks belonging to the same document have identical document id.

isCompleted::
[Number] 1 if the chunk is the last in a sequence, 0 otherwise.

url::
[String] document url.

throttleID::
[String] special attribute currently used by OmniFind.

This implementation of a sequenced queue supports proper sequencing of CASes in CPM deployments that use document chunking.
Chunking is a technique of splitting large documents into pieces to reduce overall memory consumption.
Chunking does not depend on the number of CASes in the CAS Pool.
It works equally well with one or more CASes in the CAS Pool.
Each chunk is packaged in a separate CAS and placed in the Work Queue.
If the CAS Pool is depleted, the CollectionReader thread is suspended until a CAS is released back to the pool by the processing threads.
A document may be split into 1, 2, 3 or more chunks that are analyzed independently.
In order to reconstruct the document correctly, the CAS Consumer can depend on receiving the chunks in the same sequential order that the chunks were "`produced`", when this sequenced queue implementation is used.
To plug in this sequenced queue to the CPM use the following specification:
[source]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;outputQueue dequeueTimeout="100000" queueClass=
"org.apache.uima.collection.impl.cpm.engine.SequencedQueue"/&gt;
---- where the mandatory <code>queueClass</code> attribute defines the name of the class and the second mandatory attribute, <code>dequeueTimeout</code> specifies the maximum number of milliseconds to wait for the expected chunk.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The value for this timeout must be carefully determined to avoid excessive occurrences of timeouts.
Typically, the size of a chunk and the type of analysis being done are the most important factors when deciding on the value for the timeout.
The larger the chunk and the more complicated analysis, the more time it takes for the chunk to go from source to sink.
You may specify 0, in which case, the timeout is  disabled - i.e., it is equivalent to an infinitely long timeout.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the chunk doesn&#8217;t arrive in the configured time window, the entire document is presumed to be invalid and the CAS is dropped from further processing.
This action occurs regardless of any other error action specification.
The SequencedQueue invalidate the document, adding the offending document&#8217;s metadata to a local cache of invalid documents.</p>
</div>
<div class="paragraph">
<p>If the time out occurs, the CPM notifies all <a href="tug.html#ugr.tug.cpe.using_listeners">registered listeners</a> by calling <code>entityProcessComplete()</code>. As part of this call, the SequencedQueue will pass null instead of a CAS as the first argument, and a special exception&#8201;&#8212;&#8201;<code>CPMChunkTimeoutException</code>.
The reason for passing null as the first argument is because the time out occurs due to the fact that the chunk has not been received in the configured timeout window, so there is no CAS available when the timeout event occurs.</p>
</div>
<div class="paragraph">
<p>The <code>CPMChunkTimeoutException</code> object includes an API that allows the listener to retrieve the offending document id as well as the other metadata attributes as defined above.
These attributes are part of each chunk&#8217;s metadata and are added by the Collection Reader.</p>
</div>
<div class="paragraph">
<p>Each chunk that <code>SequencedQueue</code> works on is subjected to a test to determine if the chunk belongs to an invalid document.
This test checks the chunk&#8217;s metadata against the data in the local cache.
If there is a match, the chunk is dropped.
This check is only performed for chunks and complete documents are not subject to this check.</p>
</div>
<div class="paragraph">
<p>If there is an exception during the processing of a chunk, the CPM sends a notification to all registered listeners.
The notification includes the CAS and an exception.
When the listener notification is completed, the CPM also sends separate notifications, containing the CAS, to the Artifact Producer and the SequencedQueue.
The intent is to stop adding new chunks to the Work Queue that belong to an <code>invalid</code> document and also to deal with chunks that are en-route, being processed by the processing threads.</p>
</div>
<div class="paragraph">
<p>In response to the notification, the Artifact Producer will drop and release back to the CAS Pool all CASes that belong to an &#8220;invalid&#8221; document.
Currently, there is no support in the CollectionReader&#8217;s API to tell it to stop generating chunks.
The CollectionReader keeps producing the chunks but the Artifact Producer immediately drops/releases them to the CAS Pool.
Before the CAS is released back to the CAS Pool, the Artifact Producer sends notification to all registered listeners.
This notification includes the CAS and an exception&#8201;&#8212;&#8201;<code>SkipCasException</code>.</p>
</div>
<div class="paragraph">
<p>In response to the notification of an exception involving a chunk, the SequencedQueue retrieves from the CAS the metadata and adds it to its local cache of <code>invalid</code> documents.
All chunks de-queued from the OutputQueue and belonging to <code>invalid</code> documents will be dropped and released back to the CAS Pool.
Before dropping the CAS, the CPM sends notification to all registered listeners.
The notification includes the CAS and SkipCasException.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;checkpoint&gt;</code> element is an optional element.
It specifies a CPE checkpoint file, checkpoint frequency, and strategy for checkpoints (time or count based). At checkpoint time, the CPM saves status information and statistics to the checkpoint file.
The checkpoint file is specified in the <code>file</code> attribute, which has the same form as the <code>href</code> attribute of the <code>&lt;include&gt;</code> element described in <a href="#ugr.ref.xml.cpe_descriptor.imports">Section 3.3</a>.
The <code>time</code> attribute indicates that a checkpoint should be taken every <code>[Number]</code> seconds, and the <code>batch</code> attribute indicates that a checkpoint should be taken every <code>[Number]</code> batches.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;timerImpl&gt;</code> element is optional.
It is used to identify a custom timer plug-in class to generate time stamps during the CPM execution.
The value of the element is a Java class name.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;deployAs&gt;</code> element indicates the type of CPM deployment.
Valid contents for this element include:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">vinciService</dt>
<dd>
<p>Vinci service exposing APIs for stop, pause, resume, and getStats</p>
</dd>
<dt class="hdlist1">interactive</dt>
<dd>
<p>provide command line menus (start, stop, pause, resume)</p>
</dd>
<dt class="hdlist1">immediate</dt>
<dd>
<p>run the CPM without menus or a service API</p>
</dd>
<dt class="hdlist1">single-threaded</dt>
<dd>
<p>run the CPM in a single threaded mode.
In this mode, the Collection Reader, the Processing Pipeline, and the CAS Consumer Pipeline are all running in one thread without the work queue and the output queue.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.cpe_descriptor.descriptor.resource_manager_configuration"><a class="anchor" href="#ugr.ref.xml.cpe_descriptor.descriptor.resource_manager_configuration"></a>3.4. Resource Manager Configuration</h3>
<div class="paragraph">
<p><a href="tug.html#ugr.tug.aae.accessing_external_resource_files">External resource bindings</a> for the CPE may optionally be specified in an element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;resourceManagerConfiguration href="..."/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>resourceManagerConfiguration</code> element, the value of the href attribute refers to another file that contains definitions and bindings for the external resources used by the CPE.
The format of this file is the same as for <a href="#ugr.ref.xml.component_descriptor.aes.aggregate.external_resource_bindings">Aggregate Analysis Engines</a>.
For example, in a CPE containing an aggregate analysis engine with two annotators, and a CAS Consumer, the following resource manager configuration file would bind external resource dependencies in all three components to the same physical resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;resourceManagerConfiguration&gt;

  &lt;!-- Declare Resource --&gt;

  &lt;externalResources&gt;
    &lt;externalResource&gt;
      &lt;name&gt;ExampleResource&lt;/name&gt;
      &lt;fileResourceSpecifier&gt;
        &lt;fileUrl&gt;file:MyResourceFile.dat&lt;/fileUrl&gt;
      &lt;/fileResourceSpecifier&gt;
    &lt;/externalResource&gt;
  &lt;/externalResources&gt;

  &lt;!-- Bind component resource dependencies to ExampleResource --&gt;

  &lt;externalResourceBindings&gt;
    &lt;externalResourceBinding&gt;
      &lt;key&gt;MyAE/annotator1/myResourceKey&lt;/key&gt;
      &lt;resourceName&gt;ExampleResource&lt;/resourceName&gt;
    &lt;/externalResourceBinding&gt;

    &lt;externalResourceBinding&gt;
      &lt;key&gt;MyAE/annotator2/someResourceKey&lt;/key&gt;
      &lt;resourceName&gt;ExampleResource&lt;/resourceName&gt;
    &lt;/externalResourceBinding&gt;

    &lt;externalResourceBinding&gt;
      &lt;key&gt;MyCasConsumer/otherResourceKey&lt;/key&gt;
      &lt;resourceName&gt;ExampleResource&lt;/resourceName&gt;
    &lt;/externalResourceBinding&gt;

  &lt;/externalResourceBindings&gt;

&lt;/resourceManagerConfiguration&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, <code>MyAE</code> and <code>MyCasConsumer</code> are the names of the Analysis Engine and CAS Consumer, as specified by the name attributes of the CPE&#8217;s <code>&lt;casProcessor&gt;</code> elements. <code>annotator1</code> and <code>annotator2</code> are the annotator keys specified within the Aggregate AE Descriptor, and <code>myResourceKey</code>, <code>someResourceKey</code>, and <code>otherResourceKey</code> are the keys of the resource dependencies declared in the individual annotator and CAS Consumer descriptors.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xml.cpe_descriptor.descriptor.example"><a class="anchor" href="#ugr.ref.xml.cpe_descriptor.descriptor.example"></a>3.5. Example CPE Descriptor</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;cpeDescription&gt;
  &lt;collectionReader&gt;
    &lt;collectionIterator&gt;
      &lt;descriptor&gt;
        &lt;import location=
           "../collection_reader/FileSystemCollectionReader.xml"/&gt;
      &lt;/descriptor&gt;
    &lt;/collectionIterator&gt;
  &lt;/collectionReader&gt;
  &lt;casProcessors dropCasOnException="true" casPoolSize="1"
      processingUnitThreadCount="1"&gt;
    &lt;casProcessor deployment="integrated"
      name="Aggregate TAE - Name Recognizer and Person Title Annotator"&gt;
      &lt;descriptor&gt;
        &lt;import location=
           "../analysis_engine/NamesAndPersonTitles_TAE.xml"/&gt;
      &lt;/descriptor&gt;
      &lt;deploymentParameters/&gt;
      &lt;filter/&gt;
      &lt;errorHandling&gt;
        &lt;errorRateThreshold action="terminate" value="100/1000"/&gt;
                &lt;maxConsecutiveRestarts action="terminate" value="30"/&gt;
                &lt;timeout max="100000"/&gt;
      &lt;/errorHandling&gt;
      &lt;checkpoint batch="1"/&gt;
    &lt;/casProcessor&gt;
    &lt;casProcessor deployment="integrated" name="Annotation Printer"&gt;
      &lt;descriptor&gt;
        &lt;import location="../cas_consumer/AnnotationPrinter.xml"/&gt;
      &lt;/descriptor&gt;
      &lt;deploymentParameters/&gt;
      &lt;filter/&gt;
      &lt;errorHandling&gt;
        &lt;errorRateThreshold action="terminate" value="100/1000"/&gt;
        &lt;maxConsecutiveRestarts action="terminate" value="30"/&gt;
        &lt;timeout max="100000"/&gt;
      &lt;/errorHandling&gt;
      &lt;checkpoint batch="1"/&gt;
    &lt;/casProcessor&gt;
  &lt;/casProcessors&gt;
  &lt;cpeConfig&gt;
    &lt;numToProcess&gt;1&lt;/numToProcess&gt;
    &lt;deployAs&gt;immediate&lt;/deployAs&gt;
    &lt;checkpoint file="" time="3000"/&gt;
    &lt;timerImpl/&gt;
  &lt;/cpeConfig&gt;
&lt;/cpeDescription&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.cas"><a class="anchor" href="#ugr.ref.cas"></a>4. CAS Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The CAS (Common Analysis System) is the part of the Unstructured Information Management Architecture (UIMA) that is concerned with creating and handling the data that annotators manipulate.</p>
</div>
<div class="paragraph">
<p>Java users typically use the JCas (Java interface to the CAS) when manipulating objects in the CAS.
This chapter describes an alternative interface to the CAS which allows discovery and specification of types and features at run time.
It is recommended for use when the using code cannot know ahead of time the type system it will be dealing with.</p>
</div>
<div class="paragraph">
<p>Use of the CAS as described here is also recommended (or necessary) when components add to the definitions of types of other components.
This UIMA feature allows users to add features to a type that was already defined elsewhere.
When this feature is used in conjunction with the JCas, it can lead to problems with class loading.
This is because different JCas representations of a single type are generated by the different components, and only one of them is loaded  (unless you are using Pear descriptors).  Note: we do not recommend that you add features to pre-existing types.
A type should be defined in one place only, and then there is no problem with using the JCas.
However, if you do use this feature, do not use the JCas.
Similarly, if you distribute your components for inclusion in somebody else&#8217;s UIMA application, and you&#8217;re not sure that they won&#8217;t add features to your types, do not use the JCas for the same reasons.</p>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.javadocs"><a class="anchor" href="#ugr.ref.cas.javadocs"></a>4.1. Javadocs</h3>
<div class="paragraph">
<p>The subdirectory <code>docs/api</code> contains the documentation details of all the classes, methods, and constants for the APIs discussed here.
Please refer to this for details on the methods, classes and constants, specifically in the packages <code>org.apache.uima.cas.*</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.overview"><a class="anchor" href="#ugr.ref.cas.overview"></a>4.2. CAS Overview</h3>
<div class="paragraph">
<p>There are three<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup> main parts to the CAS: the type system, data creation and manipulation, and indexing.
We will start with a brief description of these components.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.type_system"><a class="anchor" href="#ugr.ref.cas.type_system"></a>4.2.1. The Type System</h4>
<div class="paragraph">
<p>The type system specifies what kind of data you will be able to manipulate in your annotators.
The type system defines two kinds of entities, types and features.
Types are arranged in a single inheritance tree and define the kinds of entities (objects) you can manipulate in the CAS.
Features optionally specify slots or fields within a type.
The correspondence to Java is to equate a CAS Type to a Java Class, and the CAS Features to fields within the type.
A critical difference is that CAS types have no methods; they are just data structures with named slots (features). These features can have as values primitive things like integers, floating point numbers, and strings, and they also can hold references to other instances of objects in the CAS.
We call instances of the data structures declared by the type system &#8220;feature
        structures&#8221; (not to be confused with &#8220;features&#8221;). Feature structures are similar to the many variants of record structures found in computer science.<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></p>
</div>
<div class="paragraph">
<p>Each CAS Type defines a supertype; it is a subtype of that supertype.
This means that any features that the supertype defines are features of the subtype; in other words, it inherits its supertype&#8217;s features.
Only single inheritance is supported; a type&#8217;s feature set is the union of all of the features in its supertype hierarchy.
There is a built-in type called uima.cas.TOP; this is the top, root node of the inheritance tree.
It defines no features.</p>
</div>
<div class="paragraph">
<p>The values that can be stored in features are either built-in primitive values or references to other feature structures.
The primitive values are <code>boolean</code>, <code>byte</code>, <code>short</code> (16 bit integers), <code>integer</code> (32 bit), <code>long</code> (64 bit), <code>float</code> (32 bit), <code>double</code> (64 bit floats) and strings; the official names of these are <code>uima.cas.Boolean</code>, <code>uima.cas.Byte</code>, <code>uima.cas.Short</code>, <code>uima.cas.Integer</code>, <code>uima.cas.Long</code>, <code>uima.cas.Float</code> ,<code> uima.cas.Double</code> and <code>uima.cas.String</code> . The strings are Java strings, and characters are Java characters.
Technically, this means that characters are UTF-16 code points, which is not quite the same as a Unicode character.
This distinction should make no difference for almost all applications.
The CAS also defines other basic built-in types for arrays of these, plus arrays of references to other objects, called <code>uima.cas.IntegerArray</code> ,<code> uima.cas.FloatArray</code>, <code>uima.cas.StringArray</code>, <code>uima.cas.FSArray</code>, etc.</p>
</div>
<div class="paragraph">
<p>The CAS also defines a built-in type called <code>uima.tcas.Annotation</code> which inherits from <code>uima.cas.AnnotationBase</code> which in turn inherits from <code>uima.cas.TOP</code>.
There are two features defined by this type, called <code>begin</code> and <code>end</code>, both of which are integer valued.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.creating_accessing_manipulating_data"><a class="anchor" href="#ugr.ref.cas.creating_accessing_manipulating_data"></a>4.2.2. Creating, accessing and manipulating data</h4>
<div class="paragraph">
<p>Creating and accessing data in the CAS requires knowledge about the types and features  defined in the type system.
The idea is similar to other data access APIs, such as the XML DOM or SAX APIs, or database access APIs such as JDBC.
Contrary to those APIs, however, the CAS does not use the names of type system entities directly in the APIs.
Rather, you use the type system to access type and feature entities by name, then use these entities in the data manipulation APIs.
This can be compared to the Java reflection APIs: the type system is comparable to the Java class loader, and the type and feature objects to the <code>java.lang.Class</code> and <code>java.lang.reflect.Field</code> classes.</p>
</div>
<div class="paragraph">
<p>Why does it have to be this complicated?  You wouldn&#8217;t normally use reflection to create a Java object, either.
As mentioned earlier, the JCas provides the more straightforward method to manipulate CAS data.
The CAS access methods described here need only be used for generic types of applications that need to be able to handle any kind of data (e.g., generic tooling) or when the JCas may not be used for other reasons.
The generic kinds of applications are exactly the ones where you would use the reflection API in Java as well.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.creating_using_indexes"><a class="anchor" href="#ugr.ref.cas.creating_using_indexes"></a>4.2.3. Creating and using indexes</h4>
<div class="paragraph">
<p>Each view of a CAS provides a set of indexes for that view.
Instances of Types (that is, Feature Structures) can be added to a view&#8217;s indexes.
These indexes provide a way for annotators to locate existing data in the CAS, using a specific index (or the method <code>getAllIndexedFS</code> of the object <code>FSIndexRepository</code>) to retrieve the Feature Structures that were previously created.
If you want the data you Newly created Feature Structures are not automatically added to the indexes; you choose which Feature Structures to add and use one of several APIs to add them.</p>
</div>
<div class="paragraph">
<p>Indexes are named and are associated with a CAS Type; they are used to index instances of that CAS type (including instances of that type&#8217;s subtypes). If you are using <a href="tug.html#ugr.tug.mvs">multiple views</a>, each view contains a separate instantiation of all of the indexes.
To access an index, you minimally need to know its name.
A CAS view provides an index repository which you can query for indexes for that view.
Once you have a handle to an index, you can get information about the feature structures in the index, the size of the index, as well as an iterator over the feature structures.</p>
</div>
<div class="paragraph">
<p>There are three kinds of indexes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>bag - no ordering</p>
</li>
<li>
<p>set - uses a user-specfied set of keys to define equality; holds one instance of the set of equal items.</p>
</li>
<li>
<p>sorted - uses a user-specified set of keys to define ordering.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For set indexes, the comparator keys are augmented with an implicit additional field - the type of the feature structure.
This means that an index over Annotations, having subtype Token, and a key of the "begin" value, will behave as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you make two Tokens (or two Annotations), both having a begin value of 17, and add both of them to the indexes, only one of them will be in the index.</p>
</li>
<li>
<p>If you make 1 Token and 1 Annotation, both having a begin value of 17, and add both of them to the indexes, both of them will be in the index (because the types are different).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Indexes are defined in the XML descriptor metadata for the application.
Each CAS View has its own, separate instantiation of indexes based on these definitions,  kept in the view&#8217;s index repository.
When you obtain an index, it is always from a particular CAS view&#8217;s index repository.
When you index an item, it is always added to all indexes where it belongs, within just the view&#8217;s repository.
You can specify different repositories (associated with different CAS views) to use; a given Feature Structure instance  may be indexed in more than one CAS View (unless it is a subtype of AnnotationBase).</p>
</div>
<div class="paragraph">
<p>Indexes implement the Iterable interface, so you may use the Java enhanced for loop to iterate over them.</p>
</div>
<div class="paragraph">
<p>You can also get iterators from indexes;  iterators allow you to enumerate the feature structures in an index.
There are two kinds of iterators supported: the regular Java iterator API, and a specific FS iterator API where the usual Java iterator APIs (<code>hasNext()</code> and <code>next()</code>) are augmented by <code>isValid()</code>, <code>moveToNext() / moveToPrevious()</code> (which does not return an element) and <code>get()</code>.
Finally, there is a <code>moveTo(FeatureStructure)</code> API, which, for sorted indexes, moves the iteration point to the left-most (among otherwise "equal") item in the index which compares "equal" to the given FeatureStructure, using the index&#8217;s defined comparator.</p>
</div>
<div class="paragraph">
<p>Which API style you use is up to you, but we do not recommend mixing the styles as the results are sometimes unexpected.
If you just want to iterate over an index from start to finish, either style is equally appropriate.
If you also use <code>moveTo(FeatureStructure fs)</code> and <code>moveToPrevious()</code>, it is better to use the special FS iterator style.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The reason to not mix these styles is that you might be thinking that next() followed by moveToPrevious() would always work.
This is not true, because next() returns the "current" element, and advances to the next position, which might be beyond the last element.
At that point, the iterator becomes "invalid", and  moveToNext and moveToPrevious no longer move the iterator.
But you can call these methods on the iterator&#8201;&#8212;&#8201; <code>moveToFirst()</code>, <code>moveToLast()</code>, or <code>moveTo(FS)</code>&#8201;&#8212;&#8201;to reset it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Indexes are created by specifying them in the annotator&#8217;s or aggregate&#8217;s resource descriptor.
An index specification includes its name, the CAS type being indexed, the kind (bag, set or sorted) of index it is, and an (optional) set of keys.
The keys are used for set and sorted indexes, and specify what values are used for  ordering, or (for sets) what values are used to determine set equality.
When a CAS pipeline is created, all index specifications are combined; duplicate definitions (having the same name) are allowed only if their definitions are the same.</p>
</div>
<div class="paragraph">
<p>Feature structure instances need to be explicitly added to the index repository by a method call.
Feature structures that are not indexed will not be visible to other annotators, (unless they are located via being referenced by some other feature of another feature structure, which is indexed, or through a chain of these).</p>
</div>
<div class="paragraph">
<p>The framework defines an unnamed bag index which indexes all types.
The only access provided for this index is the getAllIndexedFS(type) method on the index repository, which returns an iterator over all indexed instances of the specified type (including its subtypes) for that CAS View.</p>
</div>
<div class="paragraph">
<p>The framework defines one standard, built-in annotation index, called AnnotationIndex, which indexes the <code>uima.tcas.Annotation</code> type: all feature structures of type <code>uima.tcas.Annotation</code> or its subtypes are automatically indexed with this built-in index.</p>
</div>
<div class="paragraph">
<p>The ordering relation used by this index is to first order by the value of the &#8220;begin&#8221; features (in ascending order) and then by the value of the &#8220;end&#8221; feature (in descending order), and then, finally, by the  Type Priority.
This ordering insures that longer annotations starting at the same spot come before shorter ones.
For Subjects of Analysis other than Text, this may not be an appropriate index.</p>
</div>
<div class="paragraph">
<p>In addition to normal iterators, there is a <code>select</code> API, documented in the Version 3 Users guide, which provides additional capabilities for accessing Feature Structures via the indexes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.builtin_types"><a class="anchor" href="#ugr.ref.cas.builtin_types"></a>4.3. Built-in CAS Types</h3>
<div class="paragraph">
<p>The CAS has two kinds of built-in types –primitive and non-primitive.
The primitive types are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>uima.cas.Boolean</p>
</li>
<li>
<p>uima.cas.Byte</p>
</li>
<li>
<p>uima.cas.Short</p>
</li>
<li>
<p>uima.cas.Integer</p>
</li>
<li>
<p>uima.cas.Long</p>
</li>
<li>
<p>uima.cas.Float</p>
</li>
<li>
<p>uima.cas.Double</p>
</li>
<li>
<p>uima.cas.String</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>Byte, Short, Integer, </code>and<code> Long</code> are all signed integer types, of length 8, 16, 32, and 64 bits.
The <code>Double</code> type is 64 bit floating point.
The <code>String</code> type can be subtyped to create sets of allowed values; see <a href="#ugr.ref.xml.component_descriptor.type_system.string_subtypes">String Subtypes</a>.
These types can be used to specify the range of a String-valued feature.
They act like Strings, but have additional checking to insure the setting of values into them conforms to one of the allowed values, or to null (which is the value if it is not set).  Note that the other primitive types cannot be used as a supertype for another type definition; only <code>uima.cas.String</code> can be sub-typed.</p>
</div>
<div class="paragraph">
<p>The non-primitive types exist in a type hierarchy; the top of the hierarchy is the type <code>uima.cas.TOP</code>.
All other non-primitive types inherit from some supertype.</p>
</div>
<div class="paragraph">
<p>There are 9 built-in array types.
These arrays have a size specified when they are created; the size is fixed at creation time.
They are named:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>uima.cas.BooleanArray</p>
</li>
<li>
<p>uima.cas.ByteArray</p>
</li>
<li>
<p>uima.cas.ShortArray</p>
</li>
<li>
<p>uima.cas.IntegerArray</p>
</li>
<li>
<p>uima.cas.LongArray</p>
</li>
<li>
<p>uima.cas.FloatArray</p>
</li>
<li>
<p>uima.cas.DoubleArray</p>
</li>
<li>
<p>uima.cas.StringArray</p>
</li>
<li>
<p>uima.cas.FSArray</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>uima.cas.FSArray</code> type is an array whose elements are arbitrary other feature structures (instances of non-primitive types).</p>
</div>
<div class="paragraph">
<p>The JCas cover classes for the array types support the Iterable API, so you may write extended for loops over instances of these.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>FSArray&lt;MyType&gt; myArray = ...
for (MyType fs : myArray) {
  some_method(fs);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are 3 built-in types associated with the artifact being analyzed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>uima.cas.AnnotationBase</p>
</li>
<li>
<p>uima.tcas.Annotation</p>
</li>
<li>
<p>uima.tcas.DocumentAnnotation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>AnnotationBase</code> type defines one system-used feature which specifies for an annotation the subject of analysis (Sofa) to which it refers.
The Annotation type extends from this and defines 2 features, taking <code>uima.cas.Integer</code> values, called <code>begin</code> and <code>end</code>.
The <code>begin</code> feature typically identifies the start of a span of text the annotation covers; the <code>end</code> feature identifies the end.
The values refer to character offsets; the starting index is 0.
An annotation of the word &#8220;CAS&#8221; in a text &#8220;CAS Reference&#8221; would have a start index of 0, and an end index of 3; the difference between end and start is the length of the span the annotation refers to.</p>
</div>
<div class="paragraph">
<p>Annotations are always with respect to some Sofa (Subject of Analysis –see <a href="tug.html#ugr.tug.aas">Annotations, Artifacts, and Sofas</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Artifacts which are not text strings may have a different interpretation of the meaning of begin and end, or may define their own kind of annotation, extending from <code>AnnotationBase</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>DocumentAnnotation</code> type has one special instance.
It is a subtype of the Annotation type, and the built-in definition defines one feature, <code>language</code>, which is a string indicating the language of the document in the CAS.
The value of this language feature is used by the system to control flow among annotators when the &#8220;CapabilityLanguageFlow&#8221; mode is used, allowing the flow to skip over annotators that don&#8217;t process particular languages.
Users may extend this type by adding additional features to it, using the XML Descriptor element for defining a type.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>We do <em>not</em> recommend extending the <code>DocumentAnnotation</code> type.
If you do, you must <em>not</em> use the JCas, for the reasons stated earlier.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each CAS view has a different associated instance of the <code>DocumentAnnotation</code> type.
On the CAS, use <code>getDocumentationAnnotation()</code> to access the <code>DocumentAnnotation</code>.</p>
</div>
<div class="paragraph">
<p>There are also built-in types supporting linked lists, similar to the ones available in Java and other programming languages.
Their use is constrained by the usual properties of linked lists: not very space efficient, no (efficient) random access, but an easy choice if you don&#8217;t know how long your list will be ahead of time.
The implementation is type specific; there are different list building objects for each of the primitive types, plus one for general feature structures.
Here are the type names:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>uima.cas.FloatList</p>
</li>
<li>
<p>uima.cas.IntegerList</p>
</li>
<li>
<p>uima.cas.StringList</p>
</li>
<li>
<p>uima.cas.FSList</p>
</li>
<li>
<p>uima.cas.EmptyFloatList</p>
</li>
<li>
<p>uima.cas.EmptyIntegerList</p>
</li>
<li>
<p>uima.cas.EmptyStringList</p>
</li>
<li>
<p>uima.cas.EmptyFSList</p>
</li>
<li>
<p>uima.cas.NonEmptyFloatList</p>
</li>
<li>
<p>uima.cas.NonEmptyIntegerList</p>
</li>
<li>
<p>uima.cas.NonEmptyStringList</p>
</li>
<li>
<p>uima.cas.NonEmptyFSList</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the primitive types <code>Float</code>, <code>Integer</code>, <code>String</code> and <code>FeatureStructure</code>, there is a base type, for instance, <code>uima.cas.FloatList</code>.
For each of these, there are two subtypes, corresponding to a non-empty element, and a marker that serves to indicate the end of the list, or an empty list.
The non-empty types define two features –<code>head</code> and <code>tail</code>.
The head feature holds the particular value for that part of the list.
The tail refers to the next list object (either a non-empty one or the empty version to indicate the end of the list).</p>
</div>
<div class="paragraph">
<p>For JCas users, the new operator for the NonEmptyXyzList classes includes a 3 argument version where you may specify the head and tail values as part of the constructor.
The JCas  cover classes for these implement a <code>push(item)</code> method which creates a new non-empty node, sets the <code>head</code> value to <code>item</code>, and the tail to the node it is called on, and returns the new node.
These classes also implement Iterable, so you can use the enhanced Java <code>for</code> operator.
The iterator stops when it gets to the end of the list, determined by either the tail being null or  the element being one of the EmptyXXXList elements.
Here&#8217;s a StringList example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>StringList sl = jcas.emptyStringList();
sl = sl.push("2");
sl = sl.push("1");

for (String s : sl) {
  someMethod(s);  // some sample use
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are no other built-in types.
Users are free to define their own type systems, building upon these types.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.accessing_the_type_system"><a class="anchor" href="#ugr.ref.cas.accessing_the_type_system"></a>4.4. Accessing the type system</h3>
<div class="paragraph">
<p>During annotator processing, or outside an annotator, access the type system by calling <code>CAS.getTypeSystem()</code>.</p>
</div>
<div class="paragraph">
<p>However, CAS annotators implement an additional method, <code>typeSystemInit()</code>, which is called by the UIMA framework before the annotator&#8217;s process method.
This method, implemented by the annotator writer, is passed a reference to the CAS&#8217;s type system metadata.
The method typically uses the type system APIs to obtain type and feature objects corresponding to all the types and features the annotator will be using in its process method.
This initialization step should not be done during an annotator&#8217;s initialize method since the type system can change after the initialize method is called; it should not be done during the process method, since this is presumably work that is identical for each incoming document, and so should be performed only when the type system changes (which will be a rare event). The UIMA framework guarantees it will call the <code>typeSystemInit </code>method of an annotator whenever the type system changes, before calling the annotator&#8217;s <code>process()</code> method.</p>
</div>
<div class="paragraph">
<p>The initialization done by <code>typeSystemInit()</code> is done by the UIMA framework when you use the JCas APIs; you only need to provide a <code>typeSystemInit()</code> method, as described here, when you are not using the JCas approach.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.type_system.printer_example"><a class="anchor" href="#ugr.ref.cas.type_system.printer_example"></a>4.4.1. TypeSystemPrinter example</h4>
<div class="paragraph">
<p>Here is a code fragment that, given a CAS Type System, will print a list of all types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Get all type names from the type system
// and print them to stdout.
private void listTypes1(TypeSystem ts) {
  for (Type t : ts) {
    // print its name.
    System.out.println(t.getName());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is passed the type system as a parameter.
From the type system, we can  get an iterator over all the types.
If you run this against a CAS created with no additional user-defined types, we should see something like this on the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Types in the type system:
uima.cas.Boolean
uima.cas.Byte
uima.cas.Short
uima.cas.Integer
uima.cas.Long
uima.cas.ArrayBase
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the type system had user-defined types these would show up too.
Note that some of these types are not directly creatable –they are types used by the framework in the type hierarchy (e.g.
uima.cas.ArrayBase).</p>
</div>
<div class="paragraph">
<p>CAS type names include a name-space prefix.
The components of a type name are separated by the dot (.). A type name component must start with a Unicode letter, followed by an arbitrary sequence of letters, digits and the underscore (_). By convention, the last component of a type name starts with an uppercase letter, the rest start with a lowercase letter.</p>
</div>
<div class="paragraph">
<p>Listing the type names is mildly useful, but it would be even better if we could see the inheritance relation between the types.
The following code prints the inheritance tree in indented format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>private static final int INDENT = 2;
private void listTypes2(TypeSystem ts) {
  // Get the root of the inheritance tree.
  Type top = ts.getTopType();
  // Recursively print the tree.
  printInheritanceTree(ts, top, 0);
}

private void printInheritanceTree(TypeSystem ts, Type type, int level) {
  indent(level); // Print indentation.
  System.out.println(type.getName());
  // Get a vector of the immediate subtypes.
  Vector subTypes =
    ts.getDirectlySubsumedTypes(type);
  ++level; // Increase the indentation level.
  for (int i = 0; i &lt; subTypes.size(); i++) {
    // Print the subtypes.
    printInheritanceTree(ts, (Type) subTypes.get(i), level);
  }
}

// A simple, inefficient indenter
private void indent(int level) {
  int spaces = level * INDENT;
  for (int i = 0; i &lt; spaces; i++) {
    System.out.print(" ");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows that you can traverse the type hierarchy by starting at the top with TypeSystem.getTopType and by retrieving subtypes with <code>TypeSystem.getDirectlySubsumedTypes()</code>.</p>
</div>
<div class="paragraph">
<p>The Javadocs also have APIs that allow you to access the features, as well as what the allowed value type is for that feature.
Here is sample code which prints out all the features of all the types, together with the allowed value types (the feature &#8220;range&#8221;). Each feature has a &#8220;domain&#8221; which is the type where it is defined, as well as a &#8220;range&#8221;.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>private void listFeatures2(TypeSystem ts) {
  Iterator featureIterator = ts.getFeatures();
  Feature f;
  System.out.println("Features in the type system:");
  while (featureIterator.hasNext()) {
    f = (Feature) featureIterator.next();
    System.out.println(
      f.getShortName() + ": " +
      f.getDomain() + " -&gt; " + f.getRange());
  }
  System.out.println();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can ask a feature object for its domain (the type it is defined on) and its range (the type of the value of the feature). The terminology derives from the fact that features can be viewed as functions on subspaces of the object space.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.cas_apis_create_modify_feature_structures"><a class="anchor" href="#ugr.ref.cas.cas_apis_create_modify_feature_structures"></a>4.4.2. Using the CAS APIs to create and modify feature structures</h4>
<div class="paragraph">
<p>Assume a type system declaration that defines two types: Entity and Person.
Entity has no features defined within it but inherits from uima.tcas.Annotation&#8201;&#8212;&#8201;so it has the begin and end features.
Person is, in turn, a subtype of Entity, and adds firstName and lastName features.
CAS type systems are declaratively specified using XML; the format of this XML is described in the <a href="#ugr.ref.xml.component_descriptor.type_system">Type System Reference</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;!-- Type System Definition --&gt;
&lt;typeSystemDescription&gt;
  &lt;types&gt;
    &lt;typeDescription&gt;
      &lt;name&gt;com.xyz.proj.Entity&lt;/name&gt;
      &lt;description /&gt;
      &lt;supertypeName&gt;uima.tcas.Annotation&lt;/supertypeName&gt;
    &lt;/typeDescription&gt;
    &lt;typeDescription&gt;
      &lt;name&gt;Person&lt;/name&gt;
      &lt;description /&gt;
      &lt;supertypeName&gt;com.xyz.proj.Entity &lt;/supertypeName&gt;
      &lt;features&gt;
        &lt;featureDescription&gt;
          &lt;name&gt;firstName&lt;/name&gt;
          &lt;description /&gt;
          &lt;rangeTypeName&gt;uima.cas.String&lt;/rangeTypeName&gt;
        &lt;/featureDescription&gt;
        &lt;featureDescription&gt;
          &lt;name&gt;lastName&lt;/name&gt;
          &lt;description /&gt;
          &lt;rangeTypeName&gt;uima.cas.String&lt;/rangeTypeName&gt;
        &lt;/featureDescription&gt;
      &lt;/features&gt;
    &lt;/typeDescription&gt;
  &lt;/types&gt;
&lt;/typeSystemDescription&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To be able to access types and features, we need to know their names.
The CAS interface defines constants that hold the names of built-in feature names, such as, e.g., <code>CAS.TYPE_NAME_INTEGER</code>.
It is good programming practice to create such constants for the types and features you define, for your own use as well as for others who will be using your annotators.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>/** Entity type name constant. */
public static final String ENTITY_TYPE_NAME = "com.xyz.proj.Entity";

/** Person type name constant. */
public static final String PERSON_TYPE_NAME = "com. xyz.proj.Person";

/** First name feature name constant. */
public static final String FIRST_NAME_FEAT_NAME = "firstName";

/** Last name feature name constant. */
public static final String LAST_NAME_FEAT_NAME = "lastName";</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we define type and feature member variables; these will hold the values of the type and feature objects needed by the CAS APIs, to be assigned during <code>typeSystemInit()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Type system object variables
private Type entityType;
private Type personType;
private Feature firstNameFeature;
private Feature lastNameFeature;
private Type stringType;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The type system does not throw an exception if we ask for something that is not known, it simply returns null; therefore the code checks for this and throws a proper exception.
We require all these types and features to be defined for the annotator to work.
One might imagine situations where certain computations are predicated on some type or feature being defined in the type system, but that is not the case here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Get a type object corresponding to a name.
// If it doesn't exist, throw an exception.
private Type initType(String typeName)
  throws AnnotatorInitializationException {
  Type type = ts.getType(typeName);
  if (type == null) {
    throw new AnnotatorInitializationException(
      AnnotatorInitializationException.TYPE_NOT_FOUND,
      new Object[] { this.getClass().getName(), typeName });
  }
  return type;
}

// We add similar code for retrieving feature objects.
// Get a feature object from a name and a type object.
// If it doesn't exist, throw an exception.
private Feature initFeature(String featName, Type type)
  throws AnnotatorInitializationException {
  Feature feat = type.getFeatureByBaseName(featName);
  if (feat == null) {
    throw new AnnotatorInitializationException(
      AnnotatorInitializationException.FEATURE_NOT_FOUND,
      new Object[] { this.getClass().getName(), featName });
  }
  return feat;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using these two functions, code for initializing the type system described above would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void typeSystemInit(TypeSystem aTypeSystem)
    throws AnalysisEngineProcessException {
  this.typeSystem = aTypeSystem;
  // Set type system member variables.
  this.entityType = initType(ENTITY_TYPE_NAME);
  this.personType = initType(PERSON_TYPE_NAME);
  this.firstNameFeature =
    initFeature(FIRST_NAME_FEAT_NAME, personType);
  this.lastNameFeature =
    initFeature(LAST_NAME_FEAT_NAME, personType);
  this.stringType = initType(CAS.TYPE_NAME_STRING);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we initialize the string type by using a type name constant from the CAS.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.creating_feature_structures"><a class="anchor" href="#ugr.ref.cas.creating_feature_structures"></a>4.5. Creating feature structures</h3>
<div class="paragraph">
<p>To create feature structures in JCas, we use the Java &#8220;new&#8221; operator.
In the CAS, we use one of several different API methods on the CAS object, depending on which of the 10 basic kinds of feature structures we are creating (a plain feature structure, or an instance of the built-in primitive type arrays or FSArray). There are is also a method to create an instance of a <code>uima.tcas.Annotation</code>, setting the begin and end values.</p>
</div>
<div class="paragraph">
<p>Once a feature structure is created, it needs to be added to the CAS indexes (unless it will be accessed via some reference from another accessible feature structure). The CAS provides this API: Assuming aCAS holds a reference to a CAS, and token holds a reference to a newly created feature structure, here&#8217;s the code to add that feature structure to all the relevant CAS indexes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    // Add the token to the index repository.
    aCAS.addFsToIndexes(token);</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a corresponding <code>removeFsFromIndexes(token)</code> method on CAS objects.</p>
</div>
<div class="paragraph">
<p>As of version 2.4.1, there are two methods you can use on an index repository  to efficiently bulk-remove all instances of particular types of feature structures from a particular view.
One of these, <code>aCas.getIndexRepository().removeAllIncludingSubtypes(aType)</code> removes all instances of a particular type, including instances which are subtypes of the specified type.
The other, <code>aCas.getIndexRepository().removeAllExcludingSubtypes(aType)</code> remove all instances of a particular type, only.
In both cases, the removal is done from the particular view of the CAS referenced by aCas.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.updating_indexed_feature_structures"><a class="anchor" href="#ugr.ref.cas.updating_indexed_feature_structures"></a>4.5.1. Updating indexed feature structures</h4>
<div class="paragraph">
<p>Version 2.7.0 added protection for indexes when feature structure key value features are updated.
By default this protection is automatic, but  at some performance cost.
Users may optimize this further.</p>
</div>
<div class="paragraph">
<p>Protection is needed because some of the indexes (the Sorted and Set types) use comparators defined to use values of the particular features; if these values  need to be changed after the feature structure is added to the indexes,  the correct way to do this is to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>completely remove the item from all indexes where it is indexed, in all views where it is indexed,</p>
</li>
<li>
<p>update the value of the features being used as keys,</p>
</li>
<li>
<p>add the item back to the indexes, in all views.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>It&#8217;s OK to change feature values which are not used in determining sort ordering (or set membership), without removing and re-adding back to the index.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The automatic protection checks for updates of features being used as keys, and if it finds an update like this for a feature structure that is in the indexes, it removes the feature structure from the indexes, does the update, and adds it back.
It will do this for every feature update.
This is obviously not  efficient when multiple features are being updated; in that case it would better to  remove the feature structure, do all the updates to all the features needing updates, and then do a single add-back operation.</p>
</div>
<div class="paragraph">
<p>This is supported in user&#8217;s code by using the new method <code>protectIndexes</code>  available in both the CAS and JCas interface.
Here&#8217;s two ways of using this, one with a try / finally and the other with a Runnable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// an approach using try / finally
AutoCloseable ac = my_cas.protectIndexes();  // my_cas is a CAS or a JCas
try {
   ...  arbitrary user code which updates features
        which may be "keys" in one or more indexes
} finally {
  ac.close();
}

// This can more compactly be written using the auto-close feature of try:

try (AutoCloseable ac = my_cas.protectIndexes()) {
   ...  arbitrary user code which updates features
        which may be "keys" in one or more indexes
}

// an approach using a Runnable, written in Java 8 lambda syntax
my_cas.protectIndexes(() -&gt; {
  ... arbitrary user code updating "key" features,
      but no checked exceptions are permitted
  });</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>protectIndexes</code> implementation only removes feature structures that have features being updated which are used as keys in some index(es). At the end of the scope of the protectIndexes, it adds all of these back.
It also skips removing feature structures from bag indexes, since these have no keys.</p>
</div>
<div class="paragraph">
<p>Within a <code>protectIndexes</code> block, do not do any operations which depend on the  indexes being valid, such as creating and using an iterator.
This is because the removed FSs  are only added back at the end of the protectIndexes block.</p>
</div>
<div class="paragraph">
<p>The JVM property <code>-Duima.report_fs_update_corrupts_index</code> will generate a log entry everytime the frameworks finds (and automatically surrounds with a remove - add-back) an update to  a feature which could corrupt the index.
The log entries can be identified by scanning for messages starting with <code>While FS was in the index, the feature</code> - the message goes on to identify the feature in question.
Users can use these reports to find the places in their code where  they can either change the design to avoid updating these values after the item is indexed, or surround the updates with their own <code>protectIndexes</code> blocks.</p>
</div>
<div class="paragraph">
<p>Initially, the out-of-the-box defaults for the UIMA framework will run with an automatic (but somewhat inefficient) protection.
To improve upon this, users would:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Turn on reporting using a global JVM flag <code> -Duima.report_fs_update_corrupts_index</code>. This will cause a message to be logged each time the automatic protection is being invoked, and allows the user to find the spots to improve.</p>
</li>
<li>
<p>Improve each spot, perhaps by surrounding the update code with a protectIndexes block, or by rearranging code to reduce updating feature values used as index keys.</p>
</li>
<li>
<p>Once the code is no longer generating any reports, you can turn off the automatic protection for production runs using the JVM global property <code>-Duima.disable_auto_protect_indexes</code>, and rely on the protectIndexes blocks. If protection is disabled, then the corruption detection is skipped, making the production  runs perhaps a bit faster, although this is not significant in most cases.</p>
</li>
<li>
<p>For automated build systems, there&#8217;s a JVM parameter, <code>-Duima.exception_when_fs_update_corrupts_index</code>, which will throw an exception if any automatic recovery situation is encountered. You can use this  in build/test scenarios to insure (after adding all needed protectIndexes blocks) that the code remains safe for  turning off the checking in production runs.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.accessing_modifying_feature_structures"><a class="anchor" href="#ugr.ref.cas.accessing_modifying_feature_structures"></a>4.6. Accessing or modifying feature structures</h3>
<div class="paragraph">
<p>Values of individual features for a feature structure can be set or referenced, using a set of methods that depend on the type of value that feature is declared to have.
There are methods on FeatureStructure for this: getBooleanValue, getByteValue, getShortValue, getIntValue, getLongValue, getFloatValue, getDoubleValue, getStringValue, and getFeatureValue (which means to get a value which in turn is a reference to a feature structure). There are corresponding &#8220;setter&#8221; methods, as well.
These methods on the feature structure object take as arguments the feature object retrieved earlier in the typeSystemInit method.</p>
</div>
<div class="paragraph">
<p>Using the previous example, with the type system initialized with type personType and feature lastNameFeature, here&#8217;s a sample code fragment that gets and sets that feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Assume aPerson is a variable holding an object of type Person
// get the lastNameFeature value from the feature structure
String lastName = aPerson.getStringValue(lastNameFeature);
// set the lastNameFeature value
aPerson.setStringValue(lastNameFeature, newStringValueForLastName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The getters and setters for each of the primitive types are defined in the Javadocs as methods of the FeatureStructure interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.indexes_and_iterators"><a class="anchor" href="#ugr.ref.cas.indexes_and_iterators"></a>4.7. Indexes and Iterators</h3>
<div class="paragraph">
<p>Each CAS can have many indexes associated with it; each CAS View contains  a complete set of instantiations of the indexes.
Each index is represented by an instance of the type org.apache.uima.cas.FSIndex.
You use the object org.apache.uima.cas.FSIndexRepository, accessible via a method on a CAS object, to retrieve instances of indexes.
There are methods that let you select the index by name, by type, or by both name and type.
Since each index is already associated with a type,  passing both a name and a type is valid only if the type passed in is the same type or a subtype of the one declared in the index specification for the named index.
If you pass in a subtype, the returned FSIndex object refers to an index that will return only items belonging to that subtype (or subtypes of that subtype).</p>
</div>
<div class="paragraph">
<p>The returned FSIndex objects are used, in turn, to create iterators.
There is also a method on the Index Repository, <code>getAllIndexedFS</code>,  which will return an iterator over all indexed Feature Structures (for that CAS View), in no particular order.
The iterators created can be used like common Java iterators, to sequentially retrieve items indexed.
If the index represents a sorted index, the items are returned in a sorted order, where the sort order is specified in the XML index definition.
This XML is part of the Component Descriptor, see <a href="#ugr.ref.xml.component_descriptor.aes.index">Index Definition</a>.</p>
</div>
<div class="paragraph">
<p>In UIMA V3, Feature structures may be added to or removed from indexes while iterating over them.
If this happens, any iterators already created will continue to operate over the before-modification version of the index, unless or until the iterator is re-synchronized with the current value of the index via one of the following specific 3 iterator API calls:  moveToFirst, moveToLast, or moveTo(FeatureStructure). ConcurrentModificationException is no longer thrown in UIMA v3.</p>
</div>
<div class="paragraph">
<p>Feature structures being iterated over may have features which are used as the "keys" of an index, updated.
If this is done, UIMA will protect the indexes (to prevent index corruption) by automatically removing the  Feature Structure from the indexes,  updating the field, and adding the FS back to the index (possibly in a new position).   This automatic remove / add-back operation no longer makes the iterator throw a ConcurrentModificationException (as it did in UIMA Version 2) if the iterator is incremented or decremented; existing iterators will continue to operate as if no index modification occurred.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.index.built_in_indexes"><a class="anchor" href="#ugr.ref.cas.index.built_in_indexes"></a>4.7.1. Built-in Indexes</h4>
<div class="paragraph">
<p>An unnamed built-in bag index exists which holds all feature structures which are indexed.
The only access to this index is the method <code>getAllIndexedFS(Type)`</code> which returns an iterator over all indexed Feature Structures.</p>
</div>
<div class="paragraph">
<p>The CAS also contains a built-in index for the type <code>uima.tcas.Annotation</code>, which sorts annotations in the order in which they appear in the document.
Annotations are sorted first by increasing <code>begin</code> position.
Ties are then broken by <em>decreasing</em><code>end</code> position (so that longer annotations come first). Annotations that match in both their <code>begin</code> and <code>end</code> features are sorted using the <a href="#ugr.ref.xml.component_descriptor.aes.type_priority">Type Priority</a>, if any are defined.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.index.adding_to_indexes"><a class="anchor" href="#ugr.ref.cas.index.adding_to_indexes"></a>4.7.2. Adding Feature Structures to the Indexes</h4>
<div class="paragraph">
<p>Feature Structures are added to the indexes by various APIs.
These add the Feature Structure to <em>all</em> indexes that are defined for the type of that <code>FeatureStructure</code> (or any of its supertypes), in a particular view.
Note that you should not add a Feature Structure to the indexes until you have set values for all of the features that may be used as sort keys in an index.</p>
</div>
<div class="paragraph">
<p>There are multiple APIs for adding FSs to the index.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(preferred) <code>myFeatureStructure.addToIndexes()</code>. This adds the feature structure instance to the view in which it was originally created.</p>
</li>
<li>
<p>(preferred) <code>myFeatureStructure.addToIndexes(JCas or CAS)</code>. This adds the feature structure instance to the view represented by the argument.</p>
</li>
<li>
<p>(older form) <code>casView.addFsToIndexes(myFeatureStructure)</code> or <code>jcasView.addFsToIndexes(myFeatureStructure)</code>.  This adds the feature structure instance to the view represented by the cas (or jcas).</p>
</li>
<li>
<p>(older form) <code>fsIndexRepositoryView.addFsToIndexes(myFeatureStructure)</code>.  This adds the feature structure instance to the view represented by the <code>fsIndexRepository</code> instance.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.index.iterators"><a class="anchor" href="#ugr.ref.cas.index.iterators"></a>4.7.3. Iterators over UIMA Indexes</h4>
<div class="paragraph">
<p>Iterators are objects of class <code>org.apache.uima.cas.FSIterator.</code> This class extends <code>java.util.Iterator</code> and implements the normal Java iterator methods, plus additional ones that allow moving both forwards and backwards.</p>
</div>
<div class="paragraph">
<p>UIMA Indexes implement <code>Iterable</code>, so you can use the index directly in a Java extended for loop.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.index.annotation_index"><a class="anchor" href="#ugr.ref.cas.index.annotation_index"></a>4.7.4. Special iterators for Annotation types</h4>
<div class="paragraph">
<p>Note: we recommend using the UIMA V3 select framework, instead of the following.
It implements all of the following capabilities, and more, in a uniform manner.</p>
</div>
<div class="paragraph">
<p>The built-in index over the <code>uima.tcas.Annotation</code> type named &#8220;`AnnotationIndex`&#8221; has additional capabilities.
To use them, you first get a reference to this built-in index using either the <code>getAnnotationIndex</code> method on a CAS View object, or by asking the <code>FSIndexRepository</code> object for an index having the particular name &#8220;AnnotationIndex&#8221;, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>AnnotationIndex idx = aCAS.getAnnotationIndex();
// or you can iterate over a specific subtype of Annotation:
AnnotationIndex idx = aCAS.getAnnotationIndex(aType);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This object can be used to produce several additional kinds of iterators.
It can produce unambiguous iterators; these skip over elements until it finds one where the start position of the next annotation is equal to or greater than the end position of the previously returned annotation.</p>
</div>
<div class="paragraph">
<p>It can also produce several kinds of subiterators; these are iterators whose annotations fall within the span of another annotation.
This kind of iterator can also have the unambiguous property, if desired.
It also can be &#8220;strict&#8221; or not; strict means that the returned annotation lies completely within the span of the controlling annotation.
Non-strict only implies that the beginning of the returned annotation falls within the span of the controlling annotation.</p>
</div>
<div class="paragraph">
<p>There is also a method which produces an <code>AnnotationTree</code> object, which contains nodes representing the results of doing a strict, unambiguous subiterator over the span of some controlling annotation.
For more details, please refer to the Javadocs for the <code>org.apache.uima.cas.text</code> package.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.index.constraints_and_filtered_iterators"><a class="anchor" href="#ugr.ref.cas.index.constraints_and_filtered_iterators"></a>4.7.5. Constraints and Filtered iterators</h4>
<div class="paragraph">
<p>Note: for new code, consider using the select framework plus Streams, instead of the following.</p>
</div>
<div class="paragraph">
<p>There is a set of API calls that build constraint objects.
These objects can be used directly to test if a particular feature structure matches (satisfies) the constraint, or they can be passed to the createFilteredIterator method to create an iterator that skips over instances which fail to satisfy the constraint.</p>
</div>
<div class="paragraph">
<p>It is possible to specify a feature value located by following a chain of references starting from the feature structure being tested.
Here&#8217;s a scenario to explore this concept.
Let&#8217;s suppose you have the following type system (namespaces are omitted for clarity):</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Token</strong>, having a feature PartOfSpeech which holds a reference to another type (POS)</p>
</div>
<div class="paragraph">
<p><strong>POS</strong> (a type with many subtypes, each representing a different part of speech)</p>
</div>
<div class="paragraph">
<p><strong>Noun</strong> (a subtype of POS)</p>
</div>
<div class="paragraph">
<p><strong>ProperName</strong> (a subtype of Noun), having a feature Class which holds an integer value encoding some information about the proper noun.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>If you want to filter Token instances, such that only those tokens get through which are proper names of class 3 (for example), you would need a test that started with a Token instance, followed its PartOfSpeech reference to another instance (the ProperName instance) and then tested the Class feature of that instance for a value equal to 3.</p>
</div>
<div class="paragraph">
<p>To support this, the filtering approach has components that specify tests, and components that specify &#8220;paths&#8221;.
The tests that can be done include testing references to type instances to see if they are instances of some type or its subtypes; this is done with a FSTypeConstraint constraint.
Other tests check for equality or, for numeric values, ranges.</p>
</div>
<div class="paragraph">
<p>Each test may be combined with a path&#8201;&#8212;&#8201;to get to the value to test.
Tests that start from a feature structure instance can be combined with and and or connectors.
The Javadocs for these are in the package org.apache.uima.cas in the classes that end in Constraint, plus the classes ConstraintFactory, FeaturePath and CAS.
Here&#8217;s an example; assume the variable cas holds a reference to a CAS instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// Start by getting the constraint factory from the CAS.
ConstraintFactory cf = cas.getConstraintFactory();

// To specify a path to an item to test, you start by
// creating an empty path.
FeaturePath path = cas.createFeaturePath();

// Add POS feature to path, creating one-element path.
path.addFeature(posFeat);

// You can extend the chain arbitrarily by adding additional
// features.

// Create a new type constraint.

// Type constraints will check that structures
// they match against have a type at least as specific
// as the type specified in the constraint.
FSTypeConstraint nounConstraint = cf.createTypeConstraint();

// Set the type (by default it is TOP).
// This succeeds if the type being tested by this constraint
// is nounType or a subtype of nounType.
nounConstraint.add(nounType);

// Embed the noun constraint under the pos path.
// This means, associate the test with the path, so it tests the
// proper value.

// The result is a test which will
// match a feature structure that has a posFeat defined
// which has a value which is an instance of a nounType or
// one of its subtypes.
FSMatchConstraint embeddedNoun = cf.embedConstraint(path, nounConstraint);

// Create a type constraint for token (or a subtype of it)
FSTypeConstraint tokenConstraint = cf.createTypeConstraint();

// Set the type.
tokenConstraint.add(tokenType);

// Create the final constraint by conjoining the two constraints.
FSMatchConstraint nounTokenCons = cf.and(nounConstraint, tokenConstraint);

// Create a filtered iterator from some annotation iterator.
FSIterator it = cas.createFilteredIterator(annotIt, nounTokenCons);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.guide_to_javadocs"><a class="anchor" href="#ugr.ref.cas.guide_to_javadocs"></a>4.8. The CAS API&#8217;s&#8201;&#8212;&#8201;a guide to the Javadocs</h3>
<div class="paragraph">
<p>The CAS APIs are organized into 3 Java packages: cas, cas.impl, and cas.text.
Most of the APIs described here are in the cas package.
The cas.impl package contains classes used in serializing and deserializing (reading and writing external representations) the CAS in various formats, for transporting the CAS among local and remote annotators, or for storing the CAS in permanent storage.
The cas.text contains the APIs that extend the CAS to support artifact (including &#8220;text&#8221;) analysis.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.cas.javadocs.cas_package"><a class="anchor" href="#ugr.ref.cas.javadocs.cas_package"></a>4.8.1. APIs in the CAS package</h4>
<div class="paragraph">
<p>The main objects implementing the APIs discussed here are shown in the diagram below.
The hierarchy represents that there is a way to get from an upper object to an instance of the lower object, usually by using a method on the upper object; this is not an inheritance hierarchy.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./ref/images/references/ref.cas/image001.png" alt="CAS object hierarchy">
</div>
<div class="title">Figure 2. CAS Object hierarchy</div>
</div>
<div class="paragraph">
<p>The main Interface is the CAS interface.
This has most of the functionality of the CAS, except for the type system metadata access, and the indexing access.
JCas and CAS are alternative representations and API approaches to the CAS; each has a method to get the other.
You can mix JCas and CAS APIs in your application as needed.
To use the JCas APIs, you have to create the Java classes that correspond to the CAS types, and include them in the Java class path of the application.
If you have a CAS object, you can get a JCas object by using the <code>getJCas()</code> method call on the CAS object; likewise, you can get the CAS object from a JCas by using the <code>getCAS()</code> method call on the JCas object.
There is also a low level CAS interface that is not part of the official API, and is intended for internal use only&#8201;&#8212;&#8201;it is not documented here.</p>
</div>
<div class="paragraph">
<p>The type system metadata APIs are found in the TypeSystem interface.
The objects defining each type and feature are defined by the interfaces Type and Feature.
The Type interface has methods to see what types subsume other types, to iterate over the types available, and to extract information about the types, including what features it has.
The Feature interface has methods that get what type it belongs to, its name, and its range (the kind of values it can hold).</p>
</div>
<div class="paragraph">
<p>The FSIndexRepository gives you access to methods to get instances of indexes, and also provides access to the iterator over all indexed feature structures: <code>getAllIndexedFS(aType)</code>.
The FSIndex and AnnotationIndex objects give you methods to create instances of iterators.</p>
</div>
<div class="paragraph">
<p>Iterators and the CAS methods that create new feature structures return FeatureStructure objects.
These objects can be used to set and get the values of defined features within them.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.typemerging"><a class="anchor" href="#ugr.ref.cas.typemerging"></a>4.9. Type Merging</h3>
<div class="paragraph">
<p>When annotators are combined in an aggregate, their defined type systems are merged.
This is designed to support independent development of annotator components.
The merge results in a single defined type system for CASes that flow through a particular set of annotators.</p>
</div>
<div class="paragraph">
<p>The basic operation of a type system merge is to iterate through all the defined types, and if two annotators define the same fully qualified type name,  to take the features defined for those types and form a logical union of those features.
This operation requires that same-named features have the same range type names.
The resulting type system has features comprising the union of all features over all the various definitions for this type in different annotators.</p>
</div>
<div class="paragraph">
<p>Feature merging checks that for all features having the same name in a type, that the range type is identical; otherwise an error is signaled.</p>
</div>
<div class="paragraph">
<p>Types are combined for merging when their fully qualified names are the same.
Two different definitions can be merged even if their supertype definitions do not match, if one supertype subsumes the other supertype; otherwise an error is signaled.
Likewise, two types with the same name can be merged only if their features can be merged.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.cas.limitedmultipleaccess"><a class="anchor" href="#ugr.ref.cas.limitedmultipleaccess"></a>4.10. Limited multi-thread access to read-only CASs</h3>
<div class="paragraph">
<p>Some applications may find it useful to scale up pipelines and run these in parallel.</p>
</div>
<div class="paragraph">
<p>Generally, CASs are not threadsafe, and only one thread at a time may operate on it.
In many scenarios, a CAS may be initialized and then filled with Feature Structures, and after some point, no more updates to that particular CAS will be done.</p>
</div>
<div class="paragraph">
<p>If a CAS is no longer going to be changed, it is possible to  access it on multiple threads in a read-only mode, simultaneously, with some limitations.
Limitations  arise because some UIMA Framework activities may update internal CAS data structures.</p>
</div>
<div class="paragraph">
<p>Operational data is updated while running a pipeline when a PEAR is entered or exited,  because PEARs establish new class loaders and can potentially switch the JCas classes being used (This happens because the class loaders might define different JCas cover classes  implementing the same UIMA type). Because of this, you cannot have multiple pipelines accessing a CAS in read-only mode if one or more of those pipelines contains a PEAR.
There are other edge cases where this may happen as well; for example, if you are  running a pipeline with an Extension Class Loader,  and have a callback routine loaded under a different class loader, UIMA will switch the JCas classes when calling the callback.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.jcas"><a class="anchor" href="#ugr.ref.jcas"></a>5. JCas Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The CAS is a system for sharing data among annotators, consisting of data structures (definable at run time), sets of indexes over these data, metadata describing these, subjects of analysis, and a high performance serialization/deserialization mechanism.
JCas provides Java approach to accessing CAS data, and is based on using generated, specific Java classes for each CAS type.</p>
</div>
<div class="paragraph">
<p>Annotators process one CAS per call to their process method.
During processing, annotators can retrieve feature structures from the passed in CAS, add new ones, modify existing ones, and use and update CAS indexes.
Of course, an annotator can also use plain Java Objects in addition; but the data in the CAS is what is shared among annotators within an application.</p>
</div>
<div class="paragraph">
<p>All the facilities present in the APIs for the CAS are available when using the JCas APIs; indeed, you can use the getCas() method to get the corresponding CAS object from a JCas (and vice-versa). The JCas APIs often have helper methods that make using this interface more convenient for Java developers.</p>
</div>
<div class="paragraph">
<p>The data in the CAS are typed objects having fields.
JCas uses a set of generated Java classes (each corresponding to a particular CAS type) with &#8220;getter&#8221; and &#8220;setter&#8221; methods for the features, plus a constructor so new instances can be made.
The Java classes stores the data in the class instance.</p>
</div>
<div class="paragraph">
<p>Users can modify the JCas generated Java classes by adding fields to them; this allows arbitrary non-CAS data to also be represented within the JCas objects, as well; however, the non-CAS data stored in the JCas object instances cannot be shared with annotators using the plain CAS, unless special provision is made - see the chapter in the v3 user&#8217;s guide on storing arbitrary Java objects in the CAS.</p>
</div>
<div class="paragraph">
<p>The JCas class Java source files are generated from XML type system descriptions.
The JCasGen utility does the work of generating the corresponding Java Class Model for the CAS types.
There are a variety of ways JCasGen can be run; these are described later.
You include the generated classes with your UIMA component, and you can publish these classes for others who might want to use your type system.</p>
</div>
<div class="paragraph">
<p>JCas classes are not required for all UIMA types.
Those types which don&#8217;t have  corresponding JCas classes use the nearest JCas class corresponding to a type in their superchain.</p>
</div>
<div class="paragraph">
<p>The specification of the type system in XML can be written using a conventional text editor, an XML editor, or using the Eclipse plug-in that supports editing UIMA descriptors.</p>
</div>
<div class="paragraph">
<p>Changes to the type system are done by changing the XML and regenerating the corresponding Java Class Models.
Of course, once you&#8217;ve published your type system for others to use, you should be careful that any changes you make don&#8217;t adversely impact the users.
Additional features can be added to existing types without breaking other code.</p>
</div>
<div class="paragraph">
<p>A separate Java class is generated for each type; this type implements the CAS FeatureStructure interface, as well as having the special getters and setters for the included features.
The generated Java classes have methods (getters and setters) for the fields as defined in the XML type specification.
Descriptor comments are reflected in the generated Java code as Java-doc style comments.</p>
</div>
<div class="sect2">
<h3 id="ugr.ref.jcas.name_spaces"><a class="anchor" href="#ugr.ref.jcas.name_spaces"></a>5.1. Name Spaces</h3>
<div class="paragraph">
<p>Full Type names consist of a &#8220;namespace&#8221; prefix dotted with a simple name.
Namespaces are used like packages to avoid collisions between types that are defined by different people at different times.
The namespace is used as the Java package name for generated Java files.</p>
</div>
<div class="paragraph">
<p>Type names used in the CAS correspond to the generated Java classes directly.
If the CAS name is com.myCompany.myProject.ExampleClass, the generated Java class is in the package com.myCompany.myProject, and the class is ExampleClass.</p>
</div>
<div class="paragraph">
<p>An exception to this rule is the built-in types starting with <code>uima.cas </code>and <code>uima.tcas</code>; these names are mapped to Java packages named <code>org.apache.uima.jcas.cas</code> and <code>org.apache.uima.jcas.tcas</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.jcas.use_of_description"><a class="anchor" href="#ugr.ref.jcas.use_of_description"></a>5.2. XML description element</h3>
<div class="paragraph">
<p>Each XML type specification can have &lt;description &#8230;&#8203; &gt; tags.
The description for a type will be copied into the generated Java code, as a Javadoc style comment for the class.
When writing these descriptions in the XML type specification file, you might want to use html tags, as allowed in Javadocs.</p>
</div>
<div class="paragraph">
<p>If you use the Component Description Editor, you can write the html tags normally, for instance, &#8220;&lt;h1&gt;My Title&lt;/h1&gt;&#8221;.
The Component Descriptor Editor will take care of coverting the actual descriptor source so that it has the leading &#8220;&lt;&#8221; character written as &#8220;&lt;&#8221;, to avoid confusing the XML type specification.
For example, &lt;p&gt; would be written in the source of the descriptor as &lt;p&gt;. Any characters used in the Javadoc comment must of course be from the character set allowed by the XML type specification.
These specifications often start with the line &lt;?xml version=&#8220;1.0&#8221; encoding=&#8220;UTF-8&#8221; ?&gt;, which means you can use any of the UTF-8 characters.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.jcas.mapping_built_ins"><a class="anchor" href="#ugr.ref.jcas.mapping_built_ins"></a>5.3. Mapping built-in CAS types to Java types</h3>
<div class="paragraph">
<p>The built-in primitive CAS types map to Java types as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>uima.cas.Boolean  boolean
uima.cas.Byte     byte
uima.cas.Short    short
uima.cas.Integer  int
uima.cas.Long     long
uima.cas.Float    float
uima.cas.Double   double
uima.cas.String   String</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.jcas.augmenting_generated_code"><a class="anchor" href="#ugr.ref.jcas.augmenting_generated_code"></a>5.4. Augmenting the generated Java Code</h3>
<div class="paragraph">
<p>The Java Class Models generated for each type can be augmented by the user.
Typical augmentations include adding additional (non-CAS) fields and methods, and import statements that might be needed to support these.
Commonly added methods include additional constructors (having different parameter signatures), and implementations of toString().</p>
</div>
<div class="paragraph">
<p>To augment the code, just edit the generated Java source code for the class named the same as the CAS type.
Here&#8217;s an example of an additional method you might add; the various getter methods are retrieving values from the instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public String toString() { // for debugging
  return "XsgParse "
    + getslotName() + ": "
    + getheadWord().getCoveredText()
    + " seqNo: " + getseqNo()
    + ", cAddr: " + id
    + ", size left mods: " + getlMods().size()
    + ", size right mods: " + getrMods().size();
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.keeping_augmentations_when_regenerating"><a class="anchor" href="#ugr.ref.jcas.keeping_augmentations_when_regenerating"></a>5.4.1. Keeping hand-coded augmentations when regenerating</h4>
<div class="paragraph">
<p>If the type system specification changes, you have to re-run the JCasGen generator.
This will produce updated Java for the Class Models that capture the changed specification.
If you have previously augmented the source for these Java Class Models, your changes must be merged with the newly (re)generated Java source code for the Class Models.
This can be done by hand, or you can run the version of JCasGen that is integrated with Eclipse, and use automatic merging that is done using Eclipse&#8217;s EMF plug-in.
You can obtain Eclipse and the needed EMF plug-in from <a href="http://www.eclipse.org/" class="bare">http://www.eclipse.org/</a>.</p>
</div>
<div class="paragraph">
<p>If you run the generator version that works without using Eclipse, it will not merge Java source changes you may have previously made; if you want them retained, you&#8217;ll have to do the merging by hand.</p>
</div>
<div class="paragraph">
<p>The Java source merging will keep additional constructors, additional fields, and any changes you may have made to the readObject method (see below). Merging will <em>not</em> delete classes in the target corresponding to deleted CAS types, which no longer are in the source – you should delete these by hand.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>The merging supports Java 1.4 syntactic constructs only.
JCasGen generates Java 1.4 code, so as long as any code you change here also sticks to  only Java 1.4 constructs, the merge will work.
If you use Java 5 or later specific syntax or constructs, the merge operation will likely fail to merge properly.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.additional_constructors"><a class="anchor" href="#ugr.ref.jcas.additional_constructors"></a>5.4.2. Additional Constructors</h4>
<div class="paragraph">
<p>Any additional constructors that you add must include the JCas argument.
The first line of your constructor is required to be</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>this(jcas);        // run the standard constructor</code></pre>
</div>
</div>
<div class="paragraph">
<p>where jcas is the passed in JCas reference.
If the type you&#8217;re defining extends <code>uima.tcas.Annotation</code>, JCasGen will automatically add a constructor which takes 2 additional parameters – the begin and end Java int values, and set the <code>uima.tcas.Annotation<code>`begin</code> and `end</code> fields.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example: If you&#8217;re defining a type MyType which has a feature parent, you might make an additional constructor which has an additional argument of parent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>MyType(JCas jcas, MyType parent) {
  this(jcas);        // run the standard constructor
  setParent(parent); // set the parent field from the parameter
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.jcas.using_readobject"><a class="anchor" href="#ugr.ref.jcas.using_readobject"></a>Using readObject</h5>
<div class="paragraph">
<p>Fields defined by augmenting the Java Class Model to include additional fields represent data that exist for this class in Java, in a local JVM (Java Virtual Machine), but do not exist in the CAS when it is passed to other environments (for example, passing to a remote annotator).</p>
</div>
<div class="paragraph">
<p>A problem can arise when new instances are created, perhaps by the underlying system when it iterates over an index, which is: how to insure that any additional non-CAS fields are properly initialized.
To allow for arbitrary initialization at instance creation time, an initialization method in the Java Class Model, called readObject is used.
The generated default for this method is to do nothing, but it is one of the methods that you can modify –to do whatever initialization might be needed.
It is called with 0 parameters, during the constructor for the object, after the basic object fields have been set up.
It can refer to fields in the CAS using the getters and setters, and other fields in the Java object instance being initialized.</p>
</div>
<div class="paragraph">
<p>A pre-existing CAS feature structure could exist if a CAS was being passed to this annotator; in this case the JCas system calls the readObject method when creating the corresponding Java instance for the first time for the CAS feature structure.
This can happen at two points: when a new object is being returned from an iterator over a CAS index, or a getter method is getting a field for the first time whose value is a feature structure.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.modifying_generated_items"><a class="anchor" href="#ugr.ref.jcas.modifying_generated_items"></a>5.4.3. Modifying generated items</h4>
<div class="paragraph">
<p>The following modifications, if made in generated items, will be preserved when regenerating.</p>
</div>
<div class="paragraph">
<p>The public/private etc.
flags associated with methods (getters and setters). You can change the default (&#8220;public&#8221;) if needed.</p>
</div>
<div class="paragraph">
<p>&#8220;final&#8221; or &#8220;abstract&#8221; can be added to the type itself, with the usual semantics.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.jcas.merging_types_from_other_specs"><a class="anchor" href="#ugr.ref.jcas.merging_types_from_other_specs"></a>5.5. Merging types</h3>
<div class="paragraph">
<p>Type definitions are merged by the framework from all the components being run together.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.merging_types.aggregates_and_cpes"><a class="anchor" href="#ugr.ref.jcas.merging_types.aggregates_and_cpes"></a>5.5.1. Aggregate AEs and CPEs as sources of types</h4>
<div class="paragraph">
<p>When running aggregate AEs (Analysis Engines), or a set of AEs in a collection processing engine, the UIMA framework will build a merged type system (Note: this &#8220;merge&#8221; is merging types, not to be confused with merging Java source code, discussed above). This merged type system has all the types of every component used in the application.
In addition, application code can use UIMA Framework APIs to read and merge type descriptions, manually.</p>
</div>
<div class="paragraph">
<p>In most cases, each type system can have its own Java Class Models generated individually, perhaps at an earlier time, and the resulting class files (or .jar files containing these class files) can be put in the class path to enable JCas.</p>
</div>
<div class="paragraph">
<p>However, it is possible that there may be multiple definitions of the same CAS type, each of which might have different features defined.
In this case, the UIMA framework will create a merged type by accumulating all the defined features for a particular type into that type&#8217;s type definition.
However, the JCas classes for these types are not automatically merged, which can create some issues for JCas users, as discussed in the next section.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.merging_types.jcasgen_support"><a class="anchor" href="#ugr.ref.jcas.merging_types.jcasgen_support"></a>5.5.2. JCasGen support for type merging</h4>
<div class="paragraph">
<p>When there are multiple definitions of the same CAS type with different features defined, then <a href="tools.html#ugr.tools.jcasgen">JCasGen</a> can be re-run on the merged type system, to create one set of JCas Class definitions for the merged types, which can then be shared by all the components.
This is typically done by the person who is assembling the Aggregate Analysis Engine or Collection Processing Engine.
The resulting merged Java Class Model will then contain get and set methods for the complete set of features.
These Java classes must then be made available in the class path, <em>replacing</em> the pre-merge versions of the classes.</p>
</div>
<div class="paragraph">
<p>If hand-modifications were done to the pre-merge versions of the classes, these must be applied to the merged versions, as described in section <a href="#ugr.ref.jcas.keeping_augmentations_when_regenerating">Section 5.4.1</a>, above.
If just one of the pre-merge versions had hand-modifications, the source for this hand-modified version can be put into the file system where the generated output will go, and the -merge option for JCasGen will automatically merge the hand-modifications with the generated code.
If <em>both</em> pre-merged versions had hand-modifications, then these modifications must be manually merged.</p>
</div>
<div class="paragraph">
<p>An alternative to this is packaging the components as individual PEAR files, each with their own version of the JCas generated Classes.
The Framework can run PEAR files using the  pear file descriptor, and supply each component with its particular version of the JCas generated class.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.impact_of_type_merging_on_composability"><a class="anchor" href="#ugr.ref.jcas.impact_of_type_merging_on_composability"></a>5.5.3. Type Merging impacts on Composability</h4>
<div class="paragraph">
<p>The recommended approach in UIMA is to build and maintain type systems as separate components, which are imported by Annotators.
Using this approach, Type Merging does not occur because the Type System and its JCas classes are centrally managed and shared by the annotators.</p>
</div>
<div class="paragraph">
<p>If you do choose to create a JCas Annotator that relies on Type Merging (meaning that your annotator redefines a Type that is already in use elsewhere, and adds its own features), this can negatively impact the reusability of your annotator, unless your component is used as a PEAR file.</p>
</div>
<div class="paragraph">
<p>If not using PEAR file packaging isolation capability, whenever  anyone wants to combine your annotator with another annotator that uses a different version of the same Type, they will need to be aware of all of the issues described in the previous section.
They will need to have the know-how to re-run JCasGen and appropriately set up their classpath to include the merged Java classes and to not include the pre-merge classes.
(To enable this, you should package these classes separately from other .jar files for your annotator, so that they can be more easily excluded.) And, if you have done hand-modifications to your JCas classes, the person assembling your annotator will need to properly merge those changes.
These issues significantly complicate the task of combining annotators, and will cause your annotator not to be as easily reusable as other UIMA annotators.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.documentannotation_issues"><a class="anchor" href="#ugr.ref.jcas.documentannotation_issues"></a>5.5.4. Adding Features to DocumentAnnotation</h4>
<div class="paragraph">
<p>There is one built-in type, <code>uima.tcas.DocumentAnnotation</code>,  to which applications can add additional features.
(All other built-in types are "feature-final" and you cannot add additional features to them.)  Frequently, additional features are added to <code>uima.tcas.DocumentAnnotation</code>  to provide a place to store document-level metadata.</p>
</div>
<div class="paragraph">
<p>For the same reasons mentioned in the previous section, adding features to  DocumentAnnotation is not recommended if you are using JCas.
Instead, it is recommended that you define your own type for storing your document-level metadata.
You can create  an instance of this type and add it to the indexes in the usual way.
You can then retrieve this instance using the iterator returned from the method<code>getAllIndexedFS(type)</code> on an instance of a JFSIndexRepository object.
(As of UIMA v2.1, you do not have to declare a custom index in your descriptor to get this to work).</p>
</div>
<div class="paragraph">
<p>If you do choose to add features to DocumentAnnotation, there are additional issues to be aware of.
The UIMA SDK provides the JCas cover class for the built-in definition of DocumentAnnotation, in the separate jar file <code>uima-document-annotation.jar</code>.
If you add additional features to DocumentAnnotation, you must remove this jar file from your classpath, because you will not want to use the default JCas cover class.
You will need to re-run JCasGen as described in <a href="#ugr.ref.jcas.merging_types.jcasgen_support">Section 5.5.2</a>.
JCasGen will generate a new cover class for DocumentAnnotation, which you must place in your classpath in lieu of the version in <code>uima-document-annotation.jar</code>.</p>
</div>
<div class="paragraph">
<p>Also, this is the reason why the method <code>JCas.getDocumentAnnotationFs()</code> returns type <code>TOP</code>, rather than type <code>DocumentAnnotation</code>.
Because the <code>DocumentAnnotation</code> class can be replaced by users, it is not part of <code>uima-core.jar</code> and so the core UIMA framework cannot have any references to it.
In your code, you may &#8220;cast&#8221; the result of <code>JCas.getDocumentAnnotationFs()</code>  to type <code>DocumentAnnotation</code>, which must be available on the classpath either via <code>uima-document-annotation.jar</code> or by including a custom version that you have generated using JCasGen.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.jcas.using_within_an_annotator"><a class="anchor" href="#ugr.ref.jcas.using_within_an_annotator"></a>5.6. Using JCas within an Annotator</h3>
<div class="paragraph">
<p>To use JCas within an annotator, you must include the generated Java classes output from JCasGen in the class path.</p>
</div>
<div class="paragraph">
<p>An annotator written using JCas is built by defining a class for the annotator that extends JCasAnnotator_ImplBase.
The process method for this annotator is written</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>public void process(JCas jcas)
     throws AnalysisEngineProcessException {
  ... // body of annotator goes here
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The process method is passed the JCas instance to use as a parameter.</p>
</div>
<div class="paragraph">
<p>The JCas reference is used throughout the annotator to refer to the particular JCas instance being worked on.
In pooled or multi-threaded implementations, there will be a separate JCas for each thread being (simultaneously) worked on.</p>
</div>
<div class="paragraph">
<p>You can do several kinds of operations using the JCas APIs: create new feature structures (instances of CAS types) (using the new operator), access existing feature structures passed to your annotator in the JCas (for example, by using the next method of an iterator over the feature structures), get and set the fields of a particular instance of a feature structure, and add and remove feature structure instances from the CAS indexes.
To support iteration, there are also functions to get and use indexes and iterators over the instances in a JCas.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.new_instances"><a class="anchor" href="#ugr.ref.jcas.new_instances"></a>5.6.1. Creating new instances using the Java &#8220;new&#8221; operator</h4>
<div class="paragraph">
<p>The new operator creates new instances of JCas types.
It takes at least one parameter, the JCas instance in which the type is to be created.
For example, if there was a type Meeting defined, you can create a new instance of it using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Meeting m = new Meeting(jcas);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other variations of constructors can be added in custom code; the single parameter version is the one automatically generated by JCasGen.
For types that are subtypes of Annotation, JCasGen also generates an additional constructor with additional &#8220;begin&#8221; and &#8220;end&#8221; arguments.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.getters_and_setters"><a class="anchor" href="#ugr.ref.jcas.getters_and_setters"></a>5.6.2. Getters and Setters</h4>
<div class="paragraph">
<p>If the CAS type Meeting had fields location and time, you could get or set these by using getter or setter methods.
These methods have names formed by splicing together the word &#8220;get&#8221; or &#8220;set&#8221; followed by the field name, with the first letter of the field name capitalized.
For instance</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>getLocation()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The getter forms take no parameters and return the value of the field; the setter forms take one parameter, the value to set into the field, and return void.</p>
</div>
<div class="paragraph">
<p>There are built-in CAS types for arrays of integers, strings, floats, and feature structures.
For fields whose values are these types of arrays, there is an alternate form of getters and setters that take an additional parameter, written as the first parameter, which is the index in the array of an item to get or set.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.obtaining_refs_to_indexes"><a class="anchor" href="#ugr.ref.jcas.obtaining_refs_to_indexes"></a>5.6.3. Obtaining references to Indexes</h4>
<div class="paragraph">
<p>The only way to access instances (not otherwise referenced from other instances) passed in to your annotator in its JCas is to use an iterator over some index.
Indexes in the CAS are specified in the annotator descriptor.
Indexes have a name; text annotators have a built-in, standard index over all annotations.</p>
</div>
<div class="paragraph">
<p>To get an index, first get the JFSIndexRepository from the JCas using the method jcas.getJFSIndexRepository(). Here are the calls to get indexes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>JFSIndexRepository ir = jcas.getJFSIndexRepository();

ir.getIndex(name-of-index) // get the index by its name, a string
ir.getIndex(name-of-index, Foo.type) // filtered by specific type

ir.getAnnotationIndex()      // get AnnotationIndex
jcas.getAnnotationIndex()    // get directly from jcas
ir.getAnnotationIndex(Foo.type)      // filtered by specific type</code></pre>
</div>
</div>
<div class="paragraph">
<p>For convenience, the getAnnotationIndex method is available directly on the JCas object instance; the implementation merely forwards to the associated index repository.</p>
</div>
<div class="paragraph">
<p>Filtering types have to be a subtype of the type specified for this index in its index specification.
They can be written as either Foo.type or if you have an instance of Foo, you can write</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>fooInstance.getClass()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Foo is (of course) an example of the name of the type.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.adding_removing_instances_to_indexes"><a class="anchor" href="#ugr.ref.jcas.adding_removing_instances_to_indexes"></a>5.6.4. Adding (and removing) instances to (from) indexes</h4>
<div class="paragraph">
<p>CAS indexes are maintained automatically by the CAS.
But you must add any instances of feature structures you want the index to find, to the indexes by using the call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>myInstance.addToIndexes();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Do this after setting all features in the instance <em>which could be used in indexing</em>,  for example, in determining the sorting order.
See <a href="#ugr.ref.cas.updating_indexed_feature_structures">Section 4.5.1</a> for details on updating indexed feature structures.</p>
</div>
<div class="paragraph">
<p>When writing a Multi-View component, you may need to index instances in multiple CAS views.
The methods above use the indexes associated with the current JCas object.
There is a variation of the <code>addToIndexes / removeFromIndexes</code> methods which takes one argument: a reference to a JCas object holding the view in which you want to  index this instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>myInstance.addToIndexes(anotherJCas)
myInstance.removeFromIndexes(anotherJCas)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also explicitly add instances to other views using the addFsToIndexes method on other JCas (or CAS) objects.
For instance, if you had 2 other CAS views (myView1 and myView2), in which you wanted to index myInstance, you could write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>myInstance.addToIndexes(); //addToIndexes used with the new operator
myView1.addFsToIndexes(myInstance); // index myInstance in myView1
myView2.addFsToIndexes(myInstance); // index myInstance in myView2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The rules for determining which index to use with a particular JCas object are designed to behave the way most would think they should; if you need specific behavior, you can always  explicitly designate which view the index adding and removing operations should work on.</p>
</div>
<div class="paragraph">
<p>The rules are: If the instance is a subtype of AnnotationBase, then the view is the view associated with the  annotation as specified in the feature holding the view reference in AnnotationBase.
Otherwise, if the instance was created using the "new" operator, then the view is the view passed to the  instance&#8217;s constructor.
Otherwise, if the instance was created by getting a feature value from some other instance, whose range type is a feature structure, then the view is the same as the referring instance.
Otherwise, if the instance was created by any of the Feature Structure Iterator operations over some index, then it is the view associated with the index.</p>
</div>
<div class="paragraph">
<p>As of release 2.4.1, there are two efficient bulk-remove methods to remove all instances of a given type,  or all instances of a given type and its subtypes.
These are invoked on an instance of an IndexRepository, for a particular view.
For example, to remove all instances of Token from a particular JCas instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>jcas.removeAllIncludingSubtypes(Token.type) or
jcas.removeAllIncludingSubtypes(aTokenInstance.getTypeIndexID()) or
jcas.getFsIndexRepository().
       removeAllIncludingSubtypes(jcas.getCasType(Token.type))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.using_iterators"><a class="anchor" href="#ugr.ref.jcas.using_iterators"></a>5.6.5. Using Iterators</h4>
<div class="paragraph">
<p>This chapter describes obtaining and using iterators.
However, it is recommended that instead  you use the select framework, described in a chapter in the version 3 user&#8217;s guide.</p>
</div>
<div class="paragraph">
<p>Once you have an index obtained from the JCas, you can get an iterator from the index; here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>FSIndexRepository ir = jcas.getFSIndexRepository();
FSIndex myIndex = ir.getIndex("myIndexName");
FSIterator myIterator = myIndex.iterator();

JFSIndexRepository ir = jcas.getJFSIndexRepository();
FSIndex myIndex = ir.getIndex("myIndexName", Foo.type); // filtered
FSIterator myIterator = myIndex.iterator();</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#ugr.ref.cas.indexes_and_iterators">Iterators</a> work like normal Java iterators, but are augmented to support additional capabilities.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.class_loaders"><a class="anchor" href="#ugr.ref.jcas.class_loaders"></a>5.6.6. Class Loaders in UIMA</h4>
<div class="paragraph">
<p>The basic concept of a UIMA application includes assembling engines into a flow.
The application made up of these Engines are run within the UIMA Framework, either by the Collection Processing Manager, or by using more basic UIMA Framework APIs.</p>
</div>
<div class="paragraph">
<p>The UIMA Framework exists within a JVM (Java Virtual Machine). A JVM has the capability to load multiple applications, in a way where each one is isolated from the others, by using a separate class loader for each application.
For instance, one set of UIMA Framework Classes could be shared by multiple sets of application - specific classes, even if these application-specific classes had the same names but were different versions.</p>
</div>
<div class="sect4">
<h5 id="ugr.ref.jcas.class_loaders.optional"><a class="anchor" href="#ugr.ref.jcas.class_loaders.optional"></a>Use of Class Loaders is optional</h5>
<div class="paragraph">
<p>The UIMA framework will use a specific ClassLoader, based on how ResourceManager instances are used.
Specific ClassLoaders are only created if you specify an ExtensionClassPath as part of the ResourceManager.
If you do not need to support multiple applications within one UIMA framework within a JVM, don&#8217;t specify an ExtensionClassPath; in this case, the classloader used will be the one used to load the UIMA framework - usually the overall application class loader.</p>
</div>
<div class="paragraph">
<p>Of course, you should not run multiple UIMA applications together, in this way, if they have different class definitions for the same class name.
This includes the JCas &#8220;cover&#8221; classes.
This case might arise, for instance, if both applications extended <code>uima.tcas.DocumentAnnotation</code> in differing, incompatible ways.
Each application would need its own definition of this class, but only one could be loaded (unless you specify ExtensionClassPath in the ResourceManager which will cause the UIMA application to load its private versions of its classes, from its classpath).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.jcas.accessing_jcas_objects_outside_uima_components"><a class="anchor" href="#ugr.ref.jcas.accessing_jcas_objects_outside_uima_components"></a>5.6.7. Issues accessing JCas objects outside of UIMA Engine Components</h4>
<div class="paragraph">
<p>If you are using the ExtensionClassPaths, the JCas cover classes are loaded under a class loader created by the ResourceManager part of the UIMA Framework.
If you reference the same JCas classes outside of any UIMA component, for instance, in top level application code, the JCas classes used by that top level application code also must be in the class path for the application code.</p>
</div>
<div class="paragraph">
<p>Alternatively, you could do all the JCas processing inside a UIMA component (and do no processing using JCas outside of the UIMA pipeline).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.jcas.setting_up_classpath"><a class="anchor" href="#ugr.ref.jcas.setting_up_classpath"></a>5.7. Setting up Classpath for JCas</h3>
<div class="paragraph">
<p>The JCas Java classes generated by JCasGen are typically compiled and put into a JAR file, which, in turn, is put into the application&#8217;s class path.</p>
</div>
<div class="paragraph">
<p>This JAR file must be generated from the application&#8217;s merged type system.
This is most conveniently done by opening the top level descriptor used by the application in the Component Descriptor Editor tool, and pressing the Run-JCasGen button on the Type System Definition page.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.jcas.pear_support"><a class="anchor" href="#ugr.ref.jcas.pear_support"></a>5.8. PEAR isolation</h3>
<div class="paragraph">
<p>As of version 2.2, the framework supports component descriptors which are PEAR descriptors.
These descriptors define components plus include information on the class path needed to  run them.
The framework uses the class path information to set up a localized class path, just for code running within the PEAR context.
This allows PEAR files requiring different  versions of common code to work well together, even if the class names in the different versions have the same names.</p>
</div>
<div class="paragraph">
<p>The mechanism used to switch the class loaders when entering a PEAR-packaged annotator in a flow depends on the framework knowing if JCas is being used within that annotator code.
The framework will know this if the particular view being passed has had a previous call to  getJCas(), or if the particular annotator is marked as a JCas-using one (by having it extend the class <code>JCasAnnotator_ImplBase).</code></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.pear"><a class="anchor" href="#ugr.ref.pear"></a>6. PEAR Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A PEAR (Processing Engine ARchive) file is a standard package for UIMA components.
This chapter describes the PEAR 1.0 structure and specification.</p>
</div>
<div class="paragraph">
<p>The PEAR package can be used for distribution and reuse by other components or applications.
It also allows applications and tools to manage UIMA components automatically for verification, deployment, invocation, testing, etc.</p>
</div>
<div class="paragraph">
<p>Currently, there is an Eclipse plugin and a command line tool available to create PEAR packages for standard UIMA components.
Please refer to the <a href="tools.html#ugr.tools.pear.packager">PEAR Packager</a> documentation for more information about these tools.</p>
</div>
<div class="paragraph">
<p>PEARs distributed to new targets can be installed at those targets.
UIMA includes a tool for installing PEARs; <a href="tools.html#ugr.tools.pear.installer">PEAR Installer User&#8217;s Guide</a> for  more information about installing PEARs.</p>
</div>
<div class="paragraph">
<p>An installed PEAR can be used as a component within a UIMA pipeline, by specifying the pear descriptor that is created when installing the pear.
See <a href="#ugr.ref.pear.specifier">PEAR Specifier Reference</a>.</p>
</div>
<div class="sect2">
<h3 id="ugr.ref.pear.packaging_a_component"><a class="anchor" href="#ugr.ref.pear.packaging_a_component"></a>6.1. Packaging a UIMA component</h3>
<div class="paragraph">
<p>For the purpose of describing the process of creating a PEAR file and its internal structure, this section describes the steps used to package a UIMA component as a valid PEAR file.
The PEAR packaging process consists of the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ugr.ref.pear.creating_pear_structure">Section 6.1.1</a></p>
</li>
<li>
<p><a href="#ugr.ref.pear.populating_pear_structure">Section 6.1.2</a></p>
</li>
<li>
<p><a href="#ugr.ref.pear.creating_installation_descriptor">Section 6.1.3</a></p>
</li>
<li>
<p><a href="#ugr.ref.pear.packaging_into_1_file">Section 6.1.5</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ugr.ref.pear.creating_pear_structure"><a class="anchor" href="#ugr.ref.pear.creating_pear_structure"></a>6.1.1. Creating the PEAR structure</h4>
<div class="paragraph">
<p>The first step in the PEAR creation process is to create a PEAR structure.
The PEAR structure is a structured tree of folders and files, including the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Required Elements:</p>
<div class="ulist">
<ul>
<li>
<p>The * metadata*										folder which contains the PEAR installation descriptor and properties files.</p>
</li>
<li>
<p>The installation descriptor ( * metadata/install.xml*										)</p>
</li>
<li>
<p>A UIMA analysis engine descriptor and its required code, delegates (if any), and resources</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional Elements:</p>
<div class="ulist">
<ul>
<li>
<p>The desc folder to contain descriptor files of analysis engines, delegates analysis engines (all levels), and other components (Collection Readers, CAS Consumers, etc).</p>
</li>
<li>
<p>The src folder to contain the source code</p>
</li>
<li>
<p>The bin folder to contain executables, scripts, class files, dlls, shared libraries, etc.</p>
</li>
<li>
<p>The lib folder to contain jar files.</p>
</li>
<li>
<p>The doc folder containing documentation materials, preferably accessible through an index.html.</p>
</li>
<li>
<p>The data folder to contain data files (e.g. for testing).</p>
</li>
<li>
<p>The conf folder to contain configuration files.</p>
</li>
<li>
<p>The resources folder to contain other resources and dependencies.</p>
</li>
<li>
<p>Other user-defined folders or files are allowed, but should be avoided.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./ref/images/references/ref.pear/image002.jpg" alt="diagram of the PEAR structure">
</div>
<div class="title">Figure 3. The PEAR Structure</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.pear.populating_pear_structure"><a class="anchor" href="#ugr.ref.pear.populating_pear_structure"></a>6.1.2. Populating the PEAR structure</h4>
<div class="paragraph">
<p>After creating the PEAR structure, the component&#8217;s descriptor files, code files, resources files, and any other files and folders are copied into the corresponding folders of the PEAR structure.
The developer should make sure that the code would work with this layout of files and folders, and that there are no broken links.
Although it is strongly discouraged, the optional elements of the PEAR structure can be replaced by other user defined files and folder, if required for the component to work properly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The PEAR structure must be self-contained.
For example, this means that the component must run properly independently from the PEAR root folder location.
If the developer needs to use an absolute path in configuration or descriptor files, then he/she should put these files in the &#8220;conf&#8221;					or &#8220;desc&#8221;					and replace the path of the PEAR root folder with the string &#8220;$main_root&#8221;					. The tools that deploy and use PEAR files should localize the files in the &#8220;conf&#8221;					and &#8220;desc&#8221;					folders by replacing the string &#8220;$main_root&#8221;					with the local absolute path of the PEAR root folder.
The &#8220;$main_root&#8221;					macro can also be used in the Installation descriptor (install.xml)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Currently there are three types of component packages depending on their deployment:</p>
</div>
<div class="sect4">
<h5 id="ugr.ref.pear.package_type.standard"><a class="anchor" href="#ugr.ref.pear.package_type.standard"></a>Standard Type</h5>
<div class="paragraph">
<p>A component package with the <strong>standard</strong>					type must be a valid Analysis Engine, and all the required files to deploy it locally must be included in the PEAR package.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.pear.package_type.service"><a class="anchor" href="#ugr.ref.pear.package_type.service"></a>Service Type</h5>
<div class="paragraph">
<p>A component package with the <strong>service</strong>					type must be deployable locally as a supported UIMA service (e.g.
Vinci). In this case, all the required files to deploy it locally must be included in the PEAR package.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.pear.package_type.network"><a class="anchor" href="#ugr.ref.pear.package_type.network"></a>Network Type</h5>
<div class="paragraph">
<p>A component package with the network type is not deployed locally but rather in the &#8220;remote&#8221; environment.
It&#8217;s accessed as a <a href="tug.html#ugr.tug.application.remote_services">Network Analysis Engine</a> (e.g. Vinci Service). The component owner has the responsibility to start the service and make sure it&#8217;s up and running before it&#8217;s used by others (like a webmaster that makes sure the web site is up and running). In this case, the PEAR package does not have to contain files required for deployment, but must contain the <a href="tug.html#ugr.tug.aae.creating_xml_descriptor">network AE descriptor</a> and the <code>&lt;DESC&gt;`</code> tag in the installation descriptor must point to the network AE descriptor.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.pear.creating_installation_descriptor"><a class="anchor" href="#ugr.ref.pear.creating_installation_descriptor"></a>6.1.3. Creating the installation descriptor</h4>
<div class="paragraph">
<p>The installation descriptor is an xml file called install.xml under the metadata folder of the PEAR structure.
It&#8217;s also called InsD.
The InsD XML file should be created in the UTF-8 file encoding.
The InsD should contain the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;OS&gt;</code>: This section is used to specify supported operating systems</p>
</li>
<li>
<p><code>&lt;TOOLKITS&gt;</code>: This section is used to specify toolkits, such as JDK, needed by the component.</p>
</li>
<li>
<p><code>&lt;SUBMITTED_COMPONENT&gt;</code>: This is the most important section in the Installation Descriptor. It&#8217;s used to specify required information about the component. See <a href="#ugr.ref.pear.installation_descriptor">Section 6.1.4</a> for detailed information about this section.</p>
</li>
<li>
<p><code>&lt;INSTALLATION&gt;</code>: This section is explained in section <a href="#ugr.ref.pear.installing">Section 6.2</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.pear.installation_descriptor"><a class="anchor" href="#ugr.ref.pear.installation_descriptor"></a>6.1.4. Documented template for the installation descriptor:</h4>
<div class="paragraph">
<p>The following is a sample &#8220;documented template&#8221; which describes content of the installation descriptor <code>install.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;? xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- Installation Descriptor Template --&gt;
&lt;COMPONENT_INSTALLATION_DESCRIPTOR&gt;
  &lt;!-- Specifications of OS names, including version, etc. --&gt;
  &lt;OS&gt;
    &lt;NAME&gt;OS_Name_1&lt;/NAME&gt;
    &lt;NAME&gt;OS_Name_2&lt;/NAME&gt;
  &lt;/OS&gt;
  &lt;!-- Specifications of required standard toolkits --&gt;
  &lt;TOOLKITS&gt;
    &lt;JDK_VERSION&gt;JDK_Version&lt;/JDK_VERSION&gt;
  &lt;/TOOLKITS&gt;

  &lt;!-- There are 2 types of variables that are used in the InsD:
       a) $main_root , which will be substituted with the real path to the
                 main component root directory after installing the
                 main (submitted) component
       b) $component_id$root, which will be substituted with the real path
          to the root directory of a given delegate component after
          installing the given delegate component --&gt;

  &lt;!-- Specification of submitted component (AE)             --&gt;
  &lt;!-- Note: submitted_component_id is assigned by developer; --&gt;
  &lt;!--       XML descriptor file name is set by developer.    --&gt;
  &lt;!-- Important: ID element should be the first in the       --&gt;
  &lt;!--            SUBMITTED_COMPONENT section.                --&gt;
  &lt;!-- Submitted component may include optional specification --&gt;
  &lt;!-- of Collection Reader that can be used for testing the  --&gt;
  &lt;!-- submitted component.                                   --&gt;
  &lt;!-- Submitted component may include optional specification --&gt;
  &lt;!-- of CAS Consumer that can be used for testing the       --&gt;
  &lt;!-- submitted component.                                   --&gt;

  &lt;SUBMITTED_COMPONENT&gt;
    &lt;ID&gt;submitted_component_id&lt;/ID&gt;
    &lt;NAME&gt;Submitted component name&lt;/NAME&gt;
    &lt;DESC&gt;$main_root/desc/ComponentDescriptor.xml&lt;/DESC&gt;

    &lt;!-- deployment options:                                   --&gt;
    &lt;!-- a) "standard" is deploying AE locally                 --&gt;
    &lt;!-- b) "service"  is deploying AE locally as a service,   --&gt;
    &lt;!--    using specified command (script)                   --&gt;
    &lt;!-- c) "network"  is deploying a pure network AE, which   --&gt;
    &lt;!--    is running somewhere on the network                --&gt;

    &lt;DEPLOYMENT&gt;standard | service | network&lt;/DEPLOYMENT&gt;

    &lt;!-- Specifications for "service" deployment option only   --&gt;
    &lt;SERVICE_COMMAND&gt;$main_root/bin/startService.bat&lt;/SERVICE_COMMAND&gt;
    &lt;SERVICE_WORKING_DIR&gt;$main_root&lt;/SERVICE_WORKING_DIR&gt;
    &lt;SERVICE_COMMAND_ARGS&gt;

      &lt;ARGUMENT&gt;
        &lt;VALUE&gt;1st_parameter_value&lt;/VALUE&gt;
        &lt;COMMENTS&gt;1st parameter description&lt;/COMMENTS&gt;
      &lt;/ARGUMENT&gt;

      &lt;ARGUMENT&gt;
        &lt;VALUE&gt;2nd_parameter_value&lt;/VALUE&gt;
        &lt;COMMENTS&gt;2nd parameter description&lt;/COMMENTS&gt;
      &lt;/ARGUMENT&gt;

    &lt;/SERVICE_COMMAND_ARGS&gt;

    &lt;!-- Specifications for "network" deployment option only   --&gt;

    &lt;NETWORK_PARAMETERS&gt;
      &lt;VNS_SPECS VNS_HOST="vns_host_IP" VNS_PORT="vns_port_No" /&gt;
    &lt;/NETWORK_PARAMETERS&gt;

    &lt;!-- General specifications                                --&gt;

    &lt;COMMENTS&gt;Main component description&lt;/COMMENTS&gt;

    &lt;COLLECTION_READER&gt;
      &lt;COLLECTION_ITERATOR_DESC&gt;
        $main_root/desc/CollIterDescriptor.xml
      &lt;/COLLECTION_ITERATOR_DESC&gt;

      &lt;CAS_INITIALIZER_DESC&gt;
        $main_root/desc/CASInitializerDescriptor.xml
      &lt;/CAS_INITIALIZER_DESC&gt;
    &lt;/COLLECTION_READER&gt;

    &lt;CAS_CONSUMER&gt;
      &lt;DESC&gt;$main_root/desc/CASConsumerDescriptor.xml&lt;/DESC&gt;
    &lt;/CAS_CONSUMER&gt;

  &lt;/SUBMITTED_COMPONENT&gt;
  &lt;!-- Specifications of the component installation process --&gt;
  &lt;INSTALLATION&gt;
    &lt;!-- List of delegate components that should be installed together --&gt;
    &lt;!-- with the main submitted component (for aggregate components)  --&gt;
    &lt;!-- Important: ID element should be the first in each             --&gt;

    &lt;!--            DELEGATE_COMPONENT section.                        --&gt;
    &lt;DELEGATE_COMPONENT&gt;
      &lt;ID&gt;first_delegate_component_id&lt;/ID&gt;
      &lt;NAME&gt;Name of first required separate component&lt;/NAME&gt;
    &lt;/DELEGATE_COMPONENT&gt;

    &lt;DELEGATE_COMPONENT&gt;
      &lt;ID&gt;second_delegate_component_id&lt;/ID&gt;
      &lt;NAME&gt;Name of second required separate component&lt;/NAME&gt;
    &lt;/DELEGATE_COMPONENT&gt;

    &lt;!-- Specifications of local path names that should be replaced --&gt;
    &lt;!-- with real path names after the main component as well as   --&gt;
    &lt;!-- all required delegate (library) components are installed.  --&gt;
    &lt;!-- &lt;FILE&gt; and &lt;REPLACE_WITH&gt; values may use the $main_root or --&gt;
    &lt;!-- one of the $component_id$root variables.                   --&gt;
    &lt;!-- Important: ACTION element should be the first in each      --&gt;
    &lt;!--            PROCESS section.                                --&gt;

    &lt;PROCESS&gt;
      &lt;ACTION&gt;find_and_replace_path&lt;/ACTION&gt;
      &lt;PARAMETERS&gt;
        &lt;FILE&gt;$main_root/desc/ComponentDescriptor.xml&lt;/FILE&gt;
        &lt;FIND_STRING&gt;../resources/dict/&lt;/FIND_STRING&gt;
        &lt;REPLACE_WITH&gt;$main_root/resources/dict/&lt;/REPLACE_WITH&gt;
        &lt;COMMENTS&gt;Specify actual dictionary location in XML component
          descriptor
        &lt;/COMMENTS&gt;
      &lt;/PARAMETERS&gt;
    &lt;/PROCESS&gt;

    &lt;PROCESS&gt;
      &lt;ACTION&gt;find_and_replace_path&lt;/ACTION&gt;
      &lt;PARAMETERS&gt;
        &lt;FILE&gt;$main_root/desc/DelegateComponentDescriptor.xml&lt;/FILE&gt;
        &lt;FIND_STRING&gt;
local_root_directory_for_1st_delegate_component/resources/dict/
        &lt;/FIND_STRING&gt;
        &lt;REPLACE_WITH&gt;
          $first_delegate_component_id$root/resources/dict/
        &lt;/REPLACE_WITH&gt;
        &lt;COMMENTS&gt;
          Specify actual dictionary location in the descriptor of the 1st
          delegate component
        &lt;/COMMENTS&gt;
      &lt;/PARAMETERS&gt;
    &lt;/PROCESS&gt;

    &lt;!-- Specifications of environment variables that should be set prior
         to running the main component and all other reused components.
         &lt;VAR_VALUE&gt; values may use the $main_root or one of the
         $component_id$root variables. --&gt;

    &lt;PROCESS&gt;
      &lt;ACTION&gt;set_env_variable&lt;/ACTION&gt;
      &lt;PARAMETERS&gt;
        &lt;VAR_NAME&gt;env_variable_name&lt;/VAR_NAME&gt;
        &lt;VAR_VALUE&gt;env_variable_value&lt;/VAR_VALUE&gt;
        &lt;COMMENTS&gt;Set environment variable value&lt;/COMMENTS&gt;
      &lt;/PARAMETERS&gt;
    &lt;/PROCESS&gt;

  &lt;/INSTALLATION&gt;
&lt;/COMPONENT_INSTALLATION_DESCRIPTOR&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.pear.installation_descriptor.submitted_component"><a class="anchor" href="#ugr.ref.pear.installation_descriptor.submitted_component"></a>The SUBMITTED_COMPONENT section</h5>
<div class="paragraph">
<p>The SUBMITTED_COMPONENT section of the installation descriptor (install.xml) is used to specify required information about the UIMA component.
Before explaining the details, let&#8217;s clarify the concept of component ID and &#8220;macros&#8221; used in the installation descriptor.
The component ID element should be the <strong>first element</strong> in the SUBMITTED_COMPONENT section.</p>
</div>
<div class="paragraph">
<p>The component id is a string that uniquely identifies the component.
It should use the JAVA naming convention (e.g.
com.company_name.project_name.etc.mycomponent).</p>
</div>
<div class="paragraph">
<p>Macros are variables such as $main_root, used to represent a string such as the full path of a certain directory.</p>
</div>
<div class="paragraph">
<p>The values of these macros are defined by the PEAR installation process, when the PEAR is installed, and represent the values local to that particular installation.
The values are stored in the <code>metadata/PEAR.properties</code> file that is  generated during PEAR installation.
The tools and applications that use and deploy PEAR files replace these macros with the corresponding values in the local environment as part of the deployment process in the files included in the conf and desc folders.</p>
</div>
<div class="paragraph">
<p>Currently, there are two types of macros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>$main_root, which represents the local absolute path of the main component root directory after deployment.</p>
</li>
<li>
<p>$<em>component_id</em>$root, which represents the local absolute path to the root directory of the component which has _component_id _ as component ID. This component could be, for instance, a delegate component.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, if some part of a descriptor needs to have a path to the data subdirectory of the PEAR, you write <code>$main_root/data</code>.
If your PEAR refers to a delegate component having the ID &#8220;`my.comp.Dictionary`&#8221;, and you need to specify a path to one of this component&#8217;s subdirectories, e.g. <code>resource/dict</code>, you write <code>$my.comp.Dictionary$root/resources/dict</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.pear.installation_descriptor.id_name_desc"><a class="anchor" href="#ugr.ref.pear.installation_descriptor.id_name_desc"></a>The ID, NAME, and DESC tags</h5>
<div class="paragraph">
<p>These tags are used to specify the component ID, Name, and descriptor path using the corresponding tags as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;SUBMITTED_COMPONENT&gt;
  &lt;ID&gt;submitted_component_id&lt;/ID&gt;
  &lt;NAME&gt;Submitted component name&lt;/NAME&gt;
  &lt;DESC&gt;$main_root/desc/ComponentDescriptor.xml&lt;/DESC&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.pear.installation_descriptor.deployment_type"><a class="anchor" href="#ugr.ref.pear.installation_descriptor.deployment_type"></a>Tags related to deployment types</h5>
<div class="paragraph">
<p>As mentioned before, there are currently three types of PEAR packages, depending on the following deployment types</p>
</div>
<div class="sect5">
<h6 id="ugr.ref.pear.installation_descriptor.deployment_type.standard"><a class="anchor" href="#ugr.ref.pear.installation_descriptor.deployment_type.standard"></a>Standard Type</h6>
<div class="paragraph">
<p>A component package with the <strong>standard</strong> type must be a valid UIMA Analysis Engine, and all the required files to deploy it must be included in the PEAR package.
This deployment type should be specified as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;DEPLOYMENT&gt;standard&lt;/DEPLOYMENT&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ugr.ref.pear.installation_descriptor.deployment_type.service"><a class="anchor" href="#ugr.ref.pear.installation_descriptor.deployment_type.service"></a>Service Type</h6>
<div class="paragraph">
<p>A component package with the <strong>service</strong> type must be deployable locally as a supported UIMA service (e.g.
Vinci). The installation descriptor must include the path for the executable or script to start the service including its arguments, and the working directory from where to launch it, following this template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;DEPLOYMENT&gt;service&lt;/DEPLOYMENT&gt;
&lt;SERVICE_COMMAND&gt;$main_root/bin/startService.bat&lt;/SERVICE_COMMAND&gt;
&lt;SERVICE_WORKING_DIR&gt;$main_root&lt;/SERVICE_WORKING_DIR&gt;
&lt;SERVICE_COMMAND_ARGS&gt;
  &lt;ARGUMENT&gt;
    &lt;VALUE&gt;1st_parameter_value&lt;/VALUE&gt;
    &lt;COMMENTS&gt;1st parameter description&lt;/COMMENTS&gt;
  &lt;/ARGUMENT&gt;
  &lt;ARGUMENT&gt;
    &lt;VALUE&gt;2nd_parameter_value&lt;/VALUE&gt;
    &lt;COMMENTS&gt;2nd parameter description&lt;/COMMENTS&gt;
  &lt;/ARGUMENT&gt;
&lt;/SERVICE_COMMAND_ARGS&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ugr.ref.pear.installation_descriptor.deployment_type.network"><a class="anchor" href="#ugr.ref.pear.installation_descriptor.deployment_type.network"></a>Network Type</h6>
<div class="paragraph">
<p>A component package with the network type is not deployed locally, but rather in a &#8220;remote&#8221; environment.
It&#8217;s accessed as a network AE (e.g. Vinci Service).
In this case, the PEAR package does not have to contain files required for deployment, but must contain the network AE descriptor.
The `&lt;DESC&gt; `tag in the installation descriptor must point to the network AE descriptor.
Here is a template in the case of Vinci services:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;DEPLOYMENT&gt;network&lt;/DEPLOYMENT&gt;
&lt;NETWORK_PARAMETERS&gt;
  &lt;VNS_SPECS VNS_HOST="vns_host_IP" VNS_PORT="vns_port_No" /&gt;
&lt;/NETWORK_PARAMETERS&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.pear.installation_descriptor.collection_reader_cas_consumer"><a class="anchor" href="#ugr.ref.pear.installation_descriptor.collection_reader_cas_consumer"></a>The Collection Reader and CAS Consumer tags</h5>
<div class="paragraph">
<p>These sections of the installation descriptor are used by any specific Collection Reader or CAS Consumer to be used with the packaged analysis engine.</p>
</div>
</div>
<div class="sect4">
<h5 id="ugr.ref.pear.installation_descriptor.installation"><a class="anchor" href="#ugr.ref.pear.installation_descriptor.installation"></a>The INSTALLATION section</h5>
<div class="paragraph">
<p>The <code>&lt;INSTALLATION&gt;</code> section specifies the external dependencies of the component and the operations that should be performed during the PEAR package installation.</p>
</div>
<div class="paragraph">
<p>The component dependencies are specified in the <code>&lt;DELEGATE_COMPONENT&gt;</code> sub-sections, as shown in the installation descriptor template above.</p>
</div>
<div class="paragraph">
<p>Important: The ID element should be the first element in each <code>&lt;DELEGATE_COMPONENT&gt;</code> sub-section.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;INSTALLATION&gt;</code> section may specify the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting environment variables that are required to run the installed component.</p>
<div class="paragraph">
<p>This is also how you specify additional classpaths for a Java component - by specifying the setting of an environmental variable  named <code>CLASSPATH`</code>.
The <code>buildComponentClasspath</code> method  of the <code>PackageBrowser</code> class builds a classpath string from what it finds in  the <code>CLASSPATH</code> specification here, plus adds a classpath entry for all Jars in the <code>lib</code> directory.
Because of this, there is no need to specify Class Path entries for Jars in the lib directory, when using the Eclipse plugin pear packager or the Maven Pear Packager.</p>
</div>
</li>
</ul>
</div>
<div class="quoteblock">
<blockquote>
When specifying the value of the CLASSPATH environment  variable, use the semicolon ";" as the separator character, regardless of the target Operating System conventions.
This delimiter will be replaced with  the right one for the Operating System during PEAR installation.
</blockquote>
</div>
<div class="paragraph">
<p>+
If your component needs to set the UIMA datapath you must specify the necessary  datapath setting using an environment variable with the key <code>uima.datapath</code>.
When such a key is specified the <code>getComponentDataPath</code> method of the  PackageBrowser class will return the specified datapath settings for your component.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Do not put UIMA Framework Jars into the lib directory of your PEAR; doing so will cause system failures due to class loading issues.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Note that you can use &#8220;macros&#8221;, like $main_root or $component_id$root in the VAR_VALUE element of the &lt;PARAMETERS&gt; sub-section.</p>
</li>
<li>
<p>Finding and replacing string expressions in files.</p>
</li>
<li>
<p>Note that you can use the &#8220;macros&#8221; in the FILE and REPLACE_WITH elements of the &lt;PARAMETERS&gt; sub-section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Important: the ACTION element always should be the 1st element in each &lt;PROCESS&gt; sub-section.</p>
</div>
<div class="paragraph">
<p>By default, the PEAR Installer will try to process every file in the desc and conf directories of the PEAR package in order to find the &#8220;macros&#8221; and replace them with actual path expressions.
In addition to this, the installer will process the files specified in the &lt;INSTALLATION&gt; section.</p>
</div>
<div class="paragraph">
<p>Important: all XML files which are going to be processed should be created using UTF-8 or UTF-16 file encoding.
All other text files which are going to be processed should be created using the ASCII file encoding.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.pear.packaging_into_1_file"><a class="anchor" href="#ugr.ref.pear.packaging_into_1_file"></a>6.1.5. Packaging the PEAR structure into one file</h4>
<div class="paragraph">
<p>The last step of the PEAR process is to simply <strong>zip</strong> the content of the PEAR root folder (<strong>not including the root folder itself</strong>) to a PEAR file with the extension &#8220;.pear&#8221;.</p>
</div>
<div class="paragraph">
<p>To do this you can either use the <a href="tools.html#ugr.tools.pear.packager">PEAR packaging tools</a> or you can use the PEAR packaging API that is shown below.</p>
</div>
<div class="paragraph">
<p>To use the PEAR packaging API you first have to create the necessary information for the PEAR package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>    //define PEAR data
    String componentID = "AnnotComponentID";
    String mainComponentDesc = "desc/mainComponentDescriptor.xml";
    String classpath ="$main_root/bin;";
    String datapath ="$main_root/resources;";
    String mainComponentRoot = "/home/user/develop/myAnnot";
    String targetDir = "/home/user/develop";
    Properties annotatorProperties = new Properties();
    annotatorProperties.setProperty("sysProperty1", "value1");</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create a complete PEAR package in one step call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>PackageCreator.generatePearPackage(
   componentID, mainComponentDesc, classpath, datapath,
   mainComponentRoot, targetDir, annotatorProperties);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The created PEAR package has the file name <code>&lt;componentID&gt;.pear</code> and is located in the <code>&lt;targetDir&gt;</code>.</p>
</div>
<div class="paragraph">
<p>To create just the PEAR installation descriptor in the main component root directory call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>PackageCreator.createInstallDescriptor(componentID, mainComponentDesc,
   classpath, datapath, mainComponentRoot, annotatorProperties);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To package a PEAR file with an existing installation descriptor call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>PackageCreator.createPearPackage(componentID, mainComponentRoot,
   targetDir);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The created PEAR package has the file name <code>&lt;componentID&gt;.pear</code> and is located in the <code>&lt;targetDir&gt;</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.pear.installing"><a class="anchor" href="#ugr.ref.pear.installing"></a>6.2. Installing a PEAR package</h3>
<div class="paragraph">
<p>The installation of a PEAR package can be done using  the PEAR installer tool (<a href="tools.html#ugr.tools.pear.installer">PEAR Installer User&#8217;s Guide</a>, or by an application using the PEAR APIs, directly.</p>
</div>
<div class="paragraph">
<p>During the PEAR installation the PEAR file is extracted to the installation directory and the PEAR macros  in the descriptors are updated with the corresponding path.
At the end of the installation the PEAR verification  is called to check if the installed PEAR package can be started successfully.
The PEAR verification use the classpath, datapath and the system property settings of the PEAR package to verify the PEAR content.
Necessary Java library  path settings for native libararies, PATH variable settings or system environment variables cannot be recognized  automatically and the use must take care of that manually.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default the PEAR packages are not installed directly to the specified installation directory.
For each PEAR a subdirectory with the name of the PEAR&#8217;s ID is created where the PEAR package is installed to.
If the PEAR installation  directory already exists, the old content is automatically deleted before the new content is installed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="ugr.ref.pear.installing_pear_using_api"><a class="anchor" href="#ugr.ref.pear.installing_pear_using_api"></a>6.2.1. Installing a PEAR file using the PEAR APIs</h4>
<div class="paragraph">
<p>The example below shows how to use the PEAR APIs to install a PEAR package and access the installed PEAR package data.
For more details about the PackageBrowser API, please refer to the Javadocs for the <code>org.apache.uima.pear.tools</code> package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>File installDir = new File("/home/user/uimaApp/installedPears");
File pearFile = new File("/home/user/uimaApp/testpear.pear");
boolean doVerification = true;

try {
  // install PEAR package
  PackageBrowser instPear = PackageInstaller.installPackage(
 	installDir, pearFile, doVerification);

  // retrieve installed PEAR data
  // PEAR package classpath
  String classpath = instPear.buildComponentClassPath();
  // PEAR package datapath
  String datapath = instPear.getComponentDataPath();
  // PEAR package main component descriptor
  String mainComponentDescriptor = instPear
     	.getInstallationDescriptor().getMainComponentDesc();
  // PEAR package component ID
  String mainComponentID = instPear
     	.getInstallationDescriptor().getMainComponentId();
  // PEAR package pear descriptor
  String pearDescPath = instPear.getComponentPearDescPath();

  // print out settings
  System.out.println("PEAR package class path: " + classpath);
  System.out.println("PEAR package datapath: " + datapath);
  System.out.println("PEAR package mainComponentDescriptor: "
   	+ mainComponentDescriptor);
  System.out.println("PEAR package mainComponentID: "
   	+ mainComponentID);
  System.out.println("PEAR package specifier path: " + pearDescPath);

  } catch (PackageInstallerException ex) {
    // catch PackageInstallerException - PEAR installation failed
    ex.printStackTrace();
    System.out.println("PEAR installation failed");
  } catch (IOException ex) {
    ex.printStackTrace();
    System.out.println("Error retrieving installed PEAR settings");
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To run a PEAR package after it was installed using the PEAR API see the example below.
It use the  generated PEAR specifier that was automatically created during the PEAR installation.
For more details about the APIs please refer to the Javadocs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>File installDir = new File("/home/user/uimaApp/installedPears");
File pearFile = new File("/home/user/uimaApp/testpear.pear");
boolean doVerification = true;

try {

  // Install PEAR package
  PackageBrowser instPear = PackageInstaller.installPackage(
  	installDir, pearFile, doVerification);

  // Create a default resouce manager
  ResourceManager rsrcMgr = UIMAFramework.newDefaultResourceManager();

  // Create analysis engine from the installed PEAR package using
  // the created PEAR specifier
  XMLInputSource in =
        new XMLInputSource(instPear.getComponentPearDescPath());
  ResourceSpecifier specifier =
        UIMAFramework.getXMLParser().parseResourceSpecifier(in);
  AnalysisEngine ae =
        UIMAFramework.produceAnalysisEngine(specifier, rsrcMgr, null);

  // Create a CAS with a sample document text
  CAS cas = ae.newCAS();
  cas.setDocumentText("Sample text to process");
  cas.setDocumentLanguage("en");

  // Process the sample document
  ae.process(cas);
  } catch (Exception ex) {
         ex.printStackTrace();
  }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.pear.specifier"><a class="anchor" href="#ugr.ref.pear.specifier"></a>6.3. PEAR package descriptor</h3>
<div class="paragraph">
<p>To run an installed PEAR package directly in the UIMA framework the <code>pearSpecifier</code> XML descriptor can be used.
Typically during the PEAR installation such an specifier is automatically generated  and contains all the necessary information to run the installed PEAR package.
Settings for system environment variables, system PATH settings or Java library path settings cannot be recognized automatically and must be set manually when the JVM is started.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The PEAR may contain specifications for "environment variables" and their settings.
When such a PEAR is run directly in the UIMA framework, those settings (except for Classpath and Data Path) are converted to Java System properties, and set to the specified values.
Java cannot set true environmental variables; if such a setting is needed, the application would need to arrange to do this prior to invoking Java.</p>
</div>
<div class="paragraph">
<p>The Classpath and Data Path settings are used by UIMA to configure a special Resource Manager that is used when code from this PEAR is being run.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The generated PEAR descriptor is located in the component root directory of the installed PEAR package and has a filename like  &lt;componentID&gt;_pear.xml.</p>
</div>
<div class="paragraph">
<p>The PEAR package descriptor looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;pearSpecifier xmlns="http://uima.apache.org/resourceSpecifier"&gt;
   &lt;pearPath&gt;/home/user/uimaApp/installedPears/testpear&lt;/pearPath&gt;
   &lt;pearParameters&gt;     &lt;!-- optional --&gt;
      &lt;nameValuePair&gt;   &lt;!-- any number, repeated --&gt;
         &lt;name&gt;param1&lt;/name&gt;
         &lt;value&gt;&lt;string&gt;stringVal1&lt;/string&gt;&lt;/value&gt;
      &lt;/nameValuePair&gt;
   &lt;/pearParameters&gt;
   &lt;parameters&gt;         &lt;!-- optional legacy string-valued parameters --&gt;
      &lt;parameter&gt;       &lt;!-- any number, repeated --&gt;
        &lt;name&gt;name-of-the-parameter&lt;/name&gt;
        &lt;value&gt;string-value&lt;/value&gt;
      &lt;/parameter&gt;
   &lt;/parameters&gt;
&lt;/pearSpecifier&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>pearPath</code> setting in the descriptor must point to the component root directory  of the installed PEAR package.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>It is not possible to share resources between PEAR Analysis Engines that are instantiated using the PEAR descriptor.
The PEAR runtime created for each PEAR descriptor has its own specific <code>ResourceManager</code> (unless exactly the same Classpath and Data Path are being used).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The optional <code>pearParameters</code> section, if used, specifies parameter values, which are used to customize / override parameter values in the PEAR descriptor.
The format for parameter values used here is the same as in <a href="#ugr.ref.aes.configuration_parameter_settings">component parameters</a>.
External Settings overrides continue to work for PEAR descriptors, and have precedence, if specified.</p>
</div>
<div class="paragraph">
<p>Additionally, there can be a <code>parameters</code> section.
This section supports only string-valued parameters.
This way of specifying parameters is deprecated and should no longer be used.
Support for will eventually be removed in a future version of Apache UIMA.
Parameters set in the <code>pearParameters</code> have precedence over parameters defined in <code>parameters</code> section.
For the time being, both sections can be present simultaneously in a PEAR specifier.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.xmi"><a class="anchor" href="#ugr.ref.xmi"></a>7. XMI CAS Serialization Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the specification for the mapping of the UIMA CAS into the XMI (XML Metadata Interchange<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>) format.
XMI is an OMG standard for expressing object graphs in XML.
The UIMA SDK provides support for XMI through the classes <code>org.apache.uima.cas.impl.XmiCasSerializer</code> and <code>org.apache.uima.cas.impl.XmiCasDeserializer</code>.</p>
</div>
<div class="sect2">
<h3 id="ugr.ref.xmi.xmi_tag"><a class="anchor" href="#ugr.ref.xmi.xmi_tag"></a>7.1. XMI Tag</h3>
<div class="paragraph">
<p>The outermost tag is &lt;XMI&gt; and must include a version number and XML namespace attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;xmi:XMI xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI"&gt;
  &lt;!-- CAS Contents here --&gt;
&lt;/xmi:XMI&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>XML namespaces<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup> are used throughout.
The &#8220;xmi&#8221; namespace prefix is used to identify elements and attributes that are defined by the XMI specification.
The XMI document will also define one namespace prefix for each CAS namespace, as described in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xmi.feature_structures"><a class="anchor" href="#ugr.ref.xmi.feature_structures"></a>7.2. Feature Structures</h3>
<div class="paragraph">
<p>UIMA Feature Structures are mapped to XML elements.
The name of the element is formed from the CAS type name, making use of XML namespaces as follows.</p>
</div>
<div class="paragraph">
<p>The CAS type namespace is converted to an XML namespace URI by the following rule: replace all dots with slashes, prepend <a href="http:///" class="bare">http:///</a>, and append .ecore.</p>
</div>
<div class="paragraph">
<p>This mapping was chosen because it is the default mapping used by the Eclipse Modeling Framework (EMF)<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup> to create namespace URIs from Java package names.
The use of the http scheme is a common convention, and does not imply any HTTP communication.
The <code>.ecore</code> suffix is due to the fact that the recommended type system definition for a namespace is an <a href="tug.html#ugr.tug.xmi_emf">ECore model</a>.</p>
</div>
<div class="paragraph">
<p>Consider the CAS type name <code>org.myproj.Foo</code>.
The CAS namespace (<code>org.myorg.</code>) is converted to the XML namespace URI is <code><a href="http:///org/myproj.ecore" class="bare">http:///org/myproj.ecore</a></code>.</p>
</div>
<div class="paragraph">
<p>The XML element name is then formed by concatenating the XML namespace prefix (which is an arbitrary token, but typically we use the last component of the CAS namespace) with the type name (excluding the namespace).</p>
</div>
<div class="paragraph">
<p>So the example <code>org.myproj.Foo</code> Feature Structure is written to XMI as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;xmi:XMI
    xmi:version="2.0"
    xmlns:xmi="http://www.omg.org/XMI"
    xmlns:myproj="http:///org/myproj.ecore"&gt;
  ...
  &lt;myproj:Foo xmi:id="1"/&gt;
  ...
&lt;/xmi:XMI&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>xmi:id</code> attribute is only required if this object will be referred to from elsewhere in the XMI document.
If provided, the xmi:id must be unique for each feature.</p>
</div>
<div class="paragraph">
<p>All namespace prefixes (e.g. <code>myproj</code>) in this example must be bound to URIs using the <code>xmlns:&#8230;&#8203;</code> attribute, as defined by the XML namespaces specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xmi.primitive_features"><a class="anchor" href="#ugr.ref.xmi.primitive_features"></a>7.3. Primitive Features</h3>
<div class="paragraph">
<p>CAS features of primitive types (String, Boolean, Byte, Short, Integer, Long , Float, or Double) can be mapped either to XML attributes or XML elements.
For example, a CAS FeatureStructure of type org.myproj.Foo, with features:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>begin     = 14
end       = 19
myFeature = "bar"</code></pre>
</div>
</div>
<div class="paragraph">
<p>could be mapped to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;xmi:XMI xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI"
    xmlns:myproj="http:///org/myproj.ecore"&gt;
  ...
  &lt;myproj:Foo xmi:id="1" begin="14" end="19" myFeature="bar"/&gt;
  ...
&lt;/xmi:XMI&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or equivalently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;xmi:XMI xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI"
    xmlns:myproj="http:///org/myproj.ecore"&gt;
  ...
  &lt;myproj:Foo xmi:id="1"&gt;
    &lt;begin&gt;14&lt;/begin&gt;
    &lt;end&gt;19&lt;/end&gt;
    &lt;myFeature&gt;bar&lt;/myFeature&gt;
  &lt;/myproj:Foo&gt;
  ...
&lt;/xmi:XMI&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The attribute serialization is preferred for compactness, but either representation is allowable.
Mixing the two styles is allowed; some features can be represented as attributes and others as elements.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xmi.reference_features"><a class="anchor" href="#ugr.ref.xmi.reference_features"></a>7.4. Reference Features</h3>
<div class="paragraph">
<p>CAS features that are references to other feature structures (excluding arrays and lists, which are handled separately) are serialized as ID references.</p>
</div>
<div class="paragraph">
<p>If we add to the previous CAS example a feature structure of type org.myproj.Baz, with feature &#8220;myFoo&#8221; that is a reference to the Foo object, the serialization would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;xmi:XMI xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI"
    xmlns:myproj="http:///org/myproj.ecore"&gt;
  ...
  &lt;myproj:Foo xmi:id="1" begin="14" end="19" myFeature="bar"/&gt;
  &lt;myproj:Baz xmi:id="2" myFoo="1"/&gt;
  ...
&lt;/xmi:XMI&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As with primitive-valued features, it is permitted to use an element rather than an attribute.
However, the syntax is slightly different:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;myproj:Baz xmi:id="2"&gt;
   &lt;myFoo href="#1"/&gt;
&lt;myproj.Baz&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in the attribute representation, a reference feature is indistinguishable from an integer-valued feature, so the meaning cannot be determined without prior knowledge of the type system.
The element representation is unambiguous.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xmi.array_and_list_features"><a class="anchor" href="#ugr.ref.xmi.array_and_list_features"></a>7.5. Array and List Features</h3>
<div class="paragraph">
<p>For a CAS feature whose range type is one of the CAS array or list types, the XMI serialization depends on the setting of the &#8220;multipleReferencesAllowed&#8221; attribute for that feature in the <a href="#ugr.ref.xml.component_descriptor.type_system.features">UIMA Type System Description</a>.</p>
</div>
<div class="paragraph">
<p>An array or list with <code>multipleReferencesAllowed = false</code> (the default) is serialized as a <em>multi-valued</em> property in XMI.
An array or list with <code>multipleReferencesAllowed = true</code> is serialized as a first-class object.
Details are described below.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.xmi.array_and_list_features.as_multi_valued_properties"><a class="anchor" href="#ugr.ref.xmi.array_and_list_features.as_multi_valued_properties"></a>7.5.1. Arrays and Lists as Multi-Valued Properties</h4>
<div class="paragraph">
<p>In XMI, a multi-valued property is the most natural XMI representation for most cases.
Consider the example where the FeatureStructure of type <code>org.myproj.Baz</code> has a feature <code>myIntArray</code> whose value is the integer array <code>{2,4,6}</code>.
This can be mapped to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;myproj:Baz xmi:id="3" myIntArray="2 4 6"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or equivalently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;myproj:Baz xmi:id="3"&gt;
  &lt;myIntArray&gt;2&lt;/myIntArray&gt;
  &lt;myIntArray&gt;4&lt;/myIntArray&gt;
  &lt;myIntArray&gt;6&lt;/myIntArray&gt;
&lt;/myproj:Baz&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that String arrays whose elements contain embedded spaces MUST use the latter mapping.</p>
</div>
<div class="paragraph">
<p><code>FSArray</code> or <code>FSList</code> features are serialized in a similar way.
For example an <code>FSArray</code> feature that contains references to the elements with <code>xmi:id&#8217;s `13</code> and <code>42</code> could be serialized as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;myproj:Baz xmi:id="3" myFsArray="13 42"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;myproj:Baz xmi:id="3"&gt;
  &lt;myFsArray href="#13"/&gt;
  &lt;myFsArray href="#42"/&gt;
&lt;/myproj:Baz&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.xmi.array_and_list_features.as_1st_class_objects"><a class="anchor" href="#ugr.ref.xmi.array_and_list_features.as_1st_class_objects"></a>7.5.2. Arrays and Lists as First-Class Objects</h4>
<div class="paragraph">
<p>The multi-valued-property representation described in the previous section does not allow multiple references to an array or list object.
Therefore, it cannot be used for features that are defined to allow multiple references (i.e. features for which multipleReferencesAllowed = true in the Type System Description).</p>
</div>
<div class="paragraph">
<p>When <code>multipleReferencesAllowed</code> is set to true, array and list features are serialized as references, and the array or list objects are serialized as separate objects in the XMI.
Consider again the example where the Feature Structure of type <code>org.myproj.Baz</code> has a feature <code>myIntArray</code> whose value is the integer array <code>{2,4,6}</code>. If <code>myIntArray</code> is defined with multipleReferencesAllowed=true, the serialization will be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;myproj:Baz xmi:id="3" myIntArray="4"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;myproj:Baz xmi:id="3"&gt;
  &lt;myIntArray href="#4"/&gt;
&lt;/myproj:Baz&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>with the array object serialized as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;cas:IntegerArray xmi:id="4" elements="2 4 6"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;cas:IntegerArray xmi:id="4"&gt;
  &lt;elements&gt;2&lt;/elements&gt;
  &lt;elements&gt;4&lt;/elements&gt;
  &lt;elements&gt;6&lt;/elements&gt;
&lt;/cas:IntegerArray&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that in this case, the XML element name is formed from the CAS type name (e.g. <code>uima.cas.IntegerArray</code>) in the same way as for other Feature Structures.
The elements of the array are serialized either as a space-separated attribute named <code>elements</code> or as a series of child elements named <code>elements</code>.</p>
</div>
<div class="paragraph">
<p>List nodes are just standard FeatureStructures with <code>head</code> and <code>tail</code> features, and are serialized using the normal Feature Structure serialization.
For example, an <code>IntegerList</code> with the values <code>2</code>, <code>4</code>, and <code>6</code> would be serialized as the four objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;cas:NonEmptyIntegerList xmi:id="10" head="2" tail="11"/&gt;
&lt;cas:NonEmptyIntegerList xmi:id="11" head="4" tail="12"/&gt;
&lt;cas:NonEmptyIntegerList xmi:id="12" head="6" tail="13"/&gt;
&lt;cas:EmptyIntegerList xmi:id"13"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This representation of arrays allows multiple references to an array of list.
It also allows a feature with range type TOP to refer to an array or list.
However, it is a very unnatural representation in XMI and does not support interoperability with other XMI-based systems, so we instead recommend using the multi-valued-property representation described in the previous section whenever it is possible.</p>
</div>
<div class="paragraph">
<p>When a feature is specified in the descriptor without a multipleReferencesAllowed attribute, or with the attribute specified as <code>false</code>, but the framework discovers multiple references during serialization, it will issue a message to the log say that it discovered this (look for the phrase <em>serialized in duplicate</em>).
The serialization will continue, but the multiply-referenced items will  be serialized in duplicate.</p>
</div>
</div>
<div class="sect3">
<h4 id="ugr.ref.xmi.null_array_list_elements"><a class="anchor" href="#ugr.ref.xmi.null_array_list_elements"></a>7.5.3. Null Array/List Elements</h4>
<div class="paragraph">
<p>In UIMA, an element of an FSArray or FSList may be null.
In XMI, multi-valued properties do not permit null values.
As a workaround for this, we use a dummy instance of the special type <code>cas:NULL</code>, which has <code>xmi:id="0"</code>.
For example, in the following example the &#8220;myFsArray&#8221; feature refers to an FSArray whose second element is null:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;cas:NULL xmi:id="0"/&gt;
&lt;myproj:Baz xmi:id="3"&gt;
  &lt;myFsArray href="#13"/&gt;
  &lt;myFsArray href="#0"/&gt;
  &lt;myFsArray href="#42"/&gt;
&lt;/myproj:Baz&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xmi.sofas_views"><a class="anchor" href="#ugr.ref.xmi.sofas_views"></a>7.6. Subjects of Analysis (Sofas) and Views</h3>
<div class="paragraph">
<p>A UIMA CAS contain one or more subjects of analysis (Sofas). These are serialized no differently from any other feature structure.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;?xml version="1.0"?&gt;
&lt;xmi:XMI xmi:version="2.0" xmlns:xmi=http://www.omg.org/XMI
    xmlns:cas="http:///uima/cas.ecore"&gt;
  &lt;cas:Sofa xmi:id="1" sofaNum="1"
      text="the quick brown fox jumps over the lazy dog."/&gt;
&lt;/xmi:XMI&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each Sofa defines a separate View.
Feature Structures in the CAS can be members of one or more views.
(A Feature Structure that is a member of a view is indexed in its IndexRepository, but that is an implementation detail.)</p>
</div>
<div class="paragraph">
<p>In the XMI serialization, views will be represented as first-class objects.
Each View has an (optional) &#8220;sofa&#8221; feature, which references a sofa, and multi-valued reference to the members of the View.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;cas:View sofa="1" members="3 7 21 39 61"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the integers 3, 7, 21, 39, and 61 refer to the xmi:id fields of the objects that are members of this view.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xmi.linking_to_ecore_type_system"><a class="anchor" href="#ugr.ref.xmi.linking_to_ecore_type_system"></a>7.7. Linking an XMI Document to its Ecore Type System</h3>
<div class="paragraph">
<p>If the CAS Type System has been saved to an <a href="tug.html#ugr.tug.xmi_emf">Ecore file</a>, it is possible to store a link from an XMI document to that Ecore type system.
This is done using an <code>xsi:schemaLocation</code> attribute on the root XMI element.</p>
</div>
<div class="paragraph">
<p>The <code>xsi:schemaLocation</code> attribute is a space-separated list that represents a mapping from namespace URI (e.g.
<code><a href="http:///org/myproj.ecore" class="bare">http:///org/myproj.ecore</a></code>) to the physical URI of the <code>.ecore</code> file containing the type system for that namespace.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>xsi:schemaLocation=
  "http:///org/myproj.ecore file:/c:/typesystems/myproj.ecore"</code></pre>
</div>
</div>
<div class="paragraph">
<p>would indicate that the definition for the org.myproj CAS types is contained in the file <code>c:/typesystems/myproj.ecore</code>.
You can specify a different mapping for each of your CAS namespaces, using a space separated list.
For details see Budinsky et al. <em>Eclipse Modeling Framework</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.xmi.delta"><a class="anchor" href="#ugr.ref.xmi.delta"></a>7.8. Delta CAS XMI Format</h3>
<div class="paragraph">
<p>The Delta CAS XMI serialization format is designed primarily to reduce the overhead serialization when calling annotators  configured as services.
Only Feature Structures and Views that are new or modified by the service   are serialized and returned by the service.</p>
</div>
<div class="paragraph">
<p>The classes <code>org.apache.uima.cas.impl.XmiCasSerializer</code> and <code>org.apache.uima.cas.impl.XmiCasDeserializer</code> support serialization of only the modifications to the CAS.
A caller is expected to set a marker to indicate the point from which changes to the CAS are to be tracked.</p>
</div>
<div class="paragraph">
<p>A Delta CAS XMI document contains only the Feature Structures and Views that have been added or modified.
The new and modified Feature Structures are represented in exactly the format as in a complete CAS serialization.
The ` cas:View ` element has been extended with three additional attributes to represent modifications to  View membership.
These new attributes are <code>added_members</code>, <code>deleted_members</code> and <code>reindexed_members</code>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;cas:View sofa="1" added_members="63 77"
          deleted_member="7 61" reindexed_members="39" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the integers 63, 77 represent xmi:id fields of the objects that have been newly added members to this View, 7 and 61 are xmi:id fields of the objects that have been removed from this view and 39 is the xmi:id of an object to be reindexed in this view.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.compress"><a class="anchor" href="#ugr.ref.compress"></a>8. Compressed Binary CASes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ugr.ref.compress.overview"><a class="anchor" href="#ugr.ref.compress.overview"></a>8.1. Binary CAS Compression overview</h3>
<div class="paragraph">
<p>UIMA has a proprietary binary serialization format, used internally for several things, including communicating with embedded C++ annotators using UIMA-CPP.
This binary format is also selectable for use with UIMA-AS.
Its use requires that the source and target systems implement the identical type system (because the type system is not sent, and internal coding is used within the format that is keyed to the particular type system).</p>
</div>
<div class="paragraph">
<p>Starting with version 2.4.1, two additional forms of binary serialization are added.
Both compress the data being serialized; typical size ratios can approach 50 : 1, depending on the exact contents of the CAS, when compared with normal binary serialization.</p>
</div>
<div class="paragraph">
<p>The two forms are called 4 and 6, for historical/internal reasons.
The serialized forms of both of these is fixed, but not currently standardized, and the form being used is encoded in the header so  that the appropriate deserializer can be chosen.
Both forms include support for Delta CAS being returned from a service.</p>
</div>
<div class="paragraph">
<p>Form 6 builds on form 4, and adds: serializing only those feature structures which are reachable (that is, in some index, or referenced by other reachable feature structures), and type filtering.</p>
</div>
<div class="paragraph">
<p>Type filtering takes a source type system and a target type system, and for serializing  (source to target), sends the binary representation of reachable feature structures in the target&#8217;s type system.
For deserializing (reading a target into a source), the filtering takes the specification being read as being encoded using the target&#8217;s type system, and translates that into the source&#8217;s type system.
In this process, types which exist in the source but not the target are skipped (when serializing);  types which exist in the target, but not the source are skipped when deserializing. Features that exist in some source type but not in the version of the same type in the target are skipped (when serializing) or set to default values (i.e., 0 or null) when being deserialized.</p>
</div>
<div class="paragraph">
<p>There are two main use cases for using compressed forms.
The first one is for communicating with  UIMA-AS remote services (not yet implemented).</p>
</div>
<div class="paragraph">
<p>The second use case is for saving compressed representations of CASes to other media, such as disk files, where they can be deserialized later for use in other UIMA applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.compress.usage"><a class="anchor" href="#ugr.ref.compress.usage"></a>8.2. Using Compressed Binary CASes</h3>
<div class="paragraph">
<p>The main user interface for serializing a CAS using compression is to use one of the  static methods named serializeWithCompression in Serialization.
If you pass a Type System argument representing a target type system, then form 6 compression is used; otherwise form 4 is used.
To get the benefit of only serializing reachable Feature Structure instances, without type mapping  (which is only in form 6), pass a type system argument which is null.</p>
</div>
<div class="paragraph">
<p>To deserialize into a CAS without type mapping, use one of the deserialize method in Serialization.
There are multiple forms of this method, depending on the arguments.
The forms which take extra arguments include a ReuseInfo may only be used with serialized forms created with form 6 compression.
The plain form of deserialize works with all forms of binary serialization, compressed and non-compressed, by examining a common header which identifies the form of binary serialization used; however, for form 6, since it requires additional arguments, it will fail - and you need to use the other deserialize form.</p>
</div>
<div class="paragraph">
<p>Form 6 has an additional object, ReuseInfo, which holds information which  is required for subsequent Delta CAS format serializations / deserializations.
It can speed up subsequent serializations of the same  CAS (before it is further updated), for instance, if an application is sending the CAS to multiple services in parallel.
The serializeWithCompression method returns this object when form 6 is being used.</p>
</div>
<div class="paragraph">
<p>In addition, the CasIOUtils class offers static load and save methods, which can be used with the SerialFormat enum to serialize and deserialize to URLs or streams; see the Javadocs for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.compress.simple_deltas"><a class="anchor" href="#ugr.ref.compress.simple_deltas"></a>8.3. Simple Delta CAS serialization</h3>
<div class="paragraph">
<p>Use Form 4 for this, because form 6 supports delta CAS but requires  that at the time of deserialization of a CAS (on the receiver side) which will later be delta serialized back to the sender,  an instance of the ReuseInfo must be saved, and that same instance then used for delta serialization; furthermore, the original serialization  (on the sender side) also must save an instance of the ReuseInfo and use this when deserializing the delta CAS.</p>
</div>
<div class="paragraph">
<p>Form 4 may not be as efficient as form 6 in that it does not filter the CASes  either by type systems nor by only sending reachable Feature Structure instances.
But, it doesn&#8217;t require a ReuseInfo object when doing delta serialization or deserialization,   so it may be more convenient to use when saving delta CASes to files (as opposed to the other use case of  a remote service returning delta CASes to a remote client).</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.compress.use_cases"><a class="anchor" href="#ugr.ref.compress.use_cases"></a>8.4. Use Case cookbook</h3>
<div class="paragraph">
<p>Here are some use cases, together with a suggested approach and example of how to use the APIs.</p>
</div>
<div class="paragraph">
<p><strong>Save a CAS to an output stream, using form 4 (no type system filtering):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// set up an output stream.  In this example, an internal byte array.
ByteArrayOutputStream baos = new ByteArrayOutputStream(OUT_BFR_INIT_SZ);
Serialization.serializeWithCompression(casSrc, baos);
  // or
CasIOUtls.save(casSrc, baos, SerialFormat.COMPRESSED);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Deserialize from a stream into an existing CAS:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// assume the stream is a byte array input stream
// For example, one could be created
//   from the above ByteArrayOutputStream as follows:
ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());
// Deserialize into a cas having the identical type system
Serialization.deserializeCAS(cas, bais);
  // or
CasIOUtils.load(bais, aCas);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>deserializeCAS(cas, inputStream)</code> method is a general way to deserialize into a CAS from an inputStream for all forms of binary serialized data (with exceptions as noted above). The method reads a common header, and based on what it finds, selects the appropriate deserialization routine.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>deserialization</code> method with just 2 arguments method doesn&#8217;t support type filtering, or delta cas deserializating for form 6.
To do those, see example below.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Serialize to an output stream, filtering out some types and/or features:</strong></p>
</div>
<div class="paragraph">
<p>To do this, an additional input specifying the Type System of the target must be supplied; this Type System should be a subset of the source CAS&#8217;s.
The <code>out</code> parameter may be an OutputStream, a DataOutputStream, or a File.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// set up an output stream.  In this example, an internal byte array.
ByteArrayOutputStream baos = new ByteArrayOutputStream(OUT_BFR_INIT_SZ);
Serialization.serializeWithCompression(cas, out, tgtTypeSystem);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Deserialize with type filtering:</strong></p>
</div>
<div class="paragraph">
<p>There are 2 type systems involved here: one is the receiving CAS, and the other is the type system used to decode the serialized form.
This may optionally be stored with the serialized form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CasIOUtils.save(cas, out, SerialFormat.COMPRESSED_FILTERED_TS);</code></pre>
</div>
</div>
<div class="paragraph">
<p>and/or it can be supplied at load time.
Here&#8217;s two examples of suppling this at load time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>CasIOUtils.load(input, cas, typeSystem);
CasIOUtils.load(input, type_system_serialized_form_input, cas);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The reuseInfo should be null unless  deserializing a delta CAS, in which case, it must be the reuse info captured when  the original CAS was serialized out.
If the target type system is identical to the one in the CAS, you may pass null for it.
If a delta cas is not being received, you must pass null for the reuseInfo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());
Serialization.deserializeCAS(cas, bais, tgtTypeSystem, reuseInfo);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.json"><a class="anchor" href="#ugr.ref.json"></a>9. JSON Serialization of CASs and UIMA Description objects</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ugr.ref.json.overview"><a class="anchor" href="#ugr.ref.json.overview"></a>9.1. JSON serialization support overview</h3>
<div class="paragraph">
<p>Applications are moving to the "cloud", and new applications are being rapidly developed that are hooking things up using various mashup techniques.
New standards and conventions are emerging to support this kind of application development, such as REST services.
JSON is now a popular way for services to communicate;  its popularity is rising (in 2014) while XML is falling.</p>
</div>
<div class="paragraph">
<p>Starting with version 2.7.0, JSON style serialization (but not (yet) deserialization)  for CASs and UIMA descriptions is supported.
The exact format of the serialization is configurable in several aspects.
The implementation is built on top of the Jackson JSON generation library.</p>
</div>
<div class="paragraph">
<p>The next section discusses serialization for CASes, while a later section describes serialization of description objects, such as type system descriptions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug.ref.json.cas"><a class="anchor" href="#_ug.ref.json.cas"></a>9.2. JSON CAS Serialization</h3>
<div class="paragraph">
<p>CASs primarily consist of collections of Feature Structures (FSs). Similar to XMI serialization, JSON serialization skips serializing unreachable FSs, outputting only those FSs that are found in the indexes (these are called <em>roots</em>), plus all of   the FSs that are referenced via some chain of references, from the roots.</p>
</div>
<div class="paragraph">
<p>To support the kinds of things users do with FSs,  the serialized form may be augmented to include additional information beyond the FSs.</p>
</div>
<div class="paragraph">
<p>For traditional UIMA implementations, the serialized formats mostly assumed that the receivers had access to a type system description, which specified details of the types of each feature value.
For JSON serialization, some of this information can be including directly in the serialization.</p>
</div>
<div class="paragraph">
<p>This abbreviated type system information is one kind of additional information that can be included;  here&#8217;s a summary list of the various kinds of additional information you can add to the serialization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>having a way to identify which fields in a FS should be treated as references to other FSs, or as representing serialized binary data from UIMA byte arrays.</p>
</li>
<li>
<p>something like XML namespaces to allow the use of short type names in the serialization while handling name collisions</p>
</li>
<li>
<p>enough of the UIMA type hierarchy to allow the common operation of iterating over a type together  with all of its subtypes</p>
</li>
<li>
<p>A way to identify which FSs were "added-to-the-indexes" (separately, per CAS View)  and therefore serve as roots when  iterating over types.</p>
</li>
<li>
<p>An identification of the associated type system definition</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Simple JSON serialization does not have a convention for supporting these, but many extensions do.
We borrow some of the concepts in the JSON-LD (linked data) standard in providing this  additional information.</p>
</div>
<div class="sect3">
<h4 id="_ug.ref.json.cas.bigpic"><a class="anchor" href="#_ug.ref.json.cas.bigpic"></a>9.2.1. The Big Picture</h4>
<div class="paragraph">
<p>CAS JSON serialization consists of several parts: an optional _context, the set of Feature Structures, and (if doing a delta serialization) information about changes to what was indexed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./ref/images/references/ref.json/big_picture2.png" alt="The big picture showing the parts of serialization, with the _context optional.">
</div>
<div class="title">Figure 4. The major sections of JSON serialization</div>
</div>
<div class="paragraph">
<p>The serializer can be configured to omit the _context or parts of the _context for cases where that information isn&#8217;t needed.
The index changes information is only included if Delta CAS serialization is specified.
Note that Delta CAS support is incomplete; so this information is just for planning purposes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ug.ref.json.cas.context"><a class="anchor" href="#_ug.ref.json.cas.context"></a>9.2.2. The _context section</h4>
<div class="paragraph">
<p>The _context section has entries for each used type as well as some special additional entries.
Each entry for a type has multiple sub-entries, identified by a key-name.
Each sub-entry can be selectively omitted if not needed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>\_type_system</strong> - a URI of the type system information</p>
</li>
<li>
<p><strong>\_types</strong> - information about each used type</p>
<div class="ulist">
<ul>
<li>
<p><strong>\_id</strong> - the type&#8217;s fully qualified UIMA type name</p>
</li>
<li>
<p><strong>\_feature_types</strong> - a map from features of this type to  information about the type of the value of the feature</p>
</li>
<li>
<p><strong>\_subtypes</strong> - an array of used subtype short-names</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>"_context" : {
  "_type_system" : "URI to the type system information",
  "_types : {
    "A_Typical_User_or_built_in_Type" : {
      "_id" : "org.apache.uima.test.A_Typical_User_or_built_in_Type",
      "_feature_types" : [
           "sofa"         : "_ref",
           "aFS"          : "_ref",
           "an_array"     : "_array",
           "a_byte_array" : "_byte_array"],
      "_subtypes" : [ "subtype1", "subtype2", ... ] },
    "Sofa" : {
      "_id" : "uima.cas.Sofa",
      "_feature_types" : {"sofaArray" : "_ref"} }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <strong>\_type_system</strong> is an optional URI that references a UIMA type system description that defines the types for the CAS being serialized.</p>
</div>
<div class="paragraph">
<p>In the <strong>\_types</strong> section, the key (e.g.
"Sofa" or "A_Typical_User_or_built_in_Type") is the "short" name  for the type used in the serialization.
It is either just the last segment of the full type name (e.g.
for the type x.y.z.TypeName, it&#8217;s TypeName), or,  if name would collide with another type name if just the last segment was used (example:  some.package.cname.Foo,  and some.other.package.cname.Foo), then the key is made up of the next-to-last segment, with an optional suffixed incrementing integer in case of collisions on that name, a colon (:) and then the last name.</p>
</div>
<div class="quoteblock">
<blockquote>
In this example, since the next to last segment of both names is "cname", one namespace name would be "cname", and the other would be "cname1".  The keys in this case would be cname:Foo and cname1:Foo.
</blockquote>
</div>
<div class="paragraph">
<p>The value of the _id is the fully qualified name of the type.</p>
</div>
<div class="paragraph">
<p>The <strong>\_feature_types</strong> values of _ref, _array, and _byte_array indicate the corresponding values  of the named features need special handling  when deserailized.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>\_ref</strong> - used when features are deserialized as numbers, but they are to be interpreted as references to other FSs whose <code>id</code> is the number. UIMA lists and arrays of  FSs are marked with _ref; if the value is a JSON array, the elements of the array will be either numbers (to be interpreted as references), or embedded serializations of FSs.</p>
</li>
<li>
<p><strong>\_array</strong> - used when features are serialized as JSON  arrays containing embedded values,  unless the corresponding UIMA object has multiple references, in which case it is serialized as a FS reference which looks like a single number. If a feature is marked with _array, then a non-array, single number should be interpreted as the <code>id</code> of the feature structure that is the array or the first element of the list of items. This designation is used for both UIMA arrays and lists.</p>
<div class="paragraph">
<p>This designation is for arrays and lists of primitive values, except for byte arrays.
In the case of FS arrays and lists, the _ref designation is used instead of this to indicate that the  resulting values in a JSON array that look like numbers should be interpreted as references.</p>
</div>
</li>
<li>
<p><strong>\_byte_array</strong> - _byte_array features are serialized numbers (if they are a  reference to a separate object, or as strings (if embedded).  The strings are to be decoded into binary byte arrays using the Base64 encoding (the standard one used by Jackson to serialize binary data).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that single element arrays are <em>not</em> unwrapped, as in some other JSON serializations, to enable distinguishing references to arrays from embedded arrays.</p>
</div>
<div class="paragraph">
<p><strong>_subtypes</strong> are a list of the type&#8217;s used subtypes.
A type is _used_ if it is the type of a Feature Structure being serialized, or if it is in the supertype chain of some Feature Structure which is serialized.
If a type has no used subtypes, this element is omitted.
The names are represented as the "short" name.
Users typically use this information to construct support for iterators over a type which includes all of its subtypes.</p>
</div>
<div class="sect4">
<h5 id="_ug.ref.json.cas.context.omit"><a class="anchor" href="#_ug.ref.json.cas.context.omit"></a>Omitting parts of the _context section</h5>
<div class="paragraph">
<p>It is possible to selectively omit some of the  _context sections (or the entire _context), via configuration.
Here&#8217;s an example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>// make a new instance to hold the serialization configuration
JsonCasSerializer jcs = new JsonCasSerializer();
// Omit the expanded type names information
jcs.setJsonContext(JsonContextFormat.omitExpandedTypeNames);</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>See the Javadocs for <code>JsonContextFormat</code> for how to specify the parts.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ug.ref.json.cas.featurestructures"><a class="anchor" href="#_ug.ref.json.cas.featurestructures"></a>9.2.3. Serializing Feature Structures</h4>
<div class="paragraph">
<p>Feature Structures themselves are represented as JSON objects consisting of field - value pairs, where the  fields correspond to UIMA Features, and the values are the values of the features.</p>
</div>
<div class="paragraph">
<p>The various kinds of values for a UIMA feature are represented by their natural JSON counterpart.
UIMA primitive boolean values are represented by JSON true and false literals.
UIMA Strings are  represented as JSON strings.
Numbers are represented by JSON numbers.
Byte Arrays are represented by the Jackson standard binary encoding (base64 encoding), written as JSON strings.
References to other Feature Structures are also represented as JSON integer numbers, the values of which are  interpreted as ids of the referred-to FSs.
These ids are treated in the same manner as the xmi:ids of XMI Serialization.
Arrays and Lists when embedded (see following section) are represented as JSON arrays using the [] notation.</p>
</div>
<div class="paragraph">
<p>Besides the feature values defined for a Feature Structure, an additional special feature may be serialized:  _type.
The _type is the type name, written using the short format.
This is automatically included when the type cannot  easily be inferred from other contextual information.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example, with some comments which, since JSON doesn&#8217;t support comments, are just here for explanation:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{ "_type" : "Annotation", // _type may be omitted
  "feat1" : true,   // boolean value represented as true or false
  "feat2" : 123,    // could be a number or a reference to FS with id 123
  "feat3" : "b3axgh"//could be a string or a base64 encoded byte array
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ug.ref.json.cas.featurestructures.embedding"><a class="anchor" href="#_ug.ref.json.cas.featurestructures.embedding"></a>Embedding normally referenced values</h5>
<div class="paragraph">
<p>Consider a FS which has a feature that refers to another FS.
This can be serialized in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the value of the feature can be coded as an <code>id</code> (a number), where the number is the <code>id</code> of the referred-to FS.</p>
</li>
<li>
<p>The value of the feature can be coded as the serialization of the referred-to FS.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This second way of encoding is often done by JSON style serializations, and is called "embedding".  Referred-to  FSs may be embedded if there are no other references to the embedded FS.
Multiple references may arise due to having a FS referenced as a "root" in some CAS View, or being used as a value in a FS feature.</p>
</div>
<div class="paragraph">
<p>Following the XMI conventions, UIMA arrays and lists which are  identified as singly referenced by either the static or dynamic method (see below) are embedded directly as the value of a feature.
In this case, the JSON serialization writes out the value of the feature as a JSON array.
Otherwise, the value is written out as a FS reference, and a separate serialization occurs of  the list elements or the array.</p>
</div>
<div class="paragraph">
<p>In addition to arrays and lists, FSs which are identifed as singly referenced from another FS are serialized as the embedded value of the referring feature.
This is also done (when using the dynamic method) for singly referenced rooted instances.</p>
</div>
<div class="paragraph">
<p>If a FS is multiply referenced, the serialization in these cases is just the numeric value of the <code>id</code> of the FS.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ug.ref.json.cas.featurestructures.dynamicstatic"><a class="anchor" href="#_ug.ref.json.cas.featurestructures.dynamicstatic"></a>Dynamic vs Static multiple-references and embedding</h5>
<div class="paragraph">
<p>There are two methods of determining if a particular FS or list or array can be embedded.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>dynamic</strong> - calculates at serilization time whether or not there are multiple references to a given FS.</p>
</li>
<li>
<p><strong>static</strong> - looks in the type system definition to see if  the feature is marked with &lt;multipleReferencesAllowed&gt;.</p>
<div class="ulist">
<ul>
<li>
<p><code>multipleReferencesAllowed</code> false → use the embedded style</p>
</li>
<li>
<p><code>multipleReferencesAllowed</code> true → use separate objects</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that since this flag is not available for  references to FSs from View indexes, any FS that is indexed in any view is considered (if using static mode) to be multipleReferencesAllowed.</p>
</div>
<div class="paragraph">
<p>Delta serialization only supports the static method; this mode is forced on if delta serialization is specified.</p>
</div>
<div class="paragraph">
<p>Dynamic embedding is enabled by default for JSON, but may be disabled via configuration.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ug.ref.json.cas.featurestructures.embeddedarrayslists"><a class="anchor" href="#_ug.ref.json.cas.featurestructures.embeddedarrayslists"></a>Embedded Arrays and Lists</h5>
<div class="paragraph">
<p>When static embedding is being used, a case can arise where some feature is marked to have only  singly referenced FS values, but that value may actually be multiply referenced.
This is detected during  serialization, and an message is issued if an error handler has been specified to the serializer.
The serialization continues, however.
In the case of an Array, the value of the array is embedded in the serialization and the fact that these were referring to the same object is lost.
In the case of a list, if any element in the list has multiple references (for example,  if the list has back-references, loops, etc.),  the serialization of the list is truncated at the point where the multiple reference occurs.</p>
</div>
<div class="quoteblock">
<blockquote>
Note that you can correctly serialize arbitrarily linked complex list structures created  using the built-in list types only if you use dynamic embedding, or  specify <code>multipleReferencesAllowed</code> = true.
</blockquote>
</div>
<div class="paragraph">
<p>Embedded list or array values are both serialized using the JSON array notation; as a result, these alternative representations are not distinguised in the JSON serialization.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ug.ref.json.cas.featurestructures.null"><a class="anchor" href="#_ug.ref.json.cas.featurestructures.null"></a>Omitting null values</h5>
<div class="paragraph">
<p>Following the conventions established in XMI serialization, features with <code>null</code> values have their key-value pairs omitted from the FS serialization when the type of the feature value is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a Feature Structure Reference</p>
</li>
<li>
<p>a String ( whose value is <code>null</code>, not "" (a 0-length String))</p>
</li>
<li>
<p>an embedded Array or List (where the entire array and/or list is <code>null</code>)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Inside arrays or lists of FSs, references which are being serialized as references have a <code>null</code> reference coded as the number 0; references which are embedded are serialized as <code>null</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuring the serializer with <code>setOmit0Values(true)</code> causes additional primitive features (byte/short/int/long/float/double) to be omitted, when their values are 0 or 0.0</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ug.ref.json.cas.featurestructures.organization"><a class="anchor" href="#_ug.ref.json.cas.featurestructures.organization"></a>9.3. Organizing the Feature Structures</h3>
<div class="paragraph">
<p>The set of all FSs being serialized is divided into two parts.
The first part represents all FSs that are root FSs, in that they were in one or more indexes at the time of serialization.
The second part represents feature structures that are multiply referenced, or are referenced via a chain of references from the root FSs.
The same feature structure can appear in both lists.
The elements in the second part are actual  serialized FSs, whereas, the elements in the first part are either references to the corresponding FSs in the second part, if they exist, or the actual embedded serialized FSs.
Actual embedded serialized FSs only exist once in the two parts.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>"_views" : {
  "_InitialView" : {
     "theFirstType" : [  { ... fs1 ...}, 123, 456, { ... fsn ...} ]
     "anotherType"  : [  { ... fs1 ...}, ... { ... fsn ...} ]
      ...     // more types which have roots in view "12"
         },
  "AnotherView" : {
     "theFirstType" : [  { ... fsv1 ...}, 123, { ... fsvn ...} ]
     "anotherType"  : [  { ... fsv1 ...}, ... { ... fsvn ...} ]
      ...     // more types which have roots in view "25"
         },
   ...        // more views
},

"_referenced_fss" : {
  "12" : {"_type" : "Sofa",  "sofaNum" : 1,  "sofaID" : "_InitialView" },
  "25" : {"_type" : "Sofa",  "sofaNum" : 2,  "sofaID" : "AnotherView" },

  "123" : { ... fs-123 ... },
  "456" : { ... fs-456 ... },
  ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The first part map is made up of multiple maps, one for each separate CAS View.
The outer map is keyed by the <code>id</code> of the corresponding SofaFS (or 0, if there is no corresponding SofaFS). For each view, the value is a map whose key is a used Type, and the values are an array of instances of FSs of that type which were found in some index; these are the "root" FSs.
Only root instances of a particular type are included in this array.</p>
</div>
<div class="paragraph">
<p>The second part map has keys which are the <code>id</code> value of the FSs, and values which are  a map of key-value pairs corresponding to the feature-values of that FS.
In this case, the _type extra feature is added to record the type.</p>
</div>
<div class="paragraph">
<p>The _views map, keyed by view and type name, has all the FSs (as an JSON array) for that type that were in one or more indexes in any View.
If a FS in this array is not multiply referenced (using dynamic mode),  then it is embedded here.
Otherwise, only the reference (a simple number representing the <code>id</code> of that FS) is serialized for that FS.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ug.ref.json.cas.features"><a class="anchor" href="#_ug.ref.json.cas.features"></a>9.4. Additional JSON CAS Serialization features</h3>
<div class="paragraph">
<p>JSON serialization also supports several additional features, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Type and feature filtering: only types and features that exist in a specified type system description  are serialized.</p>
</li>
<li>
<p>An ErrorHandler; this will be called in various error situations, including when  serializing in static mode an array or list value for a feature marked <code>multipleReferencesAllowed = false</code> is found to have multiple references.</p>
</li>
<li>
<p>A switch to control omitting of numeric features that have 0 values (default is to include these). See the <code>setOmit0Values(true_or_false)</code> method in JsonCasSerializer.</p>
</li>
<li>
<p>a pretty printing flag (default is not to do pretty-printing)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the Javadocs for JsonCasSerializer for details.</p>
</div>
<div class="sect3">
<h4 id="ugr.ref.json.delta"><a class="anchor" href="#ugr.ref.json.delta"></a>9.4.1. Delta CAS</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Delta CAS support is incomplete, and is not supported as of release 2.7.0, but may be supported in later releases.
The information here is just for planning purposes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>\_delta_cas</strong> is present only when a delta CAS serialization is being performed.
This serializes just the  changes in the CAS since a Mark was set; so for cases where a large CAS is deserialized into a service, which then does a relatively small amount of additions and modifications, only those changes are serialized.
The values of the keys are arrays of the ids of FSs that were added to the indexes,  removed from the indexes, or reindexed.</p>
</div>
<div class="paragraph">
<p>This mode requires the static embeddability mode.
When specified, a <code>\_delta_cas</code> key-value  is added to the serialization at the end,  which lists the FSs (by <code>id</code>) that were added, removed, or reindexed, since the mark was set.
Additional extra information, created when the CAS was previously deserialized and the mark set,  must be passed to the serializer, in the form of an instance of <code>XmiSerializationSharedData</code>, or JsonSerializationSharedData (not yet defined as of release 2.7.0).</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what the last part of the serialization looks like, when Delta CAS is specified:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>"_delta_cas" : {
  "added_members" : [  123, ... ],
  "deleted_members" : [  456, ... ],
  "reindexed_members" : [] }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.json.usage"><a class="anchor" href="#ugr.ref.json.usage"></a>9.5. Using JSON CAS serialization</h3>
<div class="paragraph">
<p>The support is built on top the Jackson JSON serialization package.
We follow Jackson conventions for configuring.</p>
</div>
<div class="paragraph">
<p>The serialization APIs are in the JsonCasSerializer class.</p>
</div>
<div class="paragraph">
<p>Although there are some static short-cut methods for common use cases, the basic operations needed to serialize a CAS as JSON are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make an instance of the <code>JsonCasSerializer</code> class. This will serve to collect configuration information.</p>
</li>
<li>
<p>Do any additional configuration needed. See the Javadocs for details. The following objects can be configured:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>JsonCasSerializer</code> object: here you can specify the kind of JSON formatting, what to serialize, whether or not delta serialization is wanted, prettyprinting, and more.</p>
</li>
<li>
<p>The underlying <code>JsonFactory</code> object from Jackson. Normally, you won&#8217;t need to configure this. If you do, you can create your own instance of this object and configure it and use it in the serialization.</p>
</li>
<li>
<p>The underlying <code>JsonGenerator</code> from Jackson. Normally, you won&#8217;t need to configure this. If you do, you can get the instance the serializer will be using and configure that.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Once all the configuration is done, the serialize(&#8230;&#8203;) call is done in this class,  which will create a one-time-use inner class where the actual serialization is done. The serialize(&#8230;&#8203;) method is thread-safe, in that the same  JsonCasSerializer instance (after it has been configured) can kick off multiple  (identically configured) serializations  on different threads at the same time.</p>
<div class="paragraph">
<p>The serialize call follows the Jackson conventions, taking one of 3 specifications of where to serialize to: a Writer, an OutputStream, or a File.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>JsonCasSerializer jcs = new JsonCasSerializer();
jcs.setPrettyPrint(true); // do some configuration
StringWriter sw = new StringWriter();
jcs.serialize(cas, sw); // serialize into sw</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The JsonCasSerializer class also has some static convenience methods for JSON serialization, for the most common configuration cases; please see the Javadocs for details.
These are named jsonSerialize, to  distinguish them from the non-static serialize methods.</p>
</div>
<div class="paragraph">
<p>Many of the common configuration methods generally return the instance, so they can be chained together.
For example, if <code>jcs</code> is an instance of the JsonCasSerializer, you can write <code>jcs.setPrettyPrint(true).setOmit0values(true);</code> to configure both of these.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.json.descriptionserialization"><a class="anchor" href="#ugr.ref.json.descriptionserialization"></a>9.6. JSON serialization for UIMA descriptors</h3>
<div class="paragraph">
<p>UIMA descriptors are things like analysis engine descriptors, type system descriptors, etc.
UIMA has an internal form for these, typically named UIMA <em>description</em>s;  these can be serialized out as XML using a <code>toXML</code> method.
JSON support adds the ability to serialize these a JSON objects, as well.
It may be of use, for example, to have the full type system description for a UIMA pipeline available in JSON notation.</p>
</div>
<div class="paragraph">
<p>The class JsonMetaDataSerializer defines a set of static methods that serialize UIMA description objects using a toJson method that takes as an argument the description object to be serialized, and the standard set of serialiization targets that Jackson supports (File, Writer, or OutputStream).  There is also an optional prettyprint flag (default is no prettyprinting).</p>
</div>
<div class="paragraph">
<p>The resulting JSON serialization is just a straight-forward serialization of the description object, having the same fields as the XML serialization of it.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what a small TypeSystem description looks like, serialized:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>{"typeSystemDescription" :
  {"name" : "casTestCaseTypesystem",
   "description" : "Type system description for CAS test cases.",
   "version" : "1.0",
   "vendor" : "Apache Software Foundation",
   "types" : [
     {"typeDescription" :
       {"name" : "Token",
        "description" : "",
         "supertypeName" : "uima.tcas.Annotation",
         "features" : [
           {"featureDescription" :
             {"name" : "type",
              "description" : "",
              "rangeTypeName" :
              "TokenType" } },
           {"featureDescription" :
             {"name" : "tokenFloatFeat",
              "description" : "",
              "rangeTypeName" : "uima.cas.Float" } } ] } },
     {"typeDescription" :
       {"name" : "TokenType",
        "description" : "",
        "supertypeName" : "uima.cas.TOP" } } ] } }</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s a sample of code to serialize a UIMA description object held in the variable <code>tsd</code>, with  and without pretty printing:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>StringWriter sw = new StringWriter();
JsonMetaDataSerializer.toJSON(tsd, sw); // no prettyprinting

sw = new StringWriter();
JsonMetaDataSerializer.toJSON(tsd, sw, true); // prettyprinting</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.config"><a class="anchor" href="#ugr.ref.config"></a>10. UIMA Setup and Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ugr.ref.config.properties"><a class="anchor" href="#ugr.ref.config.properties"></a>10.1. UIMA JVM Configuration Properties</h3>
<div class="paragraph">
<p>Some updates change UIMA&#8217;s behavior between released versions.
For example, sometimes an error check is enhanced, and this can cause something that previously incorrect but not checked, to now signal an error.
Often, users will want these kinds of things to be ignored, at least for a while, to give them time to  analyze and correct the issues.</p>
</div>
<div class="paragraph">
<p>To enable users to gradually address these issues, there are some global JVM properties for UIMA that can restore earlier behaviors, in some cases.
These are detailed in the table below.
Additionally, there are other JVM properties that can be used in checking and optimizing some performance trade-offs, such as the automatic index protection.
For the most part, you don&#8217;t need to assign any values to these properties, just define them.
For example to disable the enhanced check that insures you  don&#8217;t add a subtype of AnnotationBase to the wrong View, you could disable this by adding the JVM argument <code>-Duima.disable_enhanced_check_wrong_add_to_index</code>.
This would remove the enhanced checking for this, added in version 2.7.0 (the previously existing partial checking is still there, though).</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.config.protect_index"><a class="anchor" href="#ugr.ref.config.protect_index"></a>10.2. Configuring index protection</h3>
<div class="paragraph">
<p>A new feature in version 2.7.0 optionally can include checking for invalid feature updates  which could corrupt indexes.
Because this checking can slightly slow down performance, there are  global JVM properties to control it.
The suggested way to operation with these is as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At the beginning, run with automatic protection enabled (the default), but turn on explicit reporting (<code>-Duima.report_fs_update_corrupts_index</code>)</p>
</li>
<li>
<p>For all reported instances, examine your code to see if you can restructure to do the updates before adding the FS to the indexes. Where you cannot, surround the code doing  these updates with a try / finally or block form of <code>protectIndexes()</code>,  which is described in <a href="#ugr.ref.cas.updating_indexed_feature_structures">Section 4.5.1</a> (and also is similarly available with JCas).</p>
</li>
<li>
<p>After no further reports, for maximum performance, leave in the protections  you may have installed in the above step, and then disable the reporting and runtime checking,  using the JVM argument <code>-Duima.disable_auto_protect_indexes</code>, and removing (if present) <code>-Duima.report_fs_update_corrupts_index</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One additional JVM property, <code>-Duima.throw_exception_when_fs_update_corrupts_index</code>,  is intended to be used in automated build / testing configurations.
It causes the framework to throw a UIMARuntimeException if an update outside of a <code>protectIndexes</code> block occurs  that could corrupt the indexes, rather than "recovering" this.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.config.property_table"><a class="anchor" href="#ugr.ref.config.property_table"></a>10.3. Properties Table</h3>
<div class="paragraph">
<p>This table describes the various JVM defined properties; specify these on the Java command line using -Dxxxxxx, where the xxxxxx is one of the properties starting with <code>uima.</code> from the table below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Title</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property Name &amp; Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Since Version</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use built-in Java Logger as default back-end</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uima.use_jul_as_default_uima_logger</code></p>
<p class="tableblock">See <a href="https://issues.apache.org/jira/browse/UIMA-5381">UIMA-5381</a>.
The standard UIMA logger uses an slf4j implementation, which, in turn hooks up to  a back end implementation based on what can be found in the class path (see slf4j documentation). If no backend implementation is found, the slf4j default is to use a NOP logger back end  which discards all logging.</p>
<p class="tableblock">When this flag is specified, the behavior of the UIMA logger  is altered to use the built-in-to-Java logging implementation  as the back end for the UIMA logger.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML: enable doctype declarations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uima.xml.enable.doctype_decl</code> (default is false)</p>
<p class="tableblock">See <a href="https://issues.apache.org/jira/browse/UIMA-6064">UIMA-6064</a> Normally, this is turned off to avoid exposure to malicious XML; see <a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing">
             XML External Entity processing vulnerability</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.10.4, 3.1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Index protection properties</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Report Illegal Index-key Feature Updates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uima.report_fs_update_corrupts_index</code> (default is not to report)</p>
<p class="tableblock">See <a href="https://issues.apache.org/jira/browse/UIMA-4135">UIMA-4135</a>.
Updating Features which are used in Set and Sorted indexes as "keys" may corrupt the indexes, if the Feature Structure (FS) has been added to the indexes.
To update these, you must first completely remove the FS from the indexes in all views, then do the updates, and then add it back.
UIMA now checks for this (unless specifically disabled, see below), and if this property is set, will log WARN messages for each occurrence unless the user does explicit <code>protectIndexes</code> (see CAS JavaDocs for CAS / JCas <code>protectIndexes</code> methods), if this property is defined.</p>
<p class="tableblock">To scan the logs for these reports, search for instances of lines having the string <code>While FS was in the index, the feature</code></p>
<p class="tableblock">Specifying this property overrides <code>uima.disable_auto_protect_indexes</code>.</p>
<p class="tableblock">Users would run with this property defined, and then for high performance,  would use the report to manually change their code to avoid the problem or  to wrap the updates with a <code>protectIndexes</code> kind of protection (see the reference manual, in the CAS or JCas chapters, for examples of user code doing this,  and then run with the protection turned off (see below).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throw exception on illegal Index-key Feature Updates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uima.exception_when_fs_update_corrupts_index</code> (default is false)</p>
<p class="tableblock">See <a href="https://issues.apache.org/jira/browse/UIMA-4150">UIMA-4150</a>.
Throws a UIMARuntimeException if an Indexed FS feature used as a key in one or more  indexes is updated, outside of an explicit <code>protectIndexes</code> block..  \ This is intended for use in automated build and test environments, to provide a strong signal if this kind of mistake gets into the build.
If it is not set, then the other properties specify if corruption should be checked for,  recovered automatically, and / or reported</p>
<p class="tableblock">Specifying this property also forces <code>uima.report_fs_update_corrupts_index</code> to true even if it was set to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable the index corruption checking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uima.disable_auto_protect_indexes</code></p>
<p class="tableblock">See <a href="https://issues.apache.org/jira/browse/UIMA-4135">UIMA-4135</a>.
After you have fixed all reported issues identified with the above report, you may set this property to omit this check, which may slightly improve performance.</p>
<p class="tableblock">Note that this property is ignored if the <code>-Dexception_when_fs_update_corrupts_index</code> or <code>-Dreport_fs_update_corrupts_index</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Measurement / Tracing properties</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trace Feature Structure Creation/Updating</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uima.trace_fs_creation_and_updating</code></p>
<p class="tableblock">This causes a trace file to be produced in the current working directory.
The file has one line for each Feature Structure that is created, and include information on the cas/cas-view, and the features that are set for the Feature Structure.
There is, additionally, one line for each Feature Structure update.
Updates that occur next-to trace information for the same Feature Structure are combined.</p>
<p class="tableblock">This can generate a lot of output, and definitely slows down execution.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.10.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Measure index flattening optimization</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some additional global flags intended for helping v3 migration are documented in the V3 user&#8217;s guide.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ugr.ref.resources"><a class="anchor" href="#ugr.ref.resources"></a>11. UIMA Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ugr.ref.resources.overview"><a class="anchor" href="#ugr.ref.resources.overview"></a>11.1. What is a UIMA Resource?</h3>
<div class="paragraph">
<p>UIMA uses the term <code>Resource</code> to describe all UIMA components that can be acquired by an application or by other resources.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./ref/images/references/ref.resources/res_resource_kinds.png" alt="Resource Kinds, a partial list">
</div>
<div class="title">Figure 5. Resource Kinds</div>
</div>
<div class="paragraph">
<p>There are many kinds of resources; here&#8217;s a list of the main kinds:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Annotator</strong></dt>
<dd>
<p>a user written component, receives a CAS, does some processing, and returns the possibly updated CAS.
Variants include CollectionReaders, CAS Consumers, CAS Multipliers.</p>
</dd>
<dt class="hdlist1"><strong>Flow Controller</strong></dt>
<dd>
<p>a user written component controlling the flow of CASes within an aggregate.</p>
</dd>
<dt class="hdlist1"><strong>External Resource</strong></dt>
<dd>
<p>a user written component.
Variants include:</p>
<div class="ulist">
<ul>
<li>
<p>Data - includes special lifecycle call to load data</p>
</li>
<li>
<p>Parameterized - allows multiple instantiations with simple string parameter variants; example: a dictionary, that has variants in content for different languages</p>
</li>
<li>
<p>Configurable - supports configuration from the XML specifier</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="ugr.ref.resources.resource_inner_implementations"><a class="anchor" href="#ugr.ref.resources.resource_inner_implementations"></a>11.1.1. Resource Inner Implementations</h4>
<div class="paragraph">
<p>Many of the resource kinds include in their specification a (possibly optional) element, which is  the name of a Java class which implements the resource.
We will call this class the "inner implementation".</p>
</div>
<div class="paragraph">
<p>The UIMA framework creates instances of Resource from resource specifiers, by calling  the framework&#8217;s <code>produceResource(specifier, additional_parameters)</code> method.
This call produces a instance of Resource.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>For example, calling produceResource on an AnalysisEngineDescription produces an instance of AnalysisEngine.
This, in turn will have a reference to the user-written inner implementation class.
specified by the <code>annotatorImplementationName</code>.</p>
</div>
<div class="paragraph">
<p>External resource descriptors may include an <code>implementationName</code> element.
Calling produceResource on a ExternalResourceDescription produces an instance of Resource; the resource obtained by subsequent calls to <code>getResource(&#8230;&#8203;)</code>  is dependent on the particular descriptor, and may be an instance of the inner implementation class.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>For external resources, each resource specifier kind handles the case where  the inner implementation is omitted.
If it is supplied, the named class must implement the interface specified in the bindings for this resource.
In addition, the particular specifier kind may  further restrict the kinds of classes the user supplies as the implementationName.</p>
</div>
<div class="paragraph">
<p>Some examples of this further restriction:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>customResource</strong></dt>
<dd>
<p>the class must also implement the Resource interface</p>
</dd>
<dt class="hdlist1"><strong>dataResource</strong></dt>
<dd>
<p>the class must also implement the SharedResourceObject interface</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.resources.sharing_across_pipelines"><a class="anchor" href="#ugr.ref.resources.sharing_across_pipelines"></a>11.2. Sharing Resources, even across pipelines</h3>
<div class="paragraph">
<p>UIMA applications run one or more UIMA Pipelines.
Each pipeline has a top-level Analysis Engine, which may be an aggregation of many other Analysis Engine components.
The UIMA framework instantiates Annotator  resources as specified to configure the pipelines.</p>
</div>
<div class="paragraph">
<p>Sometimes, many identical pipelines are created (for example, in order to exploit multi-core hardware by processing multiple CASes in parallel). In this case, the framework would produce multiple instances of those Annotation resources; these are implemented as multiple instances of the same Java class.</p>
</div>
<div class="paragraph">
<p>Sets of External Resources plus a CAS Pool and UIMA Extension ClassLoader are set up and kept,  per instance of a ResourceManager;  this instance serves to allow sharing of these items across one or more pipelines.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The UIMA Extension ClassLoader (if specified) is used to find the resources to be loaded by the framework</p>
</li>
<li>
<p>The <code>External Resources</code> are specified by a pipeline&#8217;s resource configuration.</p>
</li>
<li>
<p>The CAS Pool is a pool of CASs all with identical type systems and index definitions, associated  with a pipeline.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When setting up a pipeline, the UIMA Framework&#8217;s <code>produceResource</code>  or one of its specialized variants is called, and a new ResourceManager being created and used for that pipeline.
However, in many cases, it may be advantageous to share the same Resources across multiple pipelines; this is easily doable by passing a common instance of the ResourceManager to the pipeline creation methods (using the additional parameters of the produceResource method).</p>
</div>
<div class="paragraph">
<p>To handle additional use cases, the ResourceManager has a <code>copy()</code> method which creates a copy of the Resource Manager instance.
The new instance is created with a null CAS Manager; if you want to share the the CAS Pool, you have to copy the CAS Manager: <code>newRM.setCasManager(originalRM.getCasManager())</code>.
You also may set the Extension Class Loader in the new instance (PEAR wrappers use this to allow PEARs to have their own classpath).  See the Javadocs for details.</p>
</div>
</div>
<div class="sect2">
<h3 id="ugr.ref.resources.external_resource_multiple_parameterized_instances"><a class="anchor" href="#ugr.ref.resources.external_resource_multiple_parameterized_instances"></a>11.3. External Resources support for multiple Parameterized Instances</h3>
<div class="paragraph">
<p>A typical external resource gets a single instantiation, shared with all users of a particular ResourceManager.
Sometimes, multiple instantiations may be useful (of the same resource).  The framework supports this for  ParameterizedDataResources.
There&#8217;s one kind supplied with UIMA - the fileLanguageResourceSpecifier.
This works by having each call to getResource(name, extra_keys[]) use the extra keys to select a particular instance.
On the first call for a particular instance, the named resource uses the extra keys to  initialize a new instance by calling its <code>load</code> method with a data resource derived from the  extra keys by the named resource.</p>
</div>
<div class="paragraph">
<p>For example, the fileLanguageResourceSpecifier uses the language code and goes through  a process with lots of defaulting and fall back to find a resource to load, based on the language code.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. This component is deprecated and should not be use in new development.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Deprecated; use UimaContext instead.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. Deprecated
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. A fourth part, the Subject of Analysis,       is discussed in  .
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. The name feature structure comes from         terminology used in linguistics.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. For details on XMI see Grose et al. Mastering     XMI. Java Programming with XMI, XML, and UML. John Wiley &amp; Sons, Inc.     2002.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. <a href="http://www.w3.org/TR/xml-names11/" class="bare">http://www.w3.org/TR/xml-names11/</a>
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. For details on EMF and Ecore see Budinsky et al. Eclipse Modeling Framework 2.0. Addison-Wesley. 2006.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 3.5.0<br>
Last updated 2023-11-01 17:37:27 +0100
</div>
</div>
</body>
</html>