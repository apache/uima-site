<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JCasHashMap (Apache UIMA Java SDK 2.11.0 User-Level API Documentation)</title>
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="JCasHashMap (Apache UIMA Java SDK 2.11.0 User-Level API Documentation)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":9,"i4":10,"i5":10};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/JCasHashMap.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../org/apache/uima/jcas/impl/JCasImpl.html" title="class in org.apache.uima.jcas.impl"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/uima/jcas/impl/JCasHashMap.html" target="_top">Frames</a></li>
<li><a href="JCasHashMap.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.uima.jcas.impl</div>
<h2 title="Class JCasHashMap" class="title">Class JCasHashMap</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>org.apache.uima.jcas.impl.JCasHashMap</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">JCasHashMap</span>
extends <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></pre>
<div class="block">Version 2 (2014) of map between CAS addr and JCasCover Objects
 
 Note: in the general case, the cover object may *not* be a JCas one, but rather the general one
       This happens if there is no JCas cover object defined for the type.
 
 Assumptions:  Each addr has a corresponding JCas; it is not
 permitted to "update" an addr with a different JCas
 cover class (unless the table is cleared first).
 
 Table always a power of 2 in size - permits faster hashing
 
 Accesses to this table are threadsafe, in order to support
 read-only CASes being shared by multiple threads. 
 Multiple iterators in different threads could be accessing the map and updating it.
 
 Load factor tuning. 2,000,000 random inserts, 50 reps (for JIT)
   .5 (2x to 4x entries)  99%  5 probes   250 ms
   .6 (1.67 to 3.3)       99%  6 probes   285 ms
   .7 (1.43 to 2.86)      99%  8 probes   318 ms 
   .8 (1.25 to 2.5)       99%  11 probes  360 ms
   
    version 1 at load factor .5 ran about 570 ms * 1.x 
      (did 2 lookups for fetches if not found,) 
   
 No "get" method, only getReserve.  This method, if it doesn't
 find the key, eventually finds an empty (null) slot - it then
 stores a special "reserve" item with the same key value in that slot.
    Other threads doing getReserve calls, upon encountering this 
    reserve item, wait until the reserve is converted to a
    real value (a notifyAll happens when this is done), and
    then the getReserve returns the real item.
    
 getReserve calls - when they find the item operate without any locking
    
 Locking:
   There is one lock used for reading and updating the table
     -- not used for reading when item found, only if item not found or is reserved  
 
 Strategy: have 1 outer implementation delegating to multiple inner ones
   number = concurrency level (a power of 2)
   
   The hash uses some # of low order bits to address the right inner one.
   
  This table is used to hold JCas cover classes for CAS feature structures.  
  There is one instance of this table associated with each CAS that is using it.
 <p> 
 The update occurs in the code in JCasGenerated classes, which do:
        a call to get the value of the map for a key
        if that is "null", it creates the new JCas cover object, and does a "put" to add the value.
 <p> 
 The creation of the new JCas cover object can, in turn, run arbitrary user code, 
 which can result in updates to the JCasHashMap which occur before this original update occurs.
 <p>
 In a multi-threaded environment, multiple threads can do a "get" 
 for the same Feature Structure instance.  If it's not in the Map, the correct behavior is:
 <p>
 one of the threads adds the new element
 the other threads wait for the one thread to finish adding, and then return the object that the one thread added.
 <p>
 The implementation works as follows:
 <p>
 1) The JCasHashMap is split into "n" sub-maps.   
    The number is the number of cores, but grows more slowly as the # of cores &gt; 16. 
    This number can be specified, but this is not currently exposed in the tuning parameters
    Locking occurs on the sub-maps; the outer method calls are not synchronized
 2) The number of sub maps is rounded to a power of 2, to allow the low order bits of the hash of the key 
     to be used to pick the map (via masking).
 3) A getReserve that results in not-found returns a null, but adds to the table a special reserved element.
 3a) This adding may result in table resizing
 4) A getReserve that finds a special reserved element, knows that some other thread 
    is in the process of adding an entry for that key, so it waits.
 5) A put, if it finds a reserved-for-that-key element, replaces that with the real element, 
    and then does a notifyAll to wake up any threads that were waiting (on this sub-map), 
    and these threads then re-do the get.  Multiple threads could be waiting on this, and they will all 
    wake-up.
 <p>
 All calls are of the getReserved, followed by a put if the getReserved returns null.

 (Experiment - disabled after no change noted
 To improve locality of reference, an aux data structure of size to fit in one cache line of a Power7 (128 bytes)
 caches the latest lookups)</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/uima/jcas/impl/JCasHashMap.html#clear--">clear</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/uima/jcas/impl/JCasHashMap.html#getConcurrencyLevel--">getConcurrencyLevel</a></span>()</code>&nbsp;</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="../../../../../org/apache/uima/cas/impl/FeatureStructureImpl.html" title="class in org.apache.uima.cas.impl">FeatureStructureImpl</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/uima/jcas/impl/JCasHashMap.html#getReserve-int-">getReserve</a></span>(int&nbsp;key)</code>&nbsp;</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/uima/jcas/impl/JCasHashMap.html#hashInt-int-">hashInt</a></span>(int&nbsp;k1)</code>&nbsp;</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code><a href="../../../../../org/apache/uima/cas/impl/FeatureStructureImpl.html" title="class in org.apache.uima.cas.impl">FeatureStructureImpl</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/uima/jcas/impl/JCasHashMap.html#put-org.apache.uima.cas.impl.FeatureStructureImpl-">put</a></span>(<a href="../../../../../org/apache/uima/cas/impl/FeatureStructureImpl.html" title="class in org.apache.uima.cas.impl">FeatureStructureImpl</a>&nbsp;value)</code>&nbsp;</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../org/apache/uima/jcas/impl/JCasHashMap.html#showHistogram--">showHistogram</a></span>()</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="clear--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>clear</h4>
<pre>public&nbsp;void&nbsp;clear()</pre>
</li>
</ul>
<a name="getReserve-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getReserve</h4>
<pre>public&nbsp;<a href="../../../../../org/apache/uima/cas/impl/FeatureStructureImpl.html" title="class in org.apache.uima.cas.impl">FeatureStructureImpl</a>&nbsp;getReserve(int&nbsp;key)</pre>
</li>
</ul>
<a name="put-org.apache.uima.cas.impl.FeatureStructureImpl-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>put</h4>
<pre>public&nbsp;<a href="../../../../../org/apache/uima/cas/impl/FeatureStructureImpl.html" title="class in org.apache.uima.cas.impl">FeatureStructureImpl</a>&nbsp;put(<a href="../../../../../org/apache/uima/cas/impl/FeatureStructureImpl.html" title="class in org.apache.uima.cas.impl">FeatureStructureImpl</a>&nbsp;value)</pre>
</li>
</ul>
<a name="hashInt-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>hashInt</h4>
<pre>public static&nbsp;int&nbsp;hashInt(int&nbsp;k1)</pre>
</li>
</ul>
<a name="showHistogram--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>showHistogram</h4>
<pre>public&nbsp;void&nbsp;showHistogram()</pre>
</li>
</ul>
<a name="getConcurrencyLevel--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getConcurrencyLevel</h4>
<pre>public&nbsp;int&nbsp;getConcurrencyLevel()</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/JCasHashMap.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../org/apache/uima/jcas/impl/JCasImpl.html" title="class in org.apache.uima.jcas.impl"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/uima/jcas/impl/JCasHashMap.html" target="_top">Frames</a></li>
<li><a href="JCasHashMap.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2006&#x2013;2021 <a href="https://www.apache.org/">The Apache Software Foundation</a>. All rights reserved.</small></p>
</body>
</html>
