<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>DUCC Installation and Verification
Excerpt From Complete DUCC Documentation</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- html --> 
<meta name="src" content="installation.tex"> 
<meta name="date" content="2017-02-03 09:28:00"> 
<link rel="stylesheet" type="text/css" href="installation.css"> 
</head><body 
>
<div class="maketitle">
                                                                                                
                                                                                                
                                                                                                
                                                                                                

<h2 class="titleHead">DUCC Installation and Verification<br />
Excerpt From Complete DUCC Documentation</h2>
<div class="author" ><span 
class="cmr-12">Written and maintained by the Apache</span>
<br />  <span 
class="cmr-12">UIMA</span><sup class="textsuperscript"><span 
class="cmr-9">TM</span></sup><span 
class="cmr-12">Development Community</span></div>
<br />
<div class="date" ></div>
</div>
<!--l. 18--><p class="noindent" >Copyright <span 
class="cmsy-10">©</span>&#x00A0; 2012 The Apache Software Foundation
<!--l. 20--><p class="noindent" >Copyright <span 
class="cmsy-10">©</span>&#x00A0; 2012 International Business Machines Corporation
     <!--l. 23--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-1000"></a><span 
class="cmbx-10">License and Disclaimer</span></span>
     The ASF licenses this documentation to you under the Apache License, Version 2.0 (the &#8221;License&#8221;); you may not
     use this documentation except in compliance with the License. You may obtain a copy of the License
     at
     <!--l. 28--><p class="noindent" ><a 
href="http://www.apache.org/licenses/LICENSE-2.0" class="url" ><span 
class="cmtt-10">http://www.apache.org/licenses/LICENSE-2.0</span></a>
     <!--l. 30--><p class="noindent" >Unless required by applicable law or agreed to in writing, this documentation and its contents are distributed under
     the License on an &#8221;AS IS&#8221; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
     or implied. See the License for the specific language governing permissions and limitations under the
     License.
     <!--l. 35--><p class="noindent" ><span class="paragraphHead"><a 
 id="x1-2000"></a><span 
class="cmbx-10">Trademarks</span></span>
     All terms mentioned in the text that are known to be trademarks or service marks have been appropriately capitalized.
     Use of such terms in this book should not be regarded as affecting the validity of the the trademark or service
     mark.
<!--l. 47--><p class="noindent" >Publication date: February&#x00A0;2017
                                                                                                
                                                                                                
<h3 class="sectionHead"><a 
 id="x1-3000"></a>Overview</h3>
<!--l. 21--><p class="noindent" >DUCC is a multi-user, multi-system distributed application. For first-time users a staged installation/verification
methodology is recommended, roughly as follows:
     <ul class="itemize1">
     <li class="itemize">Single system installation - single node - all work runs with the credentials of the installer.
     </li>
     <li class="itemize">Optionally add more nodes.
     </li>
     <li class="itemize">Enable multiple-user support - processes run with the credentials of the submitting user, while DUCC runs as
     user <span 
class="cmti-10">ducc</span>. This step requires root authority on one or more machines.
     </li>
     <li class="itemize">Enable CGroup containers. This step requires root authority on every DUCC machine.</li></ul>
<!--l. 37--><p class="noindent" >When upgrading from an existing installation the <span 
class="cmti-10">ducc</span><span 
class="cmti-10">_update </span>script may be used to replace the system files while leaving the
site-specific configuration files in place. For more information see <span 
class="cmti-10">&#8220;ducc</span><span 
class="cmti-10">_update&#8221; </span>in the Administrative Commands section of
the DuccBook.
<!--l. 46--><p class="noindent" >Since with this release the persistence data about completed work is stored in a database, additional upgrade steps are
required to convert the older file-based data in order to preserve information about past work. For more information see
<span 
class="cmti-10">&#8220;db</span><span 
class="cmti-10">_create&#8221; </span>and <span 
class="cmti-10">&#8220;db</span><span 
class="cmti-10">_loader&#8221; </span>in the Administrative Commands section of the DuccBook.
<!--l. 57--><p class="noindent" >DUCC is distributed as a compressed tar file. If building from source, this file will be created in your svn trunk/target
directory. The distribution file is in the form
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-1">
&#x00A0;&#x00A0;&#x00A0;uima-ducc-[version]-bin.tar.gz</div>
<!--l. 61--><p class="nopar" > where [version] is the DUCC version; for example, <span 
class="cmti-10">uima-ducc-2.1.0-bin.tar.gz</span>. This document will refer to the distribution
file as the &#8220;<span 
class="cmmi-10">&#x003C;</span>distribution.file<span 
class="cmmi-10">&#x003E;</span>&#8221;.
<!--l. 65--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-4000"></a>Software Prerequisites</h3>
<a 
 id="x1-4000doc"></a>
<!--l. 68--><p class="noindent" >Single system installation:
     <ul class="itemize1">
     <li class="itemize">Reasonably current Linux. DUCC has been tested on SLES 11, RHEL 6 &amp; 7, and Ubuntu 14.04 with 64-bit
     Intel, IBM Power (Big and Little Endian) hardware.
     <!--l. 74--><p class="noindent" ><span 
class="cmti-10">Note: </span>On some systems the default <span 
class="cmti-10">user limits </span>for max user processes (ulimit -u) and nfiles (ulimit -n) are
     defined too low for DUCC. The shell login profile for user <span 
class="cmti-10">ducc </span>should set the soft limit for max user processes
     to be the same as the hard limit (ulimit -u &#8216;ulimit -Hu&#8216;), and the nfiles limit raised above 1024 to at least twice
     the number of user processes running on the cluster.
     </li>
     <li class="itemize">Python 2.x, where &#8217;x&#8217; is 4 or greater. DUCC has not been tested on Python 3.x.
     </li>
     <li class="itemize">Java 7 or 8. DUCC has been tested and run using IBM and Oracle JDK 1.7 &amp; 1.8.
     </li>
     <li class="itemize">Passwordless ssh for the userid running DUCC</li></ul>
<!--l. 87--><p class="noindent" >Additional requirements for multiple system installation:
     <ul class="itemize1">
     <li class="itemize">All systems must have a shared filesystem (such as NFS or GPFS) and common user space. The $DUCC_HOME
     directory must be located on a shared filesystem.</li></ul>
<!--l. 94--><p class="noindent" >Additional requirements for running multiple user processes with their own credentials.
     <ul class="itemize1">
     <li class="itemize">A userid <span 
class="cmti-10">ducc</span>, and group <span 
class="cmti-10">ducc</span>. User <span 
class="cmti-10">ducc </span>must the the only member of group <span 
class="cmti-10">ducc</span>.
     </li>
     <li class="itemize">DUCC run with user <span 
class="cmti-10">ducc </span>credentials.
     </li>
     <li class="itemize">Root access is required to setuid-root the DUCC process launcher.</li></ul>
<!--l. 102--><p class="noindent" >Additional requirements for CGroup containers:
     <ul class="itemize1">
     <li class="itemize">A userid <span 
class="cmti-10">ducc</span>, and group <span 
class="cmti-10">ducc</span>. User <span 
class="cmti-10">ducc </span>must the the only member of group <span 
class="cmti-10">ducc</span>.
                                                                                                
                                                                                                
     </li>
     <li class="itemize">DUCC run with user <span 
class="cmti-10">ducc </span>credentials.
     </li>
     <li class="itemize">libcgroup1-0.37+ on SLES, libcgroup-0.37+ on RHEL, and on Ubuntu all of cgroup-bin cgroup-lite libcgroup1
     </li>
     <li class="itemize">along with a customized /etc/cgconfig.conf
     </li>
     <li class="itemize">On  some  flavors  of  Linux,  the  cgroup  swap  accounting  is  not  enabled  and  swap  is  reported  as  N/A.  To
     enable swap accounting add swapaccount=1 kernel parameter. More information on this step is available here:
     <a 
href="http://unix.stackexchange.com/questions/147158/how-to-enable-swap-accounting-for-memory-cgroup-in-archlinux" class="url" ><span 
class="cmtt-10">http://unix.stackexchange.com/questions/147158/how-to-enable-swap-accounting-for-memory-cgroup-in-archlinux</span></a>.</li></ul>
<!--l. 113--><p class="noindent" >In order to build DUCC from source the following software is also required:
     <ul class="itemize1">
     <li class="itemize">A    Subversion    client,    from    <a 
href="http://subversion.apache.org/packages.html" class="url" ><span 
class="cmtt-10">http://subversion.apache.org/packages.html</span></a>.    The    svn    url    is
     <a 
href="https://svn.apache.org/repos/asf/uima/uima-ducc/trunk" class="url" ><span 
class="cmtt-10">https://svn.apache.org/repos/asf/uima/uima-ducc/trunk</span></a>.
     </li>
     <li class="itemize">Apache Maven, from <a 
href="http://maven.apache.org/index.html" class="url" ><span 
class="cmtt-10">http://maven.apache.org/index.html</span></a></li></ul>
<!--l. 120--><p class="noindent" >The DUCC webserver server optionally supports direct &#8220;jconsole&#8221; attach to DUCC job processes. To install this, the
following is required:
     <ul class="itemize1">
     <li class="itemize">Apache Ant, any reasonably current version.</li></ul>
<!--l. 126--><p class="noindent" >To (optionally) build the documentation, the following is also required:
     <ul class="itemize1">
     <li class="itemize">Latex,  including  the  <span 
class="cmti-10">pdflatex  </span>and  <span 
class="cmti-10">htlatex  </span>packages.  A  good  place  to  start  if  you  need  to  install  it  is
     <a 
href="https://www.tug.org/texlive/" class="url" ><span 
class="cmtt-10">https://www.tug.org/texlive/</span></a>.</li></ul>
<!--l. 132--><p class="noindent" >More detailed one-time setup instructions for source-level builds via subversion can be found here:
<a 
href="http://uima.apache.org/one-time-setup.html#svn-setup" class="url" ><span 
class="cmtt-10">http://uima.apache.org/one-time-setup.html#svn-setup</span></a>
<!--l. 135--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-5000"></a>Building from Source</h3>
<!--l. 137--><p class="noindent" >To build from source, ensure you have Subversion and Maven installed. Extract the source from the SVN repository named
above.
<!--l. 140--><p class="noindent" >Then from your extract directory into the root directory (usually current-directory/trunk), and run the command
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-2">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;mvn&#x00A0;install</div>
<!--l. 144--><p class="nopar" > or
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-3">
&#x00A0;&#x00A0;&#x00A0;&#x00A0;mvn&#x00A0;install&#x00A0;-Pbuild-duccdocs</div>
<!--l. 148--><p class="nopar" > if you have LaTeX insalled and wish to do the optional build of documentation. The build-duccdocs profile can also
activated if the environment valiable BUILD_DUCCDOCS is set true.
<!--l. 152--><p class="noindent" >If this is your first Maven build it may take quite a while as Maven downloads all the open-source pre-requisites. (The
pre-requisites are stored in the Maven repository, usually your $HOME/.m2).
<!--l. 156--><p class="noindent" >When build is complete, a tarball is placed in your current-directory/trunk/target directory.
<!--l. 159--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-6000"></a>Documentation</h3>
<!--l. 161--><p class="noindent" >After installation the DUCC documentation is found (in both PDF and HTML format) in the directory ducc_runtime/docs.
As well, the DUCC webserver contains a link to the full documentation on each major page. The API is documented only via
JavaDoc, distributed in the webserver&#8217;s root directory <span 
class="cmtt-10">$DUCC</span><span 
class="cmtt-10">_HOME/webserver/root/doc/api.</span>
<!--l. 167--><p class="noindent" >If building from source, Maven places the documentation in
     <ul class="itemize1">
     <li class="itemize"><span 
class="cmtt-10">trunk/uima-ducc-duccdocs/target/site </span>(main documentation), and
     </li>
     <li class="itemize"><span 
class="cmtt-10">trunk/target/site/apidocs </span>(API Javadoc)</li></ul>
<!--l. 173--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-7000"></a>Single System Installation and Verification</h3>
<!--l. 175--><p class="noindent" >Although any user ID can be used to run a single-system DUCC, creating a &#8220;ducc&#8221; userid is recommended to enable the later
use of cgroups as well as running processes with the credentials of the submitting user.
<!--l. 178--><p class="noindent" >If multiple nodes are going to be added later, the ducc runtime tree should be installed on a shared filesystem so that it can
be mounted on the additional nodes.
<!--l. 181--><p class="noindent" >Verification submits a very simple UIMA pipeline for execution under DUCC. Once this is shown to be working, one may
proceed installing additional features.
<!--l. 185--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-8000"></a>Minimal Hardware Requirements for Single System Installation</h3>
     <ul class="itemize1">
     <li class="itemize">One Intel-based or IBM Power-based system (Big or Little Endian). (More systems may be added later.)
     </li>
     <li class="itemize">8GB of memory. 16GB or more is preferable for developing and testing applications beyond the non-trivial.
                                                                                                
                                                                                                
     </li>
     <li class="itemize">1GB disk space to hold the DUCC runtime, system logs, and job logs. More is usually needed for larger
     installations.</li></ul>
<!--l. 196--><p class="noindent" >Please note: DUCC is intended for scaling out memory-intensive UIMA applications over computing clusters consisting of
multiple nodes with large (16GB-256GB or more) memory. The minimal requirements are for initial test and evaluation
purposes, but will not be sufficient to run actual workloads.
<!--l. 201--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-9000"></a>Single System Installation</h3>
<a 
 id="x1-9000doc"></a>
<!--l. 203--><p class="noindent" >
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-9002x1">Expand the distribution file with the appropriate umask:
                                                                                                
                                                                                                
     <div class="verbatim" id="verbatim-4">
     (umask&#x00A0;022&#x00A0;&amp;&amp;&#x00A0;tar&#x00A0;-zxf&#x00A0;&#x003C;distribution.file&#x003E;)</div>
     <!--l. 207--><p class="nopar" >
     <!--l. 209--><p class="noindent" >This creates a directory with a name of the form &#8220;apache-uima-ducc-[version]&#8221;.
     <!--l. 211--><p class="noindent" >This directory contains the full DUCC runtime which you may use &#8220;in place&#8221; but it is highly recommended
     that you move it into a standard location on a shared filesystem; for example, under ducc&#8217;s HOME
     directory:
                                                                                                
                                                                                                
     <div class="verbatim" id="verbatim-5">
     mv&#x00A0;apache-uima-ducc-[version]&#x00A0;/home/ducc/ducc_runtime</div>
     <!--l. 216--><p class="nopar" >
     <!--l. 218--><p class="noindent" >We refer to this directory, regardless of its location, as $DUCC_HOME. For simplicity, some of the examples in this
     document assume it has been moved to /home/ducc/ducc_runtime.
     </li>
     <li 
  class="enumerate" id="x1-9004x2">Change directories into the admin sub-directory of $DUCC_HOME:
                                                                                                
                                                                                                
     <div class="verbatim" id="verbatim-6">
     cd&#x00A0;$DUCC_HOME/admin</div>
     <!--l. 224--><p class="nopar" >
     </li>
     <li 
  class="enumerate" id="x1-9006x3">Run the post-installation script:
                                                                                                
                                                                                                
     <div class="verbatim" id="verbatim-7">
     ./ducc_post_install</div>
     <!--l. 229--><p class="nopar" > If this script fails, correct any problems it identifies and run it again.
     <!--l. 232--><p class="noindent" >Note that <span 
class="cmti-10">ducc</span><span 
class="cmti-10">_post</span><span 
class="cmti-10">_install </span>initializes various default parameters which may be changed later by the system
     administrator. Therefore it usually should be run only during this first installation step.
     </li>
     <li 
  class="enumerate" id="x1-9008x4">If you wish to install jconsole support from the webserver, make sure Apache Ant is installed, and run
                                                                                                
                                                                                                
     <div class="verbatim" id="verbatim-8">
     ./sign_jconsole_jar</div>
     <!--l. 240--><p class="nopar" > This step may be run at any time if you wish to defer it.
     </li></ol>
<!--l. 245--><p class="noindent" >That&#8217;s it, DUCC is installed and ready to run. (If errors were displayed during ducc_post_install they must be corrected
before continuing.)
<!--l. 248--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-10000"></a>Initial System Verification</h3>
<!--l. 250--><p class="noindent" >Here we verify the system configuration, start DUCC, run a test Job, and then shutdown DUCC.
<!--l. 252--><p class="noindent" >To run the verification, issue these commands.
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-10002x1">cd $DUCC_HOME/admin
     </li>
     <li 
  class="enumerate" id="x1-10004x2">./check_ducc
     <!--l. 257--><p class="noindent" >Examine the output of check_ducc. If any errors are shown, correct the errors and rerun check_ducc until there
     are no errors.
     </li>
     <li 
  class="enumerate" id="x1-10006x3">Finally, start ducc: ./start_ducc</li></ol>
<!--l. 262--><p class="noindent" >Start_ducc will first perform a number of consistency checks. It then starts the ActiveMQ broker, the DUCC control
processes, and a single DUCC agent on the local node.
<!--l. 266--><p class="noindent" >You will see some startup messages similar to the following:
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-9">
ENV:&#x00A0;Java&#x00A0;is&#x00A0;configured&#x00A0;as:&#x00A0;/share/jdk1.7/bin/java
&#x00A0;<br />ENV:&#x00A0;java&#x00A0;full&#x00A0;version&#x00A0;"1.7.0_40-b43"
&#x00A0;<br />ENV:&#x00A0;Threading&#x00A0;enabled:&#x00A0;True
&#x00A0;<br />MEM:&#x00A0;memory&#x00A0;is&#x00A0;15&#x00A0;gB
&#x00A0;<br />ENV:&#x00A0;system&#x00A0;is&#x00A0;Linux
&#x00A0;<br />allnodes&#x00A0;/home/ducc/ducc_runtime/resources/ducc.nodes
&#x00A0;<br />Class&#x00A0;definition&#x00A0;file&#x00A0;is&#x00A0;ducc.classes
&#x00A0;<br />OK:&#x00A0;Class&#x00A0;and&#x00A0;node&#x00A0;definitions&#x00A0;validated.
&#x00A0;<br />OK:&#x00A0;Class&#x00A0;configuration&#x00A0;checked
&#x00A0;<br />Starting&#x00A0;broker&#x00A0;on&#x00A0;ducchead.biz.org
&#x00A0;<br />Waiting&#x00A0;for&#x00A0;broker&#x00A0;.....&#x00A0;0
&#x00A0;<br />Waiting&#x00A0;for&#x00A0;broker&#x00A0;.....&#x00A0;1
&#x00A0;<br />ActiveMQ&#x00A0;broker&#x00A0;is&#x00A0;found&#x00A0;on&#x00A0;configured&#x00A0;host&#x00A0;and&#x00A0;port:&#x00A0;ducchead.biz.org:61616
&#x00A0;<br />Starting&#x00A0;1&#x00A0;agents
&#x00A0;<br />**********&#x00A0;Starting&#x00A0;agents&#x00A0;from&#x00A0;file&#x00A0;/home/ducc/ducc_runtime/resources/ducc.nodes
&#x00A0;<br />Starting&#x00A0;warm
&#x00A0;<br />Waiting&#x00A0;for&#x00A0;Completion
&#x00A0;<br />ducchead.biz.org&#x00A0;Starting&#x00A0;rm
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;PID&#x00A0;14198
&#x00A0;<br />ducchead.biz.org&#x00A0;Starting&#x00A0;pm
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;PID&#x00A0;14223
&#x00A0;<br />ducchead.biz.org&#x00A0;Starting&#x00A0;sm
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;PID&#x00A0;14248
&#x00A0;<br />ducchead.biz.org&#x00A0;Starting&#x00A0;or
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;PID&#x00A0;14275
&#x00A0;<br />ducchead.biz.org&#x00A0;Starting&#x00A0;ws
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;PID&#x00A0;14300
&#x00A0;<br />ducchead.biz.org
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;ducc_ling&#x00A0;OK
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;DUCC&#x00A0;Agent&#x00A0;started&#x00A0;PID&#x00A0;14325
&#x00A0;<br />All&#x00A0;threads&#x00A0;returned</div>
<!--l. 300--><p class="nopar" >
<!--l. 302--><p class="noindent" >Now open a browser and go to the DUCC webserver&#8217;s url, http://<span 
class="cmmi-10">&#x003C;</span>hostname<span 
class="cmmi-10">&#x003E;</span>:42133 where <span 
class="cmmi-10">&#x003C;</span>hostname<span 
class="cmmi-10">&#x003E; </span>is the name of the
host where DUCC is started. Navigate to the Reservations page via the links in the upper-left corner. You should see the
DUCC JobDriver reservation in state WaitingForResources. In a few minutes this should change to Assigned. Now jobs can
be submitted.
<!--l. 308--><p class="noindent" >To submit a job,
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-10008x1">$DUCC_HOME/bin/ducc_submit &#8211;specification $DUCC_HOME/examples/simple/1.job</li></ol>
<!--l. 313--><p class="noindent" >Open the browser in the DUCC jobs page. You should see the job progress through a series of transitions: Waiting For
Driver, Waiting For Services, Waiting For Resources, Initializing, and finally, Running. You&#8217;ll see the number of work items
submitted (15) and the number of work items completed grow from 0 to 15. Finally, the job will move into Completing and
then Completed..
<!--l. 319--><p class="noindent" >Since this example does not specify a log directory DUCC will create a log directory in your HOME directory
under
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-10">
$HOME/ducc/logs/job-id</div>
<!--l. 322--><p class="nopar" >
<!--l. 324--><p class="noindent" >In this directory, you will find a log for the sample job&#8217;s JobDriver (JD), JobProcess (JP), and a number of other files
relating to the job.
<!--l. 327--><p class="noindent" >This is a good time to explore the DUCC web pages. Notice that the job id is a link to a set of pages with details about the
execution of the job.
<!--l. 330--><p class="noindent" >Notice also, in the upper-right corner is a link to the full DUCC documentation, the &#8220;DuccBook&#8221;.
<!--l. 332--><p class="noindent" >Finally, stop DUCC:
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-10010x1">cd $DUCC_HOME/admin
     </li>
     <li 
  class="enumerate" id="x1-10012x2">./stop_ducc -a</li></ol>
<!--l. 339--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-11000"></a>Add additional nodes to the DUCC cluster</h3>
<!--l. 340--><p class="noindent" >Additional nodes must meet all <span 
class="cmti-10">prerequisites </span>(listed above).
<!--l. 347--><p class="noindent" >$DUCC_HOME must be on a shared filesystem and mounted at the same location on all DUCC nodes.
<!--l. 350--><p class="noindent" >If user&#8217;s home directories are on local filesystems the location for user logfiles should be specified to be on a shared
filesystem.
<!--l. 353--><p class="noindent" >Addional nodes are normally added to a worker node group. Note that the DUCC head node does not have to be a worker
node. In addition, the webserver node can be separate from the DUCC head node (see webserver configuration options in
ducc.properties).
<!--l. 358--><p class="noindent" >For worker nodes DUCC needs to know what node group each machine belongs to, and what nodes need an Agent process to
be started on.
<!--l. 361--><p class="noindent" >The configuration shipped with DUCC have all nodes in the same &#8221;default&#8221; node pool. Worker nodes are listed in the
file
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-11">
$DUCC_HOME/resources/ducc.nodes.</div>
<!--l. 365--><p class="nopar" >
<!--l. 367--><p class="noindent" >During initial installation, this file was initialized with the node DUCC is installed on. Additional nodes may be added to the
file using a text editor to increase the size of the DUCC cluster.
<!--l. 372--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-12000"></a>Ducc_ling Configuration - Running with credentials of submitting user</h3>
<a 
 id="x1-12000doc"></a>
<!--l. 375--><p class="noindent" >DUCC launches user processes through ducc_ling, a small native C application. By default the resultant process runs with
the credentials of the user ID of the DUCC application. It is possible for multiple users to submit work to DUCC in this
configuration, but it requires that the user ID running DUCC has write access to all directories to which the user process
outputs data. By configuring the ducc user ID and ducc_ling correctly, work submitted by all users will run with their own
credentials.
<!--l. 383--><p class="noindent" >Before proceeding with this step, please note:
     <ul class="itemize1">
     <li class="itemize">The sequence operations consisting of <span 
class="cmti-10">chown </span>and <span 
class="cmti-10">chmod </span>MUST be performed in the exact order given below.
     If the <span 
class="cmti-10">chmod </span>operation is performed before the <span 
class="cmti-10">chown </span>operation, Linux will regress the permissions granted by
     <span 
class="cmti-10">chmod </span>and ducc_ling will be incorrectly installed.</li></ul>
<!--l. 391--><p class="noindent" >ducc_ling is designed to be a setuid-root program whose function is to run user processes with the identity of the submitting
user. This must be installed correctly; incorrect installation can prevent jobs from running as their submitters, and in the
worse case, can introduce security problems into the system.
<!--l. 395--><p class="noindent" >ducc_ling can either be installed on a local disk on every system in the DUCC cluster, or on a shared-filesystem that does not
suppress setuid-root permissions on client nodes. The path to ducc_ling must be the same on each DUCC node. The default
path configuration is $DUCC_HOME/admin/$<span 
class="cmsy-10">{</span>os.arch<span 
class="cmsy-10">}</span>/ in order to handle clusters with mixed OS platforms.
$<span 
class="cmsy-10">{</span>os.arch<span 
class="cmsy-10">} </span>is the architecture specific value of the Java system property with that name; examples are amd64 and
ppc64.
<!--l. 403--><p class="noindent" >The steps are: build ducc_ling for each node architecture to be added to the cluster, copy ducc_ling to the
desired location, and then configure ducc_ling to give user ducc the ability to spawn a process as a different
user.
<!--l. 407--><p class="noindent" >In the example below ducc_ling is left under $DUCC_HOME, where it is built.
<!--l. 409--><p class="noindent" >As user <span 
class="cmti-10">ducc</span>, build ducc_ling for necessary architectures (this is done automatically for the DUCC head machine by the
ducc_post_install script). For each unique OS platform:
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-12002x1">cd $DUCC_HOME/admin
     </li>
     <li 
  class="enumerate" id="x1-12004x2">./build_duccling</li></ol>
<!--l. 417--><p class="noindent" >Then, as user <span 
class="cmti-10">root </span>on the shared filesystem, <span 
class="cmti-10">cd </span><span 
class="cmsl-10">$</span><span 
class="cmti-10">DUCC</span><span 
class="cmti-10">_HOME/admin</span>, and for each unique OS architecture:
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-12006x1">chown ducc.ducc $<span 
class="cmsy-10">{</span>os.arch<span 
class="cmsy-10">}</span><br 
class="newline" />(set directory ownership to be user ducc, group ducc)
                                                                                                
                                                                                                
     </li>
     <li 
  class="enumerate" id="x1-12008x2">chmod 700 $<span 
class="cmsy-10">{</span>os.arch<span 
class="cmsy-10">}</span><br 
class="newline" />(only user ducc can read contents of directory)
     </li>
     <li 
  class="enumerate" id="x1-12010x3">chown root.ducc $<span 
class="cmsy-10">{</span>os.arch<span 
class="cmsy-10">}</span>/ducc_ling <br 
class="newline" />(make root owner of ducc_ling, and let users in group ducc access it)
     </li>
     <li 
  class="enumerate" id="x1-12012x4">chmod 4750 $<span 
class="cmsy-10">{</span>os.arch<span 
class="cmsy-10">}</span>/ducc_ling <br 
class="newline" />(ducc_ling runs as user root when started by users in group ducc)</li></ol>
<!--l. 429--><p class="noindent" >If these steps are correctly performed, ONLY user <span 
class="cmti-10">ducc </span>may use the ducc_ling program in a privileged way. ducc_ling
contains checks to prevent even user <span 
class="cmti-10">root </span>from using it for privileged operations.
<!--l. 433--><p class="noindent" >If a different location is chosen for ducc_ling the new path needs to be specified for ducc.agent.launcher.ducc_spawn_path in
$DUCC_HOME/resources/site.ducc.properties. For more information see <span 
class="cmti-10">&#8220;Properties merging&#8221; </span>in the DuccBook.
<!--l. 443--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-13000"></a>CGroups Installation and Configuration</h3>
<!--l. 445--><p class="noindent" >
     <dl class="description"><dt class="description">
<span 
class="cmbx-10">Note:</span> </dt><dd 
class="description">A key feature of DUCC is to run user processes in CGroups in order to guarantee each process always has
     the amount of RAM requested. RAM allocated to the managed process (and any child processes) that exceed
     requested DUCC memory size will be forced into swap space. Without CGroups a process that exceeds its
     requested memory size by N% is killed (default N=5 in ducc.properties), and memory use by child processes is
     ignored.
     <!--l. 452--><p class="noindent" >DUCC&#8217;s CGroup configuration also allocates CPU resources to managed processes based on relative memory
     size. A process with 50% of a machine&#8217;s RAM will be guaranteed at least 50% of the machine&#8217;s CPU resources
     as well.</dd></dl>
<!--l. 457--><p class="noindent" >The steps in this task must be done as user root and user ducc.
<!--l. 459--><p class="noindent" >To install and configure CGroups for DUCC:
     <ol  class="enumerate1" >
     <li 
  class="enumerate" id="x1-13002x1">Install the appropriate libcgroup package at level 0.37 or above (see <span 
class="cmti-10">Installation Prerequisites</span>).
     </li>
     <li 
  class="enumerate" id="x1-13004x2">Configure /etc/cgconfig.conf as follows:
                                                                                                
                                                                                                
     <div class="verbatim" id="verbatim-12">
     &#x00A0;&#x00A0;&#x00A0;#&#x00A0;Mount&#x00A0;cgroups&#x00A0;for&#x00A0;older&#x00A0;OS&#x00A0;(e.g.&#x00A0;RHEL&#x00A0;v6)
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;#&#x00A0;For&#x00A0;newer&#x00A0;OS,&#x00A0;remove&#x00A0;entire&#x00A0;mount&#x00A0;block
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;mount&#x00A0;{
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cpuset&#x00A0;=&#x00A0;/cgroup/cpuset;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cpu&#x00A0;=&#x00A0;/cgroup/cpu;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;cpuacct&#x00A0;=&#x00A0;/cgroup/cpuacct;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;memory&#x00A0;=&#x00A0;/cgroup/memory;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;devices&#x00A0;=&#x00A0;/cgroup/devices;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;freezer&#x00A0;=&#x00A0;/cgroup/freezer;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;net_cls&#x00A0;=&#x00A0;/cgroup/net_cls;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;blkio&#x00A0;=&#x00A0;/cgroup/blkio;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;}
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;#&#x00A0;Define&#x00A0;cgroup&#x00A0;ducc&#x00A0;and&#x00A0;setup&#x00A0;permissions
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;group&#x00A0;ducc&#x00A0;{
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;perm&#x00A0;{
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;task&#x00A0;{
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;uid&#x00A0;=&#x00A0;ducc;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;admin&#x00A0;{
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;uid&#x00A0;=&#x00A0;ducc;
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;}
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;memory&#x00A0;{}
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;cpu{}
     &#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;}</div>
     <!--l. 495--><p class="nopar" >
     </li>
     <li 
  class="enumerate" id="x1-13006x3">Start the cgconfig service:
                                                                                                
                                                                                                
     <div class="verbatim" id="verbatim-13">
     &#x00A0;&#x00A0;&#x00A0;service&#x00A0;cgconfig&#x00A0;start</div>
     <!--l. 499--><p class="nopar" >
     </li>
     <li 
  class="enumerate" id="x1-13008x4">Verify cgconfig service is running by the existence of directory:
                                                                                                
                                                                                                
     <div class="verbatim" id="verbatim-14">
     &#x00A0;&#x00A0;&#x00A0;/cgroups/ducc</div>
     <!--l. 504--><p class="nopar" >
     </li>
     <li 
  class="enumerate" id="x1-13010x5">Configure the cgconfig service to start on reboot:
                                                                                                
                                                                                                
     <div class="verbatim" id="verbatim-15">
     &#x00A0;&#x00A0;&#x00A0;chkconfig&#x00A0;cgconfig&#x00A0;on</div>
     <!--l. 509--><p class="nopar" ></li></ol>
<!--l. 512--><p class="noindent" ><span 
class="cmti-10">Note: </span>if CGroups is not installed on a machine the DUCC Agent will detect this and not attempt to use the feature. CGroups
can also be disabled for all machines (see <span 
class="cmti-10">ducc.agent.launcher.cgroups.enable </span>in ducc.properties, described in the DuccBook.)
or it can be disabled for individual machines (see <span 
class="cmti-10">ducc.agent.exclusion.file </span>in ducc.properties, described in the
DuccBook.)
<!--l. 529--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-14000"></a>Full DUCC Verification</h3>
<!--l. 531--><p class="noindent" >This is identical to initial verification, with the one difference that the job &#8220;1.job&#8221; should be submitted as any user other
than ducc. Watch the webserver and check that the job executes under the correct identity. Once this completes, DUCC is
installed and verified.
<!--l. 535--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-15000"></a>Enable DUCC webserver login</h3>
<!--l. 537--><p class="noindent" >This step is optional. As shipped, the webserver is disabled for logins. This can be seen by hovering over the Login text
located in the upper right of most webserver pages:
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-16">
System&#x00A0;is&#x00A0;configured&#x00A0;to&#x00A0;disallow&#x00A0;logins</div>
<!--l. 542--><p class="nopar" >
<!--l. 544--><p class="noindent" >To enable logins, a Java-based authenticator must be plugged-in and the login feature must be enabled in the ducc.properties
file by the DUCC administrator. Also, ducc_ling should be properly deployed (see Ducc_ling Installation section
above).
<!--l. 549--><p class="noindent" >A beta version of a Linux-based authentication plug-in is shipped with DUCC. It can be found in the source
tree:
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-17">
org.apache.uima.ducc.ws.authentication.LinuxAuthenticationManager</div>
<!--l. 553--><p class="nopar" >
<!--l. 555--><p class="noindent" >The Linux-based authentication plug-in will attempt to validate webserver login requests by appealing to the host OS. The
user who wishes to login provides a userid and password to the webserver via https, which in-turn are handed-off to the OS
for a success/failure reply.
<!--l. 560--><p class="noindent" >To have the webserver employ the beta Linux-based authentication plug-in, the DUCC administrator should perform the
following as user ducc:
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-18">
1.&#x00A0;edit&#x00A0;ducc.properties
&#x00A0;<br />2.&#x00A0;locate:&#x00A0;ducc.ws.login.enabled&#x00A0;=&#x00A0;false
&#x00A0;<br />3.&#x00A0;modify:&#x00A0;ducc.ws.login.enabled&#x00A0;=&#x00A0;true
&#x00A0;<br />4.&#x00A0;save</div>
<!--l. 567--><p class="nopar" >
<!--l. 569--><p class="noindent" >Note: The beta Linux-based authentication plug-in has limited testing. In particular, it was tested using:
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-19">
Red&#x00A0;Hat&#x00A0;Enterprise&#x00A0;Linux&#x00A0;Workstation&#x00A0;release&#x00A0;6.4&#x00A0;(Santiago)</div>
<!--l. 573--><p class="nopar" >
<!--l. 575--><p class="noindent" >Alternatively, you can provide your own authentication plug-in. To do so:
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-20">
1.&#x00A0;author&#x00A0;a&#x00A0;Java&#x00A0;class&#x00A0;that&#x00A0;implements
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;org.apache.uima.ducc.common.authentication.IAuthenticationManager
&#x00A0;<br />2.&#x00A0;create&#x00A0;a&#x00A0;jar&#x00A0;file&#x00A0;comprising&#x00A0;your&#x00A0;authentication&#x00A0;class
&#x00A0;<br />3.&#x00A0;put&#x00A0;the&#x00A0;jar&#x00A0;file&#x00A0;in&#x00A0;a&#x00A0;location&#x00A0;accessible&#x00A0;by&#x00A0;the&#x00A0;DUCC&#x00A0;webserver,&#x00A0;such&#x00A0;as
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;&#x00A0;$DUCC_HOME/lib/authentication
&#x00A0;<br />4.&#x00A0;put&#x00A0;any&#x00A0;authentication&#x00A0;dependency&#x00A0;jar&#x00A0;files&#x00A0;there&#x00A0;as&#x00A0;well
&#x00A0;<br />5.&#x00A0;edit&#x00A0;ducc.properties
&#x00A0;<br />6.&#x00A0;add&#x00A0;the&#x00A0;following:
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;ducc.local.jars&#x00A0;=&#x00A0;authentication/*
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;ducc.authentication.implementer=&#x003C;your.authenticator.class.Name&#x003E;
&#x00A0;<br />7.&#x00A0;locate:&#x00A0;ducc.ws.login.enabled&#x00A0;=&#x00A0;false
&#x00A0;<br />8.&#x00A0;modify:&#x00A0;ducc.ws.login.enabled&#x00A0;=&#x00A0;true
&#x00A0;<br />9.&#x00A0;save</div>
<!--l. 590--><p class="nopar" >
<!--l. 593--><p class="noindent" >
<h3 class="sectionHead"><a 
 id="x1-16000"></a>DUCC daemons monitoring and notification</h3>
                                                                                                
                                                                                                
<div class="verbatim" id="verbatim-21">
&#x00A0;<br />$DUCC_HOME/bin/ducc_watcher&#x00A0;is&#x00A0;a&#x00A0;Python&#x00A0;script&#x00A0;that,&#x00A0;when&#x00A0;run,&#x00A0;contacts&#x00A0;the
&#x00A0;<br />DUCC&#x00A0;Web&#x00A0;Server&#x00A0;to&#x00A0;fetch&#x00A0;data&#x00A0;and&#x00A0;determine&#x00A0;the&#x00A0;status&#x00A0;of&#x00A0;the&#x00A0;critical&#x00A0;head&#x00A0;node&#x00A0;daemons.
&#x00A0;<br />It&#x00A0;can&#x00A0;be&#x00A0;run&#x00A0;as&#x00A0;a&#x00A0;cron&#x00A0;job&#x00A0;to&#x00A0;detect&#x00A0;down&#x00A0;daemons&#x00A0;and&#x00A0;send&#x00A0;email&#x00A0;notifications
&#x00A0;<br />to&#x00A0;a&#x00A0;list&#x00A0;of&#x00A0;receipients&#x00A0;specified&#x00A0;via&#x00A0;command&#x00A0;invocation&#x00A0;option.
&#x00A0;<br />
&#x00A0;<br />Use&#x00A0;the&#x00A0;--help&#x00A0;options&#x00A0;for&#x00A0;details.
&#x00A0;<br />
&#x00A0;<br />Purpose:&#x00A0;send&#x00A0;e-mail&#x00A0;when&#x00A0;a&#x00A0;DUCC&#x00A0;daemon&#x00A0;state&#x00A0;changes&#x00A0;to&#x00A0;not&#x00A0;up
&#x00A0;<br />
&#x00A0;<br />Files&#x00A0;created&#x00A0;by&#x00A0;script:
&#x00A0;<br />&#x00A0;-&#x00A0;/tmp/&#x003C;user&#x003E;/ducc_watcher.state
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;+&#x00A0;comprises&#x00A0;the&#x00A0;last&#x00A0;recorded&#x00A0;state&#x00A0;of&#x00A0;DUCC&#x00A0;daemons
&#x00A0;<br />
&#x00A0;<br />&#x00A0;-&#x00A0;/tmp/&#x003C;user&#x003E;/ducc_watcher.log
&#x00A0;<br />&#x00A0;&#x00A0;&#x00A0;+&#x00A0;comprises&#x00A0;a&#x00A0;log&#x00A0;produced&#x00A0;by&#x00A0;the&#x00A0;script
&#x00A0;<br /></div>
<!--l. 613--><p class="nopar" >
 
</body></html> 

                                                                                                


